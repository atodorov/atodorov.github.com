<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[atodorov.org - you can logoff, but you can never leave]]></title>
  <link href="http://atodorov.org/atom.xml" rel="self"/>
  <link href="http://atodorov.org/"/>
  <updated>2014-02-28T15:06:50+02:00</updated>
  <id>http://atodorov.org/</id>
  <author>
    <name><![CDATA[Alexander Todorov]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Call to Action: Improving Overall Test Coverage in Fedora]]></title>
    <link href="http://atodorov.org/blog/2014/02/28/action-improving-test-coverage-in-fedora/"/>
    <updated>2014-02-28T14:46:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/02/28/action-improving-test-coverage-in-fedora</id>
    <content type="html"><![CDATA[<p>Around Christmas 2013
<a href="http://atodorov.org/blog/2013/12/24/upstream-test-suite-status-of-fedora-20/">I said</a></p>

<blockquote><p>&#8230; it looks like on average 30% of the packages execute their test suites at<br/>build time in the %check section and less than 35% have test suites at all!<br/>Thereâ€™s definitely room for improvement and I plan to focus on this during 2014!</p></blockquote>


<p>I&#8217;ve recently started working on this goal by first identifying potential offending
packages and discussing the idea on Fedora&#8217;s
<a href="https://lists.fedoraproject.org/pipermail/devel/2014-February/thread.html">devel</a>,
<a href="https://lists.fedoraproject.org/pipermail/packaging/2014-February/thread.html">packaging</a>
and <a href="https://lists.fedoraproject.org/pipermail/test/2014-February/thread.html">test</a>
mailing lists.</p>

<p>May I present you nearly <strong>2000 packages</strong> which need your love:</p>

<ul>
<li><a href="https://fedoraproject.org/wiki/QA/Testing_in_check">wiki/QA/Testing_in_check</a></li>
<li><a href="https://fedoraproject.org/wiki/QA/Missing_upstream_test_suites">wiki/QA/Missing_upstream_test_suites</a></li>
</ul>


<p>The intent for these pages is to serve as a source of working material for Fedora
volunteers.</p>

<h2>How Can I Help</h2>

<ul>
<li>Join upstream and create a test suite for a package you find interesting;</li>
<li>Provide patches - <a href="https://lists.fedoraproject.org/pipermail/devel/2014-February/196035.html">first patch</a>
came in less than 30 minutes of initial announcement :);</li>
<li>Review packages in the wiki and help identify false negatives;</li>
<li>Forward to people who may be interested to work on these items;</li>
<li>Share and promote in your local open source and developer communities;</li>
</ul>


<h2>Important</h2>

<p>If you would like to gain some open source practice and QA experience I will
happily provide mentorship and general help so you can start working on Fedora.
Just ping me!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mocking Django AUTH_PROFILE_MODULE without a Database]]></title>
    <link href="http://atodorov.org/blog/2014/02/27/mocking-django-auth-profile-module-without-database/"/>
    <updated>2014-02-27T16:18:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/02/27/mocking-django-auth-profile-module-without-database</id>
    <content type="html"><![CDATA[<p><a href="http://www.dif.io">Difio</a> is a Django based service which uses a profile
model to provide site-specific, per-user information.
In the process of <a href="https://github.com/difio/difio">open sourcing Difio</a> its core
functionality becomes available as a Django app. The trouble is that the
<code>UserProfile</code> model contains site-specific and proprietary data which doesn&#8217;t
make sense to the public nor I want to release it.</p>

<p>The solution is to have a <code>MockProfile</code> model and work with
that by default while <a href="http://www.dif.io">www.dif.io</a> and other implementations
override it as needed.
<strong>How do you do that without creating useless table and records in the database
but still have the profiles created automatically for every user?</strong></p>

<p>It turns out the solution is quite simple. See my comments inside the code below.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">AbstractMockProfile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">        Any AUTH_PROFILE_MODULE model should inherit this</span>
</span><span class='line'><span class="sd">        and override the default methods.</span>
</span><span class='line'>
</span><span class='line'><span class="sd">        This model provides the FK to User!</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">is_subscribed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot; Is this user subscribed for our newsletter? &quot;&quot;&quot;</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">True</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="c"># no DB table created b/c model is abstract</span>
</span><span class='line'>        <span class="n">abstract</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MockProfileManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">        This manager creates MockProfile&#39;s on the fly without</span>
</span><span class='line'><span class="sd">        touching the database. It is needed by User.get_profile()</span>
</span><span class='line'><span class="sd">        b/c we can&#39;t have an abstract base class as AUTH_PROFILE_MODULE.</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">using</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot; It doesn&#39;t matter which database we use! &quot;&quot;&quot;</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">            User.get_profile() calls .using(...).get(user_id__exact=X)</span>
</span><span class='line'><span class="sd">            so we instrument it here to return a MockProfile() with</span>
</span><span class='line'><span class="sd">            user_id=X parameter. Anything else may break!!!</span>
</span><span class='line'><span class="sd">        &quot;&quot;&quot;</span>
</span><span class='line'>        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span class='line'>            <span class="n">params</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;__&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># this creates an object in memory. To save it to DB</span>
</span><span class='line'>        <span class="c"># call obj.save() which we DON&#39;T do anyway!</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">MockProfile</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MockProfile</span><span class="p">(</span><span class="n">AbstractMockProfile</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">        In-memory (fake) profile class used by default for</span>
</span><span class='line'><span class="sd">        the AUTH_PROFILE_MODULE setting.</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>    <span class="n">objects</span> <span class="o">=</span> <span class="n">MockProfileManager</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="c"># DB table is NOT created automatically</span>
</span><span class='line'>        <span class="c"># when managed = False</span>
</span><span class='line'>        <span class="n">managed</span> <span class="o">=</span> <span class="bp">False</span>
</span></code></pre></td></tr></table></div></figure>


<p>In Difio core the user profile is always used like this</p>

<pre><code>profile = request.user.get_profile()
if profile.is_subscribed():
    pass
</code></pre>

<p>and by default</p>

<pre><code>AUTH_PROFILE_MODULE = "difio.MockProfile"
</code></pre>

<p>Voila!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Skip or Render Specific Blocks from Jinja2 Templates]]></title>
    <link href="http://atodorov.org/blog/2014/02/21/skip-or-render-specific-blocks-from-jinja2-templates/"/>
    <updated>2014-02-21T00:08:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/02/21/skip-or-render-specific-blocks-from-jinja2-templates</id>
    <content type="html"><![CDATA[<p>I wasn&#8217;t able to find detailed information on how to skip rendering
or only render specific blocks from Jinja2 templates so here&#8217;s my solution.
Hopefully you find it useful too.</p>

<p>With below template I want to be able to render <strong>only</strong> <em>kernel_options</em> block
as a single line and then render the rest of the template <strong>excluding</strong> <em>kernel_options</em>.</p>

<figure class='code'><figcaption><span>base.j2 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='jinja'><span class='line'><span class="cp">{%</span> <span class="k">block</span> <span class="nv">kernel_options</span> <span class="cp">%}</span><span class="x"></span>
</span><span class='line'><span class="x">console=tty0</span>
</span><span class='line'><span class="x">    </span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">debug</span> <span class="cp">%}</span><span class="x"></span>
</span><span class='line'><span class="x">        debug=1</span>
</span><span class='line'><span class="x">    </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</span><span class='line'><span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">kernel_options</span> <span class="cp">%}</span><span class="x"></span>
</span><span class='line'>
</span><span class='line'><span class="cp">{%</span> <span class="k">if</span> <span class="nv">OS_MAJOR</span> <span class="o">==</span> <span class="m">5</span> <span class="cp">%}</span><span class="x"></span>
</span><span class='line'><span class="x">key --skip</span>
</span><span class='line'><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
</span><span class='line'>
</span><span class='line'><span class="x">%packages</span>
</span><span class='line'><span class="x">@base</span>
</span><span class='line'><span class="cp">{%</span> <span class="k">if</span> <span class="nv">OS_MAJOR</span> <span class="o">&gt;</span> <span class="m">5</span> <span class="cp">%}</span><span class="x"></span>
</span><span class='line'><span class="x">%end</span>
</span><span class='line'><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>To render a particular block you have to use the low level Jinja API
<em><a href="http://jinja.pocoo.org/docs/api/#jinja2.Template.blocks">template.blocks</a></em>.
This will return a dict of block rendering functions which need a <em>Context</em> to work with.</p>

<p>The second part is trickier. To remove a block we have to create an extension
which will filter it out. The provided <em>SkipBlockExtension</em> class does
exactly this.</p>

<p>Last but not least - if you&#8217;d like to use both together you have to disable
caching in the <em>Environment</em> (so you get a fresh template every time), render
your blocks first, configure <em>env.skip_blocks</em> and render the entire template
without the specified blocks.</p>

<figure class='code'><figcaption><span>jinja2-render </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">jinja2.ext</span> <span class="kn">import</span> <span class="n">Extension</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FileSystemLoader</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">SkipBlockExtension</span><span class="p">(</span><span class="n">Extension</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">):</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">(</span><span class="n">SkipBlockExtension</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span>
</span><span class='line'>        <span class="n">environment</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">skip_blocks</span><span class="o">=</span><span class="p">[])</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">filter_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
</span><span class='line'>        <span class="n">block_level</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>        <span class="n">skip_level</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>        <span class="n">in_endblock</span> <span class="o">=</span> <span class="bp">False</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;block_begin&#39;</span><span class="p">):</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s">&#39;block&#39;</span><span class="p">):</span>
</span><span class='line'>                    <span class="n">block_level</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>                    <span class="k">if</span> <span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">look</span><span class="p">()</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">skip_blocks</span><span class="p">):</span>
</span><span class='line'>                        <span class="n">skip_level</span> <span class="o">=</span> <span class="n">block_level</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s">&#39;endblock&#39;</span> <span class="p">):</span>
</span><span class='line'>                <span class="n">in_endblock</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="n">skip_level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>                <span class="k">yield</span> <span class="n">token</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;block_end&#39;</span><span class="p">):</span>
</span><span class='line'>                <span class="k">if</span> <span class="n">in_endblock</span><span class="p">:</span>
</span><span class='line'>                    <span class="n">in_endblock</span> <span class="o">=</span> <span class="bp">False</span>
</span><span class='line'>                    <span class="n">block_level</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>                    <span class="k">if</span> <span class="n">skip_level</span> <span class="o">==</span> <span class="n">block_level</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
</span><span class='line'>                        <span class="n">skip_level</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;OS_MAJOR&#39;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;ARCH&#39;</span> <span class="p">:</span> <span class="s">&#39;x86_64&#39;</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">abs_path</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class='line'>    <span class="n">dir_name</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">abs_path</span><span class="p">)</span>
</span><span class='line'>    <span class="n">base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">abs_path</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
</span><span class='line'>                <span class="n">loader</span> <span class="o">=</span> <span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">dir_name</span><span class="p">),</span>
</span><span class='line'>                <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="n">SkipBlockExtension</span><span class="p">],</span>
</span><span class='line'>                <span class="n">cache_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c"># disable cache b/c we do 2 get_template()</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># first render only the block we want</span>
</span><span class='line'>    <span class="n">template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">base_name</span><span class="p">)</span>
</span><span class='line'>    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="s">&#39;kernel_options&#39;</span><span class="p">](</span><span class="n">template</span><span class="o">.</span><span class="n">new_context</span><span class="p">(</span><span class="n">context</span><span class="p">)):</span>
</span><span class='line'>        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;Boot Args:&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;---------------------------&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># now instruct SkipBlockExtension which blocks we don&#39;t want</span>
</span><span class='line'>    <span class="c"># and get a new instance of the template with these blocks removed</span>
</span><span class='line'>    <span class="n">env</span><span class="o">.</span><span class="n">skip_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;kernel_options&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">base_name</span><span class="p">)</span>
</span><span class='line'>    <span class="k">print</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;---------------------------&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above code results in the following output:</p>

<pre><code>$ ./jinja2-render ./base.j2 
Boot Args: console=tty0 debug=1 
---------------------------

key --skip

%packages
@base
---------------------------
</code></pre>

<p>Teaser: this is part of my effort to replace SNAKE with a client side
kickstart template engine for
<a href="http://atodorov.org/blog/2013/11/19/open-source-quality-assurance-infrastructure-for-fedora-qa/">Beaker</a>
so stay tuned!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[7 Years and 1400 Bugs Later as Red Hat QA]]></title>
    <link href="http://atodorov.org/blog/2014/02/19/7-years-1400-bugs-red-hat-qa/"/>
    <updated>2014-02-19T10:43:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/02/19/7-years-1400-bugs-red-hat-qa</id>
    <content type="html"><![CDATA[<p>Today I celebrate my 7th year working at Red Hat&#8217;s Quality Engineering department.
Here&#8217;s my story!</p>

<p><img src="http://atodorov.org/images/redhat_platform_qe.jpg" title="Platform QE" alt="Platform QE" /></p>

<p>On a cold winter Friday in 2007 I left my job as a software developer in Sofia,
packed my stuff together, purchased my <a href="http://amzn.to/1hlPuyr">first laptop</a> and
on Sunday jumped the train to Brno to join the Release Test Team at Red Hat.
Little did I know what it was all about. When I was offered the position
I was on a very noisy bus and had to pick between two positions. I didn&#8217;t quite understood
what were the options and just picked the second one.
Luckily everything turned out great and continues to this day.</p>

<p>I&#8217;m sharing my experience and highlighting some bugs which I&#8217;ve found.
Hopefully you will find this interesting and amusing. If you are a QA engineer
I urge you to take a look at <a href="http://red.ht/1gbHElQ">my public bug portfolio</a>,
dive into details, read the comments and learn as much as you can.</p>

<h2>What do I do exactly</h2>

<p>From all QE teams in Red Hat, Release Test Team is the first one and
last one to test a release. The team has both technical function and a more managerial one.
Our focus is on the core Red Hat Enterprise Linux product.
Unfortunately I can&#8217;t go into much details because this is not a public facing unit.
I will limit myself to <strong>public and/or non-sensitive information</strong>.</p>

<p>We are the first to test a new nightly build or a
snapshot of the upcoming RHEL release. If the tree is installable other teams take over
and do their magic. At the end when bits are published live we&#8217;re the last to
verify that content is published where it is expected to be. In short this is
covering the work of the release engineering team which is to build a product and
publish the contents for consumption.</p>

<p>The same principles apply to Fedora although the engagement here is less demanding.</p>

<p>Personally I have been and continue to be responsible for Red Hat Enterprise Linux 5
family of releases. It&#8217;s up to me to give the go ahead for further testing or request
a re-spin. This position
also has the power to block and delay the GA release if not happy with testing or
there is a considerable risk of failure until things are sorted out.</p>

<p>Like in other QA teams I create test plan documents, write test case scenarios,
implement test automation scripts (and sometimes tools), regularly execute said test
plans and test cases, find and report any new bugs and verify old ones are fixed.
Most importantly make sure RHEL installs and is usable for further testing :).</p>

<p>Sometimes I have to deal with capacity planning and as RHEL 5 installation
test lead I have to organize and manage the entire installation testing campaign
for that product.</p>

<p>My favorite testing technique is
<a href="https://en.wikipedia.org/wiki/Exploratory_testing">exploratory testing</a>.</p>

<h2>Stats and Numbers</h2>

<p>It is hard (if not impossible) to <a href="https://github.com/atodorov/qe-metrics">measure QA work</a>
with numbers alone but here are some interesting facts about my experience so far.</p>

<ul>
<li>Nearly 1400 bugs filed (1390 at the time of writing);</li>
<li>Reported bugs across 32 different products. Top 3 being RHEL 6, RHEL 5 and Fedora (1000+ bugs);</li>
<li>Top 3 components for reporting bugs against: anaconda, releng, kernel;</li>
<li>Nearly 100 bugs filed in my first year 2007;</li>
<li>The 3 most productive years being 2010, 2009, 2011 (800 + bugs);</li>
<li>Filed 200 bugs/year which is about 1 bug/day considering holidays;</li>
<li>35th top bug reporter (excluding robot accounts). I was in top 10 a few years back;</li>
</ul>


<p>Many of <a href="http://red.ht/1gbHElQ">the bugs I report</a> are private so if you&#8217;d like
to know more stats just ask me and I&#8217;ll see what I can do.</p>

<h2>2007</h2>

<p>My very first bug is <a href="https://bugzilla.redhat.com/show_bug.cgi?id=231860">RHBZ #231860</a>(private)
which is about the graphical update tool Pup which used to show the wrong number of available
updates.</p>

<p>Then I&#8217;ve played with adding <a href="https://fedorahosted.org/dogtail/">Dogtail</a> support to Anaconda.
While initially this was rejected (Fedora 6/7), it was <a href="https://fedoraproject.org/wiki/Anaconda/Features/Dogtail">implemented</a>
few years later (Fedora 9) and then removed once again during the big Anaconda rewrite.</p>

<p>I&#8217;ve spent my time working extensively on RHEL 5 battling with multi-lib issues, SELinux denials and
generally making the 5 family less rough. Because I was still on-boarding I generally worked
on everything I could get my hands on and also did some work on RHEL3-U9 (latest release
before EOL) and some RHEL4-U6 testing.</p>

<p>With ia64 on RHEL3 I found a corner case
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=240782">kernel bug</a> which flooded the serial
console with messages and caused a multi-CPU system to freeze.</p>

<h2>In 2008 Time went backwards</h2>

<p>My first bug in 2008 is <a href="https://bugzilla.redhat.com/show_bug.cgi?id=428280">RHBZ #428280</a>.
glibc introduced SHA-256/512 hashes for hashing passwords with crypt but that wasn&#8217;t documented.</p>

<p><strong>UPDATE 2014-02-21</strong>
While testing 5.1 to 5.2 updates I found
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=435475">RHBZ #435475</a> - a severe
<strong>performance degradation</strong> in the package installation process. Upgrades
took almost twice as much time to complete, rising <strong>from 4 hours to 7 hours</strong>
depending on hardware and package set. This was a tough one to test and verify.
<strong>END UPDATE</strong></p>

<p>While dogfooding the 5.2 beta in March I hit
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=437252">RHBZ #437252</a> - kernel: Timer ISR/0: Time went backwards.
To this date this is one of my favorite bugs with a great error message!</p>

<p>Removal of a hack in RPM led to file conflicts under <code>/usr/share/doc</code> in several packages:
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=448905">RHBZ #448905</a>,
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=448906">RHBZ #448906</a>,
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=448907">RHBZ #448907</a>,
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=448909">RHBZ #448909</a>,
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=448910">RHBZ #448910</a>,
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=448911">RHBZ #448911</a>
which is also the first time I happen to file several bugs in a row.</p>

<p>ia64 couldn&#8217;t boot with encrypted partitions -
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=464769">RHBZ #464769</a>,
RHEL 5 introduced support for ext4 - <a href="https://bugzilla.redhat.com/show_bug.cgi?id=465248">RHBZ #465248</a>
and I&#8217;ve hit a fontconfig issue during upgrades - <a href="https://bugzilla.redhat.com/show_bug.cgi?id=469190">RHBZ #469190</a>
which continued to resurface occasionally during the next 5 years.</p>

<p>This is the year when I took over responsibility for the general installation
testing of RHEL 5 from James Laska and will continue to do so until it reaches end-of-life!</p>

<p>I&#8217;ve also worked on RHEL 4, Fedora and even the OLPC project. On the testing side of things
I&#8217;ve participated in testing
<a href="https://fedoraproject.org/wiki/QA/TestPlans/Networking">Fedora networking on the XO</a>
hardware and worked on translation and general issues.</p>

<h2>2009 - here comes RHEL 6</h2>

<p>This year starts my 3 most productive years period.</p>

<p>The second bug reported this
year is <a href="https://bugzilla.redhat.com/show_bug.cgi?id=481338">RHBZ #481338</a> which
also mentions one of my hobbies - wrist watches. While browsing a particular
website Xorg CPU usage rose to 100%. I&#8217;ve seen a number of these through the years
and I&#8217;m still not sure if its Xorg or Firefox or both to blame. And I still see my
CPU usage go to 100% just like that and drain my battery. I&#8217;m open to suggestions how
to test and debug what&#8217;s going on as it doesn&#8217;t happen in a reproducible fashion.</p>

<p>I happened to work on RHEL 4, RHEL 5, Fedora and the upcoming RHEL 6 releases and
managed to file bugs in a row not once but twice.
I wish I was paid per bug reported back then :).</p>

<p>The first series was about empty debuginfo packages with both empty packages which
shouldn&#8217;t have existed at all
(e.g. <a href="https://bugzilla.redhat.com/show_bug.cgi?id=500628">redhat-release</a>)
and missing debuginfo information for binary packages
(e.g. <a href="https://bugzilla.redhat.com/show_bug.cgi?id=500612">nmap</a>).</p>

<p>The second series is around 100 bugs which had to do with the texinfo
documentation of packages when installed with &#8211;excludedocs. The first one
is <a href="https://bugzilla.redhat.com/show_bug.cgi?id=515909">RHBZ #515909</a> and the
last one <a href="https://bugzilla.redhat.com/show_bug.cgi?id=516014">RHBZ #516014</a>.
While this works great for bumping up your bug count it made lots of developers
unhappy and not all bugs were fixed. Still the use case is valid and these
were proper software errors. It is also the first time I&#8217;ve used a script to
file the bugs automatically and not by hand.</p>

<p>Near the end of the year I&#8217;ve started testing installation on new hardware
by the likes of Intel and AMD before they hit the market. I had the pleasure to work
with the latest chipsets and CPUs, even sometime pre-release versions and make sure
Red Hat Enterprise Linux installed and worked properly on them. I&#8217;ve stopped doing
this last year to free up time for other tasks.</p>

<h2>2010 - one bug a day keeps developers at bay :)</h2>

<p>My most productive year with 1+ bugs per day.</p>

<p>2010 starts with a bug about file conflicts (private one) and continues with the same
narrative throughout the year.
As a matter of fact I did a small experiment and found around <strong>50000</strong>
(you read that right, fifty thousand) potentially
conflicting files, mostly between multi-lib packages, which were being ignored by RPM
due to its multi-lib policies. However these were primarily man pages or documentation
and most of them didn&#8217;t get fixed. The proper fix would have been to introduce a
-docs sub-package and split these files from the actual binaries. Fortunately the world
migrated to 64bit only and this isn&#8217;t an issue anymore.</p>

<p>By that time RHEL 6 development was running at its peak capacity and there were Beta
versions available. Almost the entire year I&#8217;ve been working on internal RHEL 6 snapshots
and discovering the many new bugs introduced with tons of new features in the installer.
Some of the new features included better IPv6 support, dracut and KVM.</p>

<p>An interesting set of bugs from September are the rpmlint errors and warnings ones,
for example <a href="https://bugzilla.redhat.com/show_bug.cgi?id=634931">RHBZ #634931</a>. I just
run the most basic test tool against some packages. It generated lots of false negatives
but also revealed bugs which were fixed.</p>

<p>Although there were many bugs filed this year I don&#8217;t see any particularly interesting ones.
It&#8217;s been more like lots of work to improve the overall quality than exploring
edge cases and finding interesting failures. If you find a bug from this period that you
think is interesting I will comment on it.</p>

<h2>2011 - Your system may be seriously compromised</h2>

<p>This is the last year of my 3 year top cycle.</p>

<p>It starts with <a href="https://bugzilla.redhat.com/show_bug.cgi?id=666687">RHBZ #666687</a> -
a patch for my crappy printer-scanner-coffee maker which I&#8217;ve been carrying around
since <a href="https://bugzilla.redhat.com/show_bug.cgi?id=498228">2009</a> when I bought it.</p>

<p>I was still working primarily on RHEL 6 but helped test the latest RHEL 4 release
before it went end-of-life. The interesting thing about it was that unlike other
released RHEL4-U9 was not available on installation media but only as an update from
RHEL4-U8. This was a great experience which you happen to see
<a href="https://access.redhat.com/site/support/policy/updates/errata/">every 4 to 5 years</a> or so.</p>

<p>Btw I&#8217;ve also led the installation testing effort and RTT team through the last few
RHEL 4 releases but given the product was approaching EOL there weren&#8217;t many changes
and things went smoothly.</p>

<p>A minor side activity was me playing around with
<a href="http://atodorov.org/blog/2011/03/14/usb-multi-seat-on-red-hat-enterprise-linux-6/">USB Multi-seat</a>
and finding a few bugs here and there along the way.</p>

<p>Another interesting activity in 2011 was proof-reading the entire product documentation
before its release which I can now relate to the
<a href="http://atodorov.org/blog/2014/02/03/fosdem-2014-report-day-2-testing-and-automation/">Testing Documentation</a>
talk at FOSDEM 2014.</p>

<p>In 2011 I&#8217;ve started using the cloud and most notably Red Hat&#8217;s OpenShift PaaS service.
First internally as an early adopter and later externally after the product was announced
to the public. There are a few interesting bugs here but they are private and I&#8217;m not
at liberty to share although they&#8217;ve all been fixed since then.</p>

<p>An interesting bug with NUMA, Xen and ia64
(<a href="https://bugzilla.redhat.com/show_bug.cgi?id=696599">RHBZ #696599</a> - private) had
me and devel banging our heads against the wall until we figured out that on this
particular system the NUMA configuration was not suitable for running Xen virtualization.</p>

<p>Can you spot the problem here ?</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">try</span><span class="p">:</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">kickstartGui</span>
</span><span class='line'><span class="k">except</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span> <span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Could not open display because no X server is running.&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="k">print</span> <span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Try running &#39;system-config-kickstart --help&#39; for a list of options.&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Be honest and use the comments form to tell me what you&#8217;ve found. If you struggled
then see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=703085">RHBZ #703085</a> and come
back again to comment. I&#8217;d love to hear from you.</p>

<p>What do you do when you see an error message saying:
<strong>Your system may be seriously compromised! /usr/sbin/NetworkManager tried to load a kernel module.</strong>
This is the scariest error message I&#8217;ve ever seen. Luckily its just
SELinux overreacting, see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=704090">RHBZ #704090</a>.</p>

<h2>2012 is in the red zone</h2>

<p>While the number of reported bugs dropped significantly compared to previous
years this is the year when I&#8217;ve reported almost exclusively high priority and
urgent bugs, the first one being
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=771901">RHBZ #771901</a>.</p>

<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=799384">RHBZ #799384</a>(against Fedora)
is one of the rare cases when I was able to contribute
(although just by raising awareness) to localization and improved support for
Bulgarian and Cyrillic.
The other one case was <a href="http://atodorov.org/blog/2013/10/11/fedora-20-gnome-3-dot-10-test-day-post-mortem/">last year</a>.
Btw I find it strange that although
<a href="https://en.wikipedia.org/wiki/Cyrillic_script">Cyrillic was invented by Bulgarians</a>
we didn&#8217;t (or still don&#8217;t) have a native font co-maintainer.
Somebody please step up!</p>

<p>The red zone bugs continue to span till the end of the year across RHEL 5, 6 and
early cuts of RHEL 7 with a pinch of OpenShift and some internal and external test tools.</p>

<h2>In 2013 Bugzilla hit 1 million bugs</h2>

<p>The year starts with a very annoying and still not fixed bug against ABRT.
It&#8217;s very frustrating when the tool which is supposed to help you file bugs
doesn&#8217;t work properly, see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=903591">RHBZ #903591</a>.
It&#8217;s a known fact that
<a href="http://atodorov.org/2012/07/13/mission-impossible-abrt-bugzilla-plugin-on-rhel6/">ABRT has problems</a>
and for this scenario I may have a
<a href="http://atodorov.org/blog/2013/10/12/tip-installing-missing-debuginfo-packages-for-abrt/">tip</a> for you.</p>

<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=923416">RHBZ #923416</a> - another one of these
100% CPU bugs. As I said they happen from time to time and mostly go by unfixed or
partially fixed because of their nature. Btw as I&#8217;m writing this post and have
a few tabs open in Firefox it keeps using between 15% and 20% CPU and the CPU
temperature is over 90 degrees C. And all I&#8217;m doing is writing text in the console.
Help!</p>

<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=967229">RHBZ #967229</a> - a minor one but
reveals an important thing - your output (and input for that matter) methods may
be producing different results. Worth testing if your software supports more than one.</p>

<p>This year I did some odd jobs working on several of Red Hat&#8217;s layered products mainly
Developer Toolset. It wasn&#8217;t a tough job and was a refreshing break away from the mundane
installation testing.</p>

<p>While I stopped working actively on the various RHEL families which are under development
or still supported I happened to be one of top 10 bug reporters for high/urgent priority bugs
for RHEL 7. In appreciation Red Hat sent me lots of corporate gifts and the Platform QE hoodie
pictured at the top of the page. Many thanks!</p>

<p>In the summer Red Hat&#8217;s
<a href="http://atodorov.org/blog/2013/08/23/red-hats-bugzilla-hits-one-million-bugs/">Bugzilla hit One Million bugs</a>.
The closest I come to this milestone is
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=999941">RHBZ #999941</a>.</p>

<p>I finally managed to transfer most of my responsibilities to co-workers and joined
the Fedora QA team as a part-time contributor. I had some highs and lows with
<a href="http://atodorov.org/blog/2013/10/07/fedora-20-virtualization-and-gnome-test-days-at-init-lab-this-week/">Fedora test days in Sofia</a>
as well. Good thing is I scored another 15 bugs across the
<a href="http://atodorov.org/blog/2013/10/08/fedora-20-virtualization-test-day-post-mortem/">virtualization stack</a>
and <a href="http://atodorov.org/blog/2013/10/11/fedora-20-gnome-3-dot-10-test-day-post-mortem/">GNOME 3.10</a>.</p>

<p>The year wraps up with another series of identical bugs,
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1024729">RHBZ #1024729</a> and
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1025289">RHBZ #1025289</a> for example.
As it <a href="http://atodorov.org/blog/2013/12/24/upstream-test-suite-status-of-fedora-20/">turned out</a>
lots of packages don&#8217;t have any test suites at all and those
which do don&#8217;t always execute them automatically in %check. I&#8217;ve promised myself
to improve this but still haven&#8217;t had time to work on it. Hopefully by
March I will have something in the works.</p>

<h2>2014 - Fedora QA improvement</h2>

<p>Last two months I&#8217;ve been working on some internal projects and looking
a little bit into improving processes, test coverage and QA infrastructure -
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1064895">RHBZ #1064895</a>.
And Rawhide (upcoming Fedora 21) isn&#8217;t behaving -
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1063245">RHBZ #1063245</a>.</p>

<p>My goal for this year is to do more work on improving the overall test coverage
of Fedora and together with the Fedora QA team bring an
<a href="http://atodorov.org/blog/2013/11/19/open-source-quality-assurance-infrastructure-for-fedora-qa/">open testing infrastructure</a>
to the community.</p>

<p>Let&#8217;s see how well that plays out!</p>

<h2>What do I do now</h2>

<p>During the last year I have gradually changed my responsibilities to work more on Fedora.
As a volunteer in the Fedora QA I&#8217;m regularly testing installation
of Rawhide trees and try to work closely with the community. I still have to
manage RHEL 5 test cycles where I don&#8217;t expect nothing disruptive at this stage in the
product life-cycle!</p>

<p>I&#8217;m open to any ideas and help which can improve test coverage and quality of software
in Fedora. If you&#8217;re just joining the open source world this is an excellent
opportunity to do some good, get noticed and even maybe get a job. I will definitely
help you get through the process if you&#8217;re willing to commit your time to this.</p>

<p>I hope this long post has been useful and fun to read. Please use the comments form to tell
me if I&#8217;m missing something or you&#8217;d like to know more.</p>

<p><em>Looking forward to the next 7 years!</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Moving /tmp from EBS to Instance Storage]]></title>
    <link href="http://atodorov.org/blog/2014/02/10/moving-tmp-from-ebs-to-instance-storage/"/>
    <updated>2014-02-10T13:48:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/02/10/moving-tmp-from-ebs-to-instance-storage</id>
    <content type="html"><![CDATA[<p>I&#8217;ve seen a fair amount of stories about moving away from Amazon&#8217;s EBS volumes
to ephemeral instance storage. I&#8217;ve decided to give it a try starting with <code>/tmp</code>
directory where <a href="http://www.dif.io">Difio</a> operates.</p>

<p>It should be noted that although instance storage may be available for some instance
types it may not be attached by default. Use this command to check:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl http://169.254.169.254/latest/meta-data/block-device-mapping/
</span><span class='line'>ami
</span><span class='line'>root
</span><span class='line'>swap
</span></code></pre></td></tr></table></div></figure>


<p>In the above example there is no instance storage present.</p>

<p>You can attach one either when launching the EC2 instance or when creating a customized AMI
(instance storage devices are pre-defined in the AMI). When creating an AMI you can attach more ephemeral devices
but they will not available when instance is launched. The maximum number of available
instance storage devices can be found in the
<a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/InstanceStorage.html#StorageOnInstanceTypes">docs</a>.
That is to say if you have an AMI which defines 2 ephemeral devices and launch a
standard m1.small instance there will be only one ephemeral device present.</p>

<p>Also note that for M3 instances, you must specify instance store volumes in the
block device mapping for the instance. When you launch an M3 instance, Amazon ignores
any instance store volumes specified in the block device mapping for the AMI.</p>

<p>As far as I can see the AWS Console doesn&#8217;t indicate if instance storage is attached
or not. For instance with 1 ephemeral volume:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl http://169.254.169.254/latest/meta-data/block-device-mapping/
</span><span class='line'>ami
</span><span class='line'>ephemeral0
</span><span class='line'>root
</span><span class='line'>swap
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>curl http://169.254.169.254/latest/meta-data/block-device-mapping/ephemeral0
</span><span class='line'>sdb
</span></code></pre></td></tr></table></div></figure>


<p>Ephemeral devices can be mounted in <code>/media/ephemeralX/</code>, but not all volumes.
I&#8217;ve found that usually only <code>ephemeral0</code> is mounted automatically.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl http://169.254.169.254/latest/meta-data/block-device-mapping/
</span><span class='line'>ami
</span><span class='line'>ephemeral0
</span><span class='line'>ephemeral1
</span><span class='line'>root
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>ls -l /media/
</span><span class='line'>drwxr-xr-x 3 root root 4096 21 Ð½Ð¾Ðµ  2009 ephemeral0
</span></code></pre></td></tr></table></div></figure>


<p>For Difio I have an init.d script which executes when the system
boots. To enable <code>/tmp</code> on ephemeral storage I just added the following snippet:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">echo</span> <span class="s2">$&quot;Mounting /tmp on ephemeral storage:&quot;</span>
</span><span class='line'><span class="k">for </span>ef in <span class="sb">`</span>curl http://169.254.169.254/latest/meta-data/block-device-mapping/ 2&gt;/dev/null | grep ephemeral<span class="sb">`</span>; <span class="k">do</span>
</span><span class='line'><span class="k">    </span><span class="nv">disk</span><span class="o">=</span><span class="sb">`</span>curl http://169.254.169.254/latest/meta-data/block-device-mapping/<span class="nv">$ef</span> 2&gt;/dev/null<span class="sb">`</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">$&quot;Unmounting /dev/$disk&quot;</span>
</span><span class='line'>    umount /dev/<span class="nv">$disk</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">$&quot;mkfs /dev/$disk&quot;</span>
</span><span class='line'>    mkfs.ext4 -q /dev/<span class="nv">$disk</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">$&quot;Mounting /dev/$disk&quot;</span>
</span><span class='line'>    mount -t ext4 /dev/<span class="nv">$disk</span> /tmp <span class="o">&amp;&amp;</span> chmod 1777 /tmp <span class="o">&amp;&amp;</span> success <span class="o">||</span> failure
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>NB:</strong> success and failure are from <code>/etc/rc.d/init.d/functions</code>.
If you are using LVM or RAID you need to reconstruct your block devices
accordingly!</p>

<p>If everything goes right I should be able to reduce my AWS costs by saving on
provisioned storage and I/O requests. I&#8217;ll keep you posted on this after a month or two.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Articles of The Week: Git Submodules and Stopping SPAM Without CAPTCHA]]></title>
    <link href="http://atodorov.org/blog/2014/02/08/articles-week-git-submodules-stopping-spam-without-captcha/"/>
    <updated>2014-02-08T23:00:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/02/08/articles-week-git-submodules-stopping-spam-without-captcha</id>
    <content type="html"><![CDATA[<p>Here are two articles which I found very useful and interesting this week:</p>

<p><a href="http://chrisjean.com/2009/04/20/git-submodules-adding-using-removing-and-updating/">Git Submodules: Adding, Using, Removing, Updating</a>
is a clear description of working with git submodules which I had to do recently.
There&#8217;s a huge comments section with more useful info as well.</p>

<p><a href="http://nedbatchelder.com/text/stopbots.html">Stopping spambots with hashes and honeypots</a>
is a very interesting read about non-CAPTCHA techniques to stop SPAM bots from filling forms
and comments on your site. I didn&#8217;t even know these exist but I have to admin this is not my
area of expertise either. The author just scratches the surface of the topic and there are other
methods described in the comments as well. Make sure to read this if you are building forms
or sites with comments.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tip: How to Build updates.img for Fedora]]></title>
    <link href="http://atodorov.org/blog/2014/02/07/tip-how-to-build-updates.img-for-fedora/"/>
    <updated>2014-02-07T11:01:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/02/07/tip-how-to-build-updates.img-for-fedora</id>
    <content type="html"><![CDATA[<p>Anaconda the Fedora, CentOS and Red Hat Enterprise Linux installer has the
capability to incorporate
<a href="https://fedoraproject.org/wiki/Anaconda/Updates">updates at runtime</a>.
These updates are generally distributed as an <code>updates.img</code> file. Here is how
to easily build one from a working installation tree.</p>

<p>Instead of using the git sources to build an updates.img I prefer using the SRPM
from the tree which I am installing. <strike>This way the resulting updates image will be
more consistent with the anaconda version already available in the tree. And in theory
everything you need to build it should already be available as well.</strike>
<strong>UPDATE 2014-02-08:</strong> You can also build the <code>updates.img</code> from the git source tree
which is shown at the bottom of this article.</p>

<p>The following steps work for me on a Fedora 20 system.</p>

<ul>
<li>Download the source RPM for anaconda from the tree and extract the sources to a working
directory. Then;</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd </span>anaconda-20.25.16-1
</span><span class='line'>git init
</span><span class='line'>git add .
</span><span class='line'>git commit -m <span class="s2">&quot;initial import&quot;</span>
</span><span class='line'>git tag anaconda-20.25.16-1
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>The above steps will create a local git repository and tag the initial contents before
modification. The tag is required later by the script which creates the updates image;</p></li>
<li><p>After making your changes commit them and from the top anaconda directory execute:</p></li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./scripts/makeupdates -t anaconda-20.25.16-1
</span></code></pre></td></tr></table></div></figure>


<p>You can also add RPM contents to the updates.img but you need to download the packages first:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yumdownloader python-coverage python-setuptools
</span><span class='line'>
</span><span class='line'>./scripts/makeupdates -t anaconda-20.25.16-1 -a ~/python-coverage-3.7-1.fc20.x86_64.rpm -a ~/python-setuptools-1.4.2-1.fc20.noarch.rpm
</span><span class='line'>BUILDDIR /home/atodorov/anaconda-20.25.16-1
</span><span class='line'>Including anaconda
</span><span class='line'>2 RPMs added manually:
</span><span class='line'>python-setuptools-1.4.2-1.fc20.noarch.rpm
</span><span class='line'>python-coverage-3.7-1.fc20.x86_64.rpm
</span><span class='line'><span class="nb">cd</span> /home/atodorov/anaconda-20.25.16-1/updates <span class="o">&amp;&amp;</span> rpm2cpio /home/atodorov/python-setuptools-1.4.2-1.fc20.noarch.rpm | cpio -dium
</span><span class='line'>3534 blocks
</span><span class='line'><span class="nb">cd</span> /home/atodorov/anaconda-20.25.16-1/updates <span class="o">&amp;&amp;</span> rpm2cpio /home/atodorov/python-coverage-3.7-1.fc20.x86_64.rpm | cpio -dium
</span><span class='line'>1214 blocks
</span><span class='line'>&lt;stdin&gt; to &lt;stdout&gt; 4831 blocks
</span><span class='line'>
</span><span class='line'>updates.img ready
</span></code></pre></td></tr></table></div></figure>


<p>In the above example I have only modified the top level anaconda file (<code>/usr/sbin/anaconda</code>
inside the installation environment) experimenting with
<a href="http://nedbatchelder.com/code/coverage/">python-coverage</a> integration.</p>

<p>You are done! Make the <code>updates.img</code> available to Anaconda and start using it!</p>

<p><strong>UPDATE 2014-02-08:</strong> If you prefer working with the anaconda source tree here&#8217;s
how to do it:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone git://git.fedorahosted.org/git/anaconda.git
</span><span class='line'><span class="nb">cd </span>anaconda/
</span><span class='line'>git checkout anaconda-20.25.16-1 -b my_feature-branch
</span><span class='line'>
</span><span class='line'>... make changes ...
</span><span class='line'>
</span><span class='line'>git commit -a -m <span class="s2">&quot;Fixed something&quot;</span>
</span><span class='line'>
</span><span class='line'>./scripts/makeupdates -t anaconda-20.25.16-1
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AWS Tip: Shrinking EBS Root Volume Size]]></title>
    <link href="http://atodorov.org/blog/2014/02/07/aws-tip-shrinking-ebs-root-volume-size/"/>
    <updated>2014-02-07T00:23:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/02/07/aws-tip-shrinking-ebs-root-volume-size</id>
    <content type="html"><![CDATA[<p>Amazon&#8217;s Elastic Block Store volumes are easy to use and expand but notoriously
hard to shrink once their size has grown. Here is my tip for shrinking EBS size
and saving some money from over-provisioned storage. I&#8217;m assuming that you want to
shrink the root volume which is on EBS.</p>

<ul>
<li>Write down the block device name for the root volume (/dev/sda1) - <em>from AWS console:
Instances; Select instance; Look at Details tab; See Root device or Block devices</em>;</li>
<li>Write down the availability zone of your instance - <em>from AWS console: Instances;
column Availability Zone</em>;</li>
<li>Stop instance;</li>
<li>Create snapshot of the root volume;</li>
<li>From the snapshot, create a second volume, in the <strong>same availability zone</strong> as
your instance (you will have to attach it later). This will be your pristine source;</li>
<li>Create new empty EBS volume (not based on a snapshot), with smaller size,
in the same availability zone - <em>from AWS console: Volumes; Create Volume;
Snapshot == No Snapshot</em>; <strong>IMPORTANT</strong> - size should be large enough to hold
all the files from the source file system (try <code>df -h</code> on the source first);</li>
<li>Attach both volumes to instance while taking note of the block devices names
you assign for them in the AWS console;</li>
</ul>


<p>For example: In my case <code>/dev/sdc1</code> is the source snapshot and <code>/dev/sdd1</code> is the
empty target.</p>

<ul>
<li>Start instance;</li>
<li>Optionally check the source file system with <code>e2fsck -f /dev/sdc1</code>;</li>
<li>Create a file system for the empty volume - <code>mkfs.ext4 /dev/sdd1</code>;</li>
<li>Mount volumes at <code>/source</code> and <code>/target</code> respectively;</li>
<li>Now sync the files: <code>rsync -aHAXxSP /source/ /target</code>. <strong>Note the missing slash (/)
after <code>/target</code></strong>. If you add it you will end up with files inside <code>/target/source/</code>
which you don&#8217;t want;</li>
<li>Quickly verify the new directory structure with <code>ls -l /target</code>;</li>
<li>Unmount <code>/target</code>;</li>
<li>Optionally check the new file system for consistency <code>e2fsck -f /dev/sdd1</code>;</li>
<li><strong>IMPORTANT</strong> - check how <code>/boot/grub/grub.conf</code> specifies the root volume -
by UUID, by LABEL, by device name, etc. You will have to duplicate the same for the
new smaller volume or update <code>/target/boot/grub/grub.conf</code> to match the new volume.
Check <code>/target/etc/fstab</code> as well!</li>
</ul>


<p>In my case I had to <code>e2label /dev/sdd1 /</code> because both <code>grub.conf</code> and <code>fstab</code> were
using the device label.</p>

<ul>
<li>Shutdown the instance;</li>
<li>Detach all volumes;</li>
<li><strong>IMPORTANT</strong> - attach the new smaller volume to the instance using the same block device
name from the first step (e.g. <code>/dev/sda1</code>);</li>
<li>Start the instance and verify it is working correctly;</li>
<li>DELETE auxiliary volumes and snapshots so they don&#8217;t take space and accumulate costs!</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FOSDEM 2014 Report - Day #2 Testing and Automation]]></title>
    <link href="http://atodorov.org/blog/2014/02/03/fosdem-2014-report-day-2-testing-and-automation/"/>
    <updated>2014-02-03T22:54:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/02/03/fosdem-2014-report-day-2-testing-and-automation</id>
    <content type="html"><![CDATA[<p><img src="http://atodorov.org/images/fosdem/2014/testing_automation.jpg" title="Testing and Automation" alt="Testing and Automation" /></p>

<p>FOSDEM was hosting the
<a href="https://fosdem.org/2014/schedule/track/testing_and_automation/">Testing and automation devroom</a>
for the second year and this was the very reason I attended the conference. I managed to get in
early and stayed until 15:00 when I had to leave to catch my flight (which was late :().</p>

<p>There were 3 talks given by Red Hat employees in the testing devroom which was a nice opportunity
to meet some of the folks I&#8217;ve been working on IRC with. Unfortunately I didn&#8217;t meet anyone from
Fedora QA. Not sure if they were attending or not.</p>

<p>All the talks were interesting so see the official schedule and video for more details. I will
highlight only the items I saw as particularly interesting or have not heard of before.</p>

<h2>ANSTE</h2>

<p>ANSTE - Advanced Network Service Testing Environment is a test infrastructure controller,
something like our own <a href="http://beaker-project.org/">Beaker</a> but designed to create complex
networking environments. I think it lacks many of the provisioning features built in Beaker
and integration with various hypervisors and bare-metal provisioning. What it seems to do better
(as far as I can tell from the talk) is to deploy virtual systems and create more complex network
configuration between them. Not something I will need in the near future but definitely worth
a look at.</p>

<h2>cwrap</h2>

<blockquote><p>cwrap is&#8230;</p><p>a set of tools to create a fully isolated network environment to test client/server components on a single host.<br/>It provides synthetic account information, hostname resolution and support for privilege separation.<br/>The heart of cwrap consists of three libraries you can preload to any executable.</p></blockquote>


<p>That one was the coolest technology I&#8217;ve seen so far although I may not need to use it at all,
hmmm maybe testing DHCP fits the case.</p>

<p>It evolved from the Samba project and takes advantage of the order in which
libraries are searched when resolving functions. When you preload the project libraries
to any executable they will override standard libc functions for working with sockets,
user accounts and privilege escalation.</p>

<p>The socket_wrapper library redirects networking sockets through local UNIX sockets and
gives you the ability to test applications which need privileged ports with a local developer
account.</p>

<p>The nss_wrapper library provides artificial information for user and group accounts,
network name resolution using a hosts file and loading and testing of NSS modules.</p>

<p>The uid_wrapper library allows uid switching as a normal user (e.g. fake root) and
supports user/group changing in the local thread using the syscalls (like glibc).</p>

<p>All of these wrapper libraries are controlled via environment variables and definitely
makes testing of daemons and networking applications easier.</p>

<h2>Testing Documentation</h2>

<p>That one was just scratching the surface of an entire branch of testing which I&#8217;ve not
even considered before. The talk also explains why it is hard to test documentation and
what possible solutions there are.</p>

<p>If you write user guides and technical articles which need to
stay current with the software this is definitely the place to start.</p>

<h2>Automation in the Foreman Infrastructure</h2>

<p>The last talk I&#8217;ve listened to. Definitely the best one from a general testing approach
point of view. Greg talked about starting with Foreman unit tests, then testing the merged PR,
then integration tests, then moving on to test the package build and then the resulting packages themselves.</p>

<p>These guys try to even test their own infrastructure (infra as code) and the test suites
they use to test everything else. It&#8217;s all about automation and the level of confidence
you have in the entire process.</p>

<p>I like the fact that no single testing approach can make you confident enough before shipping
the code and that they&#8217;ve taken into account changes which get introduced at various places
(e.g. 3rd party package upgrades, distro specific issues, infrastructure changes and such)</p>

<p>If I had to attend only one session it would have been this one. There are many things for me
to take back home and apply to my work on Fedora and RHEL.</p>

<p>If you find any of these topics remotely interesting I advise you to wait until FOSDEM video
team uploads the recordings and watch the entire session stream. I&#8217;m definitely missing a lot
of stuff which can&#8217;t be easily reproduced in text form.</p>

<p>You can also find my report of the first FOSDEM&#8217;14 day on Saturday
<a href="http://atodorov.org/blog/2014/02/03/fosdem-2014-report-day-1-python-stands-lightning-talks/">here</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FOSDEM 2014 Report - Day #1 Python, Stands and Lightning Talks]]></title>
    <link href="http://atodorov.org/blog/2014/02/03/fosdem-2014-report-day-1-python-stands-lightning-talks/"/>
    <updated>2014-02-03T21:37:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/02/03/fosdem-2014-report-day-1-python-stands-lightning-talks</id>
    <content type="html"><![CDATA[<p>As promised I&#8217;m starting catching up on blogging after being sick and traveling.
Here&#8217;s my report of what I saw and found interesting at this year&#8217;s
<a href="https://fosdem.org/2014/">FOSDEM</a> which was held the last weekend in Brussels.</p>

<p>On Friday evening I&#8217;ve tried to attend the FOSDEM beer event at Delirium Cafe but
had a bad luck. At 21:30 the place was already packed with people. I managed to get
access to only one of the rooms but it looked like the wrong one :(. I think the space
is definitely small for all who are willing to attend.</p>

<p>During Saturday morning I did a quick sight-seeing most notably
<a href="www.migsworldwines.be/">Mig&#8217;s wine shop</a> and the area around it since I&#8217;ve never
been to this part of the city before. Then I took off to FOSDEM arriving at noon
(IOW not too late).</p>

<p>I&#8217;ve spent most of my day at building K where project stands were and I stayed quite
a long time around the Python and Perl stands meeting new people and talking to them
about their upgrade practices and how they manage package dependencies
(aka promoting <a href="http://www.dif.io">Difio</a>).</p>

<p><img src="http://atodorov.org/images/fosdem/2014/fedora_octopus.jpg" title="Fedora Octopus" alt="Fedora Octopus" /></p>

<p>Fedora stand was busy with 3D printing this year. I&#8217;ve seen 3D printing
before but here I was amazed of the fine-grained quality of the pieces produced.
This is definitely something to have in mind if you are building physical products.</p>

<p>Red Hat&#8217;s presence was very strong this year. In addition to the numerous talks they
gave there were also oVirt and OpenShift Origin stands which were packed with people.
I couldn&#8217;t even get close to say hi or take a picture.</p>

<p><img src="http://atodorov.org/images/fosdem/2014/doudou_linux.png" alt="DoudouLinux" style="float:left;margin-right:10px;"/></p>

<p>Near the end of the day I went to listen to some of the lightning talks. The ones that
I liked the most were MATE Desktop and DoudouLinux.</p>

<p>The thing about MATE which I liked
is that they have a <a href="https://github.com/mate-desktop/mate-university">MATE University</a>
initiative which is targeting developers who want to learn how to develop MATE extensions.
This is pretty cool with respect to community and developers on-boarding.</p>

<p><a href="http://www.doudoulinux.org">DoudouLinux</a> is a Debian based distribution targeted at
small children (2 or 3 years old) based on simple desktop and educational activities.
I&#8217;ve met project leader and founder Jean-Michel Philippe who gave the talk. We chatted for
a while when Alejandro Simon from <a href="http://www.kano.me/">Kano</a> came around and showed us a prototype
of their computer for children. I will definitely give DoudouLinux a try and maybe pre-order Kano as well.</p>

<p>In the evening there was a Python beer event at Delirium and after that dinner at
Chez Leon where I had snails and rabbit with cherries in cherry beer sauce.
I&#8217;ve had a few beers with Marc-Andre from <a href="http://egenix.com">eGenix</a>
and Charlie from <a href="http://www.clark-consulting.eu/">Clark Consulting</a> and the talk
was mostly about non-technical stuff which was nice.</p>

<p>After that we went back to Delirium and
re-united with <a href="http://akurtakov.blogspot.com">Alexander Kurtakov</a> and other folks from
Red Hat for more cherry beer!</p>

<p>Report of the second day of FOSDEM&#8217;14 on Sunday is
<a href="http://atodorov.org/blog/2014/02/03/fosdem-2014-report-day-2-testing-and-automation/">here</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Book Review - January 2014]]></title>
    <link href="http://atodorov.org/blog/2014/01/28/book-review-january-2014/"/>
    <updated>2014-01-28T23:16:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/01/28/book-review-january-2014</id>
    <content type="html"><![CDATA[<p>Sorry for not being able to write anything this month. I&#8217;ve been very sick
and hardly even touched a computer in the last few weeks. I promise to make
it up to you next month. Until then here&#8217;s the books I&#8217;ve managed to read in
January.</p>

<h2>Hooked: How to Build Habit-Forming Products</h2>

<p><a href="http://amzn.to/1erRrnb">Hooked</a> is an ebook for Kindle which I luckily got for
free on NYE (it&#8217;s paid now). The book describes the so called &#8220;Hook Model&#8221;
which is a guide to building products people canâ€™t put down.</p>

<p>The book goes through a cycle of <strong>trigger</strong>, <strong>action</strong>, <strong>variable reward</strong> and
<strong>investment</strong> to describe how one can design a product which users keep using
without you doing anything (pretty much). There are plenty of examples with products
like Instagram and Pinterest.</p>

<p>I really find the book interesting and will strongly recommend it as a must read
to anyone who is building a product. If you&#8217;re thinking about a mobile app or an
online service this book is definitely for you.</p>

<h2>CyberJoly Drim</h2>

<p><a href="http://hell.pl/nina/carramba.htm">CyberJoly Drim</a> is a 1998 cyber punk story by
Polish writer Antonina Liedtke. One I&#8217;ve heard about through the years but found
just recently. It&#8217;s about a love story although everything else is fiction. PDF format
is around 30 pages.</p>

<p>I found it hard to read especially b/c my Polish is totally rusty (not to mention I hardly
understand it) and Google translate didn&#8217;t manage well neither. Anyway, not a bad read
before bed time if you like this kind of stuff.</p>

<h2>The First in Bulgarian Internet</h2>

<p>Last a book about
<a href="https://www.goodreads.com/book/show/13398350">Bulgarian Internet pioneers</a>. The book
compiles a great deal with historical data as well as interviews and web site descriptions.
It&#8217;s said to mention about 400 persons.</p>

<p>The events start around 1989 with the BBS systems at the time and the first one to appear in
the country with accounts of first time logging into the network and pretty much seeing a
computer. Then it goes to tell the story of first companies and Internet providers, how they
started business, how they grew and formed the country&#8217;s backbone infrastructure. There&#8217;s
lots of personal memories and stories as well. This goes to about 2002 when the book
was written.</p>

<p>The second part of the book mostly describes various websites, some of the first ones and
some milestone or famous ones. It&#8217;s organized by date of website launch but isn&#8217;t that much
interesting. I find the local contents at the time a bit boring.</p>

<p>The book isn&#8217;t what I initially expected - I wanted more personal stories and more news from
the kitchen. It&#8217;s not that, it looks to me the people who were interviewed had chosen their
words very carefully and didn&#8217;t reveal any sensational stories.</p>

<p>The nice thing about all of that is I&#8217;ve started using the web in early 1998 and remember
most of the events and websites described in the book. It&#8217;s good to remember the history.
I own the book and can give it to you if you like. It&#8217;s on the <a href="http://atodorov.org/give-away/">Give Away</a>
list.</p>

<p>I hope you find something interesting to read in my library. If not please share what did you
read this month.</p>

<hr />

<p>PS: I&#8217;m currently in Milan and will be visiting FOSDEM at the end of the week. Catch
you there if you&#8217;re coming.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Book Review of 2013]]></title>
    <link href="http://atodorov.org/blog/2014/01/02/book-review-of-2013/"/>
    <updated>2014-01-02T10:07:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/01/02/book-review-of-2013</id>
    <content type="html"><![CDATA[<p>Happy New Year everyone! I was able to complete reading a few books in the last
days so this first post will be a quick review of
<a href="https://www.goodreads.com/review/list/16191345-alexander-todorov?read_at=2013&amp;view=covers">all twelve books I&#8217;ve read in 2013</a>.</p>

<h2>Technical Blogging</h2>

<p>I&#8217;ve started the year with
<a href="http://amzn.to/1a2QySD">Technical Blogging: Turn Your Expertise into a Remarkable Online Presence</a>
by Antonio Cangiano. This is the book which prompted me to start this blog. It is
targeted primarily at technical blogging but could be useful to non-tech bloggers as well.
I strongly recommend this book to anyone who is writing for the web.</p>

<h2>The 4-Hour Workweek</h2>

<p><a href="http://amzn.to/1ivu2q4">The 4-Hour Workweek: Escape 9-5, Live Anywhere, and Join the New Rich</a>
by Timothy Ferriss. This book I found at a local
<a href="http://atodorov.org/blog/2013/01/30/startup-talk-5-book-list/">start-up event</a> and is one of my
all time favorites. The basic idea is to ditch the traditional working space and
work less utilizing more automation. This is something I&#8217;ve been doing to an extent
during the last 5+ years and I am still changing my life and working habits to
reach the moment where I work only a few hours a week.</p>

<p>A must read for any entrepreneur, freelancer or work from home folks.</p>

<h2>The E-Myth Revisited</h2>

<p><a href="http://amzn.to/1d0j5ee">The E-Myth Revisited: Why Most Small Businesses Don&#8217;t Work and What to Do About It</a>
by Michael Gerber is the second book I&#8217;ve found at the same start-up event mentioned
previously. I found this one particularly hard to read. What I took from it was
that you should think about your business as a franchise and document processes
so that others can do it for you in the same way you would do it yourself.</p>

<h2>Culture and Wine</h2>

<p>Next two books are in Bulgarian and can be found at my
<a href="https://www.goodreads.com/review/list/16191345-alexander-todorov?read_at=2013&amp;view=covers">Goodreads list</a>.
They are about culture and religion and wine tasting 101.</p>

<h2>Accelerando</h2>

<p><a href="http://amzn.to/19Ctnk8">Accelerando (Singularity)</a> by Charles Stross is also one
of my favorites. I&#8217;ve heard about it at a local CloudFoundry conference a few years
back and finally had the time to read it. This is a fiction book where events start
in the near future and drive forward to dismantling the planets in the Solar system,
uploading lobsters minds on the Internet, space travel, aliens and family
relationships. I will definitely recommend it, the book is a very relaxing read.</p>

<h2>DevOps</h2>

<p><a href="http://amzn.to/1eXk3JN">What Is DevOps?</a> by Mike Loukides and
<a href="http://amzn.to/19KobFn">Building a DevOps Culture</a> by Mandi Walls are two short
free books for Kindle. They just touch base on the topic of DevOps and what it
takes to create a DevOps organization. Definitely worth reading even if you&#8217;re
not deeply interested in this topic.</p>

<p><a href="http://amzn.to/1dVvQmE">DevOps for Developers</a> by Michael Huttermann is a
practical books about DevOps. It talks about processes and tools and lists
lots of examples. The tools part is Ruby centric though.
I found it a bit hard to read at times and it took me a while
to complete it. I&#8217;m not sure if the book is really helpful if one decides to
change an exiting organization to a DevOps like structure but it is definitely
a starting point.</p>

<p>The days of waterfall software development are gone and knowingly or not most of
us work in a DevOps like environment these days. I think it&#8217;s worth at least skimming
through this book and taking some essentials from it.</p>

<h2>UX For Lean Startups</h2>

<p><a href="http://amzn.to/1fi1KeE">UX for Lean Startups</a> by Laura Klein is a very good book
about designing user experience and validation which I&#8217;ve
<a href="http://atodorov.org/blog/2013/12/09/book-review-ux-for-lean-startups/">reviewed previously</a>.
I strongly recommend this book to everyone who is building a product of some sort.</p>

<h2>Bulgarian Comics</h2>

<p>At the end of the year I&#8217;ve managed to read two comics books, both in Bulgarian.
The first one is a brief history of the comics arts in the country in the past 150
years with lots of references to good old stories which I&#8217;ve read when I was a kid.</p>

<p>The second one is a special edition (ebook only, print edition is out of stock) of
the popular Daga (Rainbow) magazine which ceased to exist 20 years ago. There are
some new episodes of the old stories drawn by the original artists.</p>

<p>Both books seem to be a turning point in Bulgarian comics art and market. Hopefully
we&#8217;ll see more cool stuff in the future. These books are not available on Amazon
but there are some <a href="http://amzn.to/19Cw6tV">free comics books for Kindle</a> which
you may give a try.</p>

<p>I hope you find something interesting to read in my list. Also feel free to comment
and share your favorite books in the comments below.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Upstream Test Suite Status of Fedora 20]]></title>
    <link href="http://atodorov.org/blog/2013/12/24/upstream-test-suite-status-of-fedora-20/"/>
    <updated>2013-12-24T08:01:00+02:00</updated>
    <id>http://atodorov.org/blog/2013/12/24/upstream-test-suite-status-of-fedora-20</id>
    <content type="html"><![CDATA[<p>Last week I&#8217;ve expressed my thoughts about the state of
<a href="https://lists.fedoraproject.org/pipermail/test/2013-December/119637.html">upstream test suites in Fedora</a>
along with some other ideas. Following the response on this thread I&#8217;m starting
to analyze all SRPM packages in Fedora 20 in order to establish a baseline. Here are my initial findings.</p>

<h2>What&#8217;s Inside</h2>

<p>I&#8217;ve found two source distributions for Fedora 20:</p>

<ul>
<li>The <code>Fedora-20-source-DVD.iso</code> file which to my knowledge contains the sources
of all packages that comprise the installation media;</li>
<li>The <code>Everything/source/SRPMS/</code> directory which appears to contain the sources
of everything else available in the Fedora 20 repositories.</li>
</ul>


<p>There are <strong>2574</strong> SRPM packages in Fedora-20 source DVD and <strong>14364</strong> SRPMs
in the Everything/ directory. 9,2G vs. 41G.</p>

<h2>Test Suite Execution In %check</h2>

<p><a href="https://fedoraproject.org/wiki/Packaging:Guidelines#Test_Suites">Fedora Packaging Guidelines</a>
state</p>

<blockquote><p>If the source code of the package provides a test suite,<br/>it should be executed in the %check section,<br/>whenever it is practical to do so.</p></blockquote>


<p>In my research I found <strong>738</strong> SRPMs on the DVD which have a %check
section and <strong>4838</strong> such packages under <code>Everything/</code>. This is <strong>28,6%</strong> and <strong>33,6%</strong>
respectively.</p>

<h2>Test Suite Existence</h2>

<p>A quick grep for either <code>test/</code> or <code>tests/</code> directories in the package sources revealed
<strong>870</strong> SRPM packages in the source DVD which are very likely to have a test suite.
This is <strong>33,8%</strong>. <strike>I wasn&#8217;t able to inspect the <code>Everything/</code> directory with this script
because it takes too long to execute and my system crashed out of memory.
I will update this post later with that info.</strike></p>

<p><em>UPDATE 2014-01-02</em>:
In the <code>Everything/</code> directory only <strong>4481</strong> (<strong>31,2%</strong>) SRPM packages appear to have
test suites.</p>

<p>The scripts and raw output are available at <a href="https://github.com/atodorov/fedora-scripts">https://github.com/atodorov/fedora-scripts</a>.</p>

<p>So it looks like on average <strong>30%</strong> of the packages execute their test suites at build
time in the %check section and less than <strong>35%</strong> have test suites at all!
There&#8217;s definitely room for improvement and I plan to focus on this during 2014!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Django Template Tag Inheritance How-to]]></title>
    <link href="http://atodorov.org/blog/2013/12/22/django-template-tag-inheritance-howto/"/>
    <updated>2013-12-22T23:02:00+02:00</updated>
    <id>http://atodorov.org/blog/2013/12/22/django-template-tag-inheritance-howto</id>
    <content type="html"><![CDATA[<p>While working on open-sourcing <a href="http://www.dif.io">Difio</a> I needed to remove
all hard-coded URL references from the templates. My solution was to essentially
inherit from the standard <code>{% url %}</code> template tag. Here is how to do it.</p>

<h2>Background History</h2>

<p>Difio is not hosted on a single server. Parts of the website are static HTML,
hosted on Amazon S3. Other parts are dynamic - hosted on OpenShift. It&#8217;s also
possible but not required at the moment to host at various PaaS providers for
redundancy and simple load balancing.</p>

<p>As an easy fix I had hard-coded some URLs to link to the static S3 pages and others
go link to my PaaS provider.</p>

<p>I needed a simple solution which can be extended to allow for multiple domain hosting.</p>

<h2>The Solution</h2>

<p>The solution I came up with is to override the standard <code>{% url %}</code>
tag and use it everywhere in my templates. The new tag will produce absolute URLs containing
the specified protocol plus domain name and view path. For this to work you have to
inherit the standard <code>URLNode</code> class and override the <code>render()</code> method to include the new
values.</p>

<p>You also need to register a tag method to utilize the new class. My approach was to use
the existing <code>url()</code> method to do all background processing and simply casting the result
object to the new class.</p>

<p>All code is available at <a href="https://djangosnippets.org/snippets/3013/">https://djangosnippets.org/snippets/3013/</a>.</p>

<p>To use in your templates simply add</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{% load fqdn_url from fqdn_url %}
</span><span class='line'>&lt;a href="{% fqdn_url 'dashboard' %}">Dashboard&lt;/a></span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Can I Use Android Phone as Smart Card Reader]]></title>
    <link href="http://atodorov.org/blog/2013/12/18/can-i-use-android-phone-as-smart-card-reader/"/>
    <updated>2013-12-18T23:09:00+02:00</updated>
    <id>http://atodorov.org/blog/2013/12/18/can-i-use-android-phone-as-smart-card-reader</id>
    <content type="html"><![CDATA[<p>Today I had troubles with my Omnikey CardMan 6121 smart card reader.
For some reason it will not detect the card inside and was unusable.
<code>/var/log/messages</code> was filled with  <em>Card Not Powered</em> messages:</p>

<pre><code>Dec 18 11:17:55 localhost pcscd: eventhandler.c:292:EHStatusHandlerThread() Error powering up card: -2146435050 0x80100016
Dec 18 11:18:01 localhost pcscd: winscard.c:368:SCardConnect() Card Not Powered
Dec 18 11:18:02 localhost pcscd: winscard.c:368:SCardConnect() Card Not Powered
</code></pre>

<p><img src="http://atodorov.org/images/omnikey_cardman_6121.gif" style="float:right;margin-left:20px;" /></p>

<p>I&#8217;ve found the solution in
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=531998">RHBZ #531998</a>.</p>

<blockquote><p>I&#8217;ve found the problem, and it&#8217;s purely mechanical.<br/>Omnikey has simply screwed up when they designed this reader.<br/>When the reader is inserted into the ExpressCard slot, it gets slightly<br/>compressed. This is enough to trigger the mechanical switch that detects<br/>insertions. If I jam something in there and force it apart, then pcscd<br/>starts reporting that the slot is empty.</p><footer><strong>Pierre Ossman</strong> <cite><a href='https://bugzilla.redhat.com/show_bug.cgi?id=531998#c12'>Comment #12</a></cite></footer></blockquote>


<p>So I tried moving the smart card a millimeter back and forth inside the reader and
that fixed it for me.</p>

<p>This smart card is standard SIM size and I wonder if it is possible to use
<a href="http://amzn.to/1dnl2gN">dual SIM</a> smart phones and <a href="http://amzn.to/18XpWlp">tablets</a>
as a reader? I will be happy to work on the software side if there is an open source
project already (e.g. OpenSC + drivers for Android). If not, why not?</p>

<p>If you happen to have information on the subject please share it in the comments.
Thanks!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Idempotent Django Email Sender with Amazon SQS and Memcache]]></title>
    <link href="http://atodorov.org/blog/2013/12/11/idempotent-django-email-sender-with-amazon-sqs-and-memcache/"/>
    <updated>2013-12-11T23:29:00+02:00</updated>
    <id>http://atodorov.org/blog/2013/12/11/idempotent-django-email-sender-with-amazon-sqs-and-memcache</id>
    <content type="html"><![CDATA[<p>Recently I wrote about my problem with
<a href="http://atodorov.org/blog/2013/12/06/duplicate-amazon-sqs-messages-cause-multiple-emails/">duplicate Amazon SQS messages causing multiple emails</a>
for <a href="http://www.dif.io">Difio</a>. After considering several options and
feedback from
<a href="https://twitter.com/atodorov_/status/409429840820199424">@Answers4AWS</a>
I wrote a small decorator to fix this.</p>

<p>It uses the cache backend to prevent the task from executing twice
during the specified time frame. The code is available at
<a href="https://djangosnippets.org/snippets/3010/">https://djangosnippets.org/snippets/3010/</a>.</p>

<p>As stated on Twitter you should use Memcache (or ElastiCache) for this.
If using Amazon S3 with my
<a href="https://github.com/atodorov/django-s3-cache">django-s3-cache</a> don&#8217;t use the
<code>us-east-1</code> region because it is eventually consistent.</p>

<p>The solution is fast and simple on the development side and uses my existing
cache infrastructure so it doesn&#8217;t cost anything more!</p>

<p>There is still a race condition between marking the message as processed
and the second check but nevertheless this should minimize the possibility of
receiving duplicate emails to an accepted level. Only time will tell though!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Book Review: UX for Lean Startups]]></title>
    <link href="http://atodorov.org/blog/2013/12/09/book-review-ux-for-lean-startups/"/>
    <updated>2013-12-09T10:09:00+02:00</updated>
    <id>http://atodorov.org/blog/2013/12/09/book-review-ux-for-lean-startups</id>
    <content type="html"><![CDATA[<p>Recently I&#8217;ve finished reading <a href="http://amzn.to/1fi1KeE">UX for Lean Startups</a>
and strongly recommend this book to anyone who is <strong>OR</strong> wants to be an
entrepreneur. Here is a short review of the book.</p>

<p>This book is for anyone who is creating a product/service or is considering the
idea of doing so. It talks about validation, interaction design and subsequent
product measurement and iteration. The book demonstrates some techniques and tools
to validate, design and measure your business ideas and products.
Its goal is to teach you how to design products that deliver fantastic user
experience, e.g. ones that are intuitive and easy to use.
It has nothing to do with visual design.</p>

<p>The author Laura Klein summarizes the book as follows:</p>

<blockquote><p>User research<br/>    Listen to your users. All the time. I mean it.</p><p>Validation<br/>    When you make assumptions or create hypotheses,<br/>    test them before spending lots of time building products around them.</p><p>Design<br/>    Iterate. Iterate. Iterate.</p></blockquote>


<h2>Early Validation</h2>

<p>This chapter helped me a lot to understand what exactly is validation and how
to go about it. The flow is validating the problem you are trying to solve,
then the market and then the product.</p>

<p>I will also add that by using some of these research techniques around a
vague idea/area of interest you may come around a particular trend/pattern or problem
and develop your business from there.</p>

<blockquote><p>Youâ€™ll know that youâ€™ve validated a problem when you start to hear<br/>particular groups of people complaining about something specific.</p><p>&#8230;</p><p>Your goal in validating your market is to begin to narrow down the<br/>group of people who will want their problems solved badly enough to buy<br/>your product. Your secondary goal is to understand exactly why theyâ€™re<br/>interested so you can find other markets that might be similarly motivated.</p><p>&#8230;</p><p>Youâ€™ll know that youâ€™ve successfully validated your market when you can<br/>accurately predict that a particular type of person will have a specific<br/>problem and that the problem will be severe enough that that person is<br/>interested in purchasing a solution.</p><p>&#8230;</p><p>Just because you have discovered a real problem and have a group of people<br/>willing to pay you to solve their problem, that doesnâ€™t necessarily mean that<br/>your product is the right solution. </p><p>&#8230;</p><p>Youâ€™ll know that youâ€™ve validated your product when a large percentage of<br/>your target market offers to pay you money to solve their problem.</p></blockquote>


<h2>User Research</h2>

<p>Next few chapters talk about user research, the various kinds of it and when/how
to perform it. It talks how to properly run surveys, how to ask good questions,
etc.</p>

<h2>Qualitative vs. Quantitative Research</h2>

<blockquote><p>Quantitative research is about measuring what real people are actually<br/>doing with your product. It doesnâ€™t involve speaking with specific humans.<br/>Itâ€™s about the data in aggregate. It should always be statistically significant.</p><p>&#8230;</p><p>Quantitative research tells you **what** your problem is. Qualitative<br/>research tells you **why** you have that problem.</p><p>&#8230;</p><p>If you want to measure something that exists, like traffic or revenue or how<br/>many people click on a particular button, then you want quantitative data.<br/>If you want to know why you lose people out of your purchase funnel or<br/>why people all leave once they hit a specific page, or why people seem not<br/>to click that button, then you need qualitative.</p></blockquote>


<h2>Part Two: Design</h2>

<p>The second part of this book talks about design - everything from building a
prototype to figuring out when you donâ€™t want one. It assumes you have validated
the initial idea and now move on to designing the product and validating that
design before you start building it. It talks about diagrams, sketches, wireframes,
prototypes and of course MVPs.</p>

<p>I think you can safely skip some of these steps when it comes to small applications
because it may be easier/faster to build the application instead of a prototype.
Definitely not to be skipped if you&#8217;re building a more complex product!</p>

<h2>Part Three: Product</h2>

<p>This section talks about metrics and measuring the product once it is out of the door.
Supposedly based on these metrics you will refine your design and update the product
accordingly.  Most of the time it focuses on A/B testing and which metrics are
important and which are so called &#8220;vanity metrics&#8221;.</p>

<p>I particularly liked the examples of A/B testing and explanations what it is good for
and what it does poorly. Definitely a mistake I&#8217;ve happened to made myself. I&#8217;m sure you too.</p>

<p>Let me know if you have read this book and what your thoughts are. Thanks!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Duplicate Amazon SQS Messages Cause Multiple Emails]]></title>
    <link href="http://atodorov.org/blog/2013/12/06/duplicate-amazon-sqs-messages-cause-multiple-emails/"/>
    <updated>2013-12-06T22:47:00+02:00</updated>
    <id>http://atodorov.org/blog/2013/12/06/duplicate-amazon-sqs-messages-cause-multiple-emails</id>
    <content type="html"><![CDATA[<p>Beware if using Amazon Simple Queue Service to send email messages!
Sometime SQS messages are duplicated which results in multiple copies of
the messages being sent. This happened today at <a href="http://www.dif.io">Difio</a>
and is really annoying to users. In this post I will explain why there is no easy
way of fixing it.</p>

<blockquote><p>Q: Can a deleted message be received again?</p><p>Yes, under rare circumstances you might receive a previously deleted message again.<br/>This can occur in the rare situation in which a DeleteMessage operation doesn&#8217;t<br/>delete all copies of a message because one of the servers in the distributed<br/>Amazon SQS system isn&#8217;t available at the time of the deletion. That message copy<br/>can then be delivered again. You should design your application so that no errors<br/>or inconsistencies occur if you receive a deleted message again.</p><footer><strong>Amazon FAQ</strong></footer></blockquote>


<p>In my case the cron scheduler logs say:</p>

<pre><code>&gt;&gt;&gt; &lt;AsyncResult: a9e5a73a-4d4a-4995-a91c-90295e27100a&gt;
</code></pre>

<p>While on the worker nodes the logs say:</p>

<pre><code>[2013-12-06 10:13:06,229: INFO/MainProcess] Got task from broker: tasks.cron_monthly_email_reminder[a9e5a73a-4d4a-4995-a91c-90295e27100a]
[2013-12-06 10:18:09,456: INFO/MainProcess] Got task from broker: tasks.cron_monthly_email_reminder[a9e5a73a-4d4a-4995-a91c-90295e27100a]
</code></pre>

<p>This clearly shows the same message (see the UUID) has been processed twice!
This resulted in hundreds of duplicate emails :(.</p>

<h2>Why This Is Hard To Fix</h2>

<p>There are two basic approaches to solve this issue:</p>

<ul>
<li>Check some log files or database for previous record of the message having
been processed;</li>
<li>Use idempotent operations that if you process the message again, you
get the same results, and that those results don&#8217;t create duplicate files/records.</li>
</ul>


<p>The problem with checking for duplicate messages is:</p>

<ul>
<li>There is a race condition between marking the message as processed and the
second check;</li>
<li>You need to use some sort of locking mechanism to safe-guard against the race condition;</li>
<li>In the event of an eventual consistency of the log/DB you can&#8217;t guarantee that
the previous attempt will show up and so can&#8217;t guarantee that you won&#8217;t process
the message twice.</li>
</ul>


<p>All of the above don&#8217;t seem to work well for distributed applications not to mention
Difio processes millions of messages per month, per node and the logs are quite big.</p>

<p>The second option is to have control of the Message-Id or some other email header
so that the second message will be discarded either at the server (Amazon SES in my case)
or at the receiving MUA. I like this better but I don&#8217;t think it is technically possible
with the current environment. Need to check though.</p>

<p>I&#8217;ve asked AWS support to look into
<a href="https://forums.aws.amazon.com/thread.jspa?threadID=140782">this thread</a> and hopefully
they will have some more hints. If you have any other ideas please post in the comments!
Thanks!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bug in Python URLGrabber/cURL on Fedora and Amazon Linux]]></title>
    <link href="http://atodorov.org/blog/2013/11/29/bug-python-urlgrabber-curl-fedora-amazon-linux/"/>
    <updated>2013-11-29T14:05:00+02:00</updated>
    <id>http://atodorov.org/blog/2013/11/29/bug-python-urlgrabber-curl-fedora-amazon-linux</id>
    <content type="html"><![CDATA[<p>Accidentally I have discovered a bug for Python&#8217;s
URLGrabber module which has to do with change in behavior in libcurl.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">urlgrabber.grabber</span> <span class="kn">import</span> <span class="n">URLGrabber</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">g</span> <span class="o">=</span> <span class="n">URLGrabber</span><span class="p">(</span><span class="n">reget</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">urlgrab</span><span class="p">(</span><span class="s">&#39;https://s3.amazonaws.com/production.s3.rubygems.org/gems/columnize-0.3.6.gem&#39;</span><span class="p">,</span> <span class="s">&#39;/tmp/columnize.gem&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;&lt;console&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/home/celeryd/.virtualenvs/difio/lib/python2.6/site-packages/urlgrabber/grabber.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">976</span><span class="p">,</span> <span class="ow">in</span> <span class="n">urlgrab</span>
</span><span class='line'>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retry</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">retryfunc</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/home/celeryd/.virtualenvs/difio/lib/python2.6/site-packages/urlgrabber/grabber.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">880</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_retry</span>
</span><span class='line'>    <span class="n">r</span> <span class="o">=</span> <span class="nb">apply</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">(</span><span class="n">opts</span><span class="p">,)</span> <span class="o">+</span> <span class="n">args</span><span class="p">,</span> <span class="p">{})</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/home/celeryd/.virtualenvs/difio/lib/python2.6/site-packages/urlgrabber/grabber.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">962</span><span class="p">,</span> <span class="ow">in</span> <span class="n">retryfunc</span>
</span><span class='line'>    <span class="n">fo</span> <span class="o">=</span> <span class="n">PyCurlFileObject</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/home/celeryd/.virtualenvs/difio/lib/python2.6/site-packages/urlgrabber/grabber.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1056</span><span class="p">,</span> <span class="ow">in</span> <span class="n">__init__</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">_do_open</span><span class="p">()</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/home/celeryd/.virtualenvs/difio/lib/python2.6/site-packages/urlgrabber/grabber.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1307</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_do_open</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">_set_opts</span><span class="p">()</span>
</span><span class='line'>  <span class="n">File</span> <span class="s">&quot;/home/celeryd/.virtualenvs/difio/lib/python2.6/site-packages/urlgrabber/grabber.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1161</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_set_opts</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">curl_obj</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">SSL_VERIFYHOST</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">ssl_verify_host</span><span class="p">)</span>
</span><span class='line'><span class="n">error</span><span class="p">:</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code above works fine with curl-7.27 or older while it breaks with curl-7.29 and
newer. As explained by
<a href="http://lists.baseurl.org/pipermail/yum-devel/2013-November/010428.html">Zdenek Pavlas</a>
the reason is an internal change in libcurl which doesn&#8217;t accept a value of 1 anymore!</p>

<p>The bug is reproducible with a newer libcurl version and a vanilla urlgrabber==3.9.1
from PyPI (e.g. inside a virtualenv). The latest python-urlgrabber RPM packages in both
Fedora and Amazon Linux already have the fix.</p>

<p>I have tested the patch proposed by Zdenek and it works for me. I still have no idea why
there aren&#8217;t any updates released on PyPI though!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Open Source Quality Assurance Infrastructure for Fedora QA]]></title>
    <link href="http://atodorov.org/blog/2013/11/19/open-source-quality-assurance-infrastructure-for-fedora-qa/"/>
    <updated>2013-11-19T14:12:00+02:00</updated>
    <id>http://atodorov.org/blog/2013/11/19/open-source-quality-assurance-infrastructure-for-fedora-qa</id>
    <content type="html"><![CDATA[<p><img src="http://atodorov.org/images/fedora/beaker.png" title="Beaker test lab" alt="&quot;Beaker test lab&quot;" /></p>

<p>In the last few weeks I&#8217;ve been working together with
<a href="https://fedoraproject.org/wiki/User:Tflink">Tim Flink</a> and
<a href="https://fedoraproject.org/wiki/User:Kparal">Kamil Paral</a> from the Fedora QA
team on bringing some installation testing expertise to Fedora and establishing
an <a href="http://beaker.fedoraproject.org/bkr/">open source test lab</a>
to perform automated testing in. The infrastructure is
already in relatively usable condition so I&#8217;ve decided to share this information
with the community.</p>

<h2>Beaker is Running Our Test Lab</h2>

<p><a href="http://beaker-project.org/">Beaker</a> is the software suite that powers the test
lab infrastructure. It is quite complex, with many components and sometimes not
very straight-forward to set up. Tim has been working on that with me giving it
a try and reporting issues as they have been discovered and fixed.</p>

<p>In the process of working on this I&#8217;ve managed to create
<a href="http://gerrit.beaker-project.org/#/q/owner:%22Alexander+Todorov%22,n,z">couple of patches</a>
against Beaker and friends. They are still pending release in a future version
because of more urgent bug fixes which need to released first.</p>

<h2>SNAKE is The Kickstart Template Server</h2>

<p><a href="https://fedorahosted.org/snake/">SNAKE</a> is a client/server Python framework used
to support Anaconda installations. It supports plain text ks.cfg files, IIRC those
were static templates, no variable substitution.</p>

<p>The other possibility is Python templates based on Pykickstart:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">pykickstart.constants</span> <span class="kn">import</span> <span class="n">KS_SCRIPT_POST</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">pykickstart.parser</span> <span class="kn">import</span> <span class="n">Script</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">installdefaults</span> <span class="kn">import</span> <span class="n">InstallKs</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">ks</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&#39;&#39;&#39;Anaconda autopart&#39;&#39;&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ks</span><span class="o">=</span><span class="n">InstallKs</span><span class="p">()</span>
</span><span class='line'>    <span class="n">ks</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s">&#39;@base&#39;</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ks</span><span class="o">.</span><span class="n">clearpart</span><span class="p">(</span><span class="n">initAll</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ks</span><span class="o">.</span><span class="n">autopart</span><span class="p">(</span><span class="n">autopart</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">script</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
</span><span class='line'><span class="s">cp /tmp/ks.cfg /mnt/sysimage/root/ks.cfg || </span><span class="se">\</span>
</span><span class='line'><span class="s">cp /run/install/ks.cfg /mnt/sysimage/root/ks.cfg</span>
</span><span class='line'><span class="s">&#39;&#39;&#39;</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Script</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">KS_SCRIPT_POST</span><span class="p">,</span> <span class="n">inChroot</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ks</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">ks</span>
</span></code></pre></td></tr></table></div></figure>


<p>At the moment SNAKE is essentially abandoned but feature complete.
I&#8217;m thinking about adopting the project just in case we need to make some fixes.
Will let you know more about this when it happens.</p>

<h2>Open Source Test Suite</h2>

<p>I have been working on opening up several test cases for what we (QE) call
a tier #1 installation test suite. They can be found in
<a href="http://taskbot.cloud.fedoraproject.org/cgit/fedora-beaker-tests/">git</a>.
The tests are base on <a href="https://fedorahosted.org/beakerlib/">beakerlib</a> and
the legacy RHTS framework which is now part of Beaker.</p>

<p>This effort has been coordinated with Kamil as part of a pilot
project he&#8217;s responsible for. I&#8217;ve been executing the same test suite against
earlier Fedora 20 snapshots but using an internal environment. Now everything
is going out in the open.</p>

<h2>Executing The Tests</h2>

<p>Well you can&#8217;t do that - YET! There are command line client tools for Fedora
but Beaker and SNAKE are not well suited for use outside a restricted network
like LAN or VPN. There are issues with authentication most notably for SNAKE.</p>

<p>At the moment I have to ssh through two different systems to get proper access.
However this is been worked on. I&#8217;ve read about a rewrite which will allow Beaker
to utilize a custom authentication framework like FAS for example. Hopefully that
will be implemented soon enough.</p>

<p>I will also like to see the test systems have direct access to the Internet for
various reasons but this is not without its risks either. This is still to be
decided.</p>

<p>If you are interested anyway see the <code>kick-tests.sh</code> file in the test suite for
examples and command line options.</p>

<h2>Test Results</h2>

<p>The first successfully completed
<a href="http://beaker.fedoraproject.org/bkr/jobs/">test jobs</a> are jobs 50 to 58.
There&#8217;s a failure in one of the test cases, namely SELinux related
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1027148">RHBZ #1027148</a>.</p>

<p>From what I can tell the lab is now working as expected and we can start doing
some testing against Fedora development snapshots.</p>

<p>Ping me or join #fedora-qa on irc.freenode.net if you&#8217;d like to join Fedora QA!</p>
]]></content>
  </entry>
  
</feed>
