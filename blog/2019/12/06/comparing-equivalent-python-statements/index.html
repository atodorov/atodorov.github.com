<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

            <meta name="google-site-verification" content="XynqZtldWNBbmsynVQZremIxaaO8Wgs6AGR8UZ7KIkM">

        <title>Comparing equivalent Python statements</title>

        <link href="http://feeds.feedburner.com/atodorov" type="application/atom+xml" rel="alternate" title="atodorov.org Full Atom Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="http://atodorov.org/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="http://atodorov.org/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="http://atodorov.org/theme/css/code_blocks/github.css" rel="stylesheet">

            <!-- CSS specified by the user -->
            <link href="http://atodorov.org/override.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="http://atodorov.org/theme/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="and learning how various operators work">

        <meta name="author" content="Alexander Todorov">

        <meta name="tags" content="fedora.planet">
        <meta name="tags" content="QA">
        <meta name="tags" content="Python">

	                <meta property="fb:admins" content="1616937247" >
                <meta property="og:locale" content="en_US">
		<meta property="og:site_name" content="atodorov.org">

	<meta property="og:type" content="article">
            <meta property="article:author" content="http://atodorov.org/author/alexander-todorov.html">
	<meta property="og:url" content="http://atodorov.org/blog/2019/12/06/comparing-equivalent-python-statements/">
	<meta property="og:title" content="Comparing equivalent Python statements">
	<meta property="article:published_time" content="2019-12-06 22:19:00+02:00">
            <meta property="og:description" content="and learning how various operators work">

                <meta property="og:image" content="http://atodorov.org/images/equivalent_python_statements.jpg">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@atodorov_">
        <meta name="twitter:title" content="Comparing equivalent Python statements">

                <meta property="twitter:image" content="http://atodorov.org/images/equivalent_python_statements.jpg">

            <meta name="twitter:description" content="and learning how various operators work">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://atodorov.org/">atodorov.org</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                        <li><a href="http://mrsenko.com/pylint-workshop/">Pylint Workshop</a></li>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/images/header_02.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Comparing equivalent Python statements</h1>
                            <h3 class="subheading">and learning how various operators work</h3>
                        <span class="meta">Posted by
                                <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                             on Fri 06 December 2019
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <div id="codefund"></div>

    <!-- Post Content -->
    <article>
        <p><img alt="Equivalent Python statements" src="/images/equivalent_python_statements.jpg" title="Equivalent Python statements" /></p>
<p>While teaching one of my Python classes yesterday I noticed a conditional expression
which can be written in several ways. All of these are equivalent in their behavior:</p>
<div class="highlight"><pre><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>


<p>My preferred style of writing is the last one (<code>not os.path.isdir()</code>) because it
looks the most pythonic of all. However the 5 expressions are slightly different
behind the scenes so they must also have different speed of execution
(click operator for link to documentation):</p>
<ul>
<li><a href="https://docs.python.org/3/reference/expressions.html#is"><code>is</code></a> - identity operator,
  e.g. both arguments are the same object as determined by the
  <a href="https://docs.python.org/3/library/functions.html#id"><code>id()</code></a> function. In CPython
  that means both arguments point to the same address in memory</li>
<li><a href="https://docs.python.org/3/reference/expressions.html#is"><code>is not</code></a> -
  yields the inverse truth value of <code>is</code>, e.g. both arguments are not the same
  object (address) in memory</li>
<li><a href="https://docs.python.org/3/library/stdtypes.html#comparisons"><code>==</code></a> - equality
  operator, e.g. both arguments have the same value</li>
<li><a href="https://docs.python.org/3/library/stdtypes.html#comparisons"><code>!=</code></a> - non-equality
  operator, e.g. both arguments have different values</li>
<li><a href="https://docs.python.org/3/library/stdtypes.html#boolean-operations-and-or-not"><code>not</code></a> -
  boolean operator</li>
</ul>
<p>In my <a href="https://twitter.com/atodorov_/status/1202504284400750592">initial tweet</a> I mentioned
that I think <code>is False</code> should be the fastest. <a href="http://kiwitcms.org">Kiwi TCMS</a> team
member <a href="https://twitter.com/real_zahari">Zahari</a> countered with <code>not</code> to be the fastest
but didn't provide any reasoning!</p>
<p>My initial reasoning was as follows:</p>
<ul>
<li><code>is</code> is essentially comparing addresses in memory so it should be as fast as it gets</li>
<li><code>==</code> and <code>!=</code> should be roughly the same but they do need to "read" values
  from memory which would take additional time before the actual comparison of
  these values</li>
<li><code>not</code> is a boolean operator but honestly I have no idea how it is implemented
  so I don't have any opinion as to its performance</li>
</ul>
<p>Using the following performance test script we get the average of 100 repetitions
from executing the conditional statement 1 million times:</p>
<div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">statistics</span>
<span class="kn">import</span> <span class="nn">timeit</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">if False:</span>
<span class="sd">#if not result:</span>
<span class="sd">#if result is False:</span>
<span class="sd">#if result is not True:</span>
<span class="sd">#if result != True:</span>
<span class="sd">#if result == False:</span>
<span class="sd">    pass</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">,</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">import os</span>
<span class="sd">result = os.path.isdir(&#39;/tmp&#39;)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>

<span class="n">execution_times</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">repeat</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>
<span class="n">average_time</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">average_time</span><span class="p">)</span>
</pre></div>


<p><strong>Note:</strong> in none of these variants the body of the if statement is executed so
the results must be pretty close to how long it takes to calculate the
conditional expression itself!</p>
<p>Results (ordered by speed of execution):</p>
<ul>
<li><code>False _______ 0.009309015863109380</code> - baseline</li>
<li><code>not result __ 0.011714859132189304</code> - +25.84%</li>
<li><code>is False ____ 0.018575656899483876</code> - +99.54%</li>
<li><code>is not True _ 0.018815848254598680</code> - +102.1%</li>
<li><code>!= True _____ 0.024881873669801280</code> - +167.2%</li>
<li><code>== False ____ 0.026119318689452484</code> - +180.5%</li>
</ul>
<p>Now these results weren't exactly what I was expecting. I thought <code>not</code> will come in
last but instead it came in first! Although <code>is False</code> came in second it is almost
twice as slow compared to baseline. Why is that ?</p>
<p>After digging around in
<a href="https://github.com/python/cpython">CPython</a> I found the following definition
for comparison operators:</p>
<div class="highlight"><span class="filename">Python/ceval.c</span><pre><span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span> <span class="nf">cmp_outcome</span><span class="p">(</span><span class="kt">int</span> <span class="n">op</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">w</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nl">PyCmp_IS</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">w</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">PyCmp_IS_NOT</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">!=</span> <span class="n">w</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="cm">/* ... skip PyCmp_IN, PyCmp_NOT_IN, PyCmp_EXC_MATCH ... */</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">PyObject_RichCompare</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">op</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">res</span> <span class="o">?</span> <span class="nl">Py_True</span> <span class="p">:</span> <span class="n">Py_False</span><span class="p">;</span>
    <span class="n">Py_INCREF</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>where <code>PyObject_RichCompare</code> is defined as follows (definition order reversed
in actual sources):</p>
<div class="highlight"><span class="filename">Objects/object.c</span><pre><span class="cm">/* Perform a rich comparison with object result.  This wraps do_richcompare()</span>
<span class="cm">   with a check for NULL arguments and a recursion check. */</span>
<span class="n">PyObject</span> <span class="o">*</span> <span class="nf">PyObject_RichCompare</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">op</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">res</span><span class="p">;</span>

    <span class="n">assert</span><span class="p">(</span><span class="n">Py_LT</span> <span class="o">&lt;=</span> <span class="n">op</span> <span class="o">&amp;&amp;</span> <span class="n">op</span> <span class="o">&lt;=</span> <span class="n">Py_GE</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">w</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyErr_Occurred</span><span class="p">())</span>
            <span class="n">PyErr_BadInternalCall</span><span class="p">();</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Py_EnterRecursiveCall</span><span class="p">(</span><span class="s">&quot; in comparison&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">do_richcompare</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">op</span><span class="p">);</span>
    <span class="n">Py_LeaveRecursiveCall</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Perform a rich comparison, raising TypeError when the requested comparison</span>
<span class="cm">   operator is not supported. */</span>
<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span> <span class="nf">do_richcompare</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">op</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">richcmpfunc</span> <span class="n">f</span><span class="p">;</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">res</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">checked_reverse_op</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">ob_type</span> <span class="o">!=</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">ob_type</span> <span class="o">&amp;&amp;</span>
        <span class="n">PyType_IsSubtype</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">ob_type</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">ob_type</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="p">(</span><span class="n">f</span> <span class="o">=</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">ob_type</span><span class="o">-&gt;</span><span class="n">tp_richcompare</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">checked_reverse_op</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="p">)(</span><span class="n">w</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">_Py_SwappedOp</span><span class="p">[</span><span class="n">op</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="n">Py_NotImplemented</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
        <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">f</span> <span class="o">=</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">ob_type</span><span class="o">-&gt;</span><span class="n">tp_richcompare</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="p">)(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">op</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="n">Py_NotImplemented</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
        <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">checked_reverse_op</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">f</span> <span class="o">=</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">ob_type</span><span class="o">-&gt;</span><span class="n">tp_richcompare</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="p">)(</span><span class="n">w</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">_Py_SwappedOp</span><span class="p">[</span><span class="n">op</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="n">Py_NotImplemented</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
        <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**********************************************************************</span>

<span class="cm">        IMPORTANT: actual execution enters the next block because the bool</span>
<span class="cm">        type doesn&#39;t implement it&#39;s own `tp_richcompare` function, see:</span>
<span class="cm">        Objects/boolobject.c PyBool_Type (near the bottom of that file)</span>

<span class="cm">    ***********************************************************************/</span>

    <span class="cm">/* If neither object implements it, provide a sensible default</span>
<span class="cm">       for == and !=, but raise an exception for ordering. */</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nl">Py_EQ</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="o">?</span> <span class="nl">Py_True</span> <span class="p">:</span> <span class="n">Py_False</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">Py_NE</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">!=</span> <span class="n">w</span><span class="p">)</span> <span class="o">?</span> <span class="nl">Py_True</span> <span class="p">:</span> <span class="n">Py_False</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="n">PyErr_Format</span><span class="p">(</span><span class="n">PyExc_TypeError</span><span class="p">,</span>
                     <span class="s">&quot;&#39;%s&#39; not supported between instances of &#39;%.100s&#39; and &#39;%.100s&#39;&quot;</span><span class="p">,</span>
                     <span class="n">opstrings</span><span class="p">[</span><span class="n">op</span><span class="p">],</span>
                     <span class="n">v</span><span class="o">-&gt;</span><span class="n">ob_type</span><span class="o">-&gt;</span><span class="n">tp_name</span><span class="p">,</span>
                     <span class="n">w</span><span class="o">-&gt;</span><span class="n">ob_type</span><span class="o">-&gt;</span><span class="n">tp_name</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Py_INCREF</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>The <code>not</code> operator is defined in <code>Objects/object.c</code> as follows (definition order
reverse in actual sources):</p>
<div class="highlight"><span class="filename">Objects/object.c</span><pre><span class="cm">/* equivalent of &#39;not v&#39;</span>
<span class="cm">   Return -1 if an error occurred */</span>
<span class="kt">int</span> <span class="nf">PyObject_Not</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">res</span><span class="p">;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">PyObject_IsTrue</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">res</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Test a value used as condition, e.g., in a for or if statement.</span>
<span class="cm">   Return -1 if an error occurred */</span>
<span class="kt">int</span> <span class="nf">PyObject_IsTrue</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Py_ssize_t</span> <span class="n">res</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">Py_True</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">Py_False</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">Py_None</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="cm">/*</span>
<span class="cm">        IMPORTANT: skip the rest because we are working with bool so this</span>
<span class="cm">        function will return after the first or the second if statement!</span>
<span class="cm">    */</span>
<span class="p">}</span>
</pre></div>


<p>So a rough overview of calculating the above expressions is:</p>
<ul>
<li><code>not</code> - call 1 function which compares the argument with <code>Py_True/Py_False</code>,
  compare its result with 0</li>
<li><code>is/is not</code> - do a switch/case/break, compare the result to <code>Py_True/Py_False</code>,
   call 1 function (<code>Py_INCREF</code>)</li>
<li><code>==/!=</code> - switch/default (that is evaluate all case conditions before that),
   call 1 function (<code>PyObject_RichCompare</code>), which performs couple of
   checks and calls another function (<code>do_richcompare</code>), which does a few more checks
   before executing switch/case/compare to <code>Py_True/Py_False</code>, call <code>Py_INCREF</code>
   and return the result.</li>
</ul>
<p>Obviously <code>not</code> has the shortest code which needs to be executed.</p>
<p>We can also invoke the <code>dis</code> module, aka disassembler of Python byte code into mnemonics
like so (it needs a function to dissasemble):</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">dis</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
        <span class="k">pass</span>
<span class="k">print</span><span class="p">(</span><span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</pre></div>


<p>From the results below you can see that all expression variants are very similar:</p>
<div class="highlight"><pre>--------------- if False -------------------------

              0 LOAD_GLOBAL              0 (False)
              3 POP_JUMP_IF_FALSE        9

              6 JUMP_FORWARD             0 (to 9)
        &gt;&gt;    9 LOAD_CONST               0 (None)
             12 RETURN_VALUE            None
--------------- if not result --------------------
              0 LOAD_FAST                0 (result)
              3 POP_JUMP_IF_TRUE         9

              6 JUMP_FORWARD             0 (to 9)
        &gt;&gt;    9 LOAD_CONST               0 (None)
             12 RETURN_VALUE            None
--------------- if result is False ---------------
              0 LOAD_FAST                0 (result)
              3 LOAD_GLOBAL              0 (False)
              6 COMPARE_OP               8 (is)
              9 POP_JUMP_IF_FALSE       15

             12 JUMP_FORWARD             0 (to 15)
        &gt;&gt;   15 LOAD_CONST               0 (None)
             18 RETURN_VALUE            None
--------------- if result is not True ------------
              0 LOAD_FAST                0 (result)
              3 LOAD_GLOBAL              0 (True)
              6 COMPARE_OP               9 (is not)
              9 POP_JUMP_IF_FALSE       15

             12 JUMP_FORWARD             0 (to 15)
        &gt;&gt;   15 LOAD_CONST               0 (None)
             18 RETURN_VALUE            None
--------------- if result != True ----------------
              0 LOAD_FAST                0 (result)
              3 LOAD_GLOBAL              0 (True)
              6 COMPARE_OP               3 (!=)
              9 POP_JUMP_IF_FALSE       15

             12 JUMP_FORWARD             0 (to 15)
        &gt;&gt;   15 LOAD_CONST               0 (None)
             18 RETURN_VALUE            None
--------------- if result == False ---------------
              0 LOAD_FAST                0 (result)
              3 LOAD_GLOBAL              0 (False)
              6 COMPARE_OP               2 (==)
              9 POP_JUMP_IF_FALSE       15

             12 JUMP_FORWARD             0 (to 15)
        &gt;&gt;   15 LOAD_CONST               0 (None)
             18 RETURN_VALUE            None
--------------------------------------------------
</pre></div>


<p>The last 3 instructions are the same (that is the implicit <code>return None</code> of the function).
<code>LOAD_GLOBAL</code> is to "read" the <code>True</code> or <code>False</code> boolean constants and
<code>LOAD_FAST</code> is to "read" the function parameter in this example.
All of them <code>_JUMP_</code> outside the if statement and the only difference is
which comparison operator is executed (if any in the case of <code>not</code>).</p>
<p><strong>UPDATE:</strong>
as I was publishing this blog post I read the following comments from
Ammar Askar who also gave me a few pointers on IRC:
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Note that this code path also has a direct inlined check for booleans, which should help too: <a href="https://t.co/YJ0az3q3qu">https://t.co/YJ0az3q3qu</a></p>&mdash; Ammar Askar (@<strong>ammar2</strong>) <a href="https://twitter.com/__ammar2__/status/1203012870386139137?ref_src=twsrc%5Etfw">December 6, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> </p>
<p>So go ahead and take a look at
<a href="https://github.com/python/cpython/blob/e76ee1a72b9e3f5da287663ea3daec4bb3f67612/Python/ceval.c#L2989-L3001"><code>case TARGET(POP_JUMP_IF_TRUE)</code></a>.</p>
<h2>P.S.</h2>
<p>When I teach Python I try to explain what is going on under the hood. Sometimes
I draw squares on the whiteboard to represent various cells in memory and visualize
things. One of my students asked me how do I know all of this? The essentials
(for any programming language) are always documented in its official documentation.
The rest is hacking around in its source code and learning how it works. This is
also what I expect people working with/for me to be doing!</p>
<p>See you soon and Happy learning!</p>
    </article>

        <div class="tags">
            <p>tags: <a href="http://atodorov.org/blog/categories/fedoraplanet/">fedora.planet</a>, <a href="http://atodorov.org/blog/categories/qa/">QA</a>, <a href="http://atodorov.org/blog/categories/python/">Python</a></p>
        </div>

<hr>
<div class="sharing">
        <!-- AddThis Button BEGIN -->
        <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
            <a class="addthis_button_preferred_1"></a>
            <a class="addthis_button_preferred_2"></a>
            <a class="addthis_button_preferred_3"></a>
            <a class="addthis_button_preferred_4"></a>
            <a class="addthis_button_preferred_5"></a>
            <a class="addthis_button_preferred_6"></a>
            <a class="addthis_button_preferred_7"></a>
            <a class="addthis_button_preferred_8"></a>
            <a class="addthis_button_preferred_9"></a>
            <a class="addthis_button_compact"></a>
            <a class="addthis_counter addthis_bubble_style"></a>
        </div>
        <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5103cc5a2bc6ba17"></script>
        <!-- AddThis Button END -->
</div>
    <hr>

    <script src="https://codefund.io/properties/70/funder.js" async="async"></script>

        <div class="comments">
            <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'atodorov';
                var disqus_identifier = 'blog/2019/12/06/comparing-equivalent-python-statements/';
                var disqus_url = 'http://atodorov.org/blog/2019/12/06/comparing-equivalent-python-statements/';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//atodorov.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/atodorov_">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/atodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://bg.linkedin.com/in/alextodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://feeds.feedburner.com/atodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.youtube.com/playlist?list=PLFjlI7p-h1hxBP3cIjEqePSeoBDHud5Db">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-youtube fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://amzn.to/1ivu2q4">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-amazon fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=social_icon">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-user-secret fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<section>
    <p>
        I am the project lead for
        <a href="http://kiwitcms.org/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=footer">Kiwi TCMS</a>
        and the current maintainer of <a href="http://MrSenko.com/pylint-workshop/">pylint-django</a>!
    </p>
    <p>
        <small>
            <em>
                Some of the links contained within this site have my referral id (e.g.,
                <a target="_blank" href="http://www.amazon.com/ref=as_li_ss_tl?_encoding=UTF8&camp=1789&creative=390957&linkCode=ur2&tag=atodorovorg-20&linkId=L6Q34XAXQS5RDMOY">Amazon</a><img src="https://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=ur2&o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />),
                which provides me with a small commission for each sale. Thank you for your support.
            </em>
        </small>
    </p>
</section>

<form action="http://google.com/search" method="get" style="width:300px;margin:0 auto;">
    <fieldset role="search">
        <input type="hidden" name="sitesearch" value="http://atodorov.org" />
        <input class="search" type="text" name="q" placeholder="Search" style="width:100%"/>
    </fieldset>
</form>

<p class="copyright text-muted">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">CC-BY-SA</a> &amp;
    <a rel="license" href="http://opensource.org/licenses/MIT">MIT</a>
    2011-2018 &diams; Alexander Todorov
</p>

<script type='text/javascript'>
window.__lo_site_id = 55936;
    (function() {
        var wa = document.createElement('script'); wa.type = 'text/javascript'; wa.async = true;
        wa.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://cdn') + '.luckyorange.com/w.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(wa, s);
      })();
</script>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="http://atodorov.org/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="http://atodorov.org/theme/js/bootstrap.min.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37979549-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'atodorov';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>