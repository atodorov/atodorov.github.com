<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Django | atodorov.org - you can logoff, but you can never leave]]></title>
  <link href="http://atodorov.org/blog/categories/django/atom.xml" rel="self"/>
  <link href="http://atodorov.org/"/>
  <updated>2015-09-16T19:14:48+03:00</updated>
  <id>http://atodorov.org/</id>
  <author>
    <name><![CDATA[Alexander Todorov]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Call for Ideas: Graphical Test Coverage Reports]]></title>
    <link href="http://atodorov.org/blog/2015/07/27/call-for-ideas-graphical-test-coverage-reports/"/>
    <updated>2015-07-27T13:04:00+03:00</updated>
    <id>http://atodorov.org/blog/2015/07/27/call-for-ideas-graphical-test-coverage-reports</id>
    <content type="html"><![CDATA[<p>If you are working with Python and writing unit tests chances are you are
familiar with the <a href="http://nedbatchelder.com/code/coverage/">coverage</a> reporting
tool. However there are testing scenarios in which we either don't use unit tests
or maybe execute different code paths(test cases) independent of each other.</p>

<p>For example, this is the case with installation testing in Fedora. Because anaconda
- the installer is very complex the easiest way is to test it live, not with unit tests.
Even though we can get a coverage report (anaconda is written in Python) it reflects
only the test case it was collected from.</p>

<p><code>coverage combine</code> can be used to combine several data files and produce an aggregate
report. This can tell you how much test coverage you have across all your tests.</p>

<p>As far as I can tell Python's coverage doesn't tell you how many times a particular
line of code has been executed. It also doesn't tell you which test cases executed
a particular line
(see <a href="https://bitbucket.org/ned/coveragepy/pull-request/59">PR #59</a>).
In the Fedora example, I have the feeling many of our tests are touching the same
code base and not contributing that much to the overall test coverage.
So I started working on these items.</p>

<p>I imagine a script which will read coverage data from several test executions
(preferably in JSON format,
<a href="https://bitbucket.org/ned/coveragepy/pull-request/60">PR #60</a>) and produce a
graphical report similar to what GitHub does for your commit activity.</p>

<p>See an example <a href="https://s3.amazonaws.com/atodorov/blog/pykickstart_report.html">here</a>!</p>

<p>The example uses darker colors to indicate more line executions, lighter for less
executions. Check the HTML for the actual numbers b/c there are no hints yet.
The input JSON files are
<a href="https://s3.amazonaws.com/atodorov/blog/coverage_json_reports.tar.gz">here</a> and
the script to generate the above HTML is at
<a href="https://github.com/atodorov/fedora-scripts/blob/master/coverage-tool">GitHub</a>.</p>

<p>Now I need your ideas and comments!</p>

<p>What kinds of coverage reports are you using in your job ? How do you generate them ?
How do they look like ?</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DEVit Conf 2015 Impressions]]></title>
    <link href="http://atodorov.org/blog/2015/05/22/devit-conf-2015-impressions/"/>
    <updated>2015-05-22T12:01:00+03:00</updated>
    <id>http://atodorov.org/blog/2015/05/22/devit-conf-2015-impressions</id>
    <content type="html"><![CDATA[<p>It's been a busy week after <a href="http://devitconf.org/">DEVit conf</a> took place in
Thessaloniki. Here are my impressions.</p>

<p><img src="/images/devit2015.jpg" title="Crack, Train, Fix, Release" alt="Crack, Train, Fix, Release" /></p>

<h2>Sessions</h2>

<p>I've started the day with the session called "Crack, Train, Fix, Release" by
Chris Heilmann. While it was very interesting for some unknown reason I
was expecting a talk more closely related to software testing. Unfortunately at the
same time in the other room was a talk called "Integration Testing from the Trenches"
by Nicolas Frankel which I missed.</p>

<p>At the end Chris answered the question "What to do about old versions of IE ?".
And the answer pretty much was "Don't try to support everything, leave them with
basic functionality so that users can achieve what they came for on your website.
Don't put nice buttons b/c IE 6 users are not used to nice things and they get confused."</p>

<p>If you remember I had a similar question to Jeremy Keith at
<a href="/blog/2015/04/20/videos-from-bulgaria-web-summit-2015/">Bulgaria Web Summit</a> last month
and the answer was similar:</p>

<p><blockquote><p>Q: Which one is Jeremy's favorite device/browser to develop for.<br/>A: Your approach is wrong and instead we should be thinking in terms of what features are<br/>essential or non-essential for our websites and develop around features<br/>(if supported, if not supported) not around browsers!</p></blockquote></p>

<p>Btw I did ask Chris if he knows Jeremy and he does.</p>

<p>After the coffee break there was "JavaScript â™¥ Unicode" by Mathias Bynens which
I saw last year at <a href="http://how.camp/">How Camp</a> in Veliko Tarnovo so I just stopped by
to say hi and went to listen to
"The future of responsive web design: web component queries" by Nikos Zinas.
As far as I understood Nikos is a local rock-star developer. I'm not much into web
development but the opportunity to create your own HTML components (tags) looks
very promising. I guess there will be more business coming for
<a href="http://telerik.com">Telerik</a> :).</p>

<p>I wanted to listen to "Live Productive Coder" by Heinz Kabutz but that one started
in Greek so I switched the room for
"iOS real time content modifications using websockets" by  Benny Weingarten-Gabbay.</p>

<p>After lunch I went straight for
"Introduction to Docker: What is it and why should I care?" by Ian Miell
which IMO was the most interesting talk of the day. It wasn't very technical but
managed to clear some of the mysticism around Docker and what it actually is.
I tried to grab a few minutes of Ian's time and we found topics of common interest
to talk about (<a href="http://www.projectatomic.io/">Project Atomic</a> anyone?) but later
failed to find him and continue the talk. I guess I'll have to follow online.</p>

<p>Tim Perry with "Your Web Stack Would Betray You In An Instant" made a great show.
The room was packed, I myself was actually standing the whole time. He described a series
of failures across the entire web development stack which gave developers hard times
patching and upgrading their services. The lesson: everything fails, be prepared!</p>

<p>The last talk I visited was "GitHub Automation" by Forbes Lindesay. It was more of an
inspirational talk, rather than technical one. GitHub provides cool API so why not use it?</p>

<h2>Organization</h2>

<p><img src="/images/devit2015team.jpg" title="DEVit team" alt="DEVit team" /></p>

<p>From what I know this is the first year of DEVit. For a first timer the team did great!
I particularly liked the two coffee breaks before lunch and in the early afternoon and the
sponsors pitches in between the main talks.</p>

<p>All talks were recorded but I have no idea what's happening with the videos!</p>

<p>I will definitely make a point of visiting Thessaloniki more often and follow the local
IT and start-up scenes there. And tonight is Silicon Drinkabout which will be the official
after party of <a href="http://digitalk.bg/">DigitalK</a> in Sofia.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Free Software Testing Books]]></title>
    <link href="http://atodorov.org/blog/2015/05/20/free-software-testing-books/"/>
    <updated>2015-05-20T11:35:00+03:00</updated>
    <id>http://atodorov.org/blog/2015/05/20/free-software-testing-books</id>
    <content type="html"><![CDATA[<p>There's a huge list of
<a href="https://github.com/ligurio/free-software-testing-books/blob/master/free-software-testing-books.md">free books</a>
on the topic of software testing. This will definitely be my summer reading list.
I hope you find it helpful.</p>

<h2>200 Graduation Theses About Software Testing</h2>

<p>The guys from <a href="http://qahelp.net">QAHelp</a> have compiled a list of 200
graduation theses from various universities which are freely accessible
online. The list can be found
<a href="http://qahelp.net/200-dissertatsij-po-testirovaniyu-v-svobodnoj-dostupe/">here</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Videos from Bulgaria Web Summit 2015]]></title>
    <link href="http://atodorov.org/blog/2015/04/20/videos-from-bulgaria-web-summit-2015/"/>
    <updated>2015-04-20T10:45:00+03:00</updated>
    <id>http://atodorov.org/blog/2015/04/20/videos-from-bulgaria-web-summit-2015</id>
    <content type="html"><![CDATA[<p><img src="/images/bgws2015.jpg" title="We're full" alt="We're full" /></p>

<p><a href="http://bulgariawebsummit.com">Bulgaria Web Summit</a> 2015 is over. The event was
incredible and I had a lot of fun moderating the main room. We had many people
coming from other countries and I've made lots of new friends.
Thank you to everyone who attended!</p>

<p>You can find video recordings of all talks in the main room (in order of appearance) below:</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/3THnzZCI4sw?rel=0" frameborder="0" allowfullscreen></iframe>




<iframe width="560" height="315" src="https://www.youtube.com/embed/LtgPnYkEj3E?rel=0" frameborder="0" allowfullscreen></iframe>




<iframe width="560" height="315" src="https://www.youtube.com/embed/4IFyMSvoy-c?rel=0" frameborder="0" allowfullscreen></iframe>




<iframe width="560" height="315" src="https://www.youtube.com/embed/ZGLKZSnCIUU?rel=0" frameborder="0" allowfullscreen></iframe>




<iframe width="560" height="315" src="https://www.youtube.com/embed/GBv4QWFDETY?rel=0" frameborder="0" allowfullscreen></iframe>




<iframe width="560" height="315" src="https://www.youtube.com/embed/DhnsmsvSG7w?rel=0" frameborder="0" allowfullscreen></iframe>


<p>Hope to see you next time in Sofia!</p>

<p>Mean while I learned about <a href="http://devitconf.org/">DEVit</a> in Thessaloniki in May and another one in Zagreb in October.
See you there :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Speeding Up Celery Backends, Part 3]]></title>
    <link href="http://atodorov.org/blog/2014/11/11/speeding-up-celery-backends-part-3/"/>
    <updated>2014-11-11T15:59:00+02:00</updated>
    <id>http://atodorov.org/blog/2014/11/11/speeding-up-celery-backends-part-3</id>
    <content type="html"><![CDATA[<p>In the second part of this article we've seen
<a href="/blog/2014/11/07/speeding-up-celery-backends-part-2/">how slow Celery actually is</a>.
Now let's explore what happens inside and see if we can't speed things up.</p>

<p>I've used <a href="http://pycallgraph.slowchop.com/en/latest/">pycallgraph</a> to create
call graph visualizations of my application. It has the nice feature to also show
execution time and use different colors for fast and slow operations.</p>

<p>Full command line is:</p>

<pre><code>pycallgraph -v --stdlib --include ... graphviz -o calls.png -- ./manage.py celery_load_test
</code></pre>

<p>where the <code>--include</code> is used to limit the graph to a particular Python module(s).</p>

<h2>General findings</h2>

<p><img src="/images/celery/general.png" title="call graph" alt="call graph" /></p>

<ul>
<li>The first four calls is where most of the time is spent as seen on the picture.</li>
<li>As it seems most of the slow down comes from Celery itself, not the underlying messaging
transport Kombu (not shown on picture)</li>
<li><code>celery.app.amqp.TaskProducer.publish_task</code> takes half of the execution time of
<code>celery.app.base.Celery.send_task</code></li>
<li><code>celery.app.task.Task.delay</code> directly executes <code>.apply_async</code> and can be skipped if one
rewrites the code.</li>
</ul>


<h2>More findings</h2>

<p>In <code>celery.app.base.Celery.send_task</code> there is this block of code:</p>

<pre><code>349         with self.producer_or_acquire(producer) as P:
350             self.backend.on_task_call(P, task_id)
351             task_id = P.publish_task(
352                 name, args, kwargs, countdown=countdown, eta=eta,
353                 task_id=task_id, expires=expires,
354                 callbacks=maybe_list(link), errbacks=maybe_list(link_error),
355                 reply_to=reply_to or self.oid, **options
356             )
</code></pre>

<p><code>producer</code> is always None because delay() doesn't pass it as argument.
I've tried passing it explicitly to apply_async() as so:</p>

<pre><code>from djapp.celery import *

# app = debug_task._get_app() # if not defined in djapp.celery
producer = app.amqp.producer_pool.acquire(block=True)
debug_task.apply_async(producer=producer)
</code></pre>

<p>However this doesn't speedup anything. If we replace the above code block like this:</p>

<pre><code>349         with producer as P:
</code></pre>

<p>it blows up on the second iteration because producer and its channel is already None !?!</p>

<p>If you are unfamiliar with the with statement in Python please read
<a href="http://effbot.org/zone/python-with-statement.htm">this article</a>. In short the with statement is
a compact way of writing try/finally. The underlying <code>kombu.messaging.Producer</code> class does a
<code>self.release()</code> on exit of the with statement.</p>

<p>I also tried killing the with statement and using producer directly but with limited success. While
it was not released(was non None) on subsequent iterations the memory usage grew much more and there
wasn't any performance boost.</p>

<h2>Conclusion</h2>

<p>The with statement is used throughout both Celery and Kombu and I'm not at all sure if
there's a mechanism for keep-alive connections. My time constraints are limited and I'll probably
not spend anymore time on this problem soon.</p>

<p>Since my use case involves task producer and consumers on localhost I'll try to workaround the
current limitations by using Kombu directly
(see <a href="https://gist.github.com/atodorov/2bc1fcd34531ad260ed7">this gist</a>) with a transport that
uses either a UNIX domain socket or a name pipe (FIFO) file.</p>
]]></content>
  </entry>
  
</feed>
