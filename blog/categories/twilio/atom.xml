<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Twilio | atodorov.org - you can logoff, but you can never leave]]></title>
  <link href="http://atodorov.org/blog/categories/twilio/atom.xml" rel="self"/>
  <link href="http://atodorov.org/"/>
  <updated>2014-01-24T22:12:52+02:00</updated>
  <id>http://atodorov.org/</id>
  <author>
    <name><![CDATA[Alexander Todorov]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Twilio is Located in Amazon Web Services US East]]></title>
    <link href="http://atodorov.org/blog/2013/06/24/twilio-is-located-in-amazon-web-services-us-east/"/>
    <updated>2013-06-24T23:43:00+03:00</updated>
    <id>http://atodorov.org/blog/2013/06/24/twilio-is-located-in-amazon-web-services-us-east</id>
    <content type="html"><![CDATA[<p>{% blockquote %}
Where do I store my audio files in order to minimize download and call wait time?
{% endblockquote %}</p>

<p>Twilio is a cloud vendor that provides telephony services.
It can download and <code>&lt;Play&gt;</code> arbitrary audio files and will cache the files
for better performance.</p>

<p>Twilio support told me they are not disclosing the location of their servers,
so from my web application hosted in AWS US East:
{% codeblock lang:bash %}
[ivr-otb.rhcloud.com logs]> grep TwilioProxy access_log-* | cut -f 1 -d '-' | sort | uniq
10.125.90.172
10.214.183.239
10.215.187.220
10.245.155.18
10.255.119.159
10.31.197.102
{% endcodeblock %}</p>

<p>Now let's map these addresses to host names. From another EC2 system, also in Amazon US East:</p>

<p>{% codeblock lang:bash %}
[ec2-user@ip-10-29-206-86 ~]$ dig -x 10.125.90.172 -x 10.214.183.239 -x 10.215.187.220 -x 10.245.155.18 -x 10.255.119.159 -x 10.31.197.102</p>

<p>; &lt;&lt;>> DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.29.amzn1 &lt;&lt;>> -x 10.125.90.172 -x 10.214.183.239 -x 10.215.187.220 -x 10.245.155.18 -x 10.255.119.159 -x 10.31.197.102
;; global options: +cmd
;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 43245
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</p>

<p>;; QUESTION SECTION:
;172.90.125.10.in-addr.arpa.    IN      PTR</p>

<p>;; ANSWER SECTION:
172.90.125.10.in-addr.arpa. 113 IN      PTR     ip-10-125-90-172.ec2.internal.</p>

<p>;; Query time: 1 msec
;; SERVER: 172.16.0.23#53(172.16.0.23)
;; WHEN: Mon Jun 24 20:48:21 2013
;; MSG SIZE  rcvd: 87</p>

<p>;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 52693
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</p>

<p>;; QUESTION SECTION:
;239.183.214.10.in-addr.arpa.   IN      PTR</p>

<p>;; ANSWER SECTION:
239.183.214.10.in-addr.arpa. 42619 IN   PTR     domU-12-31-39-0B-B0-01.compute-1.internal.</p>

<p>;; Query time: 0 msec
;; SERVER: 172.16.0.23#53(172.16.0.23)
;; WHEN: Mon Jun 24 20:48:21 2013
;; MSG SIZE  rcvd: 100</p>

<p>;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 25255
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</p>

<p>;; QUESTION SECTION:
;220.187.215.10.in-addr.arpa.   IN      PTR</p>

<p>;; ANSWER SECTION:
220.187.215.10.in-addr.arpa. 43140 IN   PTR     domU-12-31-39-0C-B8-2E.compute-1.internal.</p>

<p>;; Query time: 0 msec
;; SERVER: 172.16.0.23#53(172.16.0.23)
;; WHEN: Mon Jun 24 20:48:21 2013
;; MSG SIZE  rcvd: 100</p>

<p>;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 15099
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</p>

<p>;; QUESTION SECTION:
;18.155.245.10.in-addr.arpa.    IN      PTR</p>

<p>;; ANSWER SECTION:
18.155.245.10.in-addr.arpa. 840 IN      PTR     ip-10-245-155-18.ec2.internal.</p>

<p>;; Query time: 0 msec
;; SERVER: 172.16.0.23#53(172.16.0.23)
;; WHEN: Mon Jun 24 20:48:21 2013
;; MSG SIZE  rcvd: 87</p>

<p>;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 28878
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</p>

<p>;; QUESTION SECTION:
;159.119.255.10.in-addr.arpa.   IN      PTR</p>

<p>;; ANSWER SECTION:
159.119.255.10.in-addr.arpa. 43140 IN   PTR     domU-12-31-39-01-70-51.compute-1.internal.</p>

<p>;; Query time: 0 msec
;; SERVER: 172.16.0.23#53(172.16.0.23)
;; WHEN: Mon Jun 24 20:48:21 2013
;; MSG SIZE  rcvd: 100</p>

<p>;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 28727
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</p>

<p>;; QUESTION SECTION:
;102.197.31.10.in-addr.arpa.    IN      PTR</p>

<p>;; ANSWER SECTION:
102.197.31.10.in-addr.arpa. 840 IN      PTR     ip-10-31-197-102.ec2.internal.</p>

<p>;; Query time: 0 msec
;; SERVER: 172.16.0.23#53(172.16.0.23)
;; WHEN: Mon Jun 24 20:48:21 2013
;; MSG SIZE  rcvd: 87
{% endcodeblock %}</p>

<p>In short:</p>

<p>{% codeblock %}
ip-10-125-90-172.ec2.internal.
ip-10-245-155-18.ec2.internal.
ip-10-31-197-102.ec2.internal.
domU-12-31-39-01-70-51.compute-1.internal.
domU-12-31-39-0B-B0-01.compute-1.internal.
domU-12-31-39-0C-B8-2E.compute-1.internal.
{% endcodeblock %}</p>

<p>The <code>ip-*.ec2.internal</code> are clearly in US East. The <code>domU-*.computer-1.internal</code> also
look like US East although I'm not 100% sure what is the difference between the two.
The later ones look like HVM guests while the former ones are para-virtualized.</p>

<p>For comparison here are some internal addresses from my own EC2 systems:</p>

<ul>
<li>ip-10-228-237-207.eu-west-1.compute.internal - EU Ireland</li>
<li>ip-10-248-19-46.us-west-2.compute.internal - US West Oregon</li>
<li>ip-10-160-58-141.us-west-1.compute.internal - US West N. California</li>
</ul>


<p>After relocating my audio files to an S3 bucket in US East the average call length
dropped from 2:30 min to 2:00 min for the same IVR choices. This also minimizes
the costs since Twilio charges per minute of incoming/outgoing calls.
I think the audio quality has improved as well.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Django Tips: Using Cache for Stateful HTTP]]></title>
    <link href="http://atodorov.org/blog/2013/06/19/django-tips-using-cache-for-stateful-http/"/>
    <updated>2013-06-19T13:50:00+03:00</updated>
    <id>http://atodorov.org/blog/2013/06/19/django-tips-using-cache-for-stateful-http</id>
    <content type="html"><![CDATA[<p>How do you keep state when working with a stateless protocol like HTTP?
One possible answer is to use a cache back-end.</p>

<p>I'm working on an IVR application demo with Django and Twilio. The caller
will make multiple choices using the phone keyboard. All of this needs to be
put together and sent back to another server for processing. In my views
I've added a simple cache get/set lines to preserve the selection.</p>

<p>Here's how it looks with actual application logic omitted</p>

<p>{% codeblock lang:python %}</p>

<p>def incoming_call(request):</p>

<pre><code>call_sid = request.GET.get('CallSid', '')
caller_id = request.GET.get('From', '')

state = {'from' : caller_id}
cache.set(call_sid, state)

return render(request, 'step2.xml')
</code></pre>

<p>def step2(request):</p>

<pre><code>call_sid = request.GET.get('CallSid', '')
selection = int(request.GET.get('Digits', 0))

state = cache.get(call_sid, {})
state['step2_selection'] = selection
cache.set(call_sid, state)

return render(request, 'final_step.xml')
</code></pre>

<p>def final_step(request):</p>

<pre><code>call_sid = request.GET.get('CallSid', '')
selection = int(request.GET.get('Digits', 1))

state = cache.get(call_sid, {})
state['final_step_selection'] = selection

Backend.process_user_selections(state)

return render(request, 'thank_you.xml')
</code></pre>

<p>{% endcodeblock %}</p>

<p>At each step Django will update the current state associated with this call and return
a <a href="https://www.twilio.com/docs/api/twiml">TwiML</a> XML response. <code>CallSid</code> is a handy unique
identifier provided by Twilio.</p>

<p>I am using the latest <a href="http://github.com/atodorov/django-s3-cache">django-s3-cache</a> version
which properly works with directories. When going to production that will likely switch to
Amazon ElastiCache.</p>
]]></content>
  </entry>
  
</feed>
