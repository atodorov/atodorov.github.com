<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

            <meta name="google-site-verification" content="XynqZtldWNBbmsynVQZremIxaaO8Wgs6AGR8UZ7KIkM">

        <title>atodorov.org - Tag tips</title>

        <link href="http://feeds.feedburner.com/atodorov" type="application/atom+xml" rel="alternate" title="atodorov.org Full Atom Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="http://atodorov.org/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="http://atodorov.org/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="http://atodorov.org/theme/css/code_blocks/github.css" rel="stylesheet">

            <!-- CSS specified by the user -->
            <link href="http://atodorov.org/override.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

            <meta property="fb:admins" content="1616937247" />
                <meta property="og:locale" content="en_US">
		<meta property="og:site_name" content="atodorov.org">

            <meta name="twitter:card" content="summary_large_image">
            <meta name="twitter:site" content="@atodorov_">
            <meta name="twitter:title" content="atodorov.org">
            <meta name="twitter:description" content="you can logoff, but you can never leave">
                <meta name="twitter:image" content="http://atodorov.org//images/header_02.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://atodorov.org/">atodorov.org</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                        <li><a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=menu">Mr. Senko</a></li>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

        <header class="intro-header" style="background-image: url('/images/header_02.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="page-heading">
                        <h1>Tag tips</h1>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/04/24/how-to-deploy-python-hotfix-on-redhat-openshift-cloud/" rel="bookmark" title="Permalink to How to Deploy Python Hotfix on RedHat OpenShift Cloud">
                <h2 class="post-title">
                    How to Deploy Python Hotfix on RedHat OpenShift Cloud
                </h2>
            </a>
                <p>In this article I will show you how to deploy hotfix versions for
Python packages on the RedHat <a href="http://openshift.com">OpenShift</a> PaaS cloud.</p>
<h2>Background</h2>
<p>You are already running a Python application on your OpenShift instance.
You are using some 3rd party dependencies when you find a bug in one of them.
You go forward, fix the bug and submit a
<a href="https://github.com/ahupp/python-magic/pull/31">pull request</a>.
You don't want to wait for upstream to release a new version but rather
build a hotfix package yourself and deploy to production immediately.</p>
<h2>Solution</h2>
<p>There are two basic approaches to solving this problem: </p>
<ol>
<li>Include the hotfix package source code in your application, i.e.
add it to your git tree or;</li>
<li>Build the hotfix separately and deploy as a dependency. Don't
include it in your git tree, just add a requirement on the hotfix version. </li>
</ol>
<p>I will talk about the later. The tricky part here is to instruct the cloud environment
to use your package (including the proper location) and not upstream or their local
mirror.</p>
<p>Python applications hosted at <a href="http://openshift.com">OpenShift</a> don't support
<code>requirements.txt</code> which can point to various package sources and even install
packages directly from GitHub. They support <code>setup.py</code> which fetches packages
from <a href="http://pypi.python.org">http://pypi.python.org</a> but it is flexible enough to support other locations.</p>
<h2>Building the hotfix</h2>
<p>First of all we'd like to build a hotfix package. This will be the upstream
version that we are currently using plus the patch for our critical issue:</p>
<div class="highlight"><pre><span class="nv">$ </span>wget https://pypi.python.org/packages/source/p/python-magic/python-magic-0.4.3.tar.gz
<span class="nv">$ </span>tar -xzvf python-magic-0.4.3.tar.gz 
<span class="nv">$ </span><span class="nb">cd </span>python-magic-0.4.3
<span class="nv">$ </span>curl https://github.com/ahupp/python-magic/pull/31.patch <span class="p">|</span> patch
</pre></div>


<p>Verify the patch has been applied correctly and then modify <code>setup.py</code> to
increase the version string. In this case I will set it to <code>version='0.4.3.1'</code>.</p>
<p>Then build the new package using <code>python setup.py sdist</code> and upload it to a web server.</p>
<h2>Deploying to OpenShift</h2>
<p>Modify <code>setup.py</code> and specify the hotfix version. Because this version is not on PyPI
and will not be on OpenShift's local mirror you need to provide the location where it can
be found. This is done with the <code>dependency_links</code> parameter to <code>setup()</code>. Here's how it looks:</p>
<div class="highlight"><pre><span class="gh">diff --git a/setup.py b/setup.py</span>
<span class="gh">index c6e837c..2daa2a9 100644</span>
<span class="gd">--- a/setup.py</span>
<span class="gi">+++ b/setup.py</span>
<span class="gu">@@ -6,5 +6,6 @@ setup(name=&#39;YourAppName&#39;,</span>
       author=&#39;Your Name&#39;,
       author_email=&#39;example@example.com&#39;,
       url=&#39;http://www.python.org/sigs/distutils-sig/&#39;,
<span class="gd">-      install_requires=[&#39;python-magic==0.4.3&#39;],</span>
<span class="gi">+      dependency_links=[&#39;https://s3.amazonaws.com/atodorov/blog/python-magic-0.4.3.1.tar.gz&#39;],</span>
<span class="gi">+      install_requires=[&#39;python-magic==0.4.3.1&#39;],</span>
      )
</pre></div>


<p>Now just git push to OpenShift and observe the console output:</p>
<div class="highlight"><pre><span class="n">remote</span><span class="o">:</span> <span class="n">Processing</span> <span class="n">dependencies</span> <span class="k">for</span> <span class="n">YourAppName</span><span class="o">==</span><span class="mf">1.0</span>
<span class="n">remote</span><span class="o">:</span> <span class="n">Searching</span> <span class="k">for</span> <span class="n">python</span><span class="o">-</span><span class="n">magic</span><span class="o">==</span><span class="mf">0.4</span><span class="o">.</span><span class="mf">3.1</span>
<span class="n">remote</span><span class="o">:</span> <span class="n">Best</span> <span class="n">match</span><span class="o">:</span> <span class="n">python</span><span class="o">-</span><span class="n">magic</span> <span class="mf">0.4</span><span class="o">.</span><span class="mf">3.1</span>
<span class="n">remote</span><span class="o">:</span> <span class="n">Downloading</span> <span class="n">https</span><span class="o">://</span><span class="n">s3</span><span class="o">.</span><span class="na">amazonaws</span><span class="o">.</span><span class="na">com</span><span class="sr">/atodorov/blog/</span><span class="n">python</span><span class="o">-</span><span class="n">magic</span><span class="o">-</span><span class="mf">0.4</span><span class="o">.</span><span class="mf">3.1</span><span class="o">.</span><span class="na">tar</span><span class="o">.</span><span class="na">gz</span>
<span class="n">remote</span><span class="o">:</span> <span class="n">Processing</span> <span class="n">python</span><span class="o">-</span><span class="n">magic</span><span class="o">-</span><span class="mf">0.4</span><span class="o">.</span><span class="mf">3.1</span><span class="o">.</span><span class="na">tar</span><span class="o">.</span><span class="na">gz</span>
<span class="n">remote</span><span class="o">:</span> <span class="n">Running</span> <span class="n">python</span><span class="o">-</span><span class="n">magic</span><span class="o">-</span><span class="mf">0.4</span><span class="o">.</span><span class="mf">3.1</span><span class="sr">/setup.py -q bdist_egg --dist-dir /tmp/easy_install-ZRVMBg/python-magic-0.4.3.1/</span><span class="n">egg</span><span class="o">-</span><span class="n">dist</span><span class="o">-</span><span class="n">tmp</span><span class="o">-</span><span class="n">R_Nxie</span>
<span class="n">remote</span><span class="o">:</span> <span class="n">zip_safe</span> <span class="n">flag</span> <span class="n">not</span> <span class="kd">set</span><span class="o">;</span> <span class="n">analyzing</span> <span class="n">archive</span> <span class="n">contents</span><span class="o">...</span>
<span class="n">remote</span><span class="o">:</span> <span class="n">Removing</span> <span class="n">python</span><span class="o">-</span><span class="n">magic</span> <span class="mf">0.4</span><span class="o">.</span><span class="mi">3</span> <span class="n">from</span> <span class="n">easy</span><span class="o">-</span><span class="n">install</span><span class="o">.</span><span class="na">pth</span> <span class="n">file</span>
<span class="n">remote</span><span class="o">:</span> <span class="n">Adding</span> <span class="n">python</span><span class="o">-</span><span class="n">magic</span> <span class="mf">0.4</span><span class="o">.</span><span class="mf">3.1</span> <span class="n">to</span> <span class="n">easy</span><span class="o">-</span><span class="n">install</span><span class="o">.</span><span class="na">pth</span> <span class="n">file</span>
</pre></div>


<p>Congratulations! Your hotfix package has just been deployed.</p>
<p>This approach should work for other cloud providers and other programming languages
as well. Let me know if you have any experience with that.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 24 April 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/04/24/how-to-deploy-python-hotfix-on-redhat-openshift-cloud/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/04/09/creating-rpm-spec-files-from-scratch-using-vim/" rel="bookmark" title="Permalink to Creating RPM .spec Files From Scratch Using Vim">
                <h2 class="post-title">
                    Creating RPM .spec Files From Scratch Using Vim
                </h2>
            </a>
                <p>On a Red Hat Enterprise Linux or Fedora (or compatible) system execute</p>
<div class="highlight"><pre><span class="nv">$ </span>vim example.spec
</pre></div>


<p>This will create a new file with all the important sections and fields
already there. The template used is <code>/usr/share/vim/vimfiles/template.spec</code>
and is part of the <em>vim-common</em> RPM package.</p>
<p>This is very useful trick which I didn't know. Until now I always used the spec files
from previously built packages when creating new RPMs. This wasn't as fast as
creating a template and filling in the blanks.</p>
<p>For a detailed description about recommended RPM build practices see
the <a href="https://fedoraproject.org/wiki/Packaging:Guidelines">Fedora Packaging Guidelines</a>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 09 April 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/04/09/creating-rpm-spec-files-from-scratch-using-vim/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/04/06/using-django-built-in-template-tags-and-filters-in-code/" rel="bookmark" title="Permalink to Using Django built-in template tags and filters in code">
                <h2 class="post-title">
                    Using Django built-in template tags and filters in code
                </h2>
            </a>
                <p>In case you are wondering how to use Django's
<a href="https://docs.djangoproject.com/en/dev/ref/templates/builtins/">built-in template tags and filters</a>
in your source code, not inside a template here is how:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.template.defaultfilters</span> <span class="kn">import</span> <span class="o">*</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">filesizeformat</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="s">u&#39;1.0 KB&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">filesizeformat</span><span class="p">(</span><span class="mi">1020</span><span class="p">)</span>
<span class="s">u&#39;1020 bytes&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">filesizeformat</span><span class="p">(</span><span class="mi">102412354</span><span class="p">)</span>
<span class="s">u&#39;97.7 MB&#39;</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>


<p>All built-ins live in <code>pythonX.Y/site-packages/django/template/defaultfilters.py</code>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Sat 06 April 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/04/06/using-django-built-in-template-tags-and-filters-in-code/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/04/06/tip-renaming-model-fields-in-django/" rel="bookmark" title="Permalink to Tip: Renaming Model Fields in Django">
                <h2 class="post-title">
                    Tip: Renaming Model Fields in Django
                </h2>
            </a>
                <p>Did you ever have to re-purpose a column in your database schema? 
Here's a quick and easy way to do this if you happen to be using Django.</p>
<h2>Scenario</h2>
<p>I had an integer field in my model called <code>lines</code> which counted the lines of 
code in a particular tar.gz package. I figured the file size is a better indicator
so decided to start using it. I was not planning to use the old field anymore and
I didn't care about the data it was holding. So I decided to re-purpose it
as the <code>size</code> field.</p>
<h2>Possible methods</h2>
<p>Looking around I figured several different ways to do this: </p>
<ol>
<li>Continue using the existing <code>lines</code> field and keep referencing the old name in the code.
This is no-brainer but feels awkward and is a disaster waiting to happen;</li>
<li>Add new <code>size</code> field and remove the old <code>lines</code> field. This involves modification to
the DB schema and requires at least a backup with possible down time. Not something
I will jump at right away;</li>
<li>Add a <code>size</code> property in the model class which will persist to <code>self.lines</code>.
This is a quick way to go but I'm not sure if one can use the property with the
Django QuerySet API (objects.filter(), objects.update(), etc.) I suspect not.
If you don't filter by the property or use it in bulk operations this method is fine though;</li>
<li>Change the field name to <code>size</code> but continue to use the <code>lines</code> DB column;
Mind my wording here :);</li>
<li>Rename the column in the DB schema and then update the model class field.</li>
</ol>
<h2>How I did it</h2>
<p>I decided to go for option 4 above: 
change the field name to <code>size</code> but continue to use the <code>lines</code> DB column.</p>
<div class="highlight"><pre><span class="gh">diff --git a/models.py b/models.py</span>
<span class="gh">index e06d2b2..18cad6f 100644</span>
<span class="gd">--- a/models.py</span>
<span class="gi">+++ b/models.py</span>
<span class="gu">@@ -667,7 +667,7 @@ class Package(models.Model):</span>
<span class="gd">-    lines = models.IntegerField(default=None, null=True, blank=True)</span>
<span class="gi">+    size  = models.IntegerField(default=None, null=True, blank=True, db_column=&#39;lines&#39;)</span>
</pre></div>


<ol>
<li>Removed all references to <code>lines</code> from the code except the model class. This served as clean up as well. </li>
<li>Renamed the model field to <code>size</code> but continued using the <code>lines</code> DB column as shown above.
Django's <em>db_column</em> option makes this possible.</li>
<li>From the Django shell (./manage.py shell) reset <code>size</code> to None (NULL) for all objects;</li>
<li>Finally implement my new code and functionality behind the <code>size</code> field.</li>
</ol>
<p>The entire process happened for under 10 minutes. I will also opt for renaming the DB column at a later time.
This is to sync the naming used in Python code and in MySQL in case I ever need to use raw SQL or anything but Django.</p>
<p>If you were me, how would you do this? Please share in the comments below.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Sat 06 April 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/04/06/tip-renaming-model-fields-in-django/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/03/21/django-queryset-tip-search-and-order-by-exact-match/" rel="bookmark" title="Permalink to Django QuerySet tip - Search and Order By Exact Match">
                <h2 class="post-title">
                    Django QuerySet tip - Search and Order By Exact Match
                </h2>
            </a>
                <p>How do you order Django QuerySet results so that first item is the
exact match if using <code>contains</code> or <code>icontains</code> ? Both solutions were proposed on the
<a href="https://groups.google.com/d/topic/django-users/OCNmIXrRgag/discussion">django-users</a>
mailing list.</p>
<p>Solution by Tom Evans, example is mine:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Package</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">Q</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">Django</span><span class="p">)</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="n">Django</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span>
        <span class="n">select</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;match&#39;</span> <span class="p">:</span> <span class="s">&#39;name = &quot;Django&quot;&#39;</span><span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-match&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">Django</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">appomatic_django_cms</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">appomatic_django_filer</span><span class="o">&gt;</span><span class="p">,</span>
<span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">appomatic_django_vcs</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">BabelDjango</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">BDD4Django</span><span class="o">&gt;</span><span class="p">,</span>
<span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">blanc</span><span class="o">-</span><span class="n">django</span><span class="o">-</span><span class="n">admin</span><span class="o">-</span><span class="n">skin</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">bootstrap</span><span class="o">-</span><span class="n">django</span><span class="o">-</span><span class="n">forms</span><span class="o">&gt;</span><span class="p">,</span>
<span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">capistrano</span><span class="o">-</span><span class="n">django</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">ccnmtldjango</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">collective</span><span class="o">.</span><span class="n">django</span><span class="o">&gt;</span><span class="p">,</span>
<span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">csdjango</span><span class="o">.</span><span class="n">contactform</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">cykooz</span><span class="o">.</span><span class="n">djangopaste</span><span class="o">&gt;</span><span class="p">,</span>
<span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">cykooz</span><span class="o">.</span><span class="n">djangorecipe</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">d51</span><span class="o">.</span><span class="n">django</span><span class="o">.</span><span class="n">virtualenv</span><span class="o">.</span><span class="n">test_runner</span><span class="o">&gt;</span><span class="p">,</span>
<span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">django</span><span class="o">-</span><span class="mi">4</span><span class="n">store</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">django</span><span class="o">-</span><span class="mi">503</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">django</span><span class="o">-</span><span class="n">absolute</span><span class="o">&gt;</span><span class="p">,</span>
<span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">django</span><span class="o">-</span><span class="n">abstract</span><span class="o">-</span><span class="n">templates</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Package</span><span class="p">:</span> <span class="n">django</span><span class="o">-</span><span class="n">account</span><span class="o">&gt;</span><span class="p">,</span>
<span class="s">&#39;...(remaining elements truncated)...&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>


<p>Another one:</p>
<blockquote>
<p>I'm not sure this is the right way, but you could drop the Q objects, use
only icontains and sort by the length of 'name'</p>
<p>Gabriel https://groups.google.com/d/topic/django-users/OCNmIXrRgag/discussion</p>
</blockquote>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">packages</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">Package</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="s">&#39;Dancer&#39;</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
<span class="p">[</span><span class="s">u&#39;Dancer&#39;</span><span class="p">,</span> <span class="s">u&#39;Dancer2&#39;</span><span class="p">,</span> <span class="s">u&#39;breakdancer&#39;</span><span class="p">,</span> <span class="s">u&#39;Task::Dancer&#39;</span><span class="p">,</span> <span class="s">u&#39;App::Dancer2&#39;</span><span class="p">,</span> <span class="s">u&#39;Dancer::Routes&#39;</span><span class="p">,</span>
<span class="s">u&#39;DancerX::Routes&#39;</span><span class="p">,</span> <span class="s">u&#39;DancerX::Config&#39;</span><span class="p">,</span> <span class="s">u&#39;Task::DWIM::Dancer&#39;</span><span class="p">,</span> <span class="s">u&#39;Dancer::Plugin::CDN&#39;</span><span class="p">,</span>
<span class="s">u&#39;Dancer::Plugin::Feed&#39;</span><span class="p">,</span> <span class="s">u&#39;Dancer::Plugin::LDAP&#39;</span><span class="p">,</span> <span class="s">u&#39;Dancer::Plugin::Lucy&#39;</span><span class="p">,</span> 
<span class="s">&#39;...(remaining elements truncated)...&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>


<p>That's all folks. If you have other more interesting sorting needs please comment below.
Thanks!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 21 March 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/03/21/django-queryset-tip-search-and-order-by-exact-match/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/03/20/virtualization-platforms-supported-by-red-hat-enterprise-linux/" rel="bookmark" title="Permalink to Virtualization Platforms Supported by Red Hat Enterprise Linux">
                <h2 class="post-title">
                    Virtualization Platforms Supported by Red Hat Enterprise Linux
                </h2>
            </a>
                <p>This is mostly for my own reference, to have a handy list
of supported virtualization platforms by Red Hat Enterprise Linux.</p>
<h2>Software virtualization solutions</h2>
<p>A guest RHEL operating system is supported if it runs on the following
platforms:</p>
<ul>
<li>Xen shipped with RHEL Server</li>
<li>KVM shipped with RHEL Server or RHEV for Servers</li>
<li><a href="https://hardware.redhat.com/VMware">VMware</a> ESX/vSphere</li>
<li><a href="https://hardware.redhat.com/Microsoft">Microsoft Hyper-V</a></li>
</ul>
<p>Red Hat does not support Citrix XenServer. However, customers can
<a href="http://otb.bg">buy RHEL Server</a> and use it with Citrix XenServer
with the understanding that Red Hat will only support technical
issues that can be reproduced on bare metal.</p>
<p>The 
<a href="http://www.redhat.com/resourcelibrary/articles/enterprise-linux-virtualization-support">official virtualization support matrix</a>
shows which host/guest operating systems combinations are supported.</p>
<h2>Hardware partitioning</h2>
<p>Red Hat supports RHEL on hardware partitioning and virtualization solutions such as:</p>
<ul>
<li><a href="https://hardware.redhat.com/list.cgi?product=Red+Hat+Hardware+Certification&amp;quicksearch=IBM+System+Z">IBM System Z</a></li>
<li><a href="https://hardware.redhat.com/list.cgi?product=Red+Hat+Hardware+Certification&amp;quicksearch=IBM+POWER">IBM Power</a></li>
<li><a href="https://hardware.redhat.com/list.cgi?product=Red+Hat+Hardware+Certification&amp;quicksearch=PRIMEQUEST">Fujitsu PRIMEQUEST</a></li>
<li><a href="https://hardware.redhat.com/list.cgi?product=Red+Hat+Hardware+Certification&amp;quicksearch=Virtage">Hitachi Virtage</a></li>
</ul>
<p>Unfortunately the <a href="https://access.redhat.com/knowledge/articles/263573">recently updated</a>
hardware catalog
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=923802">doesn't allow to filter by hardware partitioning vs. virtualization platform</a>
so you need to know what you are looking for to find it :(.</p>
<h2>Red Hat Enterprise Linux as a guest on the Cloud</h2>
<p>Multiple public cloud providers are supported. Comprehensive list can be found here:
http://www.redhat.com/solutions/cloud-computing/public-cloud/find-partner/</p>
<p>You can also try <a href="http://redhat.force.com/finder/">Red Hat Partner Locator's</a>
advanced search. However at the time of this writing there are no partners
listed in the Cloud / Virtualization category.</p>
<p><strong>Warning:</strong> It is known that Amazon uses Xen with custom
modifications (not sure what version) and HP Cloud uses KVM but there
is not much public record about hypervisor technology used by most cloud providers.
Red Hat has partner agreements with these vendors and will commercially support 
only their platforms. This means that if you decide to use upstream Xen or anything
else not listed above, you are on your own. <strong>You have been warned!</strong></p>
<h2>Unsupported but works</h2>
<p>I'm not a big fan of running on top of unsupported environments
and I don't have the need to do so.
I've heard about people running CentOS (RHEL compatible) on VirtualBox
but I have no idea how well it works.</p>
<p>If you are using a different virtualization platform
(like LXC, OpenVZ, UML, 
<a target="_blank" href="http://www.amazon.com/s/?_encoding=UTF8&camp=1789&creative=390957&field-brandtextbin=Parallels%20Software&linkCode=ur2&node=229534&tag=atodorovorg-20">Parallels</a><img src="https://www.assoc-amazon.com/e/ir?t=atodorovorg-20&l=ur2&o=1" width="1" height="1" border="0"  style="border:none !important; margin:0px !important;" />
or other) let me know if CentOS/Fedora works on it.
Alternatively I can give it a try if you can provide me with ssh/VNC access to the machine.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 20 March 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/03/20/virtualization-platforms-supported-by-red-hat-enterprise-linux/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/03/14/django-social-auth-tip-reminder-of-login-provider/" rel="bookmark" title="Permalink to django-social-auth tip: Reminder of Login Provider">
                <h2 class="post-title">
                    django-social-auth tip: Reminder of Login Provider
                </h2>
            </a>
                <p>Every now and then users forget their passwords. This is why I prefer using
OAuth and social network accounts like GitHub or Twitter. But what do you do
when somebody forgets which OAuth provider they used to login to your site?
Your website needs a reminder. This is how to implement one if using
django-social-auth.</p>
<h2>Back-end</h2>
<p>Create a similar view on your Django back-end</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">ajax_social_auth_provider_reminder</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remind the user which social auth provider they used to login.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Not a POST&quot;</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">403</span><span class="p">)</span>

    <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span> <span class="ow">or</span> <span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;@&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Invalid address!&quot;</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s">&#39;pk&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;No user with address &#39;</span><span class="si">%s</span><span class="s">&#39; found!&quot;</span> <span class="o">%</span> <span class="n">email</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="n">providers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sa</span> <span class="ow">in</span> <span class="n">UserSocialAuth</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s">&#39;provider&#39;</span><span class="p">):</span>
        <span class="n">providers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">providers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">send_templated_mail</span><span class="p">(</span>
            <span class="n">template_name</span><span class="o">=</span><span class="s">&#39;social_provider_reminder&#39;</span><span class="p">,</span>
            <span class="n">from_email</span><span class="o">=</span><span class="s">&#39;Difio &lt;reminder@dif.io&gt;&#39;</span><span class="p">,</span>
            <span class="n">recipient_list</span><span class="o">=</span><span class="p">[</span><span class="n">email</span><span class="p">],</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;providers&#39;</span> <span class="p">:</span> <span class="n">providers</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Reminder sent to &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">email</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;User found but no social providers found!&quot;</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</pre></div>


<p>This example assumes it is called via POST request which contains the email address.
All responses are handled at the front-end via JavaScript. If a user with the specified
email address exists this address will receive a reminder listing all social auth providers
associated with the user account.</p>
<h2>Front-end</h2>
<p>On the browser side I like to use <a href="http://dojotoolkit.org">Dojo</a>.
Here is a simple script which connects to a form and POSTs the data
back to the server.</p>
<div class="highlight"><pre><span class="nx">require</span><span class="p">([</span><span class="s2">&quot;dojo&quot;</span><span class="p">]);</span>
<span class="nx">require</span><span class="p">([</span><span class="s2">&quot;dijit&quot;</span><span class="p">]);</span>

<span class="kd">function</span> <span class="nx">sendReminderForm</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s2">&quot;reminderForm&quot;</span><span class="p">);</span>

    <span class="nx">dojo</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">form</span><span class="p">,</span> <span class="s2">&quot;onsubmit&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
        <span class="nx">dojo</span><span class="p">.</span><span class="nx">stopEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
        <span class="nx">dijit</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s2">&quot;dlgForgot&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">xhrArgs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">form</span><span class="o">:</span> <span class="nx">form</span><span class="p">,</span>
            <span class="nx">handleAs</span><span class="o">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="nx">load</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span><span class="nx">alert</span><span class="p">(</span><span class="nx">data</span><span class="p">);},</span>
            <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">ioargs</span><span class="p">){</span><span class="nx">alert</span><span class="p">(</span><span class="nx">ioargs</span><span class="p">.</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);}</span>
        <span class="p">};</span>
        <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">xhrPost</span><span class="p">(</span><span class="nx">xhrArgs</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="nx">sendReminderForm</span><span class="p">);</span>
</pre></div>


<p>You can try this out at <a href="http://www.dif.io">Difio</a> and let me know how it works for you!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 14 March 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/03/14/django-social-auth-tip-reminder-of-login-provider/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/03/07/python-twitter-django-social-auth-hello-new-user/" rel="bookmark" title="Permalink to Python Twitter + django-social-auth == Hello New User">
                <h2 class="post-title">
                    Python Twitter + django-social-auth == Hello New User
                </h2>
            </a>
                <p>I have been experimenting with the <a href="https://pypi.python.org/pypi/twitter">twitter</a>
module for Python and decided to combine it with 
<a href="https://github.com/omab/django-social-auth">django-social-auth</a> to welcome new
users who join <a href="http://www.dif.io">Difio</a>. In this post I will show you how to
tweet on behalf of the user when they join your site and send them a welcome email.</p>
<h2>Configuration</h2>
<p>In django-social-auth the authentication workflow is handled by an operations
pipeline where custom functions can be added or default items can be removed to
provide custom behavior. This is how our pipeline looks:</p>
<div class="highlight"><span class="filename">settings.py</span><pre><span class="n">SOCIAL_AUTH_PIPELINE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;social_auth.backends.pipeline.social.social_auth_user&#39;</span><span class="p">,</span>
    <span class="c">#&#39;social_auth.backends.pipeline.associate.associate_by_email&#39;,</span>
    <span class="s">&#39;social_auth.backends.pipeline.user.get_username&#39;</span><span class="p">,</span>
    <span class="s">&#39;social_auth.backends.pipeline.user.create_user&#39;</span><span class="p">,</span>
    <span class="s">&#39;social_auth.backends.pipeline.social.associate_user&#39;</span><span class="p">,</span>
    <span class="s">&#39;social_auth.backends.pipeline.social.load_extra_data&#39;</span><span class="p">,</span>
    <span class="s">&#39;social_auth.backends.pipeline.user.update_user_details&#39;</span><span class="p">,</span>
    <span class="s">&#39;myproject.tasks.welcome_new_user&#39;</span>
<span class="p">)</span>
</pre></div>


<p>This is the default plus an additional method at the end to welcome new users.</p>
<p>You also have to create and configure a Twitter application so that users
can login with Twitter OAuth to your site.
<a href="http://django-social-auth.readthedocs.org/en/latest/backends/index.html">RTFM</a>
for more information on how to do this.</p>
<h2>Custom pipeline actions</h2>
<p>This is how the custom pipeline action should look:</p>
<div class="highlight"><span class="filename">myproject/tasks.py</span><pre><span class="kn">from</span> <span class="nn">urlparse</span> <span class="kn">import</span> <span class="n">parse_qs</span>

<span class="k">def</span> <span class="nf">welcome_new_user</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">social_user</span><span class="p">,</span> <span class="n">is_new</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">new_association</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Part of SOCIAL_AUTH_PIPELINE. Works with django-social-auth==0.7.21 or newer</span>
<span class="sd">        @backend - social_auth.backends.twitter.TwitterBackend (or other) object</span>
<span class="sd">        @user - User (if is_new) or django.utils.functional.SimpleLazyObject (if new_association)</span>
<span class="sd">        @social_user - UserSocialAuth object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_new</span><span class="p">:</span>
        <span class="n">send_welcome_email</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">first_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">backend</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;twitter&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_new</span> <span class="ow">or</span> <span class="n">new_association</span><span class="p">:</span>
            <span class="n">access_token</span> <span class="o">=</span> <span class="n">social_user</span><span class="o">.</span><span class="n">extra_data</span><span class="p">[</span><span class="s">&#39;access_token&#39;</span><span class="p">]</span>
            <span class="n">parsed_tokens</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span>
            <span class="n">oauth_token</span> <span class="o">=</span> <span class="n">parsed_tokens</span><span class="p">[</span><span class="s">&#39;oauth_token&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">oauth_secret</span> <span class="o">=</span> <span class="n">parsed_tokens</span><span class="p">[</span><span class="s">&#39;oauth_token_secret&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tweet_on_join</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">oauth_token</span><span class="p">,</span> <span class="n">oauth_secret</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">None</span>
</pre></div>


<p>This code works with django-social-auth==0.7.21 or newer. In older versions the
<code>new_association</code> parameter is missing as 
<a href="https://groups.google.com/forum/?fromgroups=#!topic/django-social-auth/Nxf-0iRD27Y">I discovered</a>.
If you use an older version you won't be able to distinguish between newly created
accounts and ones which have associated another OAuth backend. You are warned!</p>
<h2>Tweet &amp; email</h2>
<p>Sending the welcome email is out of the scope of this post. I am using
<a href="https://github.com/bradwhittington/django-templated-email">django-templated-email</a>
to define how emails look and sending them via Amazon SES. See 
<a href="/blog/2013/02/28/email-logging-django-redhat-openshift-amazon-ses/">Email Logging for Django on RedHat OpenShift With Amazon SES</a>
for more information on how to configure emailing with SES.</p>
<p>Here is how the Twitter code looks:</p>
<div class="highlight"><span class="filename">myproject/tasks.py</span><pre><span class="kn">import</span> <span class="nn">twitter</span>
<span class="kn">from</span> <span class="nn">celery.task</span> <span class="kn">import</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="n">TWITTER_CONSUMER_KEY</span><span class="p">,</span> <span class="n">TWITTER_CONSUMER_SECRET</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">tweet_on_join</span><span class="p">(</span><span class="n">oauth_token</span><span class="p">,</span> <span class="n">oauth_secret</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tweet when the user is logged in for the first time or</span>
<span class="sd">        when new Twitter account is associated.</span>

<span class="sd">        @oauth_token - string</span>
<span class="sd">        @oauth_secret - string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">twitter</span><span class="o">.</span><span class="n">Twitter</span><span class="p">(</span>
            <span class="n">auth</span><span class="o">=</span><span class="n">twitter</span><span class="o">.</span><span class="n">OAuth</span><span class="p">(</span>
                <span class="n">oauth_token</span><span class="p">,</span> <span class="n">oauth_secret</span><span class="p">,</span>
                <span class="n">TWITTER_CONSUMER_KEY</span><span class="p">,</span> <span class="n">TWITTER_CONSUMER_SECRET</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">statuses</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s">&#39;Started following open source changes at http://www.dif.io!&#39;</span><span class="p">)</span>
</pre></div>


<p>This will post a new tweet on behalf of the user, telling everyone they joined
your website!</p>
<p><strong>NOTE:</strong>
<code>tweet_on_join</code> and <code>send_welcome_email</code> are Celery tasks, not ordinary Python
functions. This has the advantage of being able to execute these actions async
and not slow down the user interface.</p>
<p>Are you doing something special when a user joins your website? Please share
your comments below. Thanks!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 07 March 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/03/07/python-twitter-django-social-auth-hello-new-user/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/03/06/tip-delete-user-profiles-django-social-auth/" rel="bookmark" title="Permalink to Tip: Delete User Profiles with django-social-auth">
                <h2 class="post-title">
                    Tip: Delete User Profiles with django-social-auth
                </h2>
            </a>
                <p>Common functionality for websites is the 'DELETE ACCOUNT' or 'DISABLE ACCOUNT'
button. This is how to implement it if using 
<a href="https://github.com/omab/django-social-auth">django-social-auth</a>.</p>
<div class="highlight"><span class="filename">views.py</span><pre><span class="n">delete_objects_for_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="c"># optional</span>
<span class="n">UserSocialAuth</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.views.logout&#39;</span><span class="p">))</span>
</pre></div>


<p>This snippet does the following:</p>
<ul>
<li>Delete (or archive) all objects for the current user;</li>
<li>Delete the social auth profile(s) because there is no way to disable them.
DSA will create new objects if the user logs in again;</li>
<li>Disable the <code>User</code> object. You could also delete it but mind foreign keys;</li>
<li>Clear the email for the <code>User</code> object - if a new user is created after deletion
we don't want duplicated email addresses in the database;</li>
<li>Finally redirect the user to the logout view.</li>
</ul>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 06 March 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/03/06/tip-delete-user-profiles-django-social-auth/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/02/28/email-logging-django-redhat-openshift-amazon-ses/" rel="bookmark" title="Permalink to Email Logging for Django on RedHat OpenShift with Amazon SES">
                <h2 class="post-title">
                    Email Logging for Django on RedHat OpenShift with Amazon SES
                </h2>
            </a>
                <p>Sending email in the cloud can be tricky. IPs of cloud providers are blacklisted
because of frequent abuse. For that reason I use
<a href="http://aws.amazon.com/ses/">Amazon SES</a> as my email backend. Here is how to
configure <a href="https://www.djangoproject.com/">Django</a> to send emails to site admins
when something goes wrong.</p>
<div class="highlight"><span class="filename">settings.py</span><pre><span class="c"># Valid addresses only.</span>
<span class="n">ADMINS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s">&#39;Alexander Todorov&#39;</span><span class="p">,</span> <span class="s">&#39;atodorov@example.com&#39;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;mail_admins&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;django.utils.log.AdminEmailHandler&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;django.request&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;mail_admins&#39;</span><span class="p">],</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="c"># Used as the From: address when reporting errors to admins</span>
<span class="c"># Needs to be verified in Amazon SES as a valid sender</span>
<span class="n">SERVER_EMAIL</span> <span class="o">=</span> <span class="s">&#39;django@example.com&#39;</span>

<span class="c"># Amazon Simple Email Service settings</span>
<span class="n">AWS_SES_ACCESS_KEY_ID</span> <span class="o">=</span> <span class="s">&#39;xxxxxxxxxxxx&#39;</span>
<span class="n">AWS_SES_SECRET_ACCESS_KEY</span> <span class="o">=</span> <span class="s">&#39;xxxxxxxx&#39;</span>
<span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="s">&#39;django_ses.SESBackend&#39;</span>
</pre></div>


<p>You also need the <a href="https://github.com/hmarr/django-ses">django-ses</a>
dependency.</p>
<p>See <a href="http://docs.djangoproject.com/en/dev/topics/logging">http://docs.djangoproject.com/en/dev/topics/logging</a> for
more details on how to customize your logging configuration.</p>
<p>I am using this configuration successfully at RedHat's OpenShift PaaS environment.
Other users have
<a href="https://openshift.redhat.com/community/forums/express/missing-email-on-500-ise-w-django">reported</a>
it works for them too. Should work with any other PaaS provider.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 28 February 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/02/28/email-logging-django-redhat-openshift-amazon-ses/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/02/21/tip-generating-directory-listings-with-wget/" rel="bookmark" title="Permalink to Tip: Generating Directory Listings with wget">
                <h2 class="post-title">
                    Tip: Generating Directory Listings with wget
                </h2>
            </a>
                <p>Today I was looking to generate a list of all files under remote site directory,
including sub directories. I found no built-in options for this in
<a href="https://www.gnu.org/software/wget/">wget</a>. This is how I did it:</p>
<div class="highlight"><pre>wget http://example.com/dir/ --spider -r -np 2&gt;&amp;1 | grep http:// | tr -s &#39; &#39; | cut -f3 -d&#39; &#39;
</pre></div>


<p>I managed to retrieve 12212 entries from the URL I was exploring.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 21 February 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/02/21/tip-generating-directory-listings-with-wget/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/02/13/secure-vnc-installation-red-hat-enterprise-linux/" rel="bookmark" title="Permalink to Secure VNC Installation of Red Hat Enterprise Linux 6">
                <h2 class="post-title">
                    Secure VNC Installation of Red Hat Enterprise Linux 6
                </h2>
            </a>
                <p><img src="/images/rhel6_welcome.png" alt="RHEL 6 welcome screen" />
Image CC-BY-SA,
<a href="https://access.redhat.com/knowledge/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Installation_Guide/sn-welcome-s390.html">Red Hat</a></p>
<p>From time to time I happen to remotely
<a href="http://otb.bg">install Red Hat Enterprise Linux</a>
servers via the Internet.
When the system configuration is not decided upfront you need
to use interactive mode. This means VNC in my case.</p>
<p>In this tutorial I will show you how to make VNC installations more secure
when using public networks to connect to the server.</p>
<h2>Meet your tools</h2>
<p>Starting with Red Hat Enterprise Linux 6 and all the latest Fedora releases, the
installer supports SSH connections during install.</p>
<blockquote>
<p>Note that by default, root has a blank password.</p>
<p>If you don't want any user to be able to ssh in and have full access to your hardware, 
you must specify sshpw for username root. Also note that if Anaconda fails to parse the 
kickstart file, it will allow anyone to login as root and have full access to your hardware.</p>
<p>Fedora Kickstart manual https://fedoraproject.org/wiki/Anaconda/Kickstart#sshpw</p>
</blockquote>
<h2>Preparation</h2>
<p>We are going to use SSH port forwarding and tunnel VNC traffic through it.
Create a kickstart file as shown below:</p>
<div class="highlight"><pre>install
url --url http://example.com/path/to/rhel6
lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --bootproto dhcp
vnc --password=s3cr3t
sshpw --user=root s3cr3t
</pre></div>


<p>The first 5 lines configure the loader portion of the installer. They will setup
networking and fetch the installer image called stage2. This is completely automated.
<strong>NB:</strong> If you miss some of the lines or have a syntax error the installer will prompt for
values. You either need a remote console access or somebody present at the server console!</p>
<p>The last 2 lines configure passwords for VNC and SSH respectively.</p>
<p>Make this file
<a href="https://fedoraproject.org/wiki/Anaconda/Kickstart#Chapter_6._Making_the_Kickstart_File_Available">available</a>
over HTTP(S), FTP or NFS.</p>
<p><strong>NB:</strong> Make sure that the file is available on the same network where your server is,
or use HTTPS if on public networks.</p>
<h2>Installation</h2>
<p>Now, using your favorite installation media start the
installation process like this: </p>
<div class="highlight"><pre><span class="n">boot</span><span class="o">:</span> <span class="n">linux</span> <span class="n">sshd</span><span class="o">=</span><span class="mi">1</span> <span class="n">ks</span><span class="o">=</span><span class="n">http</span><span class="o">://</span><span class="n">example</span><span class="o">.</span><span class="na">com</span><span class="o">/</span><span class="n">ks</span><span class="o">.</span><span class="na">cfg</span>
</pre></div>


<p>After a minute or more the installer will load stage2, with the
interactive VNC session. You need to know the IP address or hostname
of the server. Either look into DHCP logs, have somebody look at the
server console and tell you that (it's printed on tty1) or script it in
a <a href="https://fedoraproject.org/wiki/Anaconda/Kickstart#Chapter_4._Pre-installation_Script">%pre</a>
script which will send you an email for example.</p>
<p>When ready, redirect one of your local ports through SSH to the VNC port on the server:</p>
<div class="highlight"><pre><span class="nv">$ </span>ssh -L 5902:localhost:5901 -N root@server.example.com
</pre></div>


<p>Now connect to DISPLAY :2 on your system to begin the installation:</p>
<div class="highlight"><pre><span class="nv">$ </span>vncviewer localhost:2 <span class="p">&amp;</span>
</pre></div>


<h2>Warning Bugs Present</h2>
<p>As it happens, I find bugs everywhere. This is no exception.
Depending on your network/DHCP configuration IP address during install may 
change mid-air and cause VNC client connection to freeze.</p>
<p>The reason for this bug is evident from the code (rhel6-branch):</p>
<div class="highlight"><span class="filename">iw/timezone_gui.py</span><pre><span class="k">if</span> <span class="ow">not</span> <span class="n">anaconda</span><span class="o">.</span><span class="n">isKickstart</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">utcCheckbox</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="ow">not</span> <span class="n">hasWindows</span><span class="p">(</span><span class="n">anaconda</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">bootloader</span><span class="p">))</span>
</pre></div>


<div class="highlight"><span class="filename">textw/timezone_text.py</span><pre><span class="k">if</span> <span class="ow">not</span> <span class="n">anaconda</span><span class="o">.</span><span class="n">isKickstart</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasWindows</span><span class="p">(</span><span class="n">anaconda</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">bootloader</span><span class="p">):</span>
    <span class="n">asUtc</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>


<p>Because we are using a kickstart file Anaconda will assume the system clock <strong>DOES NOT</strong>
use UTC. If you forget to configure it manually you may see time on the server shifting
back or forward (depending on your timezone) while installing. If your DHCP is configured
for short lease time the address will expire before the installation completes. When new
address is requested from DHCP it may be different and this will cause your VNC connection
to freeze.</p>
<p>To workaround this issue select the appropriate value for the system clock settings during install
and possibly use static IP address during the installation.</p>
<h2>Feedback</h2>
<p>As always I'd love to hear your feedback in the comments section below. Let me know 
your tips and tricks to perform secure remote installations using public networks.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 13 February 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/02/13/secure-vnc-installation-red-hat-enterprise-linux/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2013/01/31/tip-save-money-on-amazon-buy-used-books/" rel="bookmark" title="Permalink to Tip: Save Money on Amazon - Buy Used Books">
                <h2 class="post-title">
                    Tip: Save Money on Amazon - Buy Used Books
                </h2>
            </a>
                <p>I like to buy books, the real ones, printed on paper. This however comes at
a certain price when buying from Amazon. The book price itself is
usually bearable but many times shipping costs to Bulgaria
will double the price. Especially if you are making a single book order.</p>
<p>To save money I started buying used books when available. For books that are
not so popular I look for items that have been owned by a library.</p>
<p>This is how I got a hardcover 1984 edition of
<a href="http://www.amazon.com/gp/product/190676820X/ref=as_li_ss_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=190676820X&linkCode=as2&tag=atodorovorg-20">The Gentlemen's Clubs of London</a><img src="http://www.assoc-amazon.com/e/ir?t=atodorovorg-20&l=as2&o=1&a=190676820X" width="1" height="1" border="0"  style="border:none !important; margin:0px !important;" />
by Anthony Lejeune for $10. This is my best deal so far.
The book was brand new I dare to say. There was no edge wear, no damaged pages,
with nice and vibrant colors. The second page had the library sign and no other marks.</p>
<p>Let me know if you had an experience buying used books online? Did you score a great
deal like I did?</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 31 January 2013
            </p>
<p>There are <a href="http://atodorov.org/blog/2013/01/31/tip-save-money-on-amazon-buy-used-books/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2012/07/12/combining-pdf-files-on-the-command-line/" rel="bookmark" title="Permalink to Combining PDF Files On The Command Line">
                <h2 class="post-title">
                    Combining PDF Files On The Command Line
                </h2>
            </a>
                <p><strong>VERSION</strong></p>
<p>Red Hat Enterprise Linux 6</p>
<p><strong>PROBLEM</strong></p>
<p>You have to create a single PDF file by combining multiple files -
for example individually scanned pages.</p>
<p><strong>ASSUMPTIONS</strong></p>
<p>You know how to start a shell and havigate to the directory containing the files.</p>
<p><strong>SOLUTION</strong></p>
<p>If individual PDF files are named, for example, <code>doc_01.pdf</code>, <code>doc_02.pdf</code>, <code>doc_03.pdf</code>,
<code>doc_04.pdf</code>, then you can combine them with the <code>gs</code> command:</p>
<div class="highlight"><pre>    $ gs -dBATCH -dNOPAUSE -sDEVICE=pdfwrite -sOutputFile=mydocument.pdf doc_*.pdf
</pre></div>


<p>The resulting PDF file will contain all pages from the individual files.</p>
<p><strong>MORE INFO</strong></p>
<p>The <code>gs</code> command is part of the <a href="http://www.ghostscript.com/">ghostscript</a> rpm package.
You can find more about it using <code>man gs</code>, the documentation file <code>/usr/share/doc/ghostscript-*/index.html</code>
or <a href="http://www.ghostscript.com">http://www.ghostscript.com</a>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 12 July 2012
            </p>
<p>There are <a href="http://atodorov.org/blog/2012/07/12/combining-pdf-files-on-the-command-line/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2012/03/14/openshift-cron-takes-over-celerybeat/" rel="bookmark" title="Permalink to OpenShift Cron Takes Over Celerybeat">
                <h2 class="post-title">
                    OpenShift Cron Takes Over Celerybeat
                </h2>
            </a>
                <p><a href="http://celeryproject.org/"><em>Celery</em></a> is an asynchronous task queue/job queue
based on distributed message passing. You can define tasks as Python functions,
execute them in the background and in a periodic fashion.
<a href="http://www.dif.io"><em>Difio</em></a> uses <em>Celery</em> for virtually everything.
Some of the tasks are scheduled after some event takes place (like user pressed a button)
or scheduled periodically.</p>
<p><em>Celery</em> provides several components of which <em>celerybeat</em> is the periodic task scheduler.
When combined with <a href="http://djangoproject.com"><em>Django</em></a> it gives you a very nice admin interface
which allows periodic tasks to be added to the scheduler.</p>
<h2>Why change</h2>
<p><em>Difio</em> has relied on <em>celerybeat</em> for a couple of months. Back then, when <em>Difio</em> launched,
there was no cron support for OpenShift so running <em>celerybeat</em> sounded reasonable.
It used to run on a dedicated virtual server and for most of the time that was fine. </p>
<p>There were a number of issues which <em>Difio</em> faced during its first months:</p>
<ul>
<li>
<p><em>celerybeat</em> would sometime die due to no free memory on the virtual instance.
When that happened no new tasks were scheduled and data was left unprocessed.
Let alone that higher memory instance and the processing power which comes with it
cost extra money.</p>
</li>
<li>
<p><em>Difio</em> is split into several components which need to have the same code base
locally - the most important are database settings and the periodic tasks
code. At least in one occasion <em>celerybeat</em> failed to start because of a buggy 
task code. The offending code was fixed in the application server on OpenShift but
not properly synced to the <em>celerybeat</em> instance. Keeping code in sync is a priority
for distributed projects which rely on <em>Celery</em>.</p>
</li>
<li>
<p><em>Celery</em> and <em>django-celery</em> seem to be updated quite often. This poses a significant risk
of ending up with different versions on the scheduler, worker nodes and the app server. This will
bring the whole application to a halt if at some point a backward incompatible change is introduced
and not properly tested and updated. Keeping infrastructure components in sync can be a big challenge
and I try to minimize this effort as much as possible.</p>
</li>
<li>
<p>Having to navigate to the admin pages every time I add a new task or want to change the execution
frequency doesn't feel very natural for a console user like myself and IMHO is less productive.
For the record I primarily use <em>mcedit</em>. I wanted to have something more close to the
write, commit and push work-flow.</p>
</li>
</ul>
<h2>The take over</h2>
<p>It's been some time since OpenShift
<a href="https://www.redhat.com/openshift/community/blogs/getting-started-with-cron-jobs-on-openshift">introduced</a>
the cron cartridge and I decided to give it a try.</p>
<p>The first thing I did is to write a simple script which can execute any task from the difio.tasks module
by piping it to the Django shell (a Python shell actually).</p>
<div class="highlight"><span class="filename">run_celery_task</span><pre><span class="c">#!/bin/bash</span>
<span class="c">#</span>
<span class="c"># Copyright (c) 2012, Alexander Todorov &lt;atodorov@nospam.otb.bg&gt;</span>
<span class="c">#</span>
<span class="c"># This script is symlinked to from the hourly/minutely, etc. directories</span>
<span class="c">#</span>
<span class="c"># SYNOPSIS</span>
<span class="c">#</span>
<span class="c"># ./run_celery_task cron_search_dates</span>
<span class="c">#</span>
<span class="c"># OR</span>
<span class="c">#</span>
<span class="c"># ln -s run_celery_task cron_search_dates</span>
<span class="c"># ./cron_search_dates</span>
<span class="c">#</span>

<span class="nv">TASK_NAME</span><span class="o">=</span><span class="nv">$1</span>
<span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$TASK_NAME</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nv">TASK_NAME</span><span class="o">=</span><span class="k">$(</span>basename <span class="nv">$0</span><span class="k">)</span>

<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;</span><span class="nv">$OPENSHIFT_APP_DIR</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">source</span> <span class="nv">$OPENSHIFT_APP_DIR</span>/virtenv/bin/activate
    <span class="nb">export </span><span class="nv">PYTHON_EGG_CACHE</span><span class="o">=</span><span class="nv">$OPENSHIFT_DATA_DIR</span>/.python-eggs
    <span class="nv">REPO_DIR</span><span class="o">=</span><span class="nv">$OPENSHIFT_REPO_DIR</span>
<span class="k">else</span>
    <span class="nv">REPO_DIR</span><span class="o">=</span><span class="k">$(</span>dirname <span class="nv">$0</span><span class="k">)</span><span class="s2">&quot;/../../..&quot;</span>
<span class="k">fi</span>

<span class="nb">echo</span> <span class="s2">&quot;import difio.tasks; difio.tasks.</span><span class="nv">$TASK_NAME</span><span class="s2">.delay()&quot;</span> <span class="p">|</span> <span class="nv">$REPO_DIR</span>/wsgi/difio/manage.py shell
</pre></div>


<p>This is a multicall script which allows symlinks with different names to point to it. 
Thus to add a new task to cron I just need to make a symlink to the script from one of the
hourly/, minutely/, daily/, etc. directories under cron/.</p>
<p>The script accepts a parameter as well which allows me to execute it locally for debugging purposes
or to schedule some tasks out of band.
This is how it looks like on the file system:</p>
<div class="highlight"><pre><span class="nv">$ </span>ls -l .openshift/cron/hourly/
some_task_name -&gt; ../tasks/run_celery_task
another_task -&gt; ../tasks/run_celery_task
</pre></div>


<p>After having done these preparations I only had to embed the cron cartridge and git push to OpenShift:</p>
<div class="highlight"><pre>rhc-ctl-app -a difio -e add-cron-1.4 &amp;&amp; git push
</pre></div>


<h2>What's next</h2>
<p>At present OpenShift can schedule your jobs every minute, hour, day, week or month and does so using the
<em>run-parts</em> script. You can't schedule a script to execute at 4:30 every Monday or every 45 minutes for example.
See <a href="https://bugzilla.redhat.com/show_bug.cgi?id=803485">rhbz #803485</a> if you want to follow the
progress. Luckily <em>Difio</em> doesn't use this sort of job scheduling for the moment.</p>
<p><em>Difio</em> is scheduling periodic tasks from OpenShift cron for a few days already. 
It seems to work reliably and with no issues. One less component to maintain and worry about.
More time to write code.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 14 March 2012
            </p>
<p>There are <a href="http://atodorov.org/blog/2012/03/14/openshift-cron-takes-over-celerybeat/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2012/03/09/how-to-get-to-the-openshift-shell/" rel="bookmark" title="Permalink to Tip: How to Get to the OpenShift Shell">
                <h2 class="post-title">
                    Tip: How to Get to the OpenShift Shell
                </h2>
            </a>
                <p>I wanted to examine the Perl environment on OpenShift and got tired of making snapshots,
unzipping the archive and poking through the files. I wanted a shell. Here's how to get one.</p>
<ol>
<li>
<p>Get the application info first</p>
<div class="highlight"><pre><span class="nv">$ </span>rhc-domain-info 
Password: 
Application <span class="nv">Info</span>
<span class="o">================</span>
myapp
    Framework: perl-5.10
     Creation: 2012-03-08T13:34:46-04:00
         UUID: 8946b976ad284cf5b2401caf736186bd
      Git URL: ssh://8946b976ad284cf5b2401caf736186bd@myapp-mydomain.rhcloud.com/~/git/myapp.git/
   Public URL: http://myapp-mydomain.rhcloud.com/

 Embedded: 
      None
</pre></div>


</li>
<li>
<p>The Git URL has your username and host</p>
</li>
<li>
<p>Now just ssh into the application</p>
<div class="highlight"><pre><span class="nv">$ </span>ssh 8946b976ad284cf5b2401caf736186bd@myapp-mydomain.rhcloud.com

    Welcome to OpenShift shell

    This shell will assist you in managing OpenShift applications.

    !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!
    Shell access is quite powerful and it is possible <span class="k">for</span> you to
    accidentally damage your application.  Proceed with care!
    If worse comes to worst, destroy your application with <span class="s1">&#39;rhc app destroy&#39;</span>
    and recreate it
    !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!

    Type <span class="s2">&quot;help&quot;</span> <span class="k">for</span> more info.

<span class="o">[</span>myapp-mydomain.rhcloud.com ~<span class="o">]</span><span class="se">\&gt;</span>
</pre></div>


</li>
</ol>
<p><strong>Voila!</strong></p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 09 March 2012
            </p>
<p>There are <a href="http://atodorov.org/blog/2012/03/09/how-to-get-to-the-openshift-shell/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2012/02/18/how-to-update-dependencies-on-openshift/" rel="bookmark" title="Permalink to How to Update Dependencies on OpenShift">
                <h2 class="post-title">
                    How to Update Dependencies on OpenShift
                </h2>
            </a>
                <p>If you are already running some cool application on <a href="http://openshift.redhat.com">OpenShift</a>
it could be the case that you have to update some of the packages installed as dependencies.
Here is an example for an application using the python-2.6 cartridge.</p>
<h2>Pull latest upstream packages</h2>
<p>The most simple method is to update everything to the latest upstream versions. </p>
<ol>
<li>
<p>Backup! Backup! Backup!</p>
<div class="highlight"><pre>rhc-snapshot -a mycoolapp
mv mycoolapp.tar.gz mycoolapp-backup-before-update.tar.gz
</pre></div>


</li>
<li>
<p>If you haven't specified any particular version in <code>setup.py</code> it will
look like this:</p>
<div class="highlight"><pre><span class="o">...</span>
<span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
                <span class="s">&#39;difio-openshift-python&#39;</span><span class="p">,</span>
                <span class="s">&#39;MySQL-python&#39;</span><span class="p">,</span>
                <span class="s">&#39;Markdown&#39;</span><span class="p">,</span>
               <span class="p">],</span>
<span class="o">...</span>
</pre></div>


</li>
<li>
<p>To update simply push to OpenShift instructing it to rebuild your virtualenv:</p>
<div class="highlight"><pre>cd mycoolapp/
touch .openshift/markers/force_clean_build
git add .openshift/markers/force_clean_build
git commit -m &quot;update to latest upstream&quot;
git push
</pre></div>


</li>
</ol>
<p>Voila! The environment hosting your application is rebuilt from scratch.</p>
<h2>Keeping some packages unchanged</h2>
<p>Suppose that before the update you have <code>Markdown-2.0.1</code> and you want to keep it!
This is easily solved by adding versioned dependency to <code>setup.py</code></p>
<div class="highlight"><pre><span class="gd">-       &#39;Markdown&#39;,</span>
<span class="gi">+       &#39;Markdown==2.0.1&#39;,</span>
</pre></div>


<p>If you do that OpenShift will install the same <code>Markdown</code> version when rebuilding your
application. Everything else will use the latest available versions.</p>
<p><strong>Note:</strong> after the update it's recommended that you remove the 
<code>.openshift/markers/force_clean_build</code> file. This will speed up the push/build process
and will not surprise you with unwanted changes.</p>
<h2>Update only selected packages</h2>
<p>Unless your application is really simple or you have tested the updates, I suspect that
you want to update only selected packages. This can be done without rebuilding the whole
virtualenv. Use versioned dependencies in <code>setup.py</code> :</p>
<div class="highlight"><pre><span class="gd">-       &#39;Markdown==2.0.1&#39;,</span>
<span class="gd">-       &#39;django-countries&#39;,</span>
<span class="gi">+       &#39;Markdown&gt;=2.1&#39;,</span>
<span class="gi">+       &#39;django-countries&gt;=1.1.2&#39;,</span>
</pre></div>


<p>No need for <code>force_clean_build</code> this time. Just</p>
<div class="highlight"><pre>    git commit &amp;&amp; git push
</pre></div>


<p>At the time of writing my application was using <code>Markdown-2.0.1</code> and <code>django-countries-1.0.5</code>.
Then it updated to <code>Markdown-2.1.1</code> and <code>django-countires-1.1.2</code> which also happened to be
the latest versions.</p>
<p><strong>Note:</strong> this will not work without <code>force_clean_build</code></p>
<div class="highlight"><pre><span class="gd">-       &#39;django-countries==1.0.5&#39;,</span>
<span class="gi">+       &#39;django-countries&#39;,</span>
</pre></div>


<h2>Warning</h2>
<p>OpenShift uses a local mirror of <a href="http://pypi.python.org">Python Package Index</a>.
It seems to be updated every 24 hours or so. Have this in mind if you want to update
to a package that was just released. It will not work! See
<a href="/blog/2013/04/24/how-to-deploy-python-hotfix-on-redhat-openshift-cloud/">How to Deploy Python Hotfix on OpenShift</a>
if you wish to work around this limitation.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Sat 18 February 2012
            </p>
<p>There are <a href="http://atodorov.org/blog/2012/02/18/how-to-update-dependencies-on-openshift/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2012/02/10/spinning-up-a-development-instance-on-openshift/" rel="bookmark" title="Permalink to Spinning-up a Development Instance on OpenShift">
                <h2 class="post-title">
                    Spinning-up a Development Instance on OpenShift
                </h2>
            </a>
                <p><a href="http://www.dif.io">Difio</a> is hosted on <a href="http://openshift.redhat.com">OpenShift</a>.
During development I often need to spin-up another copy of Difio to use for testing and development.
With OpenShift this is easy and fast. Here's how:</p>
<ol>
<li>
<p>Create another application on OpenShift. This will be your development instance.</p>
<div class="highlight"><pre>rhc-create-app -a myappdevel -t python-2.6
</pre></div>


</li>
<li>
<p>Find out the git URL for the production application:</p>
<div class="highlight"><pre><span class="nv">$ </span>rhc-user-info
Application <span class="nv">Info</span>
<span class="o">================</span>
myapp
    Framework: python-2.6
     Creation: 2012-02-10T12:39:53-05:00
         UUID: 723f0331e17041e8b34228f87a6cf1f5
      Git URL: ssh://723f0331e17041e8b34228f87a6cf1f5@myapp-mydomain.rhcloud.com/~/git/myapp.git/
   Public URL: http://myapp-mydomain.rhcloud.com/
</pre></div>


</li>
<li>
<p>Push the current code base from the production instance to devel instance:</p>
<div class="highlight"><pre>cd myappdevel
git remote add production -m master ssh://723f0331e17041e8b34228f87a6cf1f5@myapp-mydomain.rhcloud.com/~/git/myapp.git/
git pull -s recursive -X theirs production master
git push
</pre></div>


</li>
<li>
<p>Now your <code>myappdevel</code> is the same as your production instance. You will probably want to
modify your database connection settings at this point and start adding new features.</p>
</li>
</ol>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 10 February 2012
            </p>
<p>There are <a href="http://atodorov.org/blog/2012/02/10/spinning-up-a-development-instance-on-openshift/#disqus_thread">comments</a>.</p>        </div>

    <hr>
    <!-- Pager -->
    <ul class="pager">
        <li class="next">
                <a href="http://atodorov.org/blog/categories/tips/index.html">Newest Posts &rarr;</a>
        </li>
    </ul>
    Page 2 / 2
    <hr>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/atodorov_">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/atodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://bg.linkedin.com/in/alextodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://feeds.feedburner.com/atodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<section>
    <p>
        I am a QA contractor at Red Hat responsible for finding over
        <a href="/blog/2014/02/19/7-years-1400-bugs-red-hat-qa/">1600 bugs</a>,
        a general purpose open source developer, Red Hat Certified professional,
        cloud hacker and an entrepreneur! My latest start-up is
        <a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=footer">Mr. Senko</a>!
    </p>
    <p>
        I am living in the <a href="http://planet.sofiavalley.com">Sofia Valley</a>
        which is emerging as a busy place for start-up founders and tech enthusiasts
        in Eastern Europe! You can find more about me <a href="/blog/2013/01/25/about-me/">here</a>.
    </p>
    <p>
        <small>
            <em>
                Some of the links contained within this site have my referral id (e.g.,
                <a target="_blank" href="http://www.amazon.com/ref=as_li_ss_tl?_encoding=UTF8&camp=1789&creative=390957&linkCode=ur2&tag=atodorovorg-20&linkId=L6Q34XAXQS5RDMOY">Amazon</a><img src="https://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=ur2&o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />),
                which provides me with a small commission for each sale. Thank you for your support.
            </em>
        </small>
    </p>
</section>

<form action="http://google.com/search" method="get" style="width:300px;margin:0 auto;">
    <fieldset role="search">
        <input type="hidden" name="sitesearch" value="http://atodorov.org" />
        <input class="search" type="text" name="q" placeholder="Search" style="width:100%"/>
    </fieldset>
</form>

<p class="copyright text-muted">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">CC-BY-SA</a> &amp;
    <a rel="license" href="http://opensource.org/licenses/MIT">MIT</a>
    2011-2016 &diams; Alexander Todorov &diams;
    <a href="http://planet.sofiavalley.com">SofiaValley Blog</a>
</p>

<script type='text/javascript'>
window.__lo_site_id = 55936;
    (function() {
        var wa = document.createElement('script'); wa.type = 'text/javascript'; wa.async = true;
        wa.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://cdn') + '.luckyorange.com/w.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(wa, s);
      })();
</script>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="http://atodorov.org/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="http://atodorov.org/theme/js/bootstrap.min.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37979549-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'atodorov';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>