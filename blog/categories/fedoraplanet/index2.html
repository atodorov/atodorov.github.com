<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

            <meta name="google-site-verification" content="XynqZtldWNBbmsynVQZremIxaaO8Wgs6AGR8UZ7KIkM">

        <title>atodorov.org - Tag fedora.planet</title>

        <link href="http://feeds.feedburner.com/atodorov" type="application/atom+xml" rel="alternate" title="atodorov.org Full Atom Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="http://atodorov.org/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="http://atodorov.org/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="http://atodorov.org/theme/css/code_blocks/github.css" rel="stylesheet">

            <!-- CSS specified by the user -->
            <link href="http://atodorov.org/override.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

            <meta property="fb:admins" content="1616937247" />
                <meta property="og:locale" content="en_US">
		<meta property="og:site_name" content="atodorov.org">

            <meta name="twitter:card" content="summary_large_image">
            <meta name="twitter:site" content="@atodorov_">
            <meta name="twitter:title" content="atodorov.org">
            <meta name="twitter:description" content="you can logoff, but you can never leave">
                <meta name="twitter:image" content="http://atodorov.org//images/header_02.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://atodorov.org/">atodorov.org</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

        <header class="intro-header" style="background-image: url('/images/header_02.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="page-heading">
                        <h1>Tag fedora.planet</h1>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/12/01/commit-a-file-with-the-github-api-and-python/" rel="bookmark" title="Permalink to Commit a file with the GitHub API and Python">
                <h2 class="post-title">
                    Commit a file with the GitHub API and Python
                </h2>
            </a>
                <p>How do you commit changes to a file using the GitHub API ?
I've found
<a href="http://www.levibotelho.com/development/commit-a-file-with-the-github-api/">this post</a>
by Levi Botelho which explains the necessary steps but without any code.
So I've used it and created a
<a href="https://github.com/atodorov/api-commit-test">Python example</a>.</p>
<p>I've rearranged the steps so that all write operations follow after a certain
section in the code and also added an intermediate section which creates the
updated content based on what is available in the repository.</p>
<p>I'm just appending
versions of Markdown to the <code>.travis.yml</code> (I will explain why in my next post)
and this is hard-coded for the sake of example. All content related operations
are also based on the GitHub API because I want to be independent of the source
code being around when I push this script to a hosting provider.</p>
<p>I've tested this script against itself. In the
<a href="https://github.com/atodorov/api-commit-test/commits/master">commits log</a>
you can find the <em>Automatic update to Markdown-X.Y</em> messages. These are
from the script. Also notice the <em>Merge remote-tracking branch 'origin/master'</em>
messages, these appeared when I pulled to my local copy. I believe the
reason for this is that I have some dangling trees and/or commits from
the time I was still experimenting with a broken script. I've tested on another
clean repository and <a href="https://github.com/atodorov/bztest/commits/master">there are</a>
no such merges.</p>
<p><strong>IMPORTANT</strong></p>
<p>For this to work you need to properly authenticate with GitHub. I've crated
a new token at <a href="https://github.com/settings/tokens">https://github.com/settings/tokens</a> with the <em>public_repo</em>
permission and that works for me.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 01 December 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/12/01/commit-a-file-with-the-github-api-and-python/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/29/inspecting-method-arguments-in-python/" rel="bookmark" title="Permalink to Inspecting Method Arguments in Python">
                <h2 class="post-title">
                    Inspecting Method Arguments in Python
                </h2>
            </a>
                <p>How do you execute methods from 3rd party classes in a backward compatible
manner when these methods change their arguments ?</p>
<p>s3cmd's <a href="https://github.com/s3tools/s3cmd/pull/668">PR #668</a> is an example
of this behavior, where python-libs's <code>httplib.py</code> added a new parameter
to disable hostname checks. As a result of this
<a href="/blog/2015/11/24/python-libs-in-rhel-7.2-broke-ssl-verification-in-s3cmd/">s3cmd broke</a>.</p>
<p>One solution is to use try-except and nest as much blocks as you need to cover
all of the argument variations. In s3cmd's case we needed two nested try-except
blocks.</p>
<p>Another possibility is to use the
<a href="https://docs.python.org/3/library/inspect.html">inspect</a> module and create the argument
list passed to the method dynamically, based on what parameters are supported.
Depending on the number of parameters this may or may not be more elegant than
using try-except blocks although it looks to me a bit more human readable.</p>
<p>The argument list is a member named <em>co_varnames</em> of the code object. If you
want to get the members for a function then</p>
<div class="highlight"><pre><span class="nx">inspect</span><span class="p">.</span><span class="nx">getmembers</span><span class="p">(</span><span class="nx">my_function</span><span class="p">.</span><span class="nx">__code__</span><span class="p">)</span>
</pre></div>


<p>if you want to get the members for a class method then</p>
<div class="highlight"><pre><span class="nx">inspect</span><span class="p">.</span><span class="nx">getmembers</span><span class="p">(</span><span class="nx">MyClass</span><span class="p">.</span><span class="nx">my_method</span><span class="p">.</span><span class="nx">__function__</span><span class="p">.</span><span class="nx">__code__</span><span class="p">)</span>
</pre></div>


<p>Consider the following example</p>
<div class="highlight"><span class="filename">test.py</span><pre><span class="kn">import</span> <span class="nn">inspect</span>

<span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">greeting</span><span class="p">,</span> <span class="n">who</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">greeting</span><span class="p">,</span> <span class="n">who</span>

<span class="k">class</span> <span class="nc">V1</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Hello World&quot;</span>

    <span class="k">def</span> <span class="nf">do_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>

<span class="k">class</span> <span class="nc">V2</span><span class="p">(</span><span class="n">V1</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">greeting</span><span class="o">=</span><span class="s">&quot;Hello&quot;</span><span class="p">):</span>
        <span class="n">V1</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;Hello&#39;</span><span class="p">,</span> <span class="n">greeting</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">V3</span><span class="p">(</span><span class="n">V2</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">greeting</span><span class="o">=</span><span class="s">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">who</span><span class="o">=</span><span class="s">&quot;World&quot;</span><span class="p">):</span>
        <span class="n">V2</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">greeting</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;World&#39;</span><span class="p">,</span> <span class="n">who</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;=== Example: call the class directly ===&quot;</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">V1</span><span class="p">()</span>
    <span class="n">v1</span><span class="o">.</span><span class="n">do_print</span><span class="p">()</span>

    <span class="n">v2</span> <span class="o">=</span> <span class="n">V2</span><span class="p">(</span><span class="n">greeting</span><span class="o">=</span><span class="s">&quot;Good day&quot;</span><span class="p">)</span>
    <span class="n">v2</span><span class="o">.</span><span class="n">do_print</span><span class="p">()</span>

    <span class="n">v3</span> <span class="o">=</span> <span class="n">V3</span><span class="p">(</span><span class="n">greeting</span><span class="o">=</span><span class="s">&quot;Good evening&quot;</span><span class="p">,</span> <span class="n">who</span><span class="o">=</span><span class="s">&quot;everyone&quot;</span><span class="p">)</span>
    <span class="n">v3</span><span class="o">.</span><span class="n">do_print</span><span class="p">()</span>

    <span class="c"># uncomment to see the error raised</span>
    <span class="c">#v4 = V1(greeting=&quot;Good evening&quot;, who=&quot;everyone&quot;)</span>
    <span class="c">#v4.do_print()</span>

    <span class="k">print</span> <span class="s">&quot;=== Example: use try-except ===&quot;</span>
    <span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="p">[</span><span class="n">V1</span><span class="p">,</span> <span class="n">V2</span><span class="p">,</span> <span class="n">V3</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">greeting</span><span class="o">=</span><span class="s">&quot;Good evening&quot;</span><span class="p">,</span> <span class="n">who</span><span class="o">=</span><span class="s">&quot;everyone&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;    error: nested-try-except-1&quot;</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">greeting</span><span class="o">=</span><span class="s">&quot;Good evening&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;    error: nested-try-except-2&quot;</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>

        <span class="n">c</span><span class="o">.</span><span class="n">do_print</span><span class="p">()</span>


    <span class="k">print</span> <span class="s">&quot;=== Example: using inspect ===&quot;</span>
    <span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="p">[</span><span class="n">V1</span><span class="p">,</span> <span class="n">V2</span><span class="p">,</span> <span class="n">V3</span><span class="p">]:</span>
        <span class="n">members</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">__init__</span><span class="o">.</span><span class="n">__func__</span><span class="o">.</span><span class="n">__code__</span><span class="p">))</span>
        <span class="n">var_names</span> <span class="o">=</span> <span class="n">members</span><span class="p">[</span><span class="s">&#39;co_varnames&#39;</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="s">&#39;greeting&#39;</span> <span class="ow">in</span> <span class="n">var_names</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="s">&#39;greeting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Good morning&#39;</span>

        <span class="k">if</span> <span class="s">&#39;who&#39;</span> <span class="ow">in</span> <span class="n">var_names</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="s">&#39;who&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;children&#39;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">do_print</span><span class="p">()</span>
</pre></div>


<p>The output of the example above is as follows</p>
<div class="highlight"><pre>=== Example: call the class directly ===
Hello World
Good day World
Good evening everyone
=== Example: use try-except ===
    error: nested-try-except-1
    error: nested-try-except-2
Hello World
    error: nested-try-except-1
Good evening World
Good evening everyone
=== Example: using inspect ===
Hello World
Good morning World
Good morning children
</pre></div>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Sun 29 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/29/inspecting-method-arguments-in-python/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/26/3-new-python-markdown-extensions/" rel="bookmark" title="Permalink to 3 New Python Markdown extensions">
                <h2 class="post-title">
                    3 New Python Markdown extensions
                </h2>
            </a>
                <p>I've managed to resolve several of my issues with Python-Markdown behaving not
quite as I expect. I have the pleasure to announce three new extensions which
now power this blog.</p>
<h2>No Lazy BlockQuote Extension</h2>
<p><a href="https://github.com/atodorov/Markdown-No-Lazy-BlockQuote-Extension">Markdown-No-Lazy-BlockQuote-Extension</a>
makes it possible blockquotes separated by newline to be rendered separately.
If you want to include empty lines in your blockquotes make sure to prefix
each line with <code>&gt;</code>. The standard behavior can be seen in
<a href="https://github.com/atodorov/atodorov.github.com/blob/source/content/_posts/2014-03-04-how-do-you-test-fonts.markdown">GitHub</a>
while the changed behavior is visible
<a href="/blog/2014/03/04/how-do-you-test-fonts/">in this article</a>. Notice how on
GitHub both quotes are rendered as one big block, while here they are two separate
blocks.</p>
<h2>No Lazy Code Extension</h2>
<p><a href="https://github.com/atodorov/Markdown-No-Lazy-Code-Extension">Markdown-No-Lazy-Code-Extension</a>
allows code blocks separated by newline to be rendered separately. If you want to
include empty lines in your code blocks make sure to
<a href="https://github.com/atodorov/atodorov.github.com/commit/9684875920c6c7926951ce99b6588a9a7007e6f0">indent them as well</a>.
The standard behavior can be seen on
<a href="https://github.com/atodorov/atodorov.github.com/blob/source/content/_posts/2013-02-13-secure-vnc-installation-red-hat-enterprise-linux.markdown">GitHub</a>
while the improved one in this
<a href="/blog/2013/02/13/secure-vnc-installation-red-hat-enterprise-linux/">post</a>.
Notice how GitHub renders the code in the <strong>Warning Bugs Present</strong> section
as one block while in reality these are two separate blocks from two different files.</p>
<h2>Bugzilla Extension</h2>
<p><a href="https://github.com/atodorov/Markdown-Bugzilla-Extension">Markdown-Bugzilla-Extension</a>
allows for easy references to bugs. Strings like <code>[bz#123]</code> and <code>[rhbz#456]</code> will
be converted into links.</p>
<p>All three extensions are available on PyPI!</p>
<h2>Bonus: Codehilite with filenames in Markdown</h2>
<p>The standard Markdown codehilite extension doesn't allow to specify filename
on the <code>:::python</code> shebang line while Octopress did and I've used the syntax
on this blog in a number of articles. The fix is simple, but requires changes in
both Markdown and Pygments. See
<a href="https://github.com/waylan/Python-Markdown/pull/445">PR #445</a> for the initial
version and ongoing discussion. Example of the new <code>:::python settings.py</code> syntax
can be seen
<a href="/blog/2013/03/07/python-twitter-django-social-auth-hello-new-user/">here</a>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 26 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/26/3-new-python-markdown-extensions/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/25/blog-migration-from-octopress-to-pelican/" rel="bookmark" title="Permalink to Blog Migration: from Octopress to Pelican">
                <h2 class="post-title">
                    Blog Migration: from Octopress to Pelican
                </h2>
            </a>
                <p>Finally I have migrated this blog from <a href="http://octopress.org">Octopress</a> to
<a href="https://github.com/getpelican/pelican">Pelican</a>. I am using the
<a href="https://github.com/gilsondev/pelican-clean-blog/">clean-blog</a> theme with
<a href="https://github.com/gilsondev/pelican-clean-blog/pull/3">modifications</a>.</p>
<p>See the
<a href="https://github.com/atodorov/atodorov.github.com/commits/pelican_migration">pelican_migration</a>
branch for technical details. Here's the summary:</p>
<ul>
<li>I removed pretty much everything that Octopress uses, only left the content files;</li>
<li>I've added my own CSS overrides;</li>
<li>I had several Octopress pages, these were merged and converted into blog posts;</li>
<li>In Octopress all titles had quotes, which were removed using sed;</li>
<li>Octopress categories were converted to Pelican tags and removed quotes around them,
again using sed;</li>
<li>Manually updated Octopress's <code>{% codeblock %}</code> and <code>{% blockquote %}</code> tags to
match Pelican syntax. This is the biggest content change;</li>
<li>I was trying to keep as much as the original URLs as possible. <code>ARTICLE_URL</code>,
<code>ARTICLE_SAVE_AS</code>, <code>TAG_URL</code>, <code>TAG_SAVE_AS</code>, <code>FEED_ALL_ATOM</code> and <code>TAG_FEED_ATOM</code>
are the relevant settings. For 50+ posts I had to manually specify the <code>Slug:</code>
variable so that they match existing Octopress URLs. Verifying the resulting names
was as simple as diffing the file listings from both Octopress and Pelican.
<strong>NOTE:</strong> The <em>fedora.planet</em> tag changed its URL because there's no way
to assign slugs for tags in Pelican. The new URL is missing the dot! Luckily
I make use of this only in one place which was manually updated!</li>
</ul>
<p>I've also found a few bugs and missing functionality:</p>
<ul>
<li>There's no <code>rake new_post</code> counterpart in Pelican. See
<a href="https://github.com/getpelican/pelican/issues/1410">Issue 1410</a> and 
<a href="https://github.com/Kdecherf/blog.kdecherf.com/commit/6552f6f02e6c501a6cc13816cd9bb2cd6c601f9c">commit 6552f6f</a>.
Thanks Kevin Decherf;</li>
<li><strike>As far as I can tell the preview server doesn't regenerate files automatically.</strike>
Do <code>make regenerate</code> and <code>make serve</code> in two separate shells. Thanks Kevin Decherf;</li>
<li><strike>Pelican will merge code blocks and quotes which follow one after another
but are separated with a newline in Markdown. This makes it visually impossible
to distinguish code from two files, or quotes from two people, which are published
without any other comments in between.</strike> See
<a href="https://github.com/atodorov/Markdown-No-Lazy-BlockQuote-Extension">Markdown-No-Lazy-BlockQuote-Extension</a>
and <a href="https://github.com/atodorov/Markdown-No-Lazy-Code-Extension">Markdown-No-Lazy-Code-Extension</a>;</li>
<li><strike>The syntax doesn't allow to specify filename or a quote title when publishing
code blocks and quotes. Octopress did that easily. I will be happy with something
like <code>:::python settings.py</code>.</strike>
See <a href="https://github.com/waylan/Python-Markdown/pull/445">PR #445</a>;</li>
<li>There's no way to specify slugs for tag URLs in order to keep compatibility
with existing URLs, see <a href="https://github.com/getpelican/pelican/issues/1873">Issue 1873</a>.</li>
</ul>
<p>I will be filling Issues and pull requests for both Pelican and the clear-blog theme
in the next few days so stay tuned!</p>
<p><strong>UPDATED 2015-11-26:</strong> added links to issues, pull requests and custom extensions.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 25 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/25/blog-migration-from-octopress-to-pelican/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/24/python-libs-in-rhel-7.2-broke-ssl-verification-in-s3cmd/" rel="bookmark" title="Permalink to python-libs in RHEL 7.2 broke SSL verification in s3cmd">
                <h2 class="post-title">
                    python-libs in RHEL 7.2 broke SSL verification in s3cmd
                </h2>
            </a>
                <p>Today started with <a href="http://planet.sofiavalley.com">Planet Sofia Valley</a> being
broken again. Indeed it's been broken since last Friday when I've upgraded to
the latest RHEL 7.2. I quickly identified that I was hitting
<a href="https://github.com/s3tools/s3cmd/issues/647">Issue #647</a>. Then I tried the
git checkout without any luck. This is when I started to suspect that python-libs
has been updated in an incompatible way.</p>
<p>After series of reported bugs,
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1284916">rhbz#1284916</a>,
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1284930">rhbz#1284930</a>,
<a href="http://bugs.python.org/issue25722">Python#25722</a>, it was clear that
<code>ssl.py</code> was working according to RFC6125, that Amazon S3 was not playing
nicely with this same RFC and that my patch proposal was wrong.
This immediately had me looking upper in the stack at <code>httplib.py</code> and <code>s3cmd</code>.</p>
<p>Indeed there was a change in <code>httplib.py</code> which introduced two parameters,
<em>context</em> and <em>check_hostname</em>, to <code>HTTPSConnection.__init__</code>. The change
also supplied the logic which performs SSL hostname validation.</p>
<div class="highlight"><pre>if not self._context.check_hostname and self._check_hostname:
    try:
        ssl.match_hostname(self.sock.getpeercert(), server_hostname)
    except Exception:
        self.sock.shutdown(socket.SHUT_RDWR)
        self.sock.close()
        raise
</pre></div>


<p>This looks a bit doggy as I don't quite understand the intention behind
<em>not PREDICATE and PREDICATE</em>. Anyway to disable the validation you need
both parameters set to False, which is
<a href="https://github.com/s3tools/s3cmd/pull/668">PR #668</a>.</p>
<p>Notice the two try-except blocks. This is in case we're running with a
version that has a context but not the check_hostname parameter. I've found
the <em>inspect.getmembers</em> function which can be used to figure out what
parameters are there for the init method but a solution based on it
doesn't appear to be more elegant. I will describe this in more details in
my next post.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 24 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/24/python-libs-in-rhel-7.2-broke-ssl-verification-in-s3cmd/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/24/github-bugzilla-hook/" rel="bookmark" title="Permalink to GitHub Bugzilla Hook">
                <h2 class="post-title">
                    GitHub Bugzilla Hook
                </h2>
            </a>
                <p>Last month I've created a tool which adds comments to Bugzilla when a commit
message references a bug number. It was done as a proof of concept and didn't
receive much attention at the time. Today I'm happy to announce the existence
of <a href="https://github.com/atodorov/github-bugzilla-hook">GitHub Bugzilla Hook</a>.</p>
<p>I've used David Shea's
<a href="https://github.com/rhinstaller/github-email-hook/">GitHub Email Hook</a> as my
starting template and only modified it where needed. GitHub Bugzilla Hook will
examine push data and post comments for every unique bug+branch combination.
Once a comment for that particular bug+branch combination is made, new ones
will not be posted, even if later commits reference the same bug.
My main assumption is commits which are related to a bug will be pushed together
most of the times so there shouldn't be lots of noise in Bugzilla.</p>
<p>See <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1274703">rhbz#1274703</a> for
example of how the comments look. The parser behavior is taken from anaconda
and conforms to the style the Red Hat Installer Engineering Team uses.
Hopefully you find it useful as well.</p>
<p>My next step is to find a hosting place for this script and hook it up
with the rhinstaller GitHub repos!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 24 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/24/github-bugzilla-hook/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/23/bad-stub-design-in-dnf/" rel="bookmark" title="Permalink to Bad Stub Design in DNF, Pt.2">
                <h2 class="post-title">
                    Bad Stub Design in DNF, Pt.2
                </h2>
            </a>
                <p>Do you remember my example of a
<a href="/blog/2015/09/25/unit-testing-bad-stub-design-in-dnf/">bad stub design in DNF</a> ?
At that time I didn't have a good example of why this is a bad design and what are the
consequences of it. Today I have!</p>
<p>From my comment on
<a href="https://github.com/rpm-software-management/dnf-plugins-core/pull/118">PR #118</a></p>
<blockquote>
<p>Note: the benefit of this patch are quite subtle.
I've played around with creating a few more tests and the benefit I see affect
only a few lines of code.</p>
<p>For #114 there doesn't seem to be any need to test _get_query directly,
although we call</p>
<div class="highlight"><pre>   q = self.base.sack.query()
   q = q.available()
</pre></div>


<p>which will benefit from this PR b/c we're stubbing out the entire Sack object.
I will work on a test later today/tomorrow to see how it looks.</p>
<p>OTOH for #113 where we modify _get_query the test can look something like this:</p>
<div class="highlight"><pre>def test_get_query_with_local_rpm(self):
    try:
        (fs, rpm_path) = tempfile.mkstemp(&#39;foobar-99.99-1.x86_64.rpm&#39;)
        # b/c self.cmd.cli.base is a mock object add_remote_rpm
        # will not update the available packages while testing.
        # it is expected to hit an exception
        with self.assertRaises(dnf.exceptions.PackageNotFoundError):
            self.cmd._get_query(rpm_path)
        self.cmd.cli.base.add_remote_rpm.assert_called_with(rpm_path)
    finally:
        os.remove(rpm_path)
</pre></div>


<p>Note the comment above the with block. If we leave out <code>_get_query</code> as before
(a simple stub function) we're not going to be able to use <code>assert_called_with</code>
later.</p>
</blockquote>
<p>Now a more practical example. See 
<a href="https://github.com/rpm-software-management/dnf-plugins-core/commit/fe130669ffc4c1d6eba8f10cda35ab4d803d5a3d">commit fe13066</a>
- in case the package is not found we log the error. In case configuration is
<code>strict=True</code> then the plugin will raise another exception. With the initial version
of the stubs this change in behavior is silently ignored. If there was an error
in the newly introduced lines it would go straight into production because the
existing tests passed.</p>
<p>What happens is that <code>test_get_packages()</code> calls <code>_get_packages(['notfound'])</code>,
which is not the real code but a test stub and returns an empty list in this case.
The empty list is expected from the test and it will not fail!</p>
<p>With my new stub design the test will execute the actual <code>_get_packages()</code>
method from <code>download.py</code> and choke on the exception. The test itself needs
to be modified, which is done in
<a href="https://github.com/atodorov/dnf-plugins-core/commit/2c2b34237c99cbf32e23bde43027d22873f4e8b7">commit 2c2b34</a>
and no further errors were found.</p>
<p>So let me summarize:
<strong>
When using mocks, stubs and fake objects we should be replacing external
dependencies of the software under test, not internal methods from the SUT!
</strong></p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 23 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/23/bad-stub-design-in-dnf/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/23/tip-running-dnf-plugins-from-git/" rel="bookmark" title="Permalink to Tip: Running DNF Plugins from git">
                <h2 class="post-title">
                    Tip: Running DNF Plugins from git
                </h2>
            </a>
                <p>This is mostly for self reference because it is not currently documented
in the code. To use dnf plugins from a local git checkout modify your
<code>/etc/dnf/dnf.conf</code> and add the following line under the <code>[main]</code> section:</p>
<div class="highlight"><pre>pluginpath=/path/to/dnf-plugins-core/plugins
</pre></div>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 23 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/23/tip-running-dnf-plugins-from-git/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/21/updated-macbook-air-drivers-for-rhel-7.2/" rel="bookmark" title="Permalink to Updated MacBook Air Drivers for RHEL 7.2">
                <h2 class="post-title">
                    Updated MacBook Air Drivers for RHEL 7.2
                </h2>
            </a>
                <p>Yesterday I've upgraded to
<a href="https://access.redhat.com/announcements/2058583">Red Hat Enterprise Linux 7.2</a>
on my <a class="wikilink" href="http://amzn.to/1RdviyD">MacBook Air</a> and I decided to rebuild the wifi and backlight drivers.
Wifi broke immediately but I was able to fix the build with a
<a href="https://github.com/atodorov/wl-kmod-for-rhel7/commit/88d678a25eb702ce36f7c39471edefb65de57ad5">simple patch</a>.
I'm now using the newly built <em>kmod-wl-3.10.0-327.el7.x86_64-6.30.223.248-7.el7.x86_64</em>
and it appears to work as expected.</p>
<p>The <em>mba6x_bl</em> driver built without problems however I'm having problems when
closing the laptop lid. The screen stays on and (I think) the computer doesn't
suspend. My battery was drained as I left the computer as-is overnight. Suspending
from the Desktop menu however appears to work. See
<a href="https://github.com/patjak/mba6x_bl/issues/41">Issue #41</a>. I'd love to get some
help in debugging what's going wrong and trying to fix it. At this point I have
no idea where to look and if it's the driver to blame or something else on the system.</p>
<p><strong>UPDATE 2015-11-25:</strong>
After the upgrade to RHEL 7.2 I also started seeing
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1284851">rhbz#1284851</a>
- Mate power manager doesn't detect AC/DC changes on <a class="wikilink" href="http://amzn.to/1RdviyD">MacBook Air</a> with RHEL 7.2</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Sat 21 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/21/updated-macbook-air-drivers-for-rhel-7.2/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/20/revamping-anaconda-dogtail-tests/" rel="bookmark" title="Permalink to Revamping Anaconda's Dogtail Tests">
                <h2 class="post-title">
                    Revamping Anaconda's Dogtail Tests
                </h2>
            </a>
                <p>In my <a href="/blog/2015/11/13/running-anaconda-from-git/">previous post</a> I briefly talked
about running anaconda from a git checkout. My goal was to rewrite <code>tests/gui/</code> so
that they don't use a LiveCD and virtual machines anymore. I'm pleased to announce
that this is already done (still not merged), see 
<a href="https://github.com/rhinstaller/anaconda/pull/457">PR#457</a>.</p>
<p>The majority of the changes are just shuffling bits around and deleting
unused code. The existing UI tests were mostly working and only needed minor
changes. There are two things which didn't work and are temporarily disabled:</p>
<ul>
<li>Clicking the Help button results in <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1282432">rhbz#1282432</a>,
which in turn may be hiding another bug behind it;</li>
<li>Looping over the available languages resulted in AT-SPI NonImplementedError
which I'm going to debug next.</li>
</ul>
<p>To play around with this make sure you have accessibility enabled and:</p>
<div class="highlight"><pre># cd anaconda/
# export top_srcdir=`pwd`
# setenforce 0
# cd tests/gui/
# ./run_gui_tests.sh
</pre></div>


<p><strong>Note:</strong> you also need Dogtail for Python3 which isn't officially available
yet. I'm building from
<a href="https://vhumpa.fedorapeople.org/dogtail/beta/dogtail3-0.9.1-0.3.beta3.src.rpm">https://vhumpa.fedorapeople.org/dogtail/beta/dogtail3-0.9.1-0.3.beta3.src.rpm</a></p>
<p>My future plans are to figure out how to re-enable what is temporarily
disabled, update <code>run_gui_tests.sh</code> to properly start gnome-session and
enable accessibility, do a better job cleaning up after a failure,
enable coverage and hook everything into <code>make ci</code>.</p>
<p>Happy testing!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 20 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/20/revamping-anaconda-dogtail-tests/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/13/running-anaconda-from-git/" rel="bookmark" title="Permalink to Running Anaconda from git">
                <h2 class="post-title">
                    Running Anaconda from git
                </h2>
            </a>
                <p>It is now possible to execute anaconda directly from a git checkout.</p>
<p><strong>Disclaimer:</strong> this is only for testing purposes, you are not supposed to
execute anaconda from git and install a running system! My intention is
to use this feature and rewrite the Dogtail tests inside <code>tests/gui/</code> which
rely on having a LiveCD.iso and running VMs to execute. For me this has proven
very slow and difficult to debug problems in the past hence the change.</p>
<p><em>Note:</em> you will need to have an active DISPLAY in your environment and
also set SELinux to permissive, see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1276376">rhbz#1276376</a>.</p>
<p>Please see <a href="https://github.com/rhinstaller/anaconda/pull/438">PR 438</a> for
more details.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 13 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/13/running-anaconda-from-git/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/13/how-krasi-tsonev-broke-planet.sofiavalley.com/" rel="bookmark" title="Permalink to How Krasi Tsonev Broke Planet.SofiaValley.com">
                <h2 class="post-title">
                    How Krasi Tsonev Broke Planet.SofiaValley.com
                </h2>
            </a>
                <p>Yesterday I've added <a href="http://krasimirtsonev.com/blog/">Krasimir Tsonev's blog</a> to
<a href="http://planet.sofiavalley.com">http://planet.sofiavalley.com</a> and the planet broke. Suddenly it started showing
only Krasi's articles and all of them with the same date. The problem was the RSS
feed didn't have any timestamps. The fix is trivial:</p>
<div class="highlight"><pre><span class="gd">--- rss.xml.orig    2015-11-13 10:12:35.348625718 +0200</span>
<span class="gi">+++ rss.xml 2015-11-13 10:12:45.157932304 +0200</span>
<span class="gu">@@ -9,120 +9,160 @@</span>
                             &lt;title&gt;&lt;![CDATA[A modern React starter pack based on webpack]]&gt;&lt;/title&gt;
                             &lt;link&gt;http://krasimirtsonev.com/blog/article/a-modern-react-starter-pack-based-on-webpack&lt;/link&gt;
                             &lt;description&gt;&lt;![CDATA[&lt;p&gt;&lt;i&gt;Checkout React webpack starter in &lt;a href=\&quot;https://github.com/krasimir/react-web&lt;br /&gt;&lt;p&gt;You know how crazy is the JavaScript world nowadays. There are new frameworks, libraries and tools coming every day. Frequently I’m exploring some of these goodies. I got a week long holiday. I promised to myself that I’ll not code, read or watch about code. Well, it’s stronger than me. &lt;a href=\&quot;https://github.com/krasimir/react-webpack-starter\&quot;&gt;React werbpack starter&lt;/a&gt; is the result of my no-programming week.&lt;/p&gt;]]&gt;&lt;/description&gt;
<span class="gi">+                            &lt;pubDate&gt;Thu, 01 Oct 2015 00:00:00 +0300&lt;/pubDate&gt;</span>
<span class="gi">+                            &lt;guid&gt;http://krasimirtsonev.com/blog/article/a-modern-react-starter-pack-based-on-webpack&lt;/guid&gt;</span>
                         &lt;/item&gt;
</pre></div>


<p>Thanks to Krasi for fixing this quickly and happy reading!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 13 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/13/how-krasi-tsonev-broke-planet.sofiavalley.com/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/10/28/building-docker-images-with-anaconda/" rel="bookmark" title="Permalink to Building Docker Images with Anaconda">
                <h2 class="post-title">
                    Building Docker Images with Anaconda
                </h2>
            </a>
                <p>Anaconda, the Fedora and Red Hat Enterprise Linux installer, has gained some
features to facilitate building Docker images. These are only available
in kickstart. To build a Docker image for HTTPD, using packages provided in the
distro use the following ks.cfg file:</p>
<div class="highlight"><pre><span class="n">install</span>
<span class="n">lang</span> <span class="n">en_US</span><span class="p">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<span class="n">keyboard</span> <span class="n">us</span>
<span class="n">network</span> <span class="o">--</span><span class="n">onboot</span> <span class="n">yes</span> <span class="o">--</span><span class="n">device</span> <span class="n">eth0</span> <span class="o">--</span><span class="n">bootproto</span> <span class="n">dhcp</span>

<span class="n">rootpw</span>  <span class="o">--</span><span class="n">lock</span>
<span class="n">firewall</span> <span class="o">--</span><span class="n">disabled</span>
<span class="n">timezone</span> <span class="n">Europe</span><span class="o">/</span><span class="n">Sofia</span>

<span class="n">clearpart</span> <span class="o">--</span><span class="n">all</span> <span class="o">--</span><span class="n">initlabel</span>
<span class="n">part</span> <span class="o">/</span> <span class="o">--</span><span class="n">fstype</span><span class="o">=</span><span class="n">ext4</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span> <span class="o">--</span><span class="n">grow</span>

<span class="n">bootloader</span> <span class="o">--</span><span class="n">disabled</span>

<span class="nf">%packages</span> <span class="o">--</span><span class="n">nocore</span> <span class="o">--</span><span class="n">instLangs</span><span class="o">=</span><span class="n">en_US</span> <span class="o">--</span><span class="n">excludedocs</span>
<span class="n">httpd</span>
<span class="o">-</span><span class="n">kernel</span>
<span class="n">yum</span><span class="o">-</span><span class="n">langpacks</span> <span class="err">#</span> <span class="n">workaround</span> <span class="k">for</span> <span class="n">rhbz</span><span class="err">#</span><span class="mi">1271766</span>
<span class="nf">%end</span>
</pre></div>


<p>The above kickstart file will:</p>
<ul>
<li>install HTTPD and its dependencies</li>
<li>disable kernel installation by excluding it from the package list</li>
<li>disable installation of the boot loader using <code>--disabled</code>. The resulting image
will not be bootable</li>
<li>disable firewall</li>
<li>locks the root account so it can't login from the console</li>
<li>prevent installing @core using <code>--nocore</code></li>
<li>limit the installation of localization files using <code>--instLangs</code></li>
<li>limit the installation of documentation using <code>--excludedocs</code></li>
</ul>
<p><strong>Note:</strong> the previous <code>--nobase</code> option is deprected and doesn't have any effect.</p>
<p>After the VM installation is complete grab the contents of the root directory:</p>
<div class="highlight"><pre># virt-tar-out -a /var/lib/libvirt/images/disk.qcow2 / myimage.tar
</pre></div>


<p>Import the tarball into Docker and inspect the result:</p>
<div class="highlight"><pre><span class="c"># docker import myimage.tar local_images:ver1.0</span>
<span class="mi">8</span><span class="n">a2324e6d0e940a998b990262335894a17d261450c33f57dc153d3d1987e4fc1</span>

<span class="c"># docker images</span>
<span class="n">REPOSITORY</span>                                             <span class="n">TAG</span>                 <span class="n">IMAGE</span> <span class="n">ID</span>            <span class="n">CREATED</span>             <span class="n">VIRTUAL</span> <span class="n">SIZE</span>
<span class="n">local_images</span>                                           <span class="n">ver1</span><span class="o">.</span><span class="mi">0</span>              <span class="mi">8</span><span class="n">a2324e6d0e9</span>        <span class="mi">13</span> <span class="n">seconds</span> <span class="n">ago</span>      <span class="mf">320.6</span> <span class="n">MB</span>
<span class="n">registry</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">rhel</span>                        <span class="n">latest</span>              <span class="mi">82</span><span class="n">ad5fa11820</span>        <span class="mi">6</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="mf">158.3</span> <span class="n">MB</span>
<span class="n">registry</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">rhscl_beta</span><span class="o">/</span><span class="n">httpd</span><span class="o">-</span><span class="mi">24</span><span class="o">-</span><span class="n">rhel7</span>   <span class="n">latest</span>              <span class="mi">55</span><span class="n">a8a150cf2d</span>        <span class="mi">9</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="mf">201.1</span> <span class="n">MB</span>
</pre></div>


<p>Run commands into a new container: </p>
<div class="highlight"><pre># docker run --name=bash_myimage -it 8a2324e6d0e9 /bin/bash
bash-4.2# cat /etc/redhat-release 
Red Hat Enterprise Linux Server release 7.2 Beta (Maipo)
bash-4.2# rpm -q httpd
httpd-2.4.6-40.el7.x86_64
bash-4.2# exit

# docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES
64f7ca6d5844        8a2324e6d0e9        &quot;/bin/bash&quot;         24 seconds ago      Exited (0) 19 seconds ago                       bash_myimage
</pre></div>


<p>As you can see the resulting image is bigger than stock images provided by Red Hat.
At this moment I don't know if this is the minimum package set which satisfies
dependencies or anaconda adds a bit more on its own. The full package list is
given below. There are some packages like  device-mapper, dracut, e2fsprogs,
iptables, kexec-tools, SELinux related, systemd and tzdata which look out
of place. My guess is some of them are pulled in from the various kickstart
commands and not really necessary. I will follow up with devel and see if
the content can be stripped down even more.</p>
<p>For more information check out these docs:</p>
<ul>
<li><a href="https://access.redhat.com/articles/881893">Get Started with Docker Formatted Container Images on Red Hat Systems</a></li>
<li><a href="https://access.redhat.com/documentation/en/red-hat-enterprise-linux-atomic-host/version-7/red-hat-enterprise-linux-atomic-host-7-getting-started-with-containers/chapter-7-get-started-with-docker-formatted-container-images">Chapter 7. Get Started with Docker Formatted Container Images</a></li>
</ul>
<p>Full package list:</p>
<div class="highlight"><pre>acl-2.2.51-12.el7.x86_64
apr-1.4.8-3.el7.x86_64
apr-util-1.5.2-6.el7.x86_64
audit-libs-2.4.1-5.el7.x86_64
basesystem-10.0-7.el7.noarch
bash-4.2.46-19.el7.x86_64
bind-libs-lite-9.9.4-29.el7.x86_64
bind-license-9.9.4-29.el7.noarch
binutils-2.23.52.0.1-54.el7.x86_64
bzip2-libs-1.0.6-13.el7.x86_64
ca-certificates-2015.2.4-71.el7.noarch
chkconfig-1.3.61-5.el7.x86_64
chrony-2.1.1-1.el7.x86_64
coreutils-8.22-15.el7.x86_64
cpio-2.11-24.el7.x86_64
cracklib-2.9.0-11.el7.x86_64
cracklib-dicts-2.9.0-11.el7.x86_64
cryptsetup-libs-1.6.7-1.el7.x86_64
curl-7.29.0-25.el7.x86_64
cyrus-sasl-lib-2.1.26-19.2.el7.x86_64
dbus-1.6.12-13.el7.x86_64
dbus-glib-0.100-7.el7.x86_64
dbus-libs-1.6.12-13.el7.x86_64
dbus-python-1.1.1-9.el7.x86_64
device-mapper-1.02.107-5.el7.x86_64
device-mapper-libs-1.02.107-5.el7.x86_64
dhclient-4.2.5-42.el7.x86_64
dhcp-common-4.2.5-42.el7.x86_64
dhcp-libs-4.2.5-42.el7.x86_64
diffutils-3.3-4.el7.x86_64
dracut-033-358.el7.x86_64
dracut-network-033-358.el7.x86_64
e2fsprogs-1.42.9-7.el7.x86_64
e2fsprogs-libs-1.42.9-7.el7.x86_64
ebtables-2.0.10-13.el7.x86_64
elfutils-libelf-0.163-3.el7.x86_64
elfutils-libs-0.163-3.el7.x86_64
ethtool-3.15-2.el7.x86_64
expat-2.1.0-8.el7.x86_64
file-libs-5.11-31.el7.x86_64
filesystem-3.2-20.el7.x86_64
findutils-4.5.11-5.el7.x86_64
firewalld-0.3.9-14.el7.noarch
gawk-4.0.2-4.el7.x86_64
gdbm-1.10-8.el7.x86_64
glib2-2.42.2-5.el7.x86_64
glibc-2.17-105.el7.x86_64
glibc-common-2.17-105.el7.x86_64
gmp-6.0.0-11.el7.x86_64
gnupg2-2.0.22-3.el7.x86_64
gobject-introspection-1.42.0-1.el7.x86_64
gpgme-1.3.2-5.el7.x86_64
grep-2.20-2.el7.x86_64
gzip-1.5-8.el7.x86_64
hardlink-1.0-19.el7.x86_64
hostname-3.13-3.el7.x86_64
httpd-2.4.6-40.el7.x86_64
httpd-tools-2.4.6-40.el7.x86_64
info-5.1-4.el7.x86_64
initscripts-9.49.30-1.el7.x86_64
iproute-3.10.0-54.el7.x86_64
iptables-1.4.21-16.el7.x86_64
iputils-20121221-7.el7.x86_64
kexec-tools-2.0.7-37.el7.x86_64
keyutils-libs-1.5.8-3.el7.x86_64
kmod-20-5.el7.x86_64
kmod-libs-20-5.el7.x86_64
kpartx-0.4.9-85.el7.x86_64
krb5-libs-1.13.2-10.el7.x86_64
langtable-0.0.31-3.el7.noarch
langtable-data-0.0.31-3.el7.noarch
langtable-python-0.0.31-3.el7.noarch
libacl-2.2.51-12.el7.x86_64
libassuan-2.1.0-3.el7.x86_64
libattr-2.4.46-12.el7.x86_64
libblkid-2.23.2-26.el7.x86_64
libcap-2.22-8.el7.x86_64
libcap-ng-0.7.5-4.el7.x86_64
libcom_err-1.42.9-7.el7.x86_64
libcurl-7.29.0-25.el7.x86_64
libdb-5.3.21-19.el7.x86_64
libdb-utils-5.3.21-19.el7.x86_64
libedit-3.0-12.20121213cvs.el7.x86_64
libffi-3.0.13-16.el7.x86_64
libgcc-4.8.5-4.el7.x86_64
libgcrypt-1.5.3-12.el7_1.1.x86_64
libgpg-error-1.12-3.el7.x86_64
libidn-1.28-4.el7.x86_64
libmnl-1.0.3-7.el7.x86_64
libmount-2.23.2-26.el7.x86_64
libnetfilter_conntrack-1.0.4-2.el7.x86_64
libnfnetlink-1.0.1-4.el7.x86_64
libpwquality-1.2.3-4.el7.x86_64
libselinux-2.2.2-6.el7.x86_64
libselinux-python-2.2.2-6.el7.x86_64
libsemanage-2.1.10-18.el7.x86_64
libsepol-2.1.9-3.el7.x86_64
libss-1.42.9-7.el7.x86_64
libssh2-1.4.3-10.el7.x86_64
libstdc++-4.8.5-4.el7.x86_64
libtasn1-3.8-2.el7.x86_64
libuser-0.60-7.el7_1.x86_64
libutempter-1.1.6-4.el7.x86_64
libuuid-2.23.2-26.el7.x86_64
libverto-0.2.5-4.el7.x86_64
libxml2-2.9.1-5.el7_1.2.x86_64
lua-5.1.4-14.el7.x86_64
lzo-2.06-8.el7.x86_64
mailcap-2.1.41-2.el7.noarch
ncurses-5.9-13.20130511.el7.x86_64
ncurses-base-5.9-13.20130511.el7.noarch
ncurses-libs-5.9-13.20130511.el7.x86_64
nspr-4.10.8-1.el7_1.x86_64
nss-3.19.1-17.el7.x86_64
nss-softokn-3.16.2.3-13.el7_1.x86_64
nss-softokn-freebl-3.16.2.3-13.el7_1.x86_64
nss-sysinit-3.19.1-17.el7.x86_64
nss-tools-3.19.1-17.el7.x86_64
nss-util-3.19.1-3.el7_1.x86_64
openldap-2.4.40-8.el7.x86_64
openssl-libs-1.0.1e-42.el7_1.9.x86_64
p11-kit-0.20.7-3.el7.x86_64
p11-kit-trust-0.20.7-3.el7.x86_64
pam-1.1.8-12.el7_1.1.x86_64
pcre-8.32-15.el7.x86_64
pinentry-0.8.1-14.el7.x86_64
pkgconfig-0.27.1-4.el7.x86_64
popt-1.13-16.el7.x86_64
procps-ng-3.3.10-3.el7.x86_64
pth-2.0.7-23.el7.x86_64
pygobject3-base-3.14.0-3.el7.x86_64
pygpgme-0.3-9.el7.x86_64
pyliblzma-0.5.3-11.el7.x86_64
python-2.7.5-34.el7.x86_64
python-decorator-3.4.0-3.el7.noarch
python-iniparse-0.4-9.el7.noarch
python-libs-2.7.5-34.el7.x86_64
python-pycurl-7.19.0-17.el7.x86_64
python-slip-0.4.0-2.el7.noarch
python-slip-dbus-0.4.0-2.el7.noarch
python-urlgrabber-3.10-7.el7.noarch
pyxattr-0.5.1-5.el7.x86_64
qrencode-libs-3.4.1-3.el7.x86_64
readline-6.2-9.el7.x86_64
redhat-logos-70.0.3-4.el7.noarch
redhat-release-server-7.2-7.el7.x86_64
rpm-4.11.3-17.el7.x86_64
rpm-build-libs-4.11.3-17.el7.x86_64
rpm-libs-4.11.3-17.el7.x86_64
rpm-python-4.11.3-17.el7.x86_64
sed-4.2.2-5.el7.x86_64
setup-2.8.71-6.el7.noarch
shadow-utils-4.1.5.1-18.el7.x86_64
shared-mime-info-1.1-9.el7.x86_64
snappy-1.1.0-3.el7.x86_64
sqlite-3.7.17-8.el7.x86_64
systemd-219-19.el7.x86_64
systemd-libs-219-19.el7.x86_64
sysvinit-tools-2.88-14.dsf.el7.x86_64
tzdata-2015g-1.el7.noarch
ustr-1.0.4-16.el7.x86_64
util-linux-2.23.2-26.el7.x86_64
xz-5.1.2-12alpha.el7.x86_64
xz-libs-5.1.2-12alpha.el7.x86_64
yum-3.4.3-132.el7.noarch
yum-langpacks-0.4.2-4.el7.noarch
yum-metadata-parser-1.1.4-10.el7.x86_64
zlib-1.2.7-15.el7.x86_64
</pre></div>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 28 October 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/10/28/building-docker-images-with-anaconda/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/10/27/anaconda-coverage.py-coverage-diff/" rel="bookmark" title="Permalink to Anaconda & coverage.py - Pt.3 - coverage-diff">
                <h2 class="post-title">
                    Anaconda &amp; coverage.py - Pt.3 - coverage-diff
                </h2>
            </a>
                <p>In my <a href="/blog/2015/10/15/anaconda-coverage.py-details/">previous post</a>
I've talked about testing anaconda and friends and raised some questions.
Today I'm going to give an example of how to answer one of them:
"How different is the code execution path between different tests?"</p>
<h2>coverate-tools</h2>
<p>I'm going to use <a href="https://github.com/atodorov/coverage-tools">coverage-tools</a>
in my explanations below so a little introduction is required. All the tools
are executable Python scripts which build on top of existing coverage.py API.
The difference is mainly in flexibility of parameters and output formatting.
I've tried to keep as close as possible to the existing behavior of coverage.py.</p>
<p><em>coverage-annotate</em> - when given a .coverage data file prints the source code
annotated with line numbers and execution markers.</p>
<div class="highlight"><pre><span class="err">!!!</span> <span class="n">missing</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pyanaconda</span><span class="o">/</span><span class="n">anaconda_argparse</span><span class="o">.</span><span class="n">py</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">covered</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pyanaconda</span><span class="o">/</span><span class="n">anaconda_argparse</span><span class="o">.</span><span class="n">py</span>
<span class="o">...</span> <span class="n">skip</span> <span class="o">...</span>
    <span class="mi">37</span> <span class="o">&gt;</span> <span class="kn">import</span> <span class="nn">logging</span>
    <span class="mi">38</span> <span class="o">&gt;</span> <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;anaconda&quot;</span><span class="p">)</span>
    <span class="mi">39</span>   
    <span class="mi">40</span>   <span class="c"># Help text formatting constants</span>
    <span class="mi">41</span>   
    <span class="mi">42</span> <span class="o">&gt;</span> <span class="n">LEFT_PADDING</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c"># the help text will start after 8 spaces</span>
    <span class="mi">43</span> <span class="o">&gt;</span> <span class="n">RIGHT_PADDING</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c"># there will be 8 spaces left on the right</span>
    <span class="mi">44</span> <span class="o">&gt;</span> <span class="n">DEFAULT_HELP_WIDTH</span> <span class="o">=</span> <span class="mi">80</span>
    <span class="mi">45</span>   
    <span class="mi">46</span> <span class="o">&gt;</span> <span class="k">def</span> <span class="nf">get_help_width</span><span class="p">():</span>
    <span class="mi">47</span> <span class="o">&gt;</span>     <span class="s">&quot;&quot;&quot;</span>
<span class="s">    48 &gt;     Try to detect the terminal window width size and use it to</span>
<span class="s">    49 &gt;     compute optimal help text width. If it can&#39;t be detected</span>
<span class="s">    50 &gt;     a default values is returned.</span>
<span class="s">    51   </span>
<span class="s">    52 &gt;     :returns: optimal help text width in number of characters</span>
<span class="s">    53 &gt;     :rtype: int</span>
<span class="s">    54 &gt;     &quot;&quot;&quot;</span>
    <span class="mi">55</span>       <span class="c"># don&#39;t do terminal size detection on s390, it is not supported</span>
    <span class="mi">56</span>       <span class="c"># by its arcane TTY system and only results in cryptic error messages</span>
    <span class="mi">57</span>       <span class="c"># ending on the standard output</span>
    <span class="mi">58</span>       <span class="c"># (we do the s390 detection here directly to avoid</span>
    <span class="mi">59</span>       <span class="c">#  the delay caused by importing the Blivet module</span>
    <span class="mi">60</span>       <span class="c">#  just for this single call)</span>
    <span class="mi">61</span> <span class="o">&gt;</span>     <span class="n">is_s390</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;s390&#39;</span><span class="p">)</span>
    <span class="mi">62</span> <span class="o">&gt;</span>     <span class="k">if</span> <span class="n">is_s390</span><span class="p">:</span>
    <span class="mi">63</span> <span class="err">!</span>         <span class="k">return</span> <span class="n">DEFAULT_HELP_WIDTH</span>
    <span class="mi">64</span>   
<span class="o">...</span> <span class="n">skip</span> <span class="o">...</span>
</pre></div>


<p>In the example above all lines starting with <strong>&gt;</strong> were executed by the interpreter.
All top-level import statements were executed as you would expect. Then the method
<em>get_help_width()</em> was executed (called from somewhere). Because this was on x86_64
machine line 63 was not executed. It is marked with <strong>!</strong>. The comments and empty
lines are of no interest.</p>
<p><em>coverage-diff</em> - produces git like diff reports on the text output of annotate.</p>
<div class="highlight"><pre><span class="gd">--- a/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/source.py</span>
<span class="gi">+++ b/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/source.py</span>
<span class="gu">@@ -634,7 +634,7 @@</span>
    634           # Wait to make sure the other threads are done before sending ready, otherwise
    635           # the spoke may not get be sensitive by _handleCompleteness in the hub.
    636 &gt;         while not self.ready:
<span class="gd">-   637 !             time.sleep(1)</span>
<span class="gi">+   637 &gt;             time.sleep(1)</span>
    638 &gt;         hubQ.send_ready(self.__class__.__name__, False)
    639   
    640 &gt;     def refresh(self):\
</pre></div>


<p>In this example line 637 was not executed in the first test run, while it was executed
in the second test run. Reading the comments above it is clear the difference between
the two test runs is just timing and synchronization.</p>
<h2>Kickstart vs. Kickstart</h2>
<p>How different is the code execution path between different tests? Looking at
<a href="https://fedoraproject.org/wiki/Test_Results:Fedora_23_Final_RC3_Installation">Fedora 23 test results</a>
we see several tests which differ only slightly in their setup - installation
via HTTP, FTP or NFS; installation to SATA, SCSI, SAS drives; installation using
RAID for the root file system; These are good candidates for further analysis.</p>
<p>Note: my results below are not from Fedora 23 but the conclusions still apply!
The tests were executed on bare metal and virtual machines, trying to use the
same hardware or same systems configurations where possible!</p>
<p>Example: HTTP vs. FTP</p>
<div class="highlight"><pre><span class="gd">--- a/usr/lib64/python2.7/site-packages/pyanaconda/packaging/__init__.py</span>
<span class="gi">+++ b/usr/lib64/python2.7/site-packages/pyanaconda/packaging/__init__.py</span>
<span class="gu">@@ -891,7 +891,7 @@</span>
    891   
    892               # Run any listeners for the new state
    893 &gt;             for func in self._event_listeners[event_id]:
<span class="gd">-   894 !                 func()</span>
<span class="gi">+   894 &gt;                 func()</span>
    895   
    896 &gt;     def _runThread(self, storage, ksdata, payload, fallback, checkmount):
    897           # This is the thread entry
<span class="gd">--- a/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/lib/resize.py</span>
<span class="gi">+++ b/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/lib/resize.py</span>
<span class="gu">@@ -102,10 +102,10 @@</span>
    102           # Otherwise, fall back on increasingly vague information.
    103 &gt;         if not part.isleaf:
    104 &gt;             return self.storage.devicetree.getChildren(part)[0].name
<span class="gd">-   105 &gt;         if getattr(part.format, &quot;label&quot;, None):</span>
<span class="gi">+   105 !         if getattr(part.format, &quot;label&quot;, None):</span>
    106 !             return part.format.label
<span class="gd">-   107 &gt;         elif getattr(part.format, &quot;name&quot;, None):</span>
<span class="gd">-   108 &gt;             return part.format.name</span>
<span class="gi">+   107 !         elif getattr(part.format, &quot;name&quot;, None):</span>
<span class="gi">+   108 !             return part.format.name</span>
    109 !         else:
    110 !             return &quot;&quot;
    111   
<span class="gu">@@ -315,10 +315,10 @@</span>
    315 &gt;     def on_key_pressed(self, window, event, *args):
    316           # Handle any keyboard events.  Right now this is just delete for
    317           # removing a partition, but it could include more later.
<span class="gd">-   318 &gt;         if not event or event and event.type != Gdk.EventType.KEY_RELEASE:</span>
<span class="gi">+   318 !         if not event or event and event.type != Gdk.EventType.KEY_RELEASE:</span>
    319 !             return
    320   
<span class="gd">-   321 &gt;         if event.keyval == Gdk.KEY_Delete and self._deleteButton.get_sensitive():</span>
<span class="gi">+   321 !         if event.keyval == Gdk.KEY_Delete and self._deleteButton.get_sensitive():</span>
    322 !             self._deleteButton.emit(&quot;clicked&quot;)
    323   
    324 &gt;     def _sumReclaimableSpace(self, model, path, itr, *args):
<span class="gd">--- a/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/source.py</span>
<span class="gi">+++ b/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/source.py</span>
<span class="gu">@@ -634,7 +634,7 @@</span>
    634           # Wait to make sure the other threads are done before sending ready, otherwise
    635           # the spoke may not get be sensitive by _handleCompleteness in the hub.
    636 &gt;         while not self.ready:
<span class="gd">-   637 !             time.sleep(1)</span>
<span class="gi">+   637 &gt;             time.sleep(1)</span>
    638 &gt;         hubQ.send_ready(self.__class__.__name__, False)
    639   
    640 &gt;     def refresh(self):
</pre></div>


<p>The difference in <code>source.py</code> is from timing/synchronization and can safely be ignored.
I'm not exactly sure about <code>__init__.py</code> but doesn't look much of a big deal.
We're left with <code>resize.py</code>. The differences in <em>on_key_pressed()</em> are because
I've probably used the keyboard instead the mouse (these are indeed manual installs).
The other difference is in how the partition labels are displayed. One of the installs
was probably using fresh disks while the other not.</p>
<p>Example: SATA vs. SCSI - no difference</p>
<p>Example: SATA vs. SAS (mpt2sas driver)</p>
<div class="highlight"><pre><span class="gd">--- a/usr/lib64/python2.7/site-packages/pyanaconda/bootloader.py</span>
<span class="gi">+++ b/usr/lib64/python2.7/site-packages/pyanaconda/bootloader.py</span>
<span class="gu">@@ -109,10 +109,10 @@</span>
    109 &gt;     try:
    110 &gt;         opts.parity = arg[idx+0]
    111 &gt;         opts.word   = arg[idx+1]
<span class="gd">-   112 !         opts.flow   = arg[idx+2]</span>
<span class="gd">-   113 !     except IndexError:</span>
<span class="gd">-   114 &gt;         pass</span>
<span class="gd">-   115 &gt;     return opts</span>
<span class="gi">+   112 &gt;         opts.flow   = arg[idx+2]</span>
<span class="gi">+   113 &gt;     except IndexError:</span>
<span class="gi">+   114 !         pass</span>
<span class="gi">+   115 !     return opts</span>
    116   
    117 ! def _is_on_iscsi(device):
    118 !     &quot;&quot;&quot;Tells whether a given device is on an iSCSI disk or not.&quot;&quot;&quot;
<span class="gu">@@ -1075,13 +1075,13 @@</span>
   1075 &gt;             command = [&quot;serial&quot;]
   1076 &gt;             s = parse_serial_opt(self.console_options)
   1077 &gt;             if unit and unit != &#39;0&#39;:
<span class="gd">-  1078 !                 command.append(&quot;--unit=%s&quot; % unit)</span>
<span class="gi">+  1078 &gt;                 command.append(&quot;--unit=%s&quot; % unit)</span>
   1079 &gt;             if s.speed and s.speed != &#39;9600&#39;:
   1080 &gt;                 command.append(&quot;--speed=%s&quot; % s.speed)
   1081 &gt;             if s.parity:
<span class="gd">-  1082 !                 if s.parity == &#39;o&#39;:</span>
<span class="gi">+  1082 &gt;                 if s.parity == &#39;o&#39;:</span>
   1083 !                     command.append(&quot;--parity=odd&quot;)
<span class="gd">-  1084 !                 elif s.parity == &#39;e&#39;:</span>
<span class="gi">+  1084 &gt;                 elif s.parity == &#39;e&#39;:</span>
   1085 !                     command.append(&quot;--parity=even&quot;)
   1086 &gt;             if s.word and s.word != &#39;8&#39;:
   1087 !                 command.append(&quot;--word=%s&quot; % s.word)
</pre></div>


<p>As you can see the difference is minimal, mostly related to the underlying
hardware. As far as I can tell this has to do with how the bootloader is
installed on disk but I'm no expert on this particular piece of code.
I've seen the same difference in other comparisons so it probably has to do
more with hardware than with what kind of disk/driver is used.</p>
<p>Example: RAID 0 vs. RAID 1 - manual install</p>
<div class="highlight"><pre><span class="gd">--- a/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/datetime_spoke.py</span>
<span class="gi">+++ b/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/datetime_spoke.py</span>
<span class="gu">@@ -490,9 +490,9 @@</span>
    490   
    491 &gt;         time_init_thread = threadMgr.get(constants.THREAD_TIME_INIT)
    492 &gt;         if time_init_thread is not None:
<span class="gd">-   493 &gt;             hubQ.send_message(self.__class__.__name__,</span>
<span class="gd">-   494 &gt;                              _(&quot;Restoring hardware time...&quot;))</span>
<span class="gd">-   495 &gt;             threadMgr.wait(constants.THREAD_TIME_INIT)</span>
<span class="gi">+   493 !             hubQ.send_message(self.__class__.__name__,</span>
<span class="gi">+   494 !                              _(&quot;Restoring hardware time...&quot;))</span>
<span class="gi">+   495 !             threadMgr.wait(constants.THREAD_TIME_INIT)</span>
    496   
    497 &gt;         hubQ.send_ready(self.__class__.__name__, False)
    498
</pre></div>


<p>As far as I can tell the difference is related to hardware clock settings,
probably due to different defaults in BIOS on the various hardware.
Additional tests with RAID 5 and RAID 6 reveals the same exact difference.
RAID 0 vs. RAID 10 shows no difference at all. Indeed as far as I know anaconda
delegates the creation of RAID arrays to mdadm once the desired configuration
is known so these results are to be expected.</p>
<h2>Conclusion</h2>
<p>As you can see sometimes there are tests which appear to be very important
but in reality they cover a corner case of the base test. For example if any
of the RAID levels works we can be pretty confident 
<strike>all of them work</strike> <em>they won't break in anaconda</em>
(thanks Adam Williamson)!</p>
<p>What you do with this information is up to you. Sometimes QA is able to
execute all the tests and life is good. Sometimes we have to compromise,
skip some testing and accept the risks of doing so. Sometimes you can
execute all tests for every build, sometimes only once per milestone.
Whatever the case having the information to back up your decision is vital!</p>
<p>In my next post on this topic I'm going to talk more about functional tests
vs. unit tests. Both anaconda and blivet have both kinds of tests and I'm
interested to know if tests from the two categories focus on the same
functionality how are they different. If we have a unit test for feature X,
does it warrant to spend the resources doing functional testing for X as well?</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 27 October 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/10/27/anaconda-coverage.py-coverage-diff/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/10/15/anaconda-coverage.py-details/" rel="bookmark" title="Permalink to Anaconda & coverage.py - Pt.2 - Details">
                <h2 class="post-title">
                    Anaconda &amp; coverage.py - Pt.2 - Details
                </h2>
            </a>
                <p>My <a href="/blog/2015/10/14/anaconda-coverage.py-introduction/">previous post</a>
was an introduction to testing installation related components. Now I'm going to
talk more about anaconda and how it is tested.</p>
<p>There are two primary ways to test anaconda. You can execute <code>make check</code> in the
source directory which will trigger the package test suite. The other possibility
is to perform an actual installation, on bare meta or virtual machine, using the
<a href="https://kojipkgs.fedoraproject.org/mash/">latest Rawhide snapshots</a> which also
include the latest anaconda. For both of these methods we can collect code
coverage information. In live installation mode coverage is enabled via the
<code>inst.debug</code> boot argument. Fedora 23 and earlier use <code>debug=1</code> but that
can lead to <a href="https://github.com/rhinstaller/anaconda/pull/291">problems</a>
sometimes.</p>
<h2>Kickstart Testing</h2>
<p><a href="https://github.com/rhinstaller/pykickstart/blob/master/docs/kickstart-docs.rst">Kickstart</a>
is a method of automating the installation of Fedora by supplying the necessary
configuration into a text file and pointing the installer at this file. There is
the directory <code>tests/kickstart_tests</code>, inside the anaconda source, where each
test is a kickstart file and a shell script. The test runner provisions a virtual
machine using boot.iso and the kickstart file. A shell script then verifies
installation was as expected and copies files of interest to the host system.
Kickstart files are also the basis for testing Fedora installations in
<a href="https://beaker.fedoraproject.org/bkr/jobs/">Beaker</a>.</p>
<p>Naturally some of these in-package kickstart tests are the same as
<a href="https://bitbucket.org/fedoraqa/fedora-beaker-tests/">out-of-band kickstart tests</a>.
Hint: there are more available but not yet public.</p>
<p>The question which I don't have an answer for right now is
"Can we remove some of the duplicates and how this affects devel and QE teams" ?
The pros of in-package testing are that it is faster compared to Beaker. The cons
are that you're not testing the real distro (every snapshot is a possible final
release to the users).</p>
<h2>Dogtail</h2>
<p><a href="https://fedorahosted.org/dogtail/">Dogtail</a> uses accessibility technologies to
communicate with desktop applications. It is written in Python and can be used
as GUI test automation framework. Long time ago I've proposed support for Dogtail
in anaconda which was rejected, then couple of years later it was accepted and
later removed from the code again.</p>
<p>Anaconda has in-package Dogtail tests (<code>tests/gui/</code>). They work by attaching
a second disk image with the test suite to a VM running a LiveCD. Anaconda is
started on the LiveCD and an attempt to install Fedora on disk 1 is made.
Everything is driven by the Dogtail scripts. There are only a few of these
tests available and they are currently disabled.
Red Hat QE has also created another method for running Dogtail tests in anaconda
using an updates.img with the previous functionality.</p>
<p>Even if there are some duplicate tests I'm not convinced we have to drop the
<code>tests/gui/</code> directory from the code because
the framework used to drive the graphical interface of anaconda appears to be very
well written. The code is clean and easy to follow.
Also I don't have metrics of how much these two methods differ or how much they cover
in their testing. IMO they are pretty close and before we can find a way to
reliably execute them on a regular basis there isn't much to be done here.
One idea is to use the <code>--dirinstall</code> or <code>--image</code> options and skip the
LiveCD part entirely.</p>
<h2>How Much is Tested</h2>
<p><code>make ci</code> covers 10% of the entire code base for anaconda. Mind you that
<code>tests/storage</code> and <code>tests/gui</code> are currently disabled.
See <a href="https://github.com/rhinstaller/anaconda/pull/346">PR #346</a>,
<a href="https://github.com/rhinstaller/anaconda/pull/327">PR #327</a> and
<a href="https://github.com/rhinstaller/anaconda/pull/319">PR #319</a>!
There is definitely room for improvement.</p>
<p>On the other hand live installation testing is much
better. Text mode covers around 25% while graphical installations around 40%.
Text and graphical combined cover 50% though. These numbers will drop quite a bit
once anaconda learns to
<a href="https://github.com/rhinstaller/anaconda/pull/397">include all possible files</a>
in its report but it is a good estimate.</p>
<p>The important questions to ask here are:</p>
<ul>
<li>How much can PyUnit tests cover in anaconda?</li>
<li>How much can kickstart tests cover ?</li>
<li>Have we reached a threshold in any of the two primary methods for testing ?</li>
<li>Does UI automation (with Dogtail) improve anything ?</li>
<li>When testing a particular feature (say user creation) how different is the
code execution path between manual (GUI) testing, kickstart and unit testing ?
If not so different can we invest in unit tests instead of higher level tests then ?</li>
<li>How different is the code execution path between different tests (manual or kickstart) ?
In other words how much value are we getting from testing for the resources we're putting in ?</li>
</ul>
<p>In my next post I will talk more about these questions and some rudimentary
analysis against coverage data from the various test methods and test cases!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 15 October 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/10/15/anaconda-coverage.py-details/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/10/14/anaconda-coverage.py-introduction/" rel="bookmark" title="Permalink to Anaconda & coverage.py - Pt.1 - Introduction">
                <h2 class="post-title">
                    Anaconda &amp; coverage.py - Pt.1 - Introduction
                </h2>
            </a>
                <p>Since early 2015 I've been working on testing installation related
components in Rawhide. I'm interested in the code produced by the
<a href="https://github.com/rhinstaller/">Red Hat Installer Engineering Team</a> and in
particular in <em>anaconda</em>, <em>blivet</em>, <em>pyparted</em> and <em>pykickstart</em>. The goal of
this effort is to improve the overall testing of these components and also
have Red Hat QE contribute some of our knowledge back to the community. The benefit
of course will be better software for everyone. In the next
several posts I'll summarize what has been done so far and what's to be expected
in the future.</p>
<h2>Test Documentation Matters</h2>
<p>Do you want others to contribute tests? I certainly do! When I started looking
at the code it was obviously clear there was no documentation related to testing.
Everyone needs to know how to write and execute these tests! Currently we have
basic README files describing how to install necessary dependencies for development
and test execution, how to execute the tests (and what can be tested) and most
importantly what is the test architecture. There is description of how the file
structure is organized and which are the base classes to inherit from when adding
new tests. Most of the times each component goes through a <em>pylint</em> check and
a standard PyUnit test suite.</p>
<p>Test documentation is usually in a <code>tests/README</code> file. For example:</p>
<ul>
<li><a href="https://github.com/rhinstaller/anaconda/blob/master/tests/README.rst">anaconda</a></li>
<li><a href="https://github.com/rhinstaller/blivet/blob/master/tests/README.rst">blivet</a></li>
<li><a href="https://github.com/rhinstaller/pykickstart/blob/master/tests/README.rst">pykickstart</a></li>
<li><a href="https://github.com/rhinstaller/pyparted/blob/master/tests/README.rst">pyparted</a></li>
</ul>
<p>I've tried to explain as much as possible without bloating the files and going into
unnecessary details. If you spot something missing please send a pull request.</p>
<h2>Continuous Integration</h2>
<p>This has been largely an effort driven by Chris Lumens from the devel team.
All the components I'm interested in are tested regularly in a CI environment.
There is a <code>make ci</code> Makefile target for those of you interested in what exactly
gets executed.</p>
<h2>Test Coverage</h2>
<p>In order to <strong>improve</strong> something you need to know where you stand. We'll I didn't.
That's why the first step was to integrate the
<a href="https://bitbucket.org/ned/coveragepy">coverage.py</a> tool with all of these components.</p>
<p>With the exception of blivet (written in C) all of the other
components integrate well with coverage.py and produce good statistics. pykickstart is
the champ here with 90% coverage, while anaconda is somewhere between 10% and 50%.
Full test coverage measurement for anaconda isn't straight forward and will be the
subject of my next post. For the C based code we have to hook up with
<a href="https://gcc.gnu.org/onlinedocs/gcc/Gcov.html">Gcov</a> which shouldn't be too difficult.</p>
<p>At the moment there are several open pull requests to integrate the coverage test
targets with <code>make ci</code> and also report the results in human readable form. I will be
collecting these for historical references.</p>
<h2>Tools</h2>
<p>I've created some basic text-mode
<a href="https://github.com/atodorov/coverage-tools">coverage-tools</a> to help me combine and
compare data from different executions. These are only the start of it and I'm expanding
them as my needs for reporting and analytics evolve. I'm also looking into
<a href="/blog/2015/07/27/call-for-ideas-graphical-test-coverage-reports/">more detailed coverage reports</a>
but I don't have enough data and use cases to work on this front at the moment.</p>
<p>Some ideas currently in mind:</p>
<ul>
<li>map code changes (git commits) to existing test coverage to get a feeling where to
invest in more testing;</li>
<li>map bugs to code areas and to existing test coverage to see if we aren't
missing tests in areas where the bugs are happening;</li>
</ul>
<h2>Bugs</h2>
<p>coverage.py is a very nice tool indeed but I guess most people use it in a very
limited way. Shortly after I started working with it I've found several places which
need improvements. These have to do with combining and reporting on multiple files.</p>
<p>Some of the interesting issues I've found and still open are:</p>
<ul>
<li><a href="https://bitbucket.org/ned/coveragepy/pull-requests/63/">PR #63 - New option --dont-remove when combining coverage data</a></li>
<li><a href="https://bitbucket.org/ned/coveragepy/issues/425">#425 - source parameter not including files which are explicitly specified</a></li>
<li><a href="https://bitbucket.org/ned/coveragepy/issues/426">#426 - Difference between coverage results with source specifies full dir instead of module name</a></li>
</ul>
<p>In my next post I will talk about anaconda code coverage and what I want to do with it.
In the mean time please use the comments to share your feedback.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 14 October 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/10/14/anaconda-coverage.py-introduction/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/09/30/thunderbolt-to-vga-adapter-on-linux/" rel="bookmark" title="Permalink to Thunderbolt to VGA adapter on Linux">
                <h2 class="post-title">
                    Thunderbolt to VGA adapter on Linux
                </h2>
            </a>
                <p>I've previously written about my
<a href="http://amzn.to/1Iqhl9e">Thunderbolt to Ethernet</a>
adapter <a href="/blog/2015/05/04/thunderbolt-to-ethernet-adapter-on-linux/">working on Linux</a>
despite claims that it should not. Recently I've used my <a class="wikilink" href="http://amzn.to/1RdviyD">MacBook Air</a> to do a presentation
and the <a href="http://amzn.to/1Iqh0nd">Thunderbolt to VGA adapter</a> worked well enough.</p>
<p>It was an Acer adapter but I have no more details b/c it wasn't mine.</p>
<p>Before the event I've tested it and it worked so on the day of the event I've
freshly rebooted my laptop to be sure no crashed processes or anything like that
was running and gave it a go.</p>
<p>First time I plugged in the <a class="wikilink" href="http://amzn.to/1RdviyD">MacBook</a> everything worked like a charm. Then my computer was
unplugged and the lid closed, causing it to suspend. The second time I've plugged it in
I was told there was nothing showing on the projector so I quickly plugged the adapter out
and then back in. It worked more or less.</p>
<p>At the time I had LibreOffice Impress in presentation
mode but I did see ABRT detecting a kernel problem. When my slides popped up the text
on the first one was mostly missing but the rest were ok!</p>
<p>Mind you I'm still running <a href="/blog/categories/mac/">RHEL 7 on my MacBook Air</a>. The above is
with kernel-3.10.0-229.14.1.el7.x86_64.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 30 September 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/09/30/thunderbolt-to-vga-adapter-on-linux/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/09/25/unit-testing-bad-stub-design-in-dnf/" rel="bookmark" title="Permalink to Unit Testing Example - Bad Stub Design in DNF">
                <h2 class="post-title">
                    Unit Testing Example - Bad Stub Design in DNF
                </h2>
            </a>
                <p>In software testing, usually unit testing, test stubs are programs that simulate
the behaviors of external dependencies that a module undergoing the test depends
on. Test stubs provide canned answers to calls made during the test.</p>
<p>I've discovered an improperly written stub method in one of
<a href="http://dnf.baseurl.org/">DNF</a>'s tests:</p>
<div class="highlight"><span class="filename">tests/test_download.py</span><pre><span class="k">class</span> <span class="nc">DownloadCommandTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">stub_fn</span><span class="p">(</span><span class="n">pkg_spec</span><span class="p">):</span>
            <span class="k">if</span> <span class="s">&#39;.src.rpm&#39;</span> <span class="ow">in</span> <span class="n">pkg_spec</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sourcerpm</span><span class="o">=</span><span class="n">pkg_spec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">pkg</span> <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">q</span> <span class="k">if</span> <span class="n">pkg_spec</span> <span class="o">==</span> <span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="n">cli</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">DownloadCommand</span><span class="p">(</span><span class="n">cli</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">repos</span> <span class="o">=</span> <span class="n">dnf</span><span class="o">.</span><span class="n">repodict</span><span class="o">.</span><span class="n">RepoDict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">_get_query</span> <span class="o">=</span> <span class="n">stub_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">_get_query_source</span> <span class="o">=</span> <span class="n">stub_fn</span>
</pre></div>


<p>The replaced methods look like this:</p>
<div class="highlight"><span class="filename">plugins/download.py</span><pre>    <span class="k">def</span> <span class="nf">_get_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pkg_spec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a query to match a pkg_spec.&quot;&quot;&quot;</span>
        <span class="n">subj</span> <span class="o">=</span> <span class="n">dnf</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">Subject</span><span class="p">(</span><span class="n">pkg_spec</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">subj</span><span class="o">.</span><span class="n">get_best_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">sack</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">available</span><span class="p">()</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">run</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;No package &quot;</span> <span class="o">+</span> <span class="n">pkg_spec</span> <span class="o">+</span> <span class="s">&quot; available.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">dnf</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">PackageNotFoundError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">q</span>

    <span class="k">def</span> <span class="nf">_get_query_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pkg_spec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Return a query to match a source rpm file name.&quot;&quot;&quot;</span>
        <span class="n">pkg_spec</span> <span class="o">=</span> <span class="n">pkg_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>  <span class="c"># skip the .rpm</span>
        <span class="n">nevra</span> <span class="o">=</span> <span class="n">hawkey</span><span class="o">.</span><span class="n">split_nevra</span><span class="p">(</span><span class="n">pkg_spec</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">sack</span><span class="o">.</span><span class="n">query</span><span class="p">()</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">available</span><span class="p">()</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">nevra</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">nevra</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                     <span class="n">release</span><span class="o">=</span><span class="n">nevra</span><span class="o">.</span><span class="n">release</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">nevra</span><span class="o">.</span><span class="n">arch</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">run</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;No package &quot;</span> <span class="o">+</span> <span class="n">pkg_spec</span> <span class="o">+</span> <span class="s">&quot; available.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">dnf</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">PackageNotFoundError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">q</span>
</pre></div>


<p>As seen here <em>stub_fn</em> replaces the <em>_get_query</em> methods from the class under
test. At the time of writing this has probably seemed like a good idea to
speed up writing the tests.</p>
<p>The trouble is we should be replacing the external dependencies of <em>_get_query</em>
(other parts of DNF essentially) and not methods from <em>DownloadCommand</em>. To
understand why this is a bad idea check
<a href="https://github.com/rpm-software-management/dnf-plugins-core/pull/113">PR #113</a>,
which directly modifies <em>_get_query</em>. There's no way to test this patch
with the current state of the test.</p>
<p>So I took a few days to experiment and update the current test stubs. The
result is 
<a href="https://github.com/rpm-software-management/dnf-plugins-core/pull/118">PR #118</a>.
The important bits are the <em>SackStub</em> and <em>SubjectStub</em> classes which hold
information about the available RPM packages on the system. The rest are cosmetics
to fit around the way the query objects are used (q.available(), q.latest(), q.filter()).
The proposed design correctly overrides the external dependencies on
<em>dnf.subject.Subject</em> and <em>self.base.sack</em> which are initialized before our
plugin is loaded by DNF.</p>
<p>I must say this is the first error of this kind I've seen in my QA practice so far.
I have no idea if this was a minor oversight or something which happens more frequently
in open source projects but it's a great example nevertheless.</p>
<p>For those of you who'd like to get started on unit testing I can recommend the book
<a href="http://www.amazon.com/gp/product/1933988274/ref=as_li_ss_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=1933988274&linkCode=as2&tag=atodorovorg-20">The Art of Unit Testing: With Examples in .Net</a><img src="http://www.assoc-amazon.com/e/ir?t=atodorovorg-20&l=as2&o=1&a=1933988274" width="1" height="1" border="0"  style="border:none !important; margin:0px !important;" />
by Roy Osherove!</p>
<p><strong>UPDATE</strong>: Part 2 with more practical examples can be found
<a href="/blog/2015/11/23/bad-stub-design-in-dnf/">here</a>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 25 September 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/09/25/unit-testing-bad-stub-design-in-dnf/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/09/16/4000-bugs-in-fedora-checksec-failures/" rel="bookmark" title="Permalink to 4000+ bugs in Fedora - checksec failures">
                <h2 class="post-title">
                    4000+ bugs in Fedora - checksec failures
                </h2>
            </a>
                <p>In the last week I've been trying to figure out how many packages
conform to the new
<a href="https://fedoraproject.org/wiki/Changes/Harden_All_Packages">Harden All Packages</a>
policy in Fedora!</p>
<p>From 46884 RPMs, 17385 are 'x86_64' meaning they may contain ELF objects.
From them 4489 are reported as failed <code>checksec</code>.</p>
<p>What you should see as the output from <code>checksec is</code></p>
<div class="highlight"><pre>Full RELRO      Canary found      NX enabled    PIE enabled     No RPATH   No RUNPATH
Full RELRO      Canary found      NX enabled    DSO             No RPATH   No RUNPATH
</pre></div>


<p>The first line is for binaries, the second one for libraries b/c
DSOs on x86_64 are always position-independent. Some RPATHs are acceptable,
e.g. <code>%{_libdir}/foo/</code> and I've tried to exclude them unless
other offenses are found. The script which does this is
<a href="https://github.com/atodorov/fedora-scripts/blob/master/checksec-collect">checksec-collect</a>.</p>
<p>Most often I'm seeing <em>Partial RELRO</em>, <em>No canary found</em> and <em>No PIE</em> errors.
Since all packages potentially process untrusted input, it makes sense for all of them
to be hardened and enhance the security of Fedora. That's why all of these errors
should be considered valid bugs.</p>
<h2>Attn package maintainers</h2>
<p>Please see if your package is in the list and try to fix it or let me know
why it should be excluded, for example it's a boot loader and doesn't function
properly with hardening enabled. The full list is available at
<a href="https://github.com/atodorov/fedora-scripts/blob/master/checksec.log">GitHub</a>.</p>
<p>For more information about the different protection mechanisms see the following
links:</p>
<ul>
<li><a href="http://tk-blog.blogspot.bg/2009/02/relro-not-so-well-known-memory.html">Partial vs Full RELRO</a></li>
<li><a href="https://en.wikipedia.org/wiki/Buffer_overflow_protection#Canaries">Stack canaries</a></li>
<li><a href="https://en.wikipedia.org/wiki/NX_bit#Linux">NX memory protection</a></li>
<li><a href="https://securityblog.redhat.com/2012/11/28/position-independent-executables-pie/">Position Independent Executables</a></li>
<li><a href="https://fedoraproject.org/wiki/Packaging:Guidelines#Beware_of_Rpath">RPATH</a></li>
<li><a href="http://blog.tremily.us/posts/rpath/">RUNPATH</a></li>
</ul>
<p><strong>UPDATE 2015-09-17</strong></p>
<p>I've posted my findings on 
<a href="https://lists.fedoraproject.org/pipermail/devel/2015-September/thread.html">fedora-devel</a>
and the comments are more than interesting even revealing an old bug in libtool.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 16 September 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/09/16/4000-bugs-in-fedora-checksec-failures/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/08/14/tip-try-f10-when-editing-grub2-menu-in-efi-mode/" rel="bookmark" title="Permalink to Tip: Try F10 When Editing grub2 Menu in EFI Mode">
                <h2 class="post-title">
                    Tip: Try F10 When Editing grub2 Menu in EFI Mode
                </h2>
            </a>
                <p>When editing the grub2 menu (especially in EFI mode) it tells you to
press Ctrl-x to save your changes and continue the boot process.
However this doesn't work on my <a class="wikilink" href="http://amzn.to/1RdviyD">MacBook Air</a>, see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1253637">rhbz#1253637</a>,
and maybe some other platforms. If this is the case try pressing <strong>F10</strong> 
instead. It works for me!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 14 August 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/08/14/tip-try-f10-when-editing-grub2-menu-in-efi-mode/#disqus_thread">comments</a>.</p>        </div>

    <hr>
    <!-- Pager -->
    <ul class="pager">
        <li class="next">
                <a href="http://atodorov.org/blog/categories/fedoraplanet/index.html">Newest Posts &rarr;</a>
                <a href="http://atodorov.org/blog/categories/fedoraplanet/index3.html">Older Posts &rarr;</a>
        </li>
    </ul>
    Page 2 / 3
    <hr>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/atodorov_">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/atodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://bg.linkedin.com/in/alextodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://feeds.feedburner.com/atodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<section>
    <p>
        I am a QA contractor at Red Hat responsible for finding over
        <a href="/blog/2014/02/19/7-years-1400-bugs-red-hat-qa/">1600 bugs</a>,
        a general purpose open source developer, Red Hat Certified professional,
        cloud hacker and an entrepreneur! My latest start-up is
        <a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=footer">Mr. Senko</a>!
    </p>
    <p>
        I am living in the <a href="http://planet.sofiavalley.com">Sofia Valley</a>
        which is emerging as a busy place for start-up founders and tech enthusiasts
        in Eastern Europe! You can find more about me <a href="/blog/2013/01/25/about-me/">here</a>.
    </p>
    <p>
        <small>
            <em>
                Some of the links contained within this site have my referral id (e.g.,
                <a target="_blank" href="http://www.amazon.com/ref=as_li_ss_tl?_encoding=UTF8&camp=1789&creative=390957&linkCode=ur2&tag=atodorovorg-20&linkId=L6Q34XAXQS5RDMOY">Amazon</a><img src="https://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=ur2&o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />),
                which provides me with a small commission for each sale. Thank you for your support.
            </em>
        </small>
    </p>
</section>

<form action="http://google.com/search" method="get" style="width:300px;margin:0 auto;">
    <fieldset role="search">
        <input type="hidden" name="sitesearch" value="http://atodorov.org" />
        <input class="search" type="text" name="q" placeholder="Search" style="width:100%"/>
    </fieldset>
</form>

<p class="copyright text-muted">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">CC-BY-SA</a> &amp;
    <a rel="license" href="http://opensource.org/licenses/MIT">MIT</a>
    2011-2016 &diams; Alexander Todorov &diams;
    <a href="http://planet.sofiavalley.com">SofiaValley Blog</a>
</p>

<script type='text/javascript'>
window.__lo_site_id = 55936;
    (function() {
        var wa = document.createElement('script'); wa.type = 'text/javascript'; wa.async = true;
        wa.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://cdn') + '.luckyorange.com/w.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(wa, s);
      })();
</script>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="http://atodorov.org/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="http://atodorov.org/theme/js/bootstrap.min.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37979549-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'atodorov';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>