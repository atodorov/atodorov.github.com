<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

            <meta name="google-site-verification" content="XynqZtldWNBbmsynVQZremIxaaO8Wgs6AGR8UZ7KIkM">

        <title>atodorov.org - Tag QA</title>

        <link href="http://feeds.feedburner.com/atodorov" type="application/atom+xml" rel="alternate" title="atodorov.org Full Atom Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="http://atodorov.org/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="http://atodorov.org/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="http://atodorov.org/theme/css/code_blocks/github.css" rel="stylesheet">

            <!-- CSS specified by the user -->
            <link href="http://atodorov.org/override.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="http://atodorov.org/theme/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

                <meta property="fb:admins" content="1616937247" >
                <meta property="og:locale" content="en_US">
		<meta property="og:site_name" content="atodorov.org">
            <meta name="twitter:card" content="summary_large_image">
            <meta name="twitter:site" content="@atodorov_">
            <meta name="twitter:title" content="atodorov.org">
            <meta name="twitter:description" content="you can logoff, but you can never leave">
                <meta name="twitter:image" content="http://atodorov.org//images/header_02.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://atodorov.org/">atodorov.org</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                        <li><a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=menu">Mr. Senko</a></li>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

        <header class="intro-header" style="background-image: url('/images/header_02.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="page-heading">
                        <h1>Tag QA</h1>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/03/11/qa-switch-from-waterfall-to-bdd/" rel="bookmark" title="Permalink to QA Switch from Waterfall to BDD">
                <h2 class="post-title">
                    QA Switch from Waterfall to BDD
                </h2>
            </a>
                <p>For the last two weeks I've been experimenting with Behavior-Driven Development
(BDD) in order to find out what it takes for the Quality Assurance department
to switch from using the Waterfall method to BDD. Here are my initial
observations and thoughts for further investigation.</p>
<h2>Background</h2>
<p>Developing an entire Linux distribution (or any large product for that matter)
is a very complicated task. Traditionally QA has been involved in writing the
test plans for the proposed technology updates, then execute and maintain them
during the entire product life-cycle reporting and verifying tons of bugs
along the way. From the point of view of the entire product the process is
very close to the traditional waterfall development method. I will be using
the term waterfall to describe the old way of doing things and BDD the new one.
In particular I'm referring to the process of analyzing the proposed feature set
for the next major version of the product (e.g. Fedora) and designing the
necessary test plans documents and test cases.</p>
<p>To get an idea about where does QA join the process see the
<a href="https://fedoraproject.org/wiki/Releases/24/ChangeSet">Fedora 24 Change set</a>.
When the planning phase starts we are given these "feature pages" from which
QA needs to distill test plans and test cases. The challenges with the
waterfall model are that QA joins the planning process rather late and there
is not enough time to iron out all the necessary details. Add to this the fact
that feature pages are often incomplete and vaguely described and sometimes
looking for the right answers is the hardest part of the job.</p>
<h2>QA and BDD</h2>
<p>Right now I'm focusing on using the
<a href="https://github.com/cucumber/cucumber/wiki/Gherkin">Gherkin</a>
<em>Given-When-Then</em> language to
prepare feature descriptions and test scenarios from the above feature pages.
You can follow my work on <a href="https://github.com/atodorov/bdd/">GitHub</a> and
I will be using them as examples below. Also see examples from my
co-workers <a href="https://github.com/tlamer/bdd">1</a>,
<a href="https://github.com/hroncok/BDD">2</a>.</p>
<p>With this experiment I want to verify how hard/easy it is for QA to write
test cases using BDD style documents and how is that different from the
traditional method. Since I don't have any experience (nor bias) towards BDD
I'm documenting my notes and items of interest.</p>
<h2>Getting Started</h2>
<p>It took me about 2 hours to get started. The essence of Gherkin is the
<em>Action &amp; Response</em> mechanism. <strong>Given</strong> the system under test (SUT) is in a
known state and <strong>when</strong> an action is taken <strong>then</strong> we expect something
to happen in response to the action. This syntax made me think from the
point of view of the user. This way it was very easy to identify different
user roles and actions which will be attempted with the SUT. This also made
my test scenarios more explicit compared to what is described in the wiki pages.
IMO being explicit when designing tests is a good thing. I like it that way.</p>
<p>OTOH the same explicitness can be achieved with the waterfall method as well.
The trouble is that this is often overlooked because
we're not in the mindset to analyze the various user roles and scenarios.
When writing test cases with waterfall the mindset is more focused on the
technical features, e.g. how the SUT exactly works and we end up missing
important interactions between the user and the system. At least I can recall
a few times that I've made that mistake.</p>
<p>Tagging the scenarios is a good way of indicating
which scenario covers which roles. Depending on the tools you use it should
be possible to execute test scenarios for different roles (tags). In waterfall
we need to have a separate test plan for each user role, possibly duplicating
some of the test cases across test plans. A bit redundant
but more importantly easier to forget the bigger picture.</p>
<h2>Big, Small &amp; Undefined</h2>
<p>BDD originates from TDD which in turn relies heavily on unit testing and
automation. This makes it very easy to use BDD 
test development (and even automate)
for self contained changes, especially ones which affect
only a single component (e.g. a single program). From the Fedora 24 changes
such are for example the systemd and system-python split.</p>
<p>I happen to work in a team where we deal with large changes, which affect
multiple components and infrastructure. Both the
<a href="https://fedoraproject.org/wiki/Releases/24/ChangeSet#Pungi_Refactor">Pungi Refactor</a>
and
<a href="https://fedoraproject.org/wiki/Releases/24/ChangeSet#Layered_Docker_Image_Build_Service">Layered Docker Image Build Service</a>
for which I've written BDD style test scenarios are of this nature. This leads
to the following issues:</p>
<ul>
<li>QA doesn't always have the entire infrastructure stack in a
staging environment for testing so we need to test on the live infra;</li>
<li>QA doesn't always have the necessary access permissions to execute
the tests and in some cases never will. For example it is very unlikely
that QA will be able to build a test release and push that for syncing
to the mirrors infrastructure to verify that there are no files left behind;</li>
<li>Not being able to test independently means QA has to wait for something to happen
then verify the results (e.g. rel-eng builds new Docker images and pushes
them live). When something breaks this testing is often too late.</li>
</ul>
<p>Complex changes are often not described into detail. As they affect multiple
infrastructure layers and components sometimes it is not known what the required
changes need to be. That's why we implement them in stages and have contingency
plans. However this makes it harder for QA to write the tests. 
Btw this is the same regardless of which development method is used.
The good thing is that by forcing you to think from the POV of the user and
in terms of action &amp; response BDD helps identify these missing bits faster.</p>
<p>For example, with Pungi (Fedora distro build tool),
the feature pages says that the produced directory
structure will be different from previous releases but it doesn't say what
is going to be different so we can't really test that. I know from
experience that this may break tools which rely on this structure like
virt-manager and anaconda and have added simple sanity tests for them.</p>
<p>In the Docker feature page we have functional requirement for automatic
image rebuilds if one of the underlying components (e.g. RPM package) changes.
This is not described in details and so is the test scenario. I can easily
write a separate BDD feature document for this functionality alone.</p>
<p>With the waterfall model when a feature isn't well defined QA often waits
for the devel team to implement the basic features and then writes test cases
based on the existing behavior. This is only good for regression testing
the next version but it can't show you something that is missing because
we're never going to look for it. BDD makes it easier to spot when we need
better definitions of scope and roles, even better functional requirements.</p>
<h2>Automation and Integration</h2>
<p>Having a small SUT is nice. For example we can easily write a
test script to install, upgrade and query RPM packages and verify the
systemd package split. We can easily prepare a test system and execute
the scripts to verify the expected results.</p>
<p>OTOH complex features are hard to integrate with BDD automation tools.
For the Docker Image Build Service the straight forward script would
be to start building a new image, then change an underlying component
and see if it gets rebuilt, then ensure all the content comes from
the existing RPM repos, then push the image to the Docker registry
and verify it can be used by the user, etc, etc. 
All of these steps take a non-trivial amount of time. Sometimes hours.
You can also execute them in parallel to save time but how do you sync
back the results ?</p>
<p>My preference for the moment is to kick-off individual
test suites for a particular BDD scenario and then aggregate the results back.
This also has a side benefit - for complex changes we can have layered
BDD feature documents, each one referencing another feature document.
Repeat this over and over until we get down to purely technical scenarios
which can be tested easily. Once the result are in go back the chain
and fill-in the rest. This way we can traverse all testing activities
from the unit testing level up to the infrastructure level.</p>
<p>I actually like the back &amp; forth traversing idea very much. I've always
wanted to know how does each individual testing effort relate to the
general product development strategy and in which areas the product is
doing well or not. You can construct the same chain of events with waterfall
as well. IMO BDD just makes it a bit more easier to think about it.</p>
<p>Another problem I faced is how do I mark the scenarios as out of scope
for the current release ? I can tag them or split them into separate files
or maybe something else? I don't know which one is the best practice. In
waterfall I'll just disable the test cases or move them into a separate
test plan.</p>
<h2>TODO</h2>
<p>I will be writing more BDD test definitions in the upcoming 2 weeks to get
more experience with them. I still don't have a clear idea how to approach
BDD test writing when given a particular feature to work on. So far I've
used the functional requirements and items of concern (when present), in the
feature pages, as a starting point for my BDD test scenarios.</p>
<p>I also want to get more feedback from the development teams and product
management folks.</p>
<h2>Summary</h2>
<p>BDD style test writing puts the tester into a mind set where it is easier
to see the big picture by visualizing different user roles and scenarios.
It makes it easier to define explicit test cases and highlights missing
details. It is easier for QA to join early in the planning process by
defining roles and thinking about all the possible interactions with the SUT.
This is the biggest benefit for me!</p>
<p>Self-contained changes are easier to describe and test automatically.</p>
<p>Bigger and complex features are harder to describe and even harder to
automate in one piece. Divide and conqueror is our best friend here!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 11 March 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/03/11/qa-switch-from-waterfall-to-bdd/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/03/08/floating-point-precision-error-with-ruby/" rel="bookmark" title="Permalink to Floating-point precision error with Ruby">
                <h2 class="post-title">
                    Floating-point precision error with Ruby
                </h2>
            </a>
                <p>One of my tests was faiing and it turned out this was caused by a
floating-point precision error. The functionality in question was a "Load more"
button with pagination which loads records from the database and the front-end displays them.</p>
<p>Ruby and JavaScript were passing around a parameter
which was only used as part of the SQL queries.
Now the problem is that JavaScript doesn't have a <code>Time</code> class and the parameter
was passed as string, then converted back to <code>Time</code> in Ruby. The problem
comes from the intermediate conversion to <code>float</code> which was used.</p>
<p>Here's a little code snippet to demonstrate the problem:</p>
<div class="highlight"><pre><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">06</span><span class="mi">8</span><span class="p">:</span><span class="mi">0</span><span class="o">*</span> <span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
<span class="o">=&gt;</span> <span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">08</span> <span class="mi">10</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">26</span> <span class="o">+</span><span class="mo">0200</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">06</span><span class="mi">9</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> 
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">070</span><span class="p">:</span><span class="mi">0</span><span class="o">*</span> <span class="no">Time</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">now</span><span class="p">)</span> <span class="o">==</span> <span class="n">now</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">071</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> 
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">072</span><span class="p">:</span><span class="mi">0</span><span class="o">*</span> <span class="no">Time</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">to_f</span><span class="p">)</span> <span class="o">==</span> <span class="n">now</span>
<span class="o">=&gt;</span> <span class="kp">false</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">073</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> 
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">074</span><span class="p">:</span><span class="mi">0</span><span class="o">*</span> <span class="n">now</span><span class="o">.</span><span class="n">to_f</span>
<span class="o">=&gt;</span> <span class="mi">1457427266</span><span class="o">.</span><span class="mi">7206197</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">075</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> 
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">076</span><span class="p">:</span><span class="mi">0</span><span class="o">*</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d %H:%M:%S.%9N&#39;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="s2">&quot;2016-03-08 10:54:26.720619705&quot;</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">077</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> 
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">07</span><span class="mi">9</span><span class="p">:</span><span class="mi">0</span><span class="o">*</span> <span class="no">Time</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">to_f</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d %H:%M:%S.%9N&#39;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="s2">&quot;2016-03-08 10:54:26.720619678&quot;</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">080</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span>
</pre></div>


<p>As you can see the conversion to float and back to Time is off by a few
nano-seconds and the database either didn't return any records or was
returning the same set of records.
This isn't something you can usually see in production, right ? Unless you
have huge traffic and happen to have records created exactly at the same moment.</p>
<p>The solution is to simply send <code>Time.now.strftime</code> to the JavaScript and then
use <code>Time.parse</code> to reconstruct the value.</p>
<div class="highlight"><pre><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">077</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> 
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">&#39;time&#39;</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">002</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d %H:%M:%S.%9N&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d %H:%M:%S.%9N&#39;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="s2">&quot;2016-03-08 10:54:26.720619705&quot;</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">003</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span>
</pre></div>


<p>If you'd like to read more about floating point arithmetics please see
<a href="http://floating-point-gui.de">http://floating-point-gui.de</a>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 08 March 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/03/08/floating-point-precision-error-with-ruby/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/02/23/ruby-time-based-testing/" rel="bookmark" title="Permalink to Ruby & Time-based Testing">
                <h2 class="post-title">
                    Ruby & Time-based Testing
                </h2>
            </a>
                <p>Publishing this mostly for self reference.
Here are two blog posts on the topic of testing time
dependent code in Ruby applications:</p>
<p><a href="http://metaskills.net/2012/08/07/synchronized-times-in-ruby-and-javascript-acceptance-tests-using-capybara-timecop-and-sinon-js/">Synchronized Times In Ruby &amp; JavaScript Acceptance Tests Using Capybara, Timecop &amp; Sinon.JS</a></p>
<p><a href="https://blog.pivotal.io/labs/labs/goodbye-timecop-hello-timehelpers">Move Over Timecop…Hello ActiveSupport::Testing::TimeHelpers</a></p>
<p>I haven't seen a module similar to timecop in Python, but frankly I've never needed one either.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 23 February 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/02/23/ruby-time-based-testing/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/02/02/fosdem-2016-report/" rel="bookmark" title="Permalink to FOSDEM 2016 Report">
                <h2 class="post-title">
                    FOSDEM 2016 Report
                </h2>
            </a>
                <p>Hello everyone, this year I've been to FOSDEM again. Here is a quick report
of what I did, saw and liked during the event.</p>
<h2>Day 0 - Elixir &amp; Erlang</h2>
<p>Friday started with an unexpected shopping trip. The airline broke
my luggage and I had to buy a replacement. The irony is that just before taking off
I saw a guy with an
<a rel="nofollow" href="http://www.amazon.com/gp/product/B006P65P1W/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=B006P65P1W&linkCode=as2&tag=atodorovorg-20&linkId=4VNFFQEDPY5JXCLP">Osprey Meridian</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=as2&o=1&a=B006P65P1W" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
and thought how cool that was. The next day I was running around Brussels to
find the exact same model! I also searched to buy the book
<a rel="nofollow" href="http://www.amazon.com/gp/product/0140238301/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=0140238301&linkCode=as2&tag=atodorovorg-20&linkId=3I6DMH5CC6ZGNX5A">Teach Your Child How to Think</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=as2&o=1&a=0140238301" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
by Edward De Bono but all 4 bookstores I checked were out of stock.</p>
<p>With the luggage problem solved I headed to
<a href="http://betacowork.com">BetaCowork</a> for
<a href="http://www.erlang-factory.com/brussels2016/">Brussels Erlang Factory Lite</a>
where I learned a bit about Erlang and Elixir. I also managed to squeeze a meeting
with <a href="http://www.betacowork.com/profile/122/gilbert-west/">Gilbert West</a> talking about
open source bugs.</p>
<p>I found particularly interesting the Elixir workshop and the talk
<a href="http://www.erlang-factory.com/brussels2016/pieterjan-montens">Erlang In The Wild: A Governmental Web Application</a>
by Pieterjan Montens. Later I've managed to get a hold of him and talk some more
about his experiences working for the government. As I figured out later we
are likely to have mutual friends.</p>
<p>BetaCowork was hosting FOSDEM related events during the entire week.
There was a GNOME event and the Libre Office Italian team was there as well.
Next time definitely worth a longer visit.</p>
<p>Friday night was reserved for a dinner with the Red Hat Eclipse team and
a fair amount of beer at Delirium afterwards where I've met my friend
<a href="https://fedoraproject.org/wiki/User:Giannisk">Giannis Konstantinidis</a>
and the new Fedora Ambassador for Albania -
<a href="https://fedoraproject.org/wiki/User:Jonatoni">Jona Azizai</a>.</p>
<p>All-in-all pretty good Friday!</p>
<h2>Day 1 - Testing and Automation</h2>
<p><img alt="Testing and Automation" src="/images/fosdem/2014/testing_automation.jpg" title="Testing and Automation" /></p>
<p>FOSDEM was hosting the
<a href="https://fosdem.org/2016/schedule/track/testing_and_automation/">Testing and automation devroom</a>
again. I've spent the entire Saturday there.</p>
<p>Definitely the most interesting talk was
<a href="https://fosdem.org/2016/schedule/event/closed_source_interop/">Testing interoperability with closed-source software through scriptable diplomacy</a>
which introduced <a href="http://frida.re">Frida</a>. Frida is a testing tool which injects
a JavaScript VM into your process and you can write scripts driving the
application automatically. It was designed as means to control closed source
software but can definitely be used for open source apps as well.</p>
<p>I've talked to both Karl and Ole about Frida and my use-case for
<a href="http://atodorov.org/blog/2016/01/14/controlling-interactive-terminal-programs/">testing interactive terminal programs</a>.
That should be easy to do with Frida - just hook into the read and write
functions and write some JavaScript or Python to run the test.
Later we talked about how exactly Frida attaches to the running process
and what external dependencies are needed if I'm to inject Frida
into the Fedora installation environment.</p>
<p>In <em>Testing embedded systems</em> Itamar Hassin talked about testing medical devices
and made a point about regulation, security and compliance. Basically you are not
allowed to ship non-application code on production system. However that code
is necessary instrumentation to allow external integration testing. I suspect most
developers and QA engineers will never have to deal with so strict
regulations but that is something to have in mind if you test software
in a heavily regulated industry.</p>
<p><em>Testing complex software in CI</em> was essentially a presentation about <em>cwrap</em> which
I've seen at
<a href="http://atodorov.org/blog/2014/02/03/fosdem-2014-report-day-2-testing-and-automation/">FOSDEM 2014</a>.
It touched the topic from a slightly different angle though. Tests in any open source
project should have the following properties</p>
<ul>
<li>Be able to execute without the need of a complex environment;</li>
<li>Enable full CI during code review (dependent on previous property);</li>
<li>Be able to create complete integration tests.</li>
</ul>
<p>The demo showed how you can execute Samba's test suite locally without
preparing a domain controller for example. This helps both devel and external
contributors. Now contrast this with how Red Hat QE will do the testing - 
they will create a bunch of virtual and bare metal machines, configure all
related services and then execute the same test scripts to verify that indeed
Samba works as expected.</p>
<p>Btw I've been thinking what if I patch <em>cwrap</em> to overwrite read and write ?
That will also make it possible to test interactive console programs,
wouldn't it?</p>
<p><em>Jenkins as Code</em> by Marcin and Lukasz was a blast. I think there were
people standing alongside the walls. The guys shared their experience
with <a href="https://github.com/jenkinsci/job-dsl-plugin">Jenkins Job DSL</a>
plugin. The plugin is very flexible and powerful,
using Groovy as its programming language. The only drawback is that it is
sometimes too complex to use and requires a steep learning curve. Maybe
<a href="http://docs.openstack.org/infra/jenkins-job-builder/">Jenkins Job Builder</a>
is better suited if you don't need all that flexibility
and complexity. I've met both of them afterwards and talked a bit more
about open source bugs.</p>
<p>At Saturday evening I've visited a panel discussion about
<a href="https://www.eventbrite.com/e/startupbusaccelerate-the-impact-of-open-source-software-on-the-tech-industry-tickets-20869395925">the impact of open source on the tech industry</a>
at <a href="http://co-station.com">Co.Station</a> organized by <a href="http://europe.startupbus.com">The Startup Bus</a>.
There was beer, pizza, entrepreneur networking and talking about startups
and open source. Do I need to say more? I will post a separate blog post
about the interesting start-ups I've found so stay tuned.</p>
<h2>Day 2 - Ping-pong with BBC Open Source</h2>
<p><img alt="ping-pong" src="/images/bbc_ping_pong.jpg" title="ping-pong" /></p>
<p>Sunday was my lazy day. I've attended a few talks but nothing too interesting.
I've managed to go around the project stands, 
<a href="https://fedorahosted.org/fedora-infrastructure/ticket/5085">filed a bug against FAS</a>
and scored the highest ping-pong score for the day at the BBC Open Source stand.</p>
<p>BBC has a long history of being involved with education in the UK and the
<a href="https://www.microbit.co.uk">micro:bit</a> is their latest project. I will love to
see this (or similar) delivered by the thousands here in Bulgaria so if you
think about sponsoring let me know.</p>
<p>Accidentally I met
<a href="https://fedoraproject.org/wiki/User:Msivak">Martin Sivak</a> - a former
Anaconda developer whom I've worked with in the past. He is now at the
Virtualization Development team at Red Hat and we briefly talked about
the need for more oVirt testing. I have something in mind about this
which will be announced in the next 2 months so stay tuned.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 02 February 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/02/02/fosdem-2016-report/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/01/21/how-to-get-started-on-a-new-qa-project/" rel="bookmark" title="Permalink to How to Get Started on a New QA Project">
                <h2 class="post-title">
                    How to Get Started on a New QA Project
                </h2>
            </a>
                <p>Every time I have to look at a new software project and use my QA powers
to help them I follow a standard process of getting involved. Usually my
job is to reveal which areas are lacking adequate test coverage and propose
and implement improvements. Here's what it looks like.</p>
<h2>Obtain Domain Knowledge</h2>
<p>Whatever the software does I don't start looking into the technical details
before I have domain knowledge about the subject. If the domain is purely
outside my expertise my first reading materials have
nothing to do with the product itself. My goal is to learn how the domain
works, what language it uses, any particular specifics that may exists, etc.</p>
<p>Then I start asking general questions about the software, how it works and
what it does. At this stage I'm not trying to go into details but rather
cover as much angles as possible. I want to know the big picture of how
things are supposed to work and what the team is trying to do. This also
starts to reveal the architecture behind the project.</p>
<p>Then I start using the software as if I'm the intended target audience while
taking notes about everything that seems odd or I simply don't understand.
Being with limited knowledge about the domain and the product helps a lot
because I haven't developed any bias yet. This initial hands-on introduction
is best done with a peer who is better familiar with the
product. It is not necessary for the peer to be a technical person, although
that helps when implementation related questions arise.</p>
<h2>RTFM</h2>
<p>I make a point to read any available documents, wikis, READMEs, etc. They can
fill the gaps with often used terms, explain processes and workflows or
reveal that such are missing and document existing infrastructure.
Quite often I'm able to see some areas for
improvements directly from reading the documentation.</p>
<p>At this stage I'm just collecting notes and impressions which will be validated
later. I don't try to remember all of the docs because I can always go back
and read them again. Instead I try to remember the topics these documents
talk about and possibly collect links for future reference.</p>
<h2>Get to Know the Devel Team</h2>
<p>One thing I hate the most, except not knowing what a piece of code does is
not knowing who to ask. Quite often team structure follows the application
structure - front-end, back-end, mobile, etc. While getting to know who does
what I also use this as opportunity to gain deeper knowledge about the
product. I will talk to team leads and individual developers asking them to
explain the chosen architecture and also tell me what are the most annoying
problems according to them.</p>
<p>Later this knowledge makes it easier to see trends and suggest changes that
will improve the overall product quality. Having good working relationship
with developers also makes it easy for these changes to get through.</p>
<h2>Get to Know the QA Team</h2>
<p>Similar to the previous step but with a deeper focus on details. This is my
personal domain so I'm trying to figure out who does what in terms of software
testing for the project in question. When I'm working with less experienced
QA teams I focus on what are the individual tasks at hand, how often are they
executed, what is the general workflow and how are we dealing with bugs.</p>
<p>Behind the scenes what this accomplishes is that I'm able to find what the
bug reporting, testing and verification process is. How are new bugs discovered
and what are the general test strategies without confronting people
directly. I also find what tools are used and get familiar with them in the
process and discover the level of technical abilities of individual team members.</p>
<h2>Get to Know the App</h2>
<p>Armed with the previous knowledge I set off to explore the entire application.
Again this is best done with a peer. This time I look at every screen, widget
and button there is. I try using all the available features which also doubles
as an exploratory testing session.</p>
<p>For backend services which are usually harder to test I opt for a more
detailed explanation session with the developers. Here's the time when I'm
asking the question "How do you test .... ?" multiple times.</p>
<h2>Deploy to Production</h2>
<p>If possible I like to keep an eye on how things are deployed to production.
It is not uncommon for software to experience problems due to problems with
the deployment procedure or the production environment itself.</p>
<p>Also with agile teams it is common to deploy more often. This in turn may
generate additional work for QA. Knowing how software is deployed to
production and what the workflow in the team is helps later with planning
test activities and resources.</p>
<h2>Read All Bugs</h2>
<p>Unless there are millions of them I try to go through all the bugs reported
in the bug tracker. If the project has some age to it earlier reports may not
be relevant anymore. In this case my marker is an important event like big
refactoring, important or big new features, changes in teams and organization
or similar. The thinking behind this is that every big change introduces lots
of risks from software quality stand point. Also large changes invalidate
previous conditions and may render existing problems obsolete, replacing them
with newer set of problems instead!</p>
<p>From reading bug reports I'm able to discover failure trends, which in turn
indicate areas for improvement. For example: lots of translation related bugs
indicate problems with the translation workflow, lots of broken existing
functionality means poor regression testing, probably also lack of unit tests,
lots of partially(poorly) implemented features shows chaotic planning and
unclear feature specifications, etc.</p>
<p>At this stage I try to classify problems both by technical component and
by type of issue. Later this will be my starting reference for creating
test strategies and test plans!</p>
<p>If possible and practical I talk to support and read all the support tickets
as well. This gives me an idea which problems are most visible to
customers which aren't necessary the biggest technical issues but may consume
man power dealing with them.</p>
<h2>Summarize, Divide and Conquer</h2>
<p>Depending on the project and team size these initial steps will take anywhere 
from a full week to a month or even more. After they are complete I'm
feeling comfortable talking about the software at hand and have a list of
possible problems and areas of improvements.</p>
<p>After talking to people in charge (e.g. PMs, Project Leads, etc) my initial
list is transformed into tasks. I strive to keep the tasks as independent
as possible. Then these tasks are prioritized and it's time to start executing
them one by one.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 21 January 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/01/21/how-to-get-started-on-a-new-qa-project/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/01/15/tesla-needs-more-qa/" rel="bookmark" title="Permalink to Tesla Needs More QA">
                <h2 class="post-title">
                    Tesla Needs More QA
                </h2>
            </a>
                <p><img alt="Tesla email" src="/images/tesla_qa_bug.png" title="Tesla email" /></p>
<p>A nice way for Tesla Motors to tell me they won't consider my interest in their
QA positions - by sending me an email with a bug! It only goes to show that
everything coming out of an IT system needs to be tested.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 15 January 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/01/15/tesla-needs-more-qa/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/01/14/controlling-interactive-terminal-programs/" rel="bookmark" title="Permalink to Controlling Interactive Terminal Programs">
                <h2 class="post-title">
                    Controlling Interactive Terminal Programs
                </h2>
            </a>
                <p>Building on my previous experience about
<a href="http://atodorov.org/blog/2015/12/25/capture-terminal-output-from-other-processes/">capturing terminal output from other processes</a>
I wanted to create an automated test case for the initial-setup-text service
which would control <code>stdin</code>. Something like
<a href="https://fedorahosted.org/dogtail/">Dogtail</a> but for text mode applications.</p>
<p>What you have to do is attach <code>gdb</code> to the process. Then you can <code>write</code> to
any file descriptor that is already opened. <strong>WARNING:</strong> writing directly to
stdin didn't quite work! Because (I assume) stdin is a tty the text was shown on
the console but the return character wasn't interpreted and the application wasn't
accepting the input string. What I had to do is replace the tty with a pipe and
it worked. However the input is not duplicated on the console this way!</p>
<p>Another drawback is that I couldn't use <code>strace</code> to log the output in combination
with <code>gdb</code>. Once a process is under trace you can't trace it a second time! For this
simple test I was able to live with this by not inspecting the actual text printed
by initial-setup. Instead I'm validating the state of the system after setup is
complete. I've tried to <code>read</code> from <code>stdout</code> in gdb but that didn't work either.
If there's a way to make this happen I can convert this script to a mini-framework.</p>
<p>Another unknown is interacting with <code>passwd</code>. Probably for security reasons
it doesn't allow to mess around with its stdin but I didn't investigate deeper.</p>
<p>I've used the
<a href="https://github.com/ticpu/tools/blob/master/fdmanage.py">fdmanage.py</a>
script which does most of the work for me. I've removed the extra bits
that I didn't need, added the <code>write()</code> method and removed the original call to
<code>fcntl</code> which puts gdb.stdout into non-blocking mode (that didn't work for me).</p>
<div class="highlight"><span class="filename">initial_setup_driver.py</span><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c"># fdmanage.py is a program to manage file descriptors of running programs</span>
<span class="c"># by using GDB to modify the running program.</span>
<span class="c"># https://github.com/ticpu/tools/blob/master/fdmanage.py</span>
<span class="c"># Copyright (C) 2015 Jérôme Poulin &lt;jeromepoulin@gmail.com&gt;</span>
<span class="c">#</span>
<span class="c"># This program is free software: you can redistribute it and/or modify</span>
<span class="c"># it under the terms of the GNU General Public License as published by</span>
<span class="c"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c"># (at your option) any later version.</span>
<span class="c">#</span>
<span class="c"># This program is distributed in the hope that it will be useful,</span>
<span class="c"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c"># GNU General Public License for more details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU General Public License</span>
<span class="c"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c">#</span>
<span class="c"># Copyright (c) 2016 Alexander Todorov &lt;atodorov@redhat.com&gt;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">select</span>
<span class="kn">import</span> <span class="nn">subprocess</span>


<span class="k">class</span> <span class="nc">Gdb</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gdb</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
            <span class="p">[</span><span class="s">&quot;gdb&quot;</span><span class="p">,</span> <span class="s">&quot;-q&quot;</span><span class="p">,</span> <span class="s">&quot;-p&quot;</span><span class="p">,</span> <span class="n">pid</span><span class="p">],</span>
            <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>
            <span class="n">close_fds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pid</span> <span class="o">=</span> <span class="n">pid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s">&quot;detach&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s">&quot;quit&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gdb</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gdb</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdb</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Program terminated.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gdb</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf8&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gdb</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">send_command_expect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdb</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;utf8&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&quot; = &quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">gdb</span><span class="o">.</span><span class="n">stdout</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close_fd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s">&quot;call close(</span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">fd</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">dup2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_fd</span><span class="p">,</span> <span class="n">new_fd</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s">&quot;call dup2(</span><span class="si">%d</span><span class="s">, </span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">old_fd</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_fd</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">66</span><span class="p">):</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_command_expect</span><span class="p">(</span><span class="s">&#39;call open(&quot;</span><span class="si">%s</span><span class="s">&quot;, </span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fd</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">txt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s">&#39;call write(</span><span class="si">%d</span><span class="s">, &quot;</span><span class="si">%s</span><span class="s">&quot;, </span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="kn">import</span> <span class="nn">tempfile</span>

    <span class="c"># these are specific to initial-setup-text</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">&quot;1</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span> <span class="c"># License information</span>
        <span class="s">&quot;2</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span> <span class="c"># Accept license</span>
        <span class="s">&quot;c</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span> <span class="c"># Continue back to the main hub</span>

        <span class="s">&quot;3</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span>  <span class="c"># Timezone settings</span>
        <span class="s">&quot;8</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span>  <span class="c"># Europe</span>
        <span class="s">&quot;43</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span> <span class="c"># Sofia</span>

<span class="c"># passwd doesn&#39;t allow us to overwrite its file descriptors</span>
<span class="c"># either aborts or simply doesn&#39;t work</span>
<span class="c">#        &quot;4\\n&quot;,      # Root password</span>
<span class="c">#        &quot;redhat\\n&quot;,</span>
<span class="c">#        &quot;redhat\\n&quot;,</span>
<span class="c">#        &quot;no\\n&quot;,     # password is weak</span>
<span class="c">#        &quot;123\\n&quot;,</span>
<span class="c">#        &quot;123\\n&quot;,</span>
<span class="c">#        &quot;no\\n&quot;,     # password is too short</span>
<span class="c">#        &quot;Th1s-Is-a-Str0ng-Password!\\n&quot;,</span>
<span class="c">#        &quot;Th1s-Is-a-Str0ng-Password!\\n&quot;,</span>

        <span class="s">&quot;c</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span> <span class="c"># Continue to exit</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;USAGE: </span><span class="si">%s</span><span class="s"> &lt;PID&gt;&quot;</span> <span class="o">%</span> <span class="n">__file__</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="s">&quot;pipe&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkfifo</span><span class="p">(</span><span class="n">pipe</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Gdb</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">gdb</span><span class="p">:</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">gdb</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c"># O_RDWR</span>
        <span class="n">gdb</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c"># replace STDIN with a PIPE</span>
        <span class="n">gdb</span><span class="o">.</span><span class="n">close_fd</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>

        <span class="c"># set a breakpoint before continuing</span>
        <span class="n">break_point_num</span> <span class="o">=</span> <span class="n">gdb</span><span class="o">.</span><span class="n">send_command_expect</span><span class="p">(</span><span class="s">&quot;break read&quot;</span><span class="p">)</span>

        <span class="c"># now execute the process step-by-step</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">len_steps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
            <span class="n">gdb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">len_steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">gdb</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s">&quot;delete </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">break_point_num</span><span class="p">)</span>
            <span class="n">gdb</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s">&quot;continue&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># clean up</span>
    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">pipe</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>
</pre></div>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 14 January 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/01/14/controlling-interactive-terminal-programs/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/12/25/capture-terminal-output-from-other-processes/" rel="bookmark" title="Permalink to Capture Terminal Output From Other Processes">
                <h2 class="post-title">
                    Capture Terminal Output From Other Processes
                </h2>
            </a>
                <p>I've been working on a test case to verify that Anaconda will print its EULA
notice at the end of a text mode installation. The problem is how do you capture
all the text which is printed to the terminal from processes outside your control ?
The answer is surprisingly simple - using strace! </p>
<div class="highlight"><pre><span class="nf">%post</span> <span class="o">--</span><span class="n">nochroot</span>
<span class="n">PID</span><span class="o">=</span><span class="err">`</span><span class="n">ps</span> <span class="n">aux</span> <span class="o">|</span> <span class="n">grep</span> <span class="s">&quot;/usr/bin/python /sbin/anaconda&quot;</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="s">&quot;grep&quot;</span> <span class="o">|</span> <span class="n">tr</span> <span class="o">-</span><span class="n">s</span> <span class="sc">&#39; &#39;</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">f2</span> <span class="o">-</span><span class="n">d</span><span class="sc">&#39; &#39;</span><span class="err">`</span>
<span class="n">STRACE_LOG</span><span class="o">=</span><span class="s">&quot;/mnt/sysimage/root/anaconda.strace&quot;</span>

<span class="cp"># see https:</span><span class="c1">//fedoraproject.org/wiki/Features/SELinuxDenyPtrace</span>
<span class="n">setsebool</span> <span class="n">deny_ptrace</span> <span class="mi">0</span>

<span class="cp"># EULA notice is printed after post-scripts are run</span>
<span class="n">strace</span> <span class="o">-</span><span class="n">e</span> <span class="n">read</span><span class="p">,</span><span class="n">write</span> <span class="o">-</span><span class="n">s16384</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span><span class="n">o</span> <span class="n">$STRACE_LOG</span> <span class="o">-</span><span class="n">p</span> <span class="n">$PID</span> <span class="o">-</span><span class="n">f</span> <span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span>
</pre></div>


<p>strace is tracing only read and write events (we really only need write) and
extending the maximum string size printed in the log file. For a simple grep
this is sufficient. If you need to pretty-print the strace output have a look
at the <a href="http://search.cpan.org/~bbb/ttylog/ttylog">ttylog</a> utility.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 25 December 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/12/25/capture-terminal-output-from-other-processes/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/12/17/facebook-is-bugging-me/" rel="bookmark" title="Permalink to Facebook is Bugging me">
                <h2 class="post-title">
                    Facebook is Bugging me
                </h2>
            </a>
                <p><img alt="Facebook icon" src="/images/facebook_android_icon_small.png" title="Facebook icon" /></p>
<p>Facebook for Android version 55.0.0.18.66 broke the home screen icon title.
It reads <code>false</code> instead of <code>Facebook</code>. This is now fixed in version 58.0.0.28.70.
I wonder how they managed to get this slip through. Also isn't Google
supposed to review the apps coming into the Play Store and not publish them
if there are such visible issues ? I guess this wasn't the case here.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 17 December 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/12/17/facebook-is-bugging-me/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/12/02/automatic-upstream-dependency-testing/" rel="bookmark" title="Permalink to Automatic Upstream Dependency Testing">
                <h2 class="post-title">
                    Automatic Upstream Dependency Testing
                </h2>
            </a>
                <p>Ever since
<a href="http://atodorov.org/blog/2015/11/24/python-libs-in-rhel-7.2-broke-ssl-verification-in-s3cmd/">RHEL 7.2 python-libs broke s3cmd</a>
I've been pondering an age old problem: <em>How do I know if my software works with the
latest upstream dependencies ? How can I pro-actively monitor for new versions
and add them to my test matrix ?</em></p>
<p>Mixing together my previous experience with
<a href="http://atodorov.org/blog/2014/05/06/opensource-dot-com-article-10-steps-to-migrate-your-closed-software-to-open-source/">Difio</a>
and monitoring upstream sources,
and <a href="https://twitter.com/ForbesLindesay">Forbes Lindesay's</a> <em>GitHub Automation</em> talk
at <a href="http://atodorov.org/blog/2015/05/22/devit-conf-2015-impressions/">DEVit Conf</a> I came
together with a plan:</p>
<ul>
<li>Make an application which will execute when new upstream version is available;</li>
<li><a href="http://atodorov.org/blog/2015/12/01/commit-a-file-with-the-github-api-and-python/">Automatically update <code>.travis.yml</code></a>
for the projects I'm interested in;</li>
<li>Let Travis-CI execute my test suite for all available upstream versions;</li>
<li>Profit!</li>
</ul>
<h2>How Does It Work</h2>
<p>First we need to monitor upstream! RubyGems.org has nice
<a href="http://guides.rubygems.org/rubygems-org-api/#webhook-methods">webhooks interface</a>,
you can even trigger on individual packages. PyPI however doesn't have anything
like this :(. My solution is to run a cron job every hour and parse their RSS
stream for newly released packages. This has been working previously for Difio
so I re-used one function from the code.</p>
<p>After finding anything we're interested in comes the hard part - automatically
updating <code>.travis.yml</code> using the GitHub API. I've described this in more detail
<a href="http://atodorov.org/blog/2015/12/01/commit-a-file-with-the-github-api-and-python/">here</a>. This time
I've slightly modified the code to update only when needed and accept more
parameters so it can be reused.</p>
<p>Travis-CI has a clean interface to specify environment variables and
<a href="https://docs.travis-ci.com/user/environment-variables/#Defining-Multiple-Variables-per-Item">defining several</a>
of them crates a test matrix. This is exactly what I'm doing.
<code>.travis.yml</code> is updated with a new ENV setting, which determines the upstream
package version. After commit new build is triggered which includes the expanded
test matrix.</p>
<h2>Example</h2>
<p><img alt="Travis-CI build log" src="http://atodorov.org/images/travisci_matrix.png" title="Travis-CI build log" /></p>
<p>Imagine that our <em>Project 2501</em> depends on FOO version <em>0.3.1</em>. The
<a href="https://travis-ci.org/atodorov/bztest/builds">build log</a> illustrates what
happened:</p>
<ul>
<li>Build #9 is what we've tested with <em>FOO-0.3.1</em> and released to production.
Test result is PASS!</li>
<li>Build #10 - meanwhile upstream releases <em>FOO-0.3.2</em> which causes our project
to break. We're not aware of this and continue developing new features
while all test results still PASS! When our customers upgrade their systems
<em>Project 2501</em> will break ! Tests didn't catch it because test matrix wasn't
updated. Please
ignore the actual commit message in the example! I've used the same repository
for the dummy dependency package.</li>
<li>Build #11 - the monitoring solution finds <em>FOO-0.3.2</em> and updates the test
matrix automatically. The build immediately breaks! More precisely the
<a href="https://travis-ci.org/atodorov/bztest/builds/94263181">test with version <em>0.3.2</em> fails</a>!</li>
<li>Build #12 - we've alerted FOO.org about their problem and they've released
<em>FOO-0.3.3</em>. Our monitor has found that and updated the test matrix.
However <a href="https://travis-ci.org/atodorov/bztest/builds/94270592">the 0.3.2 test job still fails</a>!</li>
<li>Build #13 - we decide to workaround the 0.3.2 failure or simply handle the
error gracefully. In this example I've removed version 0.3.2 from the test
matrix to simulate that. In reality I wouldn't touch <code>.travis.yml</code> but instead
update my application and tests to check for that particular version.
All test results are PASS again!</li>
</ul>
<p>Btw Build #11 above was triggered manually (./monitor.py) while Build #12
came from OpenShit, my hosting environment.</p>
<p>At present I have this monitoring enabled for my
<a href="http://atodorov.org/blog/2015/11/26/3-new-python-markdown-extensions/">new Markdown extensions</a>
and will also add it to <a href="https://github.com/atodorov/django-s3-cache">django-s3-cache</a>
once it migrates to Travis-CI (it uses drone.io now).</p>
<h2>Enough Talk, Show me the Code</h2>
<div class="highlight"><span class="filename">monitor.py</span><pre><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">httplib</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">xml.dom.minidom</span> <span class="kn">import</span> <span class="n">parseString</span>

<span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">post_data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="c"># GitHub requires a valid UA string</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;User-Agent&#39;</span> <span class="p">:</span> <span class="s">&#39;Mozilla/5.0 (X11; Linux x86_64; rv:10.0.5) Gecko/20120601 Firefox/10.0.5&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c"># shortcut for GitHub API calls</span>
    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;://&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;https://api.github.com</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">url</span>

    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;api.github.com&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&quot;GITHUB_TOKEN&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Set the GITHUB_TOKEN variable&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s">&#39;token </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;GITHUB_TOKEN&#39;</span><span class="p">]</span>
            <span class="p">})</span>

    <span class="p">(</span><span class="n">proto</span><span class="p">,</span> <span class="n">host_path</span><span class="p">)</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;//&#39;</span><span class="p">)</span>
    <span class="p">(</span><span class="n">host_port</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="o">=</span> <span class="n">host_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">path</span>

    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;https&#39;</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPSConnection</span><span class="p">(</span><span class="n">host_port</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="n">host_port</span><span class="p">)</span>


    <span class="n">method</span> <span class="o">=</span> <span class="s">&#39;GET&#39;</span>
    <span class="k">if</span> <span class="n">post_data</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s">&#39;POST&#39;</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">post_data</span><span class="p">)</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">404</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;404 - </span><span class="si">%s</span><span class="s"> not found&quot;</span> <span class="o">%</span> <span class="n">url</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c"># not a JSON response</span>
        <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">post_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">get_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">monitor_rss</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scan the PyPI RSS feeds to look for new packages.</span>
<span class="sd">        If name is found in config then execute the specified callback.</span>

<span class="sd">        @config is a dict with keys matching package names and values</span>
<span class="sd">        are lists of dicts</span>
<span class="sd">            {</span>
<span class="sd">                &#39;cb&#39; : a_callback,</span>
<span class="sd">                &#39;args&#39; : dict</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rss</span> <span class="o">=</span> <span class="n">get_url</span><span class="p">(</span><span class="s">&quot;https://pypi.python.org/pypi?:action=rss&quot;</span><span class="p">)</span>
    <span class="n">dom</span> <span class="o">=</span> <span class="n">parseString</span><span class="p">(</span><span class="n">rss</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dom</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;item&quot;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pub_date</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;pubDate&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">wholeText</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
            <span class="n">released_on</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">pub_date</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">wholeText</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s"> %b %Y %H:%M:%S GMT&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">print</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="s">&quot;found in config&quot;</span>
                <span class="k">for</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">args</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s">&#39;args&#39;</span><span class="p">]</span>
                        <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                            <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                            <span class="s">&#39;version&#39;</span> <span class="p">:</span> <span class="n">version</span><span class="p">,</span>
                            <span class="s">&#39;released_on&#39;</span> <span class="p">:</span> <span class="n">released_on</span>
                        <span class="p">})</span>

                        <span class="c"># execute the call back</span>
                        <span class="n">cfg</span><span class="p">[</span><span class="s">&#39;cb&#39;</span><span class="p">](</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">print</span> <span class="n">e</span>
                        <span class="k">continue</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">e</span>
            <span class="k">continue</span>

<span class="k">def</span> <span class="nf">update_travis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">new_version</span><span class="p">):</span>
    <span class="n">travis</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="n">new_ver_line</span> <span class="o">=</span> <span class="s">&quot;  - VERSION=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">new_version</span>
    <span class="k">if</span> <span class="n">travis</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">new_ver_line</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">travis</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">new_ver_line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="k">return</span> <span class="n">travis</span>


<span class="k">def</span> <span class="nf">update_github</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update GitHub via API</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">GITHUB_REPO</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;GITHUB_REPO&#39;</span><span class="p">)</span>
    <span class="n">GITHUB_BRANCH</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;GITHUB_BRANCH&#39;</span><span class="p">)</span>
    <span class="n">GITHUB_FILE</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;GITHUB_FILE&#39;</span><span class="p">)</span>

    <span class="c"># step 1: Get a reference to HEAD</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">get_url</span><span class="p">(</span><span class="s">&quot;/repos/</span><span class="si">%s</span><span class="s">/git/refs/heads/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GITHUB_REPO</span><span class="p">,</span> <span class="n">GITHUB_BRANCH</span><span class="p">))</span>
    <span class="n">HEAD</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;sha&#39;</span> <span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;object&#39;</span><span class="p">][</span><span class="s">&#39;sha&#39;</span><span class="p">],</span>
        <span class="s">&#39;url&#39;</span> <span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;object&#39;</span><span class="p">][</span><span class="s">&#39;url&#39;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="c"># step 2: Grab the commit that HEAD points to</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">get_url</span><span class="p">(</span><span class="n">HEAD</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">])</span>
    <span class="c"># remove what we don&#39;t need for clarity</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;sha&#39;</span><span class="p">,</span> <span class="s">&#39;tree&#39;</span><span class="p">]:</span>
            <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">HEAD</span><span class="p">[</span><span class="s">&#39;commit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

    <span class="c"># step 4: Get a hold of the tree that the commit points to</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">get_url</span><span class="p">(</span><span class="n">HEAD</span><span class="p">[</span><span class="s">&#39;commit&#39;</span><span class="p">][</span><span class="s">&#39;tree&#39;</span><span class="p">][</span><span class="s">&#39;url&#39;</span><span class="p">])</span>
    <span class="n">HEAD</span><span class="p">[</span><span class="s">&#39;tree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;sha&#39;</span> <span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;sha&#39;</span><span class="p">]</span> <span class="p">}</span>

    <span class="c"># intermediate step: get the latest content from GitHub and make an updated version</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;tree&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">GITHUB_FILE</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">get_url</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">])</span> <span class="c"># get the blob from the tree</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;content&#39;</span><span class="p">])</span>
            <span class="k">break</span>

    <span class="n">old_travis</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="n">new_travis</span> <span class="o">=</span> <span class="n">update_travis</span><span class="p">(</span><span class="n">old_travis</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;version&#39;</span><span class="p">))</span>

    <span class="c"># bail out if nothing changed</span>
    <span class="k">if</span> <span class="n">new_travis</span> <span class="o">==</span> <span class="n">old_travis</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;new == old, bailing out&quot;</span><span class="p">,</span> <span class="n">kwargs</span>
        <span class="k">return</span>

    <span class="c">####</span>
    <span class="c">#### WARNING WRITE OPERATIONS BELOW</span>
    <span class="c">####</span>

    <span class="c"># step 3: Post your new file to the server</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">post_url</span><span class="p">(</span>
                <span class="s">&quot;/repos/</span><span class="si">%s</span><span class="s">/git/blobs&quot;</span> <span class="o">%</span> <span class="n">GITHUB_REPO</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s">&#39;content&#39;</span> <span class="p">:</span> <span class="n">new_travis</span><span class="p">,</span>
                    <span class="s">&#39;encoding&#39;</span> <span class="p">:</span> <span class="s">&#39;utf-8&#39;</span>
                <span class="p">}</span>
            <span class="p">)</span>
    <span class="n">HEAD</span><span class="p">[</span><span class="s">&#39;UPDATE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;sha&#39;</span> <span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;sha&#39;</span><span class="p">]</span> <span class="p">}</span>

    <span class="c"># step 5: Create a tree containing your new file</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">post_url</span><span class="p">(</span>
                <span class="s">&quot;/repos/</span><span class="si">%s</span><span class="s">/git/trees&quot;</span> <span class="o">%</span> <span class="n">GITHUB_REPO</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s">&quot;base_tree&quot;</span><span class="p">:</span> <span class="n">HEAD</span><span class="p">[</span><span class="s">&#39;tree&#39;</span><span class="p">][</span><span class="s">&#39;sha&#39;</span><span class="p">],</span>
                    <span class="s">&quot;tree&quot;</span><span class="p">:</span> <span class="p">[{</span>
                        <span class="s">&quot;path&quot;</span><span class="p">:</span> <span class="n">GITHUB_FILE</span><span class="p">,</span>
                        <span class="s">&quot;mode&quot;</span><span class="p">:</span> <span class="s">&quot;100644&quot;</span><span class="p">,</span>
                        <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;blob&quot;</span><span class="p">,</span>
                        <span class="s">&quot;sha&quot;</span><span class="p">:</span> <span class="n">HEAD</span><span class="p">[</span><span class="s">&#39;UPDATE&#39;</span><span class="p">][</span><span class="s">&#39;sha&#39;</span><span class="p">]</span>
                    <span class="p">}]</span>
                <span class="p">}</span>
            <span class="p">)</span>
    <span class="n">HEAD</span><span class="p">[</span><span class="s">&#39;UPDATE&#39;</span><span class="p">][</span><span class="s">&#39;tree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;sha&#39;</span> <span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;sha&#39;</span><span class="p">]</span> <span class="p">}</span>

    <span class="c"># step 6: Create a new commit</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">post_url</span><span class="p">(</span>
                <span class="s">&quot;/repos/</span><span class="si">%s</span><span class="s">/git/commits&quot;</span> <span class="o">%</span> <span class="n">GITHUB_REPO</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s">&quot;message&quot;</span><span class="p">:</span> <span class="s">&quot;New upstream dependency found! Auto update .travis.yml&quot;</span><span class="p">,</span>
                    <span class="s">&quot;parents&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">HEAD</span><span class="p">[</span><span class="s">&#39;commit&#39;</span><span class="p">][</span><span class="s">&#39;sha&#39;</span><span class="p">]],</span>
                    <span class="s">&quot;tree&quot;</span><span class="p">:</span> <span class="n">HEAD</span><span class="p">[</span><span class="s">&#39;UPDATE&#39;</span><span class="p">][</span><span class="s">&#39;tree&#39;</span><span class="p">][</span><span class="s">&#39;sha&#39;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">)</span>
    <span class="n">HEAD</span><span class="p">[</span><span class="s">&#39;UPDATE&#39;</span><span class="p">][</span><span class="s">&#39;commit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;sha&#39;</span> <span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;sha&#39;</span><span class="p">]</span> <span class="p">}</span>

    <span class="c"># step 7: Update HEAD, but don&#39;t force it!</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">post_url</span><span class="p">(</span>
                <span class="s">&quot;/repos/</span><span class="si">%s</span><span class="s">/git/refs/heads/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GITHUB_REPO</span><span class="p">,</span> <span class="n">GITHUB_BRANCH</span><span class="p">),</span>
                <span class="p">{</span>
                    <span class="s">&quot;sha&quot;</span><span class="p">:</span> <span class="n">HEAD</span><span class="p">[</span><span class="s">&#39;UPDATE&#39;</span><span class="p">][</span><span class="s">&#39;commit&#39;</span><span class="p">][</span><span class="s">&#39;sha&#39;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;object&#39;</span><span class="p">):</span> <span class="c"># PASS</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span> <span class="c"># FAIL</span>
        <span class="k">print</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">]</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;atodorov-test&quot;</span> <span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">&#39;cb&#39;</span> <span class="p">:</span> <span class="n">update_github</span><span class="p">,</span>
                <span class="s">&#39;args&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">&#39;GITHUB_REPO&#39;</span> <span class="p">:</span> <span class="s">&#39;atodorov/bztest&#39;</span><span class="p">,</span>
                    <span class="s">&#39;GITHUB_BRANCH&#39;</span> <span class="p">:</span> <span class="s">&#39;master&#39;</span><span class="p">,</span>
                    <span class="s">&#39;GITHUB_FILE&#39;</span> <span class="p">:</span> <span class="s">&#39;.travis.yml&#39;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="s">&quot;Markdown&quot;</span> <span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">&#39;cb&#39;</span> <span class="p">:</span> <span class="n">update_github</span><span class="p">,</span>
                <span class="s">&#39;args&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">&#39;GITHUB_REPO&#39;</span> <span class="p">:</span> <span class="s">&#39;atodorov/Markdown-Bugzilla-Extension&#39;</span><span class="p">,</span>
                    <span class="s">&#39;GITHUB_BRANCH&#39;</span> <span class="p">:</span> <span class="s">&#39;master&#39;</span><span class="p">,</span>
                    <span class="s">&#39;GITHUB_FILE&#39;</span> <span class="p">:</span> <span class="s">&#39;.travis.yml&#39;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s">&#39;cb&#39;</span> <span class="p">:</span> <span class="n">update_github</span><span class="p">,</span>
                <span class="s">&#39;args&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">&#39;GITHUB_REPO&#39;</span> <span class="p">:</span>  <span class="s">&#39;atodorov/Markdown-No-Lazy-Code-Extension&#39;</span><span class="p">,</span>
                    <span class="s">&#39;GITHUB_BRANCH&#39;</span> <span class="p">:</span> <span class="s">&#39;master&#39;</span><span class="p">,</span>
                    <span class="s">&#39;GITHUB_FILE&#39;</span> <span class="p">:</span> <span class="s">&#39;.travis.yml&#39;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s">&#39;cb&#39;</span> <span class="p">:</span> <span class="n">update_github</span><span class="p">,</span>
                <span class="s">&#39;args&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">&#39;GITHUB_REPO&#39;</span> <span class="p">:</span>  <span class="s">&#39;atodorov/Markdown-No-Lazy-BlockQuote-Extension&#39;</span><span class="p">,</span>
                    <span class="s">&#39;GITHUB_BRANCH&#39;</span> <span class="p">:</span> <span class="s">&#39;master&#39;</span><span class="p">,</span>
                    <span class="s">&#39;GITHUB_FILE&#39;</span> <span class="p">:</span> <span class="s">&#39;.travis.yml&#39;</span>
                <span class="p">}</span>
            <span class="p">},</span>
        <span class="p">],</span>
    <span class="p">}</span>

    <span class="c"># check the RSS to see if we have something new</span>
    <span class="n">monitor_rss</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</pre></div>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 02 December 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/12/02/automatic-upstream-dependency-testing/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/24/python-libs-in-rhel-7.2-broke-ssl-verification-in-s3cmd/" rel="bookmark" title="Permalink to python-libs in RHEL 7.2 broke SSL verification in s3cmd">
                <h2 class="post-title">
                    python-libs in RHEL 7.2 broke SSL verification in s3cmd
                </h2>
            </a>
                <p>Today started with <a href="http://planet.sofiavalley.com">Planet Sofia Valley</a> being
broken again. Indeed it's been broken since last Friday when I've upgraded to
the latest RHEL 7.2. I quickly identified that I was hitting
<a href="https://github.com/s3tools/s3cmd/issues/647">Issue #647</a>. Then I tried the
git checkout without any luck. This is when I started to suspect that python-libs
has been updated in an incompatible way.</p>
<p>After series of reported bugs,
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1284916">rhbz#1284916</a>,
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1284930">rhbz#1284930</a>,
<a href="http://bugs.python.org/issue25722">Python#25722</a>, it was clear that
<code>ssl.py</code> was working according to RFC6125, that Amazon S3 was not playing
nicely with this same RFC and that my patch proposal was wrong.
This immediately had me looking upper in the stack at <code>httplib.py</code> and <code>s3cmd</code>.</p>
<p>Indeed there was a change in <code>httplib.py</code> which introduced two parameters,
<em>context</em> and <em>check_hostname</em>, to <code>HTTPSConnection.__init__</code>. The change
also supplied the logic which performs SSL hostname validation.</p>
<div class="highlight"><pre>if not self._context.check_hostname and self._check_hostname:
    try:
        ssl.match_hostname(self.sock.getpeercert(), server_hostname)
    except Exception:
        self.sock.shutdown(socket.SHUT_RDWR)
        self.sock.close()
        raise
</pre></div>


<p>This looks a bit doggy as I don't quite understand the intention behind
<em>not PREDICATE and PREDICATE</em>. Anyway to disable the validation you need
both parameters set to False, which is
<a href="https://github.com/s3tools/s3cmd/pull/668">PR #668</a>.</p>
<p>Notice the two try-except blocks. This is in case we're running with a
version that has a context but not the check_hostname parameter. I've found
the <em>inspect.getmembers</em> function which can be used to figure out what
parameters are there for the init method but a solution based on it
doesn't appear to be more elegant. I will describe this in more details in
my next post.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 24 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/24/python-libs-in-rhel-7.2-broke-ssl-verification-in-s3cmd/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/24/github-bugzilla-hook/" rel="bookmark" title="Permalink to GitHub Bugzilla Hook">
                <h2 class="post-title">
                    GitHub Bugzilla Hook
                </h2>
            </a>
                <p>Last month I've created a tool which adds comments to Bugzilla when a commit
message references a bug number. It was done as a proof of concept and didn't
receive much attention at the time. Today I'm happy to announce the existence
of <a href="https://github.com/atodorov/github-bugzilla-hook">GitHub Bugzilla Hook</a>.</p>
<p>I've used David Shea's
<a href="https://github.com/rhinstaller/github-email-hook/">GitHub Email Hook</a> as my
starting template and only modified it where needed. GitHub Bugzilla Hook will
examine push data and post comments for every unique bug+branch combination.
Once a comment for that particular bug+branch combination is made, new ones
will not be posted, even if later commits reference the same bug.
My main assumption is commits which are related to a bug will be pushed together
most of the times so there shouldn't be lots of noise in Bugzilla.</p>
<p>See <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1274703">rhbz#1274703</a> for
example of how the comments look. The parser behavior is taken from anaconda
and conforms to the style the Red Hat Installer Engineering Team uses.
Hopefully you find it useful as well.</p>
<p>My next step is to find a hosting place for this script and hook it up
with the rhinstaller GitHub repos!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 24 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/24/github-bugzilla-hook/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/23/bad-stub-design-in-dnf/" rel="bookmark" title="Permalink to Bad Stub Design in DNF, Pt.2">
                <h2 class="post-title">
                    Bad Stub Design in DNF, Pt.2
                </h2>
            </a>
                <p>Do you remember my example of a
<a href="/blog/2015/09/25/unit-testing-bad-stub-design-in-dnf/">bad stub design in DNF</a> ?
At that time I didn't have a good example of why this is a bad design and what are the
consequences of it. Today I have!</p>
<p>From my comment on
<a href="https://github.com/rpm-software-management/dnf-plugins-core/pull/118">PR #118</a></p>
<blockquote>
<p>Note: the benefit of this patch are quite subtle.
I've played around with creating a few more tests and the benefit I see affect
only a few lines of code.</p>
<p>For #114 there doesn't seem to be any need to test _get_query directly,
although we call</p>
<div class="highlight"><pre>   q = self.base.sack.query()
   q = q.available()
</pre></div>


<p>which will benefit from this PR b/c we're stubbing out the entire Sack object.
I will work on a test later today/tomorrow to see how it looks.</p>
<p>OTOH for #113 where we modify _get_query the test can look something like this:</p>
<div class="highlight"><pre>def test_get_query_with_local_rpm(self):
    try:
        (fs, rpm_path) = tempfile.mkstemp(&#39;foobar-99.99-1.x86_64.rpm&#39;)
        # b/c self.cmd.cli.base is a mock object add_remote_rpm
        # will not update the available packages while testing.
        # it is expected to hit an exception
        with self.assertRaises(dnf.exceptions.PackageNotFoundError):
            self.cmd._get_query(rpm_path)
        self.cmd.cli.base.add_remote_rpm.assert_called_with(rpm_path)
    finally:
        os.remove(rpm_path)
</pre></div>


<p>Note the comment above the with block. If we leave out <code>_get_query</code> as before
(a simple stub function) we're not going to be able to use <code>assert_called_with</code>
later.</p>
</blockquote>
<p>Now a more practical example. See 
<a href="https://github.com/rpm-software-management/dnf-plugins-core/commit/fe130669ffc4c1d6eba8f10cda35ab4d803d5a3d">commit fe13066</a>
- in case the package is not found we log the error. In case configuration is
<code>strict=True</code> then the plugin will raise another exception. With the initial version
of the stubs this change in behavior is silently ignored. If there was an error
in the newly introduced lines it would go straight into production because the
existing tests passed.</p>
<p>What happens is that <code>test_get_packages()</code> calls <code>_get_packages(['notfound'])</code>,
which is not the real code but a test stub and returns an empty list in this case.
The empty list is expected from the test and it will not fail!</p>
<p>With my new stub design the test will execute the actual <code>_get_packages()</code>
method from <code>download.py</code> and choke on the exception. The test itself needs
to be modified, which is done in
<a href="https://github.com/atodorov/dnf-plugins-core/commit/2c2b34237c99cbf32e23bde43027d22873f4e8b7">commit 2c2b34</a>
and no further errors were found.</p>
<p>So let me summarize:
<strong>
When using mocks, stubs and fake objects we should be replacing external
dependencies of the software under test, not internal methods from the SUT!
</strong></p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 23 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/23/bad-stub-design-in-dnf/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/23/tip-running-dnf-plugins-from-git/" rel="bookmark" title="Permalink to Tip: Running DNF Plugins from git">
                <h2 class="post-title">
                    Tip: Running DNF Plugins from git
                </h2>
            </a>
                <p>This is mostly for self reference because it is not currently documented
in the code. To use dnf plugins from a local git checkout modify your
<code>/etc/dnf/dnf.conf</code> and add the following line under the <code>[main]</code> section:</p>
<div class="highlight"><pre>pluginpath=/path/to/dnf-plugins-core/plugins
</pre></div>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 23 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/23/tip-running-dnf-plugins-from-git/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/20/revamping-anaconda-dogtail-tests/" rel="bookmark" title="Permalink to Revamping Anaconda's Dogtail Tests">
                <h2 class="post-title">
                    Revamping Anaconda's Dogtail Tests
                </h2>
            </a>
                <p>In my <a href="/blog/2015/11/13/running-anaconda-from-git/">previous post</a> I briefly talked
about running anaconda from a git checkout. My goal was to rewrite <code>tests/gui/</code> so
that they don't use a LiveCD and virtual machines anymore. I'm pleased to announce
that this is already done (still not merged), see 
<a href="https://github.com/rhinstaller/anaconda/pull/457">PR#457</a>.</p>
<p>The majority of the changes are just shuffling bits around and deleting
unused code. The existing UI tests were mostly working and only needed minor
changes. There are two things which didn't work and are temporarily disabled:</p>
<ul>
<li>Clicking the Help button results in <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1282432">rhbz#1282432</a>,
which in turn may be hiding another bug behind it;</li>
<li>Looping over the available languages resulted in AT-SPI NonImplementedError
which I'm going to debug next.</li>
</ul>
<p>To play around with this make sure you have accessibility enabled and:</p>
<div class="highlight"><pre># cd anaconda/
# export top_srcdir=`pwd`
# setenforce 0
# cd tests/gui/
# ./run_gui_tests.sh
</pre></div>


<p><strong>Note:</strong> you also need Dogtail for Python3 which isn't officially available
yet. I'm building from
<a href="https://vhumpa.fedorapeople.org/dogtail/beta/dogtail3-0.9.1-0.3.beta3.src.rpm">https://vhumpa.fedorapeople.org/dogtail/beta/dogtail3-0.9.1-0.3.beta3.src.rpm</a></p>
<p>My future plans are to figure out how to re-enable what is temporarily
disabled, update <code>run_gui_tests.sh</code> to properly start gnome-session and
enable accessibility, do a better job cleaning up after a failure,
enable coverage and hook everything into <code>make ci</code>.</p>
<p>Happy testing!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 20 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/20/revamping-anaconda-dogtail-tests/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/13/running-anaconda-from-git/" rel="bookmark" title="Permalink to Running Anaconda from git">
                <h2 class="post-title">
                    Running Anaconda from git
                </h2>
            </a>
                <p>It is now possible to execute anaconda directly from a git checkout.</p>
<p><strong>Disclaimer:</strong> this is only for testing purposes, you are not supposed to
execute anaconda from git and install a running system! My intention is
to use this feature and rewrite the Dogtail tests inside <code>tests/gui/</code> which
rely on having a LiveCD.iso and running VMs to execute. For me this has proven
very slow and difficult to debug problems in the past hence the change.</p>
<p><em>Note:</em> you will need to have an active DISPLAY in your environment and
also set SELinux to permissive, see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1276376">rhbz#1276376</a>.</p>
<p>Please see <a href="https://github.com/rhinstaller/anaconda/pull/438">PR 438</a> for
more details.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 13 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/13/running-anaconda-from-git/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/13/how-krasi-tsonev-broke-planet.sofiavalley.com/" rel="bookmark" title="Permalink to How Krasi Tsonev Broke Planet.SofiaValley.com">
                <h2 class="post-title">
                    How Krasi Tsonev Broke Planet.SofiaValley.com
                </h2>
            </a>
                <p>Yesterday I've added <a href="http://krasimirtsonev.com/blog/">Krasimir Tsonev's blog</a> to
<a href="http://planet.sofiavalley.com">http://planet.sofiavalley.com</a> and the planet broke. Suddenly it started showing
only Krasi's articles and all of them with the same date. The problem was the RSS
feed didn't have any timestamps. The fix is trivial:</p>
<div class="highlight"><pre><span class="gd">--- rss.xml.orig    2015-11-13 10:12:35.348625718 +0200</span>
<span class="gi">+++ rss.xml 2015-11-13 10:12:45.157932304 +0200</span>
<span class="gu">@@ -9,120 +9,160 @@</span>
                             &lt;title&gt;&lt;![CDATA[A modern React starter pack based on webpack]]&gt;&lt;/title&gt;
                             &lt;link&gt;http://krasimirtsonev.com/blog/article/a-modern-react-starter-pack-based-on-webpack&lt;/link&gt;
                             &lt;description&gt;&lt;![CDATA[&lt;p&gt;&lt;i&gt;Checkout React webpack starter in &lt;a href=\&quot;https://github.com/krasimir/react-web&lt;br /&gt;&lt;p&gt;You know how crazy is the JavaScript world nowadays. There are new frameworks, libraries and tools coming every day. Frequently I’m exploring some of these goodies. I got a week long holiday. I promised to myself that I’ll not code, read or watch about code. Well, it’s stronger than me. &lt;a href=\&quot;https://github.com/krasimir/react-webpack-starter\&quot;&gt;React werbpack starter&lt;/a&gt; is the result of my no-programming week.&lt;/p&gt;]]&gt;&lt;/description&gt;
<span class="gi">+                            &lt;pubDate&gt;Thu, 01 Oct 2015 00:00:00 +0300&lt;/pubDate&gt;</span>
<span class="gi">+                            &lt;guid&gt;http://krasimirtsonev.com/blog/article/a-modern-react-starter-pack-based-on-webpack&lt;/guid&gt;</span>
                         &lt;/item&gt;
</pre></div>


<p>Thanks to Krasi for fixing this quickly and happy reading!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 13 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/13/how-krasi-tsonev-broke-planet.sofiavalley.com/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/11/11/ui-usability-bug-qachallengeaccepted.com/" rel="bookmark" title="Permalink to UI Usability Bug for QAChallengeAccepted.com">
                <h2 class="post-title">
                    UI Usability Bug for QAChallengeAccepted.com
                </h2>
            </a>
                <p><img alt="Initial view" src="/images/qachallenge1.png" title="Initial view" /></p>
<p>Today I wanted to submit a presentation proposal for
<a href="http://qachallengeaccepted.com">QA Challenge Accepted 2016</a> and found a usability
problem in their website. The first picture is how the UI looks on my screen.
As you can see the screen height is enough to show the first section of the
interface. There's something orange at the bottom which isn't clearly identifiable.
The next picture shows the UI as it looks after clicking on the PROGRAM menu link.</p>
<p><img alt="View after clicking the menu" src="/images/qachallenge2.png" title="View after clicking the menu" /></p>
<p>The problem is that I never saw the orange section, which turned out to be
the call for papers and a link to the submission form. To fix this the orange
section either needs to go at the top and be clearly visible or at least a new
item be added to the menu.</p>
<p>Btw the next event will be in March 2016 in Sofia and I hope to see you there!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 11 November 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/11/11/ui-usability-bug-qachallengeaccepted.com/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/10/27/anaconda-coverage.py-coverage-diff/" rel="bookmark" title="Permalink to Anaconda & coverage.py - Pt.3 - coverage-diff">
                <h2 class="post-title">
                    Anaconda &amp; coverage.py - Pt.3 - coverage-diff
                </h2>
            </a>
                <p>In my <a href="/blog/2015/10/15/anaconda-coverage.py-details/">previous post</a>
I've talked about testing anaconda and friends and raised some questions.
Today I'm going to give an example of how to answer one of them:
"How different is the code execution path between different tests?"</p>
<h2>coverate-tools</h2>
<p>I'm going to use <a href="https://github.com/atodorov/coverage-tools">coverage-tools</a>
in my explanations below so a little introduction is required. All the tools
are executable Python scripts which build on top of existing coverage.py API.
The difference is mainly in flexibility of parameters and output formatting.
I've tried to keep as close as possible to the existing behavior of coverage.py.</p>
<p><em>coverage-annotate</em> - when given a .coverage data file prints the source code
annotated with line numbers and execution markers.</p>
<div class="highlight"><pre><span class="err">!!!</span> <span class="n">missing</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pyanaconda</span><span class="o">/</span><span class="n">anaconda_argparse</span><span class="o">.</span><span class="n">py</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">covered</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pyanaconda</span><span class="o">/</span><span class="n">anaconda_argparse</span><span class="o">.</span><span class="n">py</span>
<span class="o">...</span> <span class="n">skip</span> <span class="o">...</span>
    <span class="mi">37</span> <span class="o">&gt;</span> <span class="kn">import</span> <span class="nn">logging</span>
    <span class="mi">38</span> <span class="o">&gt;</span> <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;anaconda&quot;</span><span class="p">)</span>
    <span class="mi">39</span>   
    <span class="mi">40</span>   <span class="c"># Help text formatting constants</span>
    <span class="mi">41</span>   
    <span class="mi">42</span> <span class="o">&gt;</span> <span class="n">LEFT_PADDING</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c"># the help text will start after 8 spaces</span>
    <span class="mi">43</span> <span class="o">&gt;</span> <span class="n">RIGHT_PADDING</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c"># there will be 8 spaces left on the right</span>
    <span class="mi">44</span> <span class="o">&gt;</span> <span class="n">DEFAULT_HELP_WIDTH</span> <span class="o">=</span> <span class="mi">80</span>
    <span class="mi">45</span>   
    <span class="mi">46</span> <span class="o">&gt;</span> <span class="k">def</span> <span class="nf">get_help_width</span><span class="p">():</span>
    <span class="mi">47</span> <span class="o">&gt;</span>     <span class="s">&quot;&quot;&quot;</span>
<span class="s">    48 &gt;     Try to detect the terminal window width size and use it to</span>
<span class="s">    49 &gt;     compute optimal help text width. If it can&#39;t be detected</span>
<span class="s">    50 &gt;     a default values is returned.</span>
<span class="s">    51   </span>
<span class="s">    52 &gt;     :returns: optimal help text width in number of characters</span>
<span class="s">    53 &gt;     :rtype: int</span>
<span class="s">    54 &gt;     &quot;&quot;&quot;</span>
    <span class="mi">55</span>       <span class="c"># don&#39;t do terminal size detection on s390, it is not supported</span>
    <span class="mi">56</span>       <span class="c"># by its arcane TTY system and only results in cryptic error messages</span>
    <span class="mi">57</span>       <span class="c"># ending on the standard output</span>
    <span class="mi">58</span>       <span class="c"># (we do the s390 detection here directly to avoid</span>
    <span class="mi">59</span>       <span class="c">#  the delay caused by importing the Blivet module</span>
    <span class="mi">60</span>       <span class="c">#  just for this single call)</span>
    <span class="mi">61</span> <span class="o">&gt;</span>     <span class="n">is_s390</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;s390&#39;</span><span class="p">)</span>
    <span class="mi">62</span> <span class="o">&gt;</span>     <span class="k">if</span> <span class="n">is_s390</span><span class="p">:</span>
    <span class="mi">63</span> <span class="err">!</span>         <span class="k">return</span> <span class="n">DEFAULT_HELP_WIDTH</span>
    <span class="mi">64</span>   
<span class="o">...</span> <span class="n">skip</span> <span class="o">...</span>
</pre></div>


<p>In the example above all lines starting with <strong>&gt;</strong> were executed by the interpreter.
All top-level import statements were executed as you would expect. Then the method
<em>get_help_width()</em> was executed (called from somewhere). Because this was on x86_64
machine line 63 was not executed. It is marked with <strong>!</strong>. The comments and empty
lines are of no interest.</p>
<p><em>coverage-diff</em> - produces git like diff reports on the text output of annotate.</p>
<div class="highlight"><pre><span class="gd">--- a/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/source.py</span>
<span class="gi">+++ b/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/source.py</span>
<span class="gu">@@ -634,7 +634,7 @@</span>
    634           # Wait to make sure the other threads are done before sending ready, otherwise
    635           # the spoke may not get be sensitive by _handleCompleteness in the hub.
    636 &gt;         while not self.ready:
<span class="gd">-   637 !             time.sleep(1)</span>
<span class="gi">+   637 &gt;             time.sleep(1)</span>
    638 &gt;         hubQ.send_ready(self.__class__.__name__, False)
    639   
    640 &gt;     def refresh(self):\
</pre></div>


<p>In this example line 637 was not executed in the first test run, while it was executed
in the second test run. Reading the comments above it is clear the difference between
the two test runs is just timing and synchronization.</p>
<h2>Kickstart vs. Kickstart</h2>
<p>How different is the code execution path between different tests? Looking at
<a href="https://fedoraproject.org/wiki/Test_Results:Fedora_23_Final_RC3_Installation">Fedora 23 test results</a>
we see several tests which differ only slightly in their setup - installation
via HTTP, FTP or NFS; installation to SATA, SCSI, SAS drives; installation using
RAID for the root file system; These are good candidates for further analysis.</p>
<p>Note: my results below are not from Fedora 23 but the conclusions still apply!
The tests were executed on bare metal and virtual machines, trying to use the
same hardware or same systems configurations where possible!</p>
<p>Example: HTTP vs. FTP</p>
<div class="highlight"><pre><span class="gd">--- a/usr/lib64/python2.7/site-packages/pyanaconda/packaging/__init__.py</span>
<span class="gi">+++ b/usr/lib64/python2.7/site-packages/pyanaconda/packaging/__init__.py</span>
<span class="gu">@@ -891,7 +891,7 @@</span>
    891   
    892               # Run any listeners for the new state
    893 &gt;             for func in self._event_listeners[event_id]:
<span class="gd">-   894 !                 func()</span>
<span class="gi">+   894 &gt;                 func()</span>
    895   
    896 &gt;     def _runThread(self, storage, ksdata, payload, fallback, checkmount):
    897           # This is the thread entry
<span class="gd">--- a/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/lib/resize.py</span>
<span class="gi">+++ b/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/lib/resize.py</span>
<span class="gu">@@ -102,10 +102,10 @@</span>
    102           # Otherwise, fall back on increasingly vague information.
    103 &gt;         if not part.isleaf:
    104 &gt;             return self.storage.devicetree.getChildren(part)[0].name
<span class="gd">-   105 &gt;         if getattr(part.format, &quot;label&quot;, None):</span>
<span class="gi">+   105 !         if getattr(part.format, &quot;label&quot;, None):</span>
    106 !             return part.format.label
<span class="gd">-   107 &gt;         elif getattr(part.format, &quot;name&quot;, None):</span>
<span class="gd">-   108 &gt;             return part.format.name</span>
<span class="gi">+   107 !         elif getattr(part.format, &quot;name&quot;, None):</span>
<span class="gi">+   108 !             return part.format.name</span>
    109 !         else:
    110 !             return &quot;&quot;
    111   
<span class="gu">@@ -315,10 +315,10 @@</span>
    315 &gt;     def on_key_pressed(self, window, event, *args):
    316           # Handle any keyboard events.  Right now this is just delete for
    317           # removing a partition, but it could include more later.
<span class="gd">-   318 &gt;         if not event or event and event.type != Gdk.EventType.KEY_RELEASE:</span>
<span class="gi">+   318 !         if not event or event and event.type != Gdk.EventType.KEY_RELEASE:</span>
    319 !             return
    320   
<span class="gd">-   321 &gt;         if event.keyval == Gdk.KEY_Delete and self._deleteButton.get_sensitive():</span>
<span class="gi">+   321 !         if event.keyval == Gdk.KEY_Delete and self._deleteButton.get_sensitive():</span>
    322 !             self._deleteButton.emit(&quot;clicked&quot;)
    323   
    324 &gt;     def _sumReclaimableSpace(self, model, path, itr, *args):
<span class="gd">--- a/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/source.py</span>
<span class="gi">+++ b/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/source.py</span>
<span class="gu">@@ -634,7 +634,7 @@</span>
    634           # Wait to make sure the other threads are done before sending ready, otherwise
    635           # the spoke may not get be sensitive by _handleCompleteness in the hub.
    636 &gt;         while not self.ready:
<span class="gd">-   637 !             time.sleep(1)</span>
<span class="gi">+   637 &gt;             time.sleep(1)</span>
    638 &gt;         hubQ.send_ready(self.__class__.__name__, False)
    639   
    640 &gt;     def refresh(self):
</pre></div>


<p>The difference in <code>source.py</code> is from timing/synchronization and can safely be ignored.
I'm not exactly sure about <code>__init__.py</code> but doesn't look much of a big deal.
We're left with <code>resize.py</code>. The differences in <em>on_key_pressed()</em> are because
I've probably used the keyboard instead the mouse (these are indeed manual installs).
The other difference is in how the partition labels are displayed. One of the installs
was probably using fresh disks while the other not.</p>
<p>Example: SATA vs. SCSI - no difference</p>
<p>Example: SATA vs. SAS (mpt2sas driver)</p>
<div class="highlight"><pre><span class="gd">--- a/usr/lib64/python2.7/site-packages/pyanaconda/bootloader.py</span>
<span class="gi">+++ b/usr/lib64/python2.7/site-packages/pyanaconda/bootloader.py</span>
<span class="gu">@@ -109,10 +109,10 @@</span>
    109 &gt;     try:
    110 &gt;         opts.parity = arg[idx+0]
    111 &gt;         opts.word   = arg[idx+1]
<span class="gd">-   112 !         opts.flow   = arg[idx+2]</span>
<span class="gd">-   113 !     except IndexError:</span>
<span class="gd">-   114 &gt;         pass</span>
<span class="gd">-   115 &gt;     return opts</span>
<span class="gi">+   112 &gt;         opts.flow   = arg[idx+2]</span>
<span class="gi">+   113 &gt;     except IndexError:</span>
<span class="gi">+   114 !         pass</span>
<span class="gi">+   115 !     return opts</span>
    116   
    117 ! def _is_on_iscsi(device):
    118 !     &quot;&quot;&quot;Tells whether a given device is on an iSCSI disk or not.&quot;&quot;&quot;
<span class="gu">@@ -1075,13 +1075,13 @@</span>
   1075 &gt;             command = [&quot;serial&quot;]
   1076 &gt;             s = parse_serial_opt(self.console_options)
   1077 &gt;             if unit and unit != &#39;0&#39;:
<span class="gd">-  1078 !                 command.append(&quot;--unit=%s&quot; % unit)</span>
<span class="gi">+  1078 &gt;                 command.append(&quot;--unit=%s&quot; % unit)</span>
   1079 &gt;             if s.speed and s.speed != &#39;9600&#39;:
   1080 &gt;                 command.append(&quot;--speed=%s&quot; % s.speed)
   1081 &gt;             if s.parity:
<span class="gd">-  1082 !                 if s.parity == &#39;o&#39;:</span>
<span class="gi">+  1082 &gt;                 if s.parity == &#39;o&#39;:</span>
   1083 !                     command.append(&quot;--parity=odd&quot;)
<span class="gd">-  1084 !                 elif s.parity == &#39;e&#39;:</span>
<span class="gi">+  1084 &gt;                 elif s.parity == &#39;e&#39;:</span>
   1085 !                     command.append(&quot;--parity=even&quot;)
   1086 &gt;             if s.word and s.word != &#39;8&#39;:
   1087 !                 command.append(&quot;--word=%s&quot; % s.word)
</pre></div>


<p>As you can see the difference is minimal, mostly related to the underlying
hardware. As far as I can tell this has to do with how the bootloader is
installed on disk but I'm no expert on this particular piece of code.
I've seen the same difference in other comparisons so it probably has to do
more with hardware than with what kind of disk/driver is used.</p>
<p>Example: RAID 0 vs. RAID 1 - manual install</p>
<div class="highlight"><pre><span class="gd">--- a/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/datetime_spoke.py</span>
<span class="gi">+++ b/usr/lib64/python2.7/site-packages/pyanaconda/ui/gui/spokes/datetime_spoke.py</span>
<span class="gu">@@ -490,9 +490,9 @@</span>
    490   
    491 &gt;         time_init_thread = threadMgr.get(constants.THREAD_TIME_INIT)
    492 &gt;         if time_init_thread is not None:
<span class="gd">-   493 &gt;             hubQ.send_message(self.__class__.__name__,</span>
<span class="gd">-   494 &gt;                              _(&quot;Restoring hardware time...&quot;))</span>
<span class="gd">-   495 &gt;             threadMgr.wait(constants.THREAD_TIME_INIT)</span>
<span class="gi">+   493 !             hubQ.send_message(self.__class__.__name__,</span>
<span class="gi">+   494 !                              _(&quot;Restoring hardware time...&quot;))</span>
<span class="gi">+   495 !             threadMgr.wait(constants.THREAD_TIME_INIT)</span>
    496   
    497 &gt;         hubQ.send_ready(self.__class__.__name__, False)
    498
</pre></div>


<p>As far as I can tell the difference is related to hardware clock settings,
probably due to different defaults in BIOS on the various hardware.
Additional tests with RAID 5 and RAID 6 reveals the same exact difference.
RAID 0 vs. RAID 10 shows no difference at all. Indeed as far as I know anaconda
delegates the creation of RAID arrays to mdadm once the desired configuration
is known so these results are to be expected.</p>
<h2>Conclusion</h2>
<p>As you can see sometimes there are tests which appear to be very important
but in reality they cover a corner case of the base test. For example if any
of the RAID levels works we can be pretty confident 
<strike>all of them work</strike> <em>they won't break in anaconda</em>
(thanks Adam Williamson)!</p>
<p>What you do with this information is up to you. Sometimes QA is able to
execute all the tests and life is good. Sometimes we have to compromise,
skip some testing and accept the risks of doing so. Sometimes you can
execute all tests for every build, sometimes only once per milestone.
Whatever the case having the information to back up your decision is vital!</p>
<p>In my next post on this topic I'm going to talk more about functional tests
vs. unit tests. Both anaconda and blivet have both kinds of tests and I'm
interested to know if tests from the two categories focus on the same
functionality how are they different. If we have a unit test for feature X,
does it warrant to spend the resources doing functional testing for X as well?</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 27 October 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/10/27/anaconda-coverage.py-coverage-diff/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/10/15/anaconda-coverage.py-details/" rel="bookmark" title="Permalink to Anaconda & coverage.py - Pt.2 - Details">
                <h2 class="post-title">
                    Anaconda &amp; coverage.py - Pt.2 - Details
                </h2>
            </a>
                <p>My <a href="/blog/2015/10/14/anaconda-coverage.py-introduction/">previous post</a>
was an introduction to testing installation related components. Now I'm going to
talk more about anaconda and how it is tested.</p>
<p>There are two primary ways to test anaconda. You can execute <code>make check</code> in the
source directory which will trigger the package test suite. The other possibility
is to perform an actual installation, on bare meta or virtual machine, using the
<a href="https://kojipkgs.fedoraproject.org/mash/">latest Rawhide snapshots</a> which also
include the latest anaconda. For both of these methods we can collect code
coverage information. In live installation mode coverage is enabled via the
<code>inst.debug</code> boot argument. Fedora 23 and earlier use <code>debug=1</code> but that
can lead to <a href="https://github.com/rhinstaller/anaconda/pull/291">problems</a>
sometimes.</p>
<h2>Kickstart Testing</h2>
<p><a href="https://github.com/rhinstaller/pykickstart/blob/master/docs/kickstart-docs.rst">Kickstart</a>
is a method of automating the installation of Fedora by supplying the necessary
configuration into a text file and pointing the installer at this file. There is
the directory <code>tests/kickstart_tests</code>, inside the anaconda source, where each
test is a kickstart file and a shell script. The test runner provisions a virtual
machine using boot.iso and the kickstart file. A shell script then verifies
installation was as expected and copies files of interest to the host system.
Kickstart files are also the basis for testing Fedora installations in
<a href="https://beaker.fedoraproject.org/bkr/jobs/">Beaker</a>.</p>
<p>Naturally some of these in-package kickstart tests are the same as
<a href="https://bitbucket.org/fedoraqa/fedora-beaker-tests/">out-of-band kickstart tests</a>.
Hint: there are more available but not yet public.</p>
<p>The question which I don't have an answer for right now is
"Can we remove some of the duplicates and how this affects devel and QE teams" ?
The pros of in-package testing are that it is faster compared to Beaker. The cons
are that you're not testing the real distro (every snapshot is a possible final
release to the users).</p>
<h2>Dogtail</h2>
<p><a href="https://fedorahosted.org/dogtail/">Dogtail</a> uses accessibility technologies to
communicate with desktop applications. It is written in Python and can be used
as GUI test automation framework. Long time ago I've proposed support for Dogtail
in anaconda which was rejected, then couple of years later it was accepted and
later removed from the code again.</p>
<p>Anaconda has in-package Dogtail tests (<code>tests/gui/</code>). They work by attaching
a second disk image with the test suite to a VM running a LiveCD. Anaconda is
started on the LiveCD and an attempt to install Fedora on disk 1 is made.
Everything is driven by the Dogtail scripts. There are only a few of these
tests available and they are currently disabled.
Red Hat QE has also created another method for running Dogtail tests in anaconda
using an updates.img with the previous functionality.</p>
<p>Even if there are some duplicate tests I'm not convinced we have to drop the
<code>tests/gui/</code> directory from the code because
the framework used to drive the graphical interface of anaconda appears to be very
well written. The code is clean and easy to follow.
Also I don't have metrics of how much these two methods differ or how much they cover
in their testing. IMO they are pretty close and before we can find a way to
reliably execute them on a regular basis there isn't much to be done here.
One idea is to use the <code>--dirinstall</code> or <code>--image</code> options and skip the
LiveCD part entirely.</p>
<h2>How Much is Tested</h2>
<p><code>make ci</code> covers 10% of the entire code base for anaconda. Mind you that
<code>tests/storage</code> and <code>tests/gui</code> are currently disabled.
See <a href="https://github.com/rhinstaller/anaconda/pull/346">PR #346</a>,
<a href="https://github.com/rhinstaller/anaconda/pull/327">PR #327</a> and
<a href="https://github.com/rhinstaller/anaconda/pull/319">PR #319</a>!
There is definitely room for improvement.</p>
<p>On the other hand live installation testing is much
better. Text mode covers around 25% while graphical installations around 40%.
Text and graphical combined cover 50% though. These numbers will drop quite a bit
once anaconda learns to
<a href="https://github.com/rhinstaller/anaconda/pull/397">include all possible files</a>
in its report but it is a good estimate.</p>
<p>The important questions to ask here are:</p>
<ul>
<li>How much can PyUnit tests cover in anaconda?</li>
<li>How much can kickstart tests cover ?</li>
<li>Have we reached a threshold in any of the two primary methods for testing ?</li>
<li>Does UI automation (with Dogtail) improve anything ?</li>
<li>When testing a particular feature (say user creation) how different is the
code execution path between manual (GUI) testing, kickstart and unit testing ?
If not so different can we invest in unit tests instead of higher level tests then ?</li>
<li>How different is the code execution path between different tests (manual or kickstart) ?
In other words how much value are we getting from testing for the resources we're putting in ?</li>
</ul>
<p>In my next post I will talk more about these questions and some rudimentary
analysis against coverage data from the various test methods and test cases!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 15 October 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/10/15/anaconda-coverage.py-details/#disqus_thread">comments</a>.</p>        </div>

    <hr>
    <!-- Pager -->
    <ul class="pager">
        <li class="next">
                <a href="http://atodorov.org/blog/categories/qa/index3.html">Older Posts &rarr;</a>
                <a href="http://atodorov.org/blog/categories/qa/index.html"> &larr; Newest Posts</a>
        </li>
    </ul>
    Page 2 / 5
    <hr>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/atodorov_">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/atodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://bg.linkedin.com/in/alextodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://feeds.feedburner.com/atodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.youtube.com/playlist?list=PLFjlI7p-h1hxBP3cIjEqePSeoBDHud5Db">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-youtube fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://amzn.to/1ivu2q4">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-amazon fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=social_icon">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-user-secret fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<section>
    <p>
        I am a Senior QA contractor at Red Hat responsible for finding over
        <a href="/blog/2014/02/19/7-years-1400-bugs-red-hat-qa/">1600 bugs</a>,
        a general purpose open source developer, Red Hat Certified professional,
        cloud hacker and an entrepreneur! My latest start-up is
        <a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=footer">Mr. Senko</a>!
    </p>
    <p>
        I am living in the <a href="http://planet.sofiavalley.com">Sofia Valley</a>
        which is emerging as a busy place for start-up founders and tech enthusiasts
        in Eastern Europe! You can find more about me <a href="/blog/2013/01/25/about-me/">here</a>.
    </p>
    <p>
        <small>
            <em>
                Some of the links contained within this site have my referral id (e.g.,
                <a target="_blank" href="http://www.amazon.com/ref=as_li_ss_tl?_encoding=UTF8&camp=1789&creative=390957&linkCode=ur2&tag=atodorovorg-20&linkId=L6Q34XAXQS5RDMOY">Amazon</a><img src="https://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=ur2&o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />),
                which provides me with a small commission for each sale. Thank you for your support.
            </em>
        </small>
    </p>
</section>

<form action="http://google.com/search" method="get" style="width:300px;margin:0 auto;">
    <fieldset role="search">
        <input type="hidden" name="sitesearch" value="http://atodorov.org" />
        <input class="search" type="text" name="q" placeholder="Search" style="width:100%"/>
    </fieldset>
</form>

<p class="copyright text-muted">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">CC-BY-SA</a> &amp;
    <a rel="license" href="http://opensource.org/licenses/MIT">MIT</a>
    2011-2016 &diams; Alexander Todorov &diams;
    <a href="http://planet.sofiavalley.com">SofiaValley Blog</a>
</p>

<script type='text/javascript'>
window.__lo_site_id = 55936;
    (function() {
        var wa = document.createElement('script'); wa.type = 'text/javascript'; wa.async = true;
        wa.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://cdn') + '.luckyorange.com/w.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(wa, s);
      })();
</script>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="http://atodorov.org/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="http://atodorov.org/theme/js/bootstrap.min.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37979549-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'atodorov';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>