<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

            <meta name="google-site-verification" content="XynqZtldWNBbmsynVQZremIxaaO8Wgs6AGR8UZ7KIkM">

        <title>atodorov.org - Tag QA</title>

        <link href="http://feeds.feedburner.com/atodorov" type="application/atom+xml" rel="alternate" title="atodorov.org Full Atom Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="http://atodorov.org/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="http://atodorov.org/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="http://atodorov.org/theme/css/code_blocks/github.css" rel="stylesheet">

            <!-- CSS specified by the user -->
            <link href="http://atodorov.org/override.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="http://atodorov.org/theme/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

                <meta property="fb:admins" content="1616937247" >
                <meta property="og:locale" content="en_US">
		<meta property="og:site_name" content="atodorov.org">
            <meta name="twitter:card" content="summary_large_image">
            <meta name="twitter:site" content="@atodorov_">
            <meta name="twitter:title" content="atodorov.org">
            <meta name="twitter:description" content="you can logoff, but you can never leave">
                <meta name="twitter:image" content="http://atodorov.org//images/header_02.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://atodorov.org/">atodorov.org</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                        <li><a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=menu">Mr. Senko</a></li>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

        <header class="intro-header" style="background-image: url('/images/header_02.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="page-heading">
                        <h1>Tag QA</h1>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/12/28/4-quick-wins-to-manage-the-cost-of-software-testing/" rel="bookmark" title="Permalink to 4 Quick Wins to Manage the Cost of Software Testing">
                <h2 class="post-title">
                    4 Quick Wins to Manage the Cost of Software Testing
                </h2>
            </a>
                <div class="highlight"><pre>Every activity in software development has a cost and a value. Getting cost to
trend down while increasing value, is the ultimate goal.
</pre></div>


<p>This is the introduction of an e-book called
<a href="http://pi.qasymphony.com/four-quick-wins-thank-you">4 Quick Wins to Manage the Cost of Software Testing</a>.
It was sent to me by Ivan Fingarov couple of months ago. Just now I've managed to
read it and here's a quick summary. I urge everyone to download the original copy
and give it a read.</p>
<p>The paper focuses on several practices which organizations can apply immediately
in order to become more efficient and transparent in their software testing. While
larger organizations (e.g. enterprises) have most of these practices already in place
smaller companies (up to 50-100 engineering staff) may not be familiar with them
and will reap the most benefits of implementing said practices. Even though I work
for a large enterprise I find this guide useful when considered at the individual
team level!</p>
<p>The first chapter focuses on <em>Tactics</em> to minimize cost: Process, Tools, Bug System Mining
and Eliminating Handoffs.</p>
<p>In <em>Process</em> the goal is to minimize the burden of documenting the test process
(aka testing artifacts), allow for better transparency and visibility outside the QA group
and streamline the decision making process of what to test and when to stop testing,
how much has been tested, what the risk is, ect. The authors propose testing core functionality
paired with emerging risk areas based on new features development. They propose making
a list of these and sorting that list by perceived risk/priority and testing as much
as possible. Indeed this is very similar to the method I've used at Red Hat when designing
testing for new features and new major releases of Red Hat Enterprise Linux. A similar
method I've seen in place at several start-ups as well, although in the small organization
the primary driver for this method is lack of sufficient test resources.</p>
<p><em>Tools</em> proposes the use of test case management systems to ease the documentation burden.
I've used <a href="http://testlink.org/">TestLink</a> and <a href="https://github.com/Nitrate/Nitrate">Nitrate</a>.
From them Nitrate has more features but is currently unmaintained with me being the
largest contributor on GitHub. From the paid variants I've used
<a href="https://www.polarion.com/products/qa/test-automation">Polarion</a> which I generally dislike.
Polarion is most suitable for large organizations because it gives lots of opportunities
for tracking and reporting. For small organizations it is an overkill.</p>
<p><em>Bug System Mining</em> is a technique which involves regularly scanning the bug tracker
and searching for patterns. This is useful for finding bug types which appear
frequently and generally point to a flaw in the software development process. The fix for these
flaws usually is a change in policy/workflow which eliminates the source of the errors.
I'm a fan of this technique when joining an existing project and need to assess
what the current state is. I've done this when consulting for a few start-ups, including
<a href="http://meet.jit.si">Jitsi Meet</a> (acquired by Atlassian), however I'm not doing bug mining
on a regular basis which I consider a drawback and I really should start doing!</p>
<p>For example at one project I found lots of bugs reported against translations, e.g.
missing translations, text overflowing the visible screen area or not playing well with
existing design, chosen language/style not fitting well with the product domain, etc.</p>
<p>The root cause of the problem was how the software in question has been localized.
The translators were given a file of English strings, which they would translate and
return back in an spread sheet. Developers would copy&amp;paste the translated strings
into localization files and integrate with the software. Then QA would usually
inspect all the pages and report the above issues. The solution was to remove devel
and QA from the translation process, implement a translation management system together
with live preview (web based) so that translators can keep track of what is left to
translate and can visually inspect their work immediately after a string was translated.
Thus translators are given more context for their work but also given the responsibility
to produce good quality translations.</p>
<p>Another example I've seen are many bugs which seem like a follow up/nice to have features
of partially implemented functionality. The root cause of this problem turned out to be
that devel was jumping straight to implementation without taking the time to brainstorm
and consult with QE and product owners, not taking into account corner cases and minor
issues which would have easily been raised by skillful testers. This process lead to
several iterations until the said functionality was considered initially implemented.</p>
<p><em>Eliminating Handoffs</em> proposes the use of cross-functional teams to reduce idle time
and reduce the back-and-forth communication which happens when a bug is found, reported,
evaluated and considered for a fix, fixed by devel and finally deployed for testing.
This method argues that including testers early in the process and pairing them with
the devel team will produce faster bug fixes and reduce communication burden.</p>
<p>While I generally agree with that statement it's worth noting that cross-functional
teams perform really well when all team members have relatively equal skill level
on the horizontal scale and strong experience on the vertical scale (think T-shaped specialist).
Cross-functional teams
don't work well when you have developers who aren't well versed in the testing domain
and/or testers who are not well versed in programming or the broader OS/computer science
fundamentals domain. In my opinion you need well experienced engineers for a good cross-functional
team.</p>
<p>In the chapter <em>Collaboration</em> the paper focuses on pairing, building the right thing
and faster feedback loops for developers. This overlaps with earlier proposals for
cross-functional teams and QA bringing value by asking the "what if" questions.
The chapter specifically talks about the Three Amigos meeting between PM, devel and QA
where they discuss a feature proposal from all angles and finally come to a conclusion
what the feature should look like. I'm a strong supporter of this technique and have
been working with it under one form or another during my entire career. This also
touches on the notion that testers need to move into the <em>Quality Assistance</em> business
and be proactive during the software development process, which is something I'm
hoping to talk about at the
<a href="http://www.romaniatesting.ro/">Romanian Testing Conference</a> next year!</p>
<p>Finally the book talks about <em>Skills Development</em> and makes the distinction between
Centers of Excellence (CoE) and Communities of Practice (CoP). Both the book and I
are supporters of the CoP approach. This is a bottoms-up approach which is open for
everyone to join in and harnesses the team creative abilities. It also takes into
account that different teams use different methods and tools and that
"one size doesn't fit all"!</p>
<div class="highlight"><pre>Skilled teams find important bugs faster, discover innovative solutions to hard
testing problems and know how to communicate their value. Sometimes, a few super
testers can replace an army of average testers.
</pre></div>


<p>While I consider myself to be a "super tester" with thousands of bugs reported there
is a very important note to make here. Communities of Practice are successful when
their members are self-focused on skill development! In my view and to some
extent the communities I've worked with everyone should strive to constantly improve
their skills but also exercise peer pressure on their co-workers to not fall behind.
This has been confirmed by other folks in the QA industry and I've heard it many times
when talking to friends from other companies.</p>
<p>Thanks for reading and happy testing!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 28 December 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/12/28/4-quick-wins-to-manage-the-cost-of-software-testing/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/12/27/mutation-testing-vs-coverage/" rel="bookmark" title="Permalink to Mutation Testing vs. Coverage">
                <h2 class="post-title">
                    Mutation Testing vs. Coverage
                </h2>
            </a>
                <p>At GTAC 2015 Laura Inozemtseva made a lightning talk titled
<a href="https://www.youtube.com/watch?v=sAfROROGujU&amp;list=PLFjlI7p-h1hxBP3cIjEqePSeoBDHud5Db&amp;index=47">Coverage is Not Strongly Correlated with Test Suite Effectiveness</a>
which is the single event that got me hooked up with mutation testing.
This year, at GTAC 2016, Rahul Gopinath made a counter argument
with his lightning talk
<a href="https://www.youtube.com/watch?v=NKEptA3KP08&amp;list=PLFjlI7p-h1hxBP3cIjEqePSeoBDHud5Db&amp;index=1">Code Coverage is a Strong Predictor of Test Suite Effectiveness</a>.
So which one is better ? I urge you to watch both talks and take notes before
reading about my practical experiment and other opinions on the topic!</p>
<p><strong>DISCLAIMER:</strong> I'm a heavy contributor to Cosmic-Ray, the mutation testing tool for Python
so my view is biased!</p>
<p>Both Laura and Rahul (you will too) agree that a test suite effectiveness depends
on the strength of its oracles. In other words the assertions you make in your tests.
This is what makes a test suite good and determines its ability to detect bugs when
present. I've decided to use <a href="https://github.com/MrSenko/pelican-ab">pelican-ab</a> as
a practical example. pelican-ab is a plugin for Pelican, the static site generator
for Python. It allows you to generate A/B experiments by writing out the content
into different directories and adjusting URL paths based on the experiment name.</p>
<h2>Can 100% code coverage detect bugs</h2>
<p>Absolutely <strong>NOT</strong>! In version 0.2.1,
<a href="https://github.com/MrSenko/pelican-ab/commit/ef1e2117ad8ffa5b9fa8470d32d54a36ccb140bb">commit ef1e211</a>,
pelican-ab had the following bug:</p>
<div class="highlight"><pre><span class="n">Given</span><span class="o">:</span> <span class="n">Pelican</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">DELETE_OUTPUT_DIRECTORY</span> <span class="k">is</span> <span class="kd">set</span> <span class="n">to</span> <span class="n">True</span> <span class="o">(</span><span class="n">which</span> <span class="n">it</span> <span class="k">is</span> <span class="n">by</span> <span class="k">default</span><span class="o">)</span>
<span class="n">When</span><span class="o">:</span> <span class="n">we</span> <span class="n">generate</span> <span class="n">several</span> <span class="n">experiments</span> <span class="n">using</span> <span class="n">the</span> <span class="n">commands</span><span class="o">:</span>
    <span class="n">AB_EXPERIMENT</span><span class="o">=</span><span class="s2">&quot;control&quot;</span> <span class="n">make</span> <span class="n">regenerate</span>
    <span class="n">AB_EXPERIMENT</span><span class="o">=</span><span class="s2">&quot;123&quot;</span> <span class="n">make</span> <span class="n">regenerate</span>
    <span class="n">AB_EXPERIMENT</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span> <span class="n">make</span> <span class="n">regenerate</span>
    <span class="n">make</span> <span class="n">publish</span>
<span class="n">Actual</span> <span class="n">result</span><span class="o">:</span> <span class="n">only</span> <span class="n">the</span> <span class="s2">&quot;xy&quot;</span> <span class="n">experiment</span> <span class="o">(</span><span class="n">the</span> <span class="n">last</span> <span class="n">one</span><span class="o">)</span> <span class="n">would</span> <span class="n">be</span> <span class="n">published</span> <span class="n">online</span><span class="o">.</span>
<span class="n">And</span><span class="o">:</span> <span class="n">all</span> <span class="n">of</span> <span class="n">the</span> <span class="n">other</span> <span class="n">contents</span> <span class="n">will</span> <span class="n">be</span> <span class="n">deleted</span><span class="o">.</span>

<span class="n">Expected</span> <span class="n">result</span><span class="o">:</span> <span class="n">content</span> <span class="n">from</span> <span class="n">all</span> <span class="n">experiments</span> <span class="n">will</span> <span class="n">be</span> <span class="n">available</span> <span class="n">under</span> <span class="n">the</span> <span class="n">output</span> <span class="n">directory</span><span class="o">.</span>
</pre></div>


<p>This is because before each invocation Pelican deletes the output directory and
re-creates the entire content structure. The bug was not caught regardless of
having 100% line + branch coverage. See
<a href="https://travis-ci.org/MrSenko/pelican-ab/builds/129514715">Build #10</a> for more
info.</p>
<h2>Can 100% mutation coverage detect bugs</h2>
<p>So I've branched off since commit ef1e211 into the
<a href="https://github.com/MrSenko/pelican-ab/commits/mutation_testing_vs_coverage_experiment">mutation_testing_vs_coverage_experiment branch</a>
(requires Pelican==3.6.3).</p>
<p>After initial execution of Cosmic Ray I have 2 mutants left:</p>
<div class="highlight"><pre>$ cosmic-ray run --baseline=10 --test-runner=unittest example.json pelican_ab -- tests/
$ cosmic-ray report example.json 
job ID 29:Outcome.SURVIVED:pelican_ab
command: cosmic-ray worker pelican_ab mutate_comparison_operator 3 unittest -- tests/
<span class="gd">--- mutation diff ---</span>
<span class="gd">--- a/home/senko/pelican-ab/pelican_ab/__init__.py</span>
<span class="gi">+++ b/home/senko/pelican-ab/pelican_ab/__init__.py</span>
<span class="gu">@@ -14,7 +14,7 @@</span>
     def __init__(self, output_path, settings=None):
         super(self.__class__, self).__init__(output_path, settings)
         experiment = os.environ.get(jinja_ab._ENV, jinja_ab._ENV_DEFAULT)
<span class="gd">-        if (experiment != jinja_ab._ENV_DEFAULT):</span>
<span class="gi">+        if (experiment &gt; jinja_ab._ENV_DEFAULT):</span>
             self.output_path = os.path.join(self.output_path, experiment)
             Content.url = property((lambda s: ((experiment + &#39;/&#39;) + _orig_content_url.fget(s))))
             URLWrapper.url = property((lambda s: ((experiment + &#39;/&#39;) + _orig_urlwrapper_url.fget(s))))

job ID 33:Outcome.SURVIVED:pelican_ab
command: cosmic-ray worker pelican_ab mutate_comparison_operator 7 unittest -- tests/
<span class="gd">--- mutation diff ---</span>
<span class="gd">--- a/home/senko/pelican-ab/pelican_ab/__init__.py</span>
<span class="gi">+++ b/home/senko/pelican-ab/pelican_ab/__init__.py</span>
<span class="gu">@@ -14,7 +14,7 @@</span>
     def __init__(self, output_path, settings=None):
         super(self.__class__, self).__init__(output_path, settings)
         experiment = os.environ.get(jinja_ab._ENV, jinja_ab._ENV_DEFAULT)
<span class="gd">-        if (experiment != jinja_ab._ENV_DEFAULT):</span>
<span class="gi">+        if (experiment not in jinja_ab._ENV_DEFAULT):</span>
             self.output_path = os.path.join(self.output_path, experiment)
             Content.url = property((lambda s: ((experiment + &#39;/&#39;) + _orig_content_url.fget(s))))
             URLWrapper.url = property((lambda s: ((experiment + &#39;/&#39;) + _orig_urlwrapper_url.fget(s))))

total jobs: 33
complete: 33 (100.00%)
survival rate: 6.06%
</pre></div>


<p>The last one, job 33 is equivalent mutation. The first one, job 29 is killed by the test
added in
<a href="https://github.com/MrSenko/pelican-ab/commit/b8bff85eeca6c18fbf62cac55fd1a0d64295c43c">commit b8bff85</a>.
For all practical purposes we now have 100% code coverage and 100% mutation coverage.
The bug described above still exists thought.</p>
<h2>How can we detect the bug</h2>
<p>The bug isn't detected by any test because
we don't have tests designed to perform and validate the exact same steps that a
physical person will execute when using pelican-ab. Such test is added in
<a href="https://github.com/MrSenko/pelican-ab/commit/ca85bd042d783f2f6551ae17f16b29aa3750711b">commit ca85bd0</a>
and you can see that it causes
<a href="https://travis-ci.org/MrSenko/pelican-ab/builds/186510356">Build #22</a> to fail.</p>
<p>Experiment with setting <code>DELETE_OUTPUT_DIRECTORY=False</code> in <code>tests/pelicanconf.py</code> and
the test will PASS!</p>
<h2>Is pelican-ab bug free</h2>
<p>Not of course. Even after 100% code and mutation coverage and after manually constructing
a test which mimics user behavior there is at least one more bug present. There
is a pylint <code>bad-super-call</code> error, fixed in
<a href="https://github.com/MrSenko/pelican-ab/commit/193e3db9e7d021e11b54f54ac8b8718651c633c8">commit 193e3db</a>.
For more information about the error see
<a href="http://mrsenko.com/blog/atodorov/2016/09/14/beware-of-recursion-loop-when-using-super/">this blog post</a>.</p>
<h2>Other bugs found</h2>
<p>During my humble experience with mutation testing so far I've added
<a href="https://github.com/rhinstaller/pykickstart/pulls/atodorov">quite a few new tests</a>
and discovered two bugs which went unnoticed for years. The first one is
constructor parameter not passed to parent constructor,
see
<a href="https://github.com/rhinstaller/pykickstart/pull/96/files#diff-f4294048719aeac4da7a86eee0fbdfd3">PR#96, pykickstart/commands/authconfig.py</a></p>
<div class="highlight"><pre>     def __init__(self, writePriority=0, *args, **kwargs):
<span class="gd">-        KickstartCommand.__init__(self, *args, **kwargs)</span>
<span class="gi">+        KickstartCommand.__init__(self, writePriority, *args, **kwargs)</span>
         self.authconfig = kwargs.get(&quot;authconfig&quot;, &quot;&quot;)
</pre></div>


<p>The second bug is parameter being passed to parent class constructor,
but the parent class doesn't care about this parameter. For example
<a href="https://github.com/rhinstaller/pykickstart/pull/96/files#diff-7d2833450b6e1c9a94eb90e7f171ff52">PR#96, pykickstart/commands/driverdisk.py</a></p>
<div class="highlight"><pre><span class="gd">-    def __init__(self, writePriority=0, *args, **kwargs):</span>
<span class="gd">-        BaseData.__init__(self, writePriority, *args, **kwargs)</span>
<span class="gi">+    def __init__(self, *args, **kwargs):</span>
<span class="gi">+        BaseData.__init__(self, *args, **kwargs)</span>
</pre></div>


<p>Also note that pykickstart has nearly 100% test coverage as a whole
and the affected files were 100% covered as well.</p>
<p>The bugs above don't seem like a big deal and when considered out of context
are relatively minor. However pykickstart's biggest client is anaconda, the Fedora
and Red Hat Enterprise Linux installation program. Anaconda uses pykickstart to
parse and generate text files (called kickstart files) which contain information
for driving the installation in a fully automated manner. This is used by everyone
who installs Linux on a large scale and is pretty important functionality!</p>
<p><code>writePriority</code> controls the order of which individual commands are written to file
at the end of the installation. In rare cases the order of commands may depend
on each other. Now imagine the bugs above produce a disordered kickstart file,
which a system administrator thinks should work but it doesn't. It may be the case
this administrator is trying to provision hundreds of Linux systems to bootstrap
a new data center or maybe performing disaster recovery. You get the scale of
the problem now, don't you?</p>
<p>To be honest I've seen bugs of this nature but not in the last several years.</p>
<p>This is all to say a minor change like this may have
an unexpectedly big impact somewhere down the line.</p>
<h2>Conclusion</h2>
<p>With respect to the above findings and my bias I'll say the following:</p>
<ul>
<li>Neither 100% coverage, nor 100% mutation coverage are a silver bullet against bugs;</li>
<li>100% mutation coverage appears to be better than 100% code coverage in practice;</li>
<li>Mutation testing clearly shows out pieces of code which need refactoring
  which in turn minimizes the number of possible mutations;</li>
<li>Mutation testing causes you to write more asserts and construct more detailed tests
  which is always a good thing when testing software;</li>
<li>You can't replace humans designing test cases just yet but can give them tools
  to allow them to write more and better tests;</li>
<li>You should not rely on a single tool (or two of them) because tools are only
  able to find bugs they were designed for!</li>
</ul>
<h2>Bonus: What others think</h2>
<p>As a bonus to this article let me share a transcript from the
<a href="https://mutation-testing.slack.com">mutation-testing.slack.com</a> community:</p>
<div class="highlight"><pre>atodorov 2:28 PM
Hello everyone, I&#39;d like to kick-off a discussion / interested in what you think about
Rahul Gopinath&#39;s talk at GTAC this year. What he argues is that test coverage is still
the best metric for how good a test suite is and that mutation coverage doesn&#39;t add much
additional value. His talk is basically the opposite of what @lminozem presented last year
at GTAC. Obviously the community here and especially tools authors will have an opinion on
these two presentations.

tjchambers 12:37 AM
@atodorov I have had the &quot;pleasure&quot; of working on a couple projects lately that illustrate
why LOC test coverage is a misnomer. I am a **strong** proponent of mutation testing so will
declare my bias.

The projects I have worked on have had a mix of test coverage - one about 50% and
another &gt; 90%.

In both cases however there was a significant difference IMO relative to mutation coverage
(which I have more faith in as representative of true tested code).

Critical factors I see when I look at the difference:

- Line length: in both projects the line lengths FAR exceeded visible line lengths that are
&quot;acceptable&quot;. Many LONGER lines had inline conditionals at the end, or had ternary operators
and therefore were in fact only 50% or not at all covered, but were &quot;traversed&quot;

- Code Conviction (my term): Most of the code in these projects (Rails applications) had
significant Hash references all of which were declared in &quot;traditional&quot; format hhh[:symbol].
So it was nearly impossible for the code in execution to confirm the expectation of the
existence of a hash entry as would be the case with stronger code such as &quot;hhh.fetch(:symbol)&quot;

- Instance variables abound: As with most of Rails code the number of instance variables
in a controller are extreme. This pattern of reference leaked into all other code as well,
making it nearly impossible with the complex code flow to ascertain proper reference
patterns that ensured the use of the instance variables, so there were numerous cases
of instance variable typos that went unnoticed for years. (edited)

- .save and .update: yes again a Rails issue, but use of these &quot;weak&quot; operations showed again
that although they were traversed, in many cases those method references could be removed
during mutation and the tests would still pass - a clear indication that save or update was
silently failing.

I could go on and on, but the mere traversal of a line of code in Ruby is far from an indication
of anything more than it may be &quot;typed in correctly&quot;.

@atodorov Hope that helps.

LOC test coverage is a place to begin - NOT a place to end.

atodorov 1:01 AM
@tjchambers: thanks for your answer. It&#39;s too late for me here to read it carefully but
I&#39;ll do it tomorrow and ping you back

dkubb 1:13 AM
As a practice mutation testing is less widely used. The tooling is still maturing. Depending on your
language and environment you might have widely different experiences with mutation testing

I have not watched the video, but it is conceivable that someone could try out mutation testing tools
for their language and conclude it doesn’t add very much

mbj 1:14 AM
Yeah, I recall talking with @lminozem here and we identified that the tools she used likely
show high rates of false positives / false coverage (as the tools likely do not protect against
certain types of integration errors)

dkubb 1:15 AM
IME, having done TDD for about 15+ years or so, and mutation testing for about 6 years, I think
when it is done well it can be far superior to using line coverage as a measurement of test quality

mbj 1:16 AM
Any talk pro/against mutation testing must, as the tool basis is not very homogeneous, show a non consistent result.

dkubb 1:16 AM
Like @tjchambers says though, if you have really poor line coverage you’re not going to
get as much of a benefit from mutation testing, since it’s going to be telling you what
you already know — that your project is poorly tested and lots of code is never exercised

mbj 1:19 AM
Thats a good and likely the core point. I consider that mutation testing only makes sense
when aiming for 100% (and this is to my experience not impractical).

tjchambers 1:20 AM
I don&#39;t discount the fact that tool quality in any endeavor can bring pro/con judgements
based on particular outcomes

dkubb 1:20 AM
What is really interesting for people is to get to 100% line coverage, and then try mutation
testing. You think you’ve done a good job, but I guarantee mutation testing will find dozens
if not hundreds of untested cases .. even in something with 100% line coverage

To properly evaluate mutation testing, I think this process is required, because you can’t
truly understand how little line coverage gives you in comparison

tjchambers 1:22 AM
But I don&#39;t need a tool to tell me that a 250 character line of conditional code that by
itself would be an oversized method AND counts more because there are fewer lines in the
overall percentage contributes to a very foggy sense of coverage.

dkubb 1:22 AM
It would not be unusual for something with 100% line coverage to undergo mutation testing
and actually find out that the tests only kill 60-70% of possible mutations

tjchambers 1:22 AM
@dkubb or less

dkubb 1:23 AM
usually much less :stuck_out_tongue:

it can be really humbling

mbj 1:23 AM
In this discussion you miss that many test suites (unless you have noop detection):
Will show false coverage.

tjchambers 1:23 AM
When I started with mutant on my own project which I developed I had 95% LOC coverage

mbj 1:23 AM
Test suites need to be fixed to comply to mutation testing invariants.

tjchambers 1:23 AM
I had 34% mutation coverage

And that was ignoring the 5% that wasn&#39;t covered at all

mbj 1:24 AM
Also if the tool you compare MT with line coverage on: Is not very strong,
the improvement may not be visible.

dkubb 1:24 AM
another nice benefit is that you will become much better at enumerating all
the things you need to do when writing tests

tjchambers 1:24 AM
@dkubb or better yet - when writing code.

The way I look at it - the fewer the alive mutations the better the test,
the fewer the mutations the better the code.

dkubb 1:29 AM
yeah, you can infer a kind of cyclomatic complexity by looking at how many mutations there are

tjchambers 1:31 AM
Even without tests (not recommended) you can judge a lot from the mutations themselves.

I still am an advocate for mutations/LOC metric
</pre></div>


<p>As you can see members in the community are strong supporters of mutation testing, all of them
having much more experience than I do.</p>
<p>I'd like to hear more practical examples if you are able to share them since I'm
collecting conference material on this topic. Thanks for reading and happy testing!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 27 December 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/12/27/mutation-testing-vs-coverage/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/12/16/how-to-create-auxiliary-build-jobs-in-travis-ci-matrix/" rel="bookmark" title="Permalink to How to create auxiliary build jobs in Travis-CI matrix">
                <h2 class="post-title">
                    How to create auxiliary build jobs in Travis-CI matrix
                </h2>
            </a>
                <p><img alt="Auxiliary build job in Travis-CI" src="/images/travisci_extra_job_in_matrix.png" title="Auxiliary build job in Travis-CI" /></p>
<p>In Travis-CI when you combine the three main configuration options of
<em>Runtime (language)</em>, <em>Environment</em> and <em>Exclusions/Inclusions</em> you get a
<a href="https://docs.travis-ci.com/user/customizing-the-build#Build-Matrix">build matrix</a>
of all possible combinations! For example, for <em>django-chartit</em> the matrix includes
43 build jobs, spread across various Python and Django versions. For reference
see <a href="https://travis-ci.org/chartit/django-chartit/builds/181115880">Build #75</a>.</p>
<p>For <em>django-chartit</em> I wanted to have an additional build job which would execute
pylint. I wanted the job to be independent because currently pylint produces lots
of errors and warnings. Having an independent job instead of integrating pylint
together with all jobs makes it easier to see if any of the functional tests failed.</p>
<p>Using the inclusion functionality of Travis-CI I was able to define an auxiliary
build job. The trick is to provide sane environment defaults for all
build jobs (regular and auxiliary ones) so you don't have to expand your environment
section! In this case the change looks like this</p>
<div class="highlight"><pre><span class="gh">diff --git a/.travis.yml b/.travis.yml</span>
<span class="gh">index 67f656d..9b669f9 100644</span>
<span class="gd">--- a/.travis.yml</span>
<span class="gi">+++ b/.travis.yml</span>
<span class="gu">@@ -2,6 +2,8 @@ after_success:</span>
 - coveralls
 before_install:
 - pip install coveralls
<span class="gi">+- if [ -z &quot;$_COMMAND&quot; ]; then export _COMMAND=coverage; fi</span>
<span class="gi">+- if [ -z &quot;$_DJANGO&quot; ]; then export _DJANGO=1.10.4; fi</span>
 env:
 - !!python/unicode &#39;_DJANGO=1.10&#39;
 - !!python/unicode &#39;_DJANGO=1.10.2&#39;
<span class="gu">@@ -41,6 +43,10 @@ matrix:</span>
     python: 3.3
   - env: _DJANGO=1.10.4
     python: 3.3
<span class="gi">+  include:</span>
<span class="gi">+  - env: _COMMAND=pylint</span>
<span class="gi">+    python: 3.5</span>
<span class="gi">+</span>
 notifications:
   email:
     on_failure: change
<span class="gu">@@ -50,4 +56,4 @@ python:</span>
 - 3.3
 - 3.4
 - 3.5
<span class="gd">-script: make coverage</span>
<span class="gi">+script: make $_COMMAND</span>
</pre></div>


<p>For more info take a look at
<a href="https://github.com/chartit/django-chartit/commit/b22eda7cd67a062f49a0f60b8ac51383e4f8c3a5">commit b22eda7</a>
and <a href="https://travis-ci.org/chartit/django-chartit/builds/183883813">Build #77</a>. Note
Job #77.44!</p>
<p>Thanks for reading and happy testing!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 16 December 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/12/16/how-to-create-auxiliary-build-jobs-in-travis-ci-matrix/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/12/04/overridden-let-causes-segfault-with-rspec/" rel="bookmark" title="Permalink to Overridden let() causes segfault with RSpec">
                <h2 class="post-title">
                    Overridden let() causes segfault with RSpec
                </h2>
            </a>
                <p>Last week <a href="https://github.com/syndbg">Anton</a> asked me to take a look at one of
his RSpec test suites. He was able to consistently reproduce a segfault which
looked like this:</p>
<div class="highlight"><pre><span class="o">/</span><span class="s-Atom">home</span><span class="o">/</span><span class="s-Atom">atodorov/.rbenv</span><span class="o">/</span><span class="s-Atom">versions</span><span class="o">/</span><span class="mf">2.3.2</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">ruby</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="mf">2.3.0</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">-</span><span class="s-Atom">core</span><span class="o">-</span><span class="mf">3.5.4</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">/</span><span class="s-Atom">core</span><span class="o">/</span><span class="s-Atom">runner</span><span class="p">.</span><span class="nn">rb</span><span class="p">:</span><span class="mi">113</span><span class="s-Atom">:</span> <span class="p">[</span><span class="nv">BUG</span><span class="p">]</span> <span class="s-Atom">vm_call_cfunc</span> <span class="o">-</span> <span class="s-Atom">cfp</span> <span class="s-Atom">consistency</span> <span class="s-Atom">error</span>
<span class="s-Atom">ruby</span> <span class="mf">2.3.2</span><span class="nf">p217</span> <span class="p">(</span><span class="mi">2016</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">15</span> <span class="s-Atom">revision</span> <span class="mi">56796</span><span class="p">)</span> <span class="p">[</span><span class="s-Atom">x86_64</span><span class="o">-</span><span class="s-Atom">linux</span><span class="p">]</span>

<span class="s-Atom">--</span> <span class="nv">Control</span> <span class="s-Atom">frame</span> <span class="s-Atom">information</span> <span class="s-Atom">-----------------------------------------------</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0013</span> <span class="nn">p</span><span class="p">:</span><span class="s-Atom">----</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0048</span> <span class="nn">e</span><span class="p">:</span><span class="mi">000047</span> <span class="nv">CFUNC</span>  <span class="s-Atom">:map</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0012</span> <span class="nn">p</span><span class="p">:</span><span class="mi">0011</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0045</span> <span class="nn">e</span><span class="p">:</span><span class="mi">000044</span> <span class="nv">BLOCK</span>  <span class="o">/</span><span class="s-Atom">home</span><span class="o">/</span><span class="s-Atom">atodorov/.rbenv</span><span class="o">/</span><span class="s-Atom">versions</span><span class="o">/</span><span class="mf">2.3.2</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">ruby</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="mf">2.3.0</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">-</span><span class="s-Atom">core</span><span class="o">-</span><span class="mf">3.5.4</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">/</span><span class="s-Atom">core</span><span class="o">/</span><span class="s-Atom">runner</span><span class="p">.</span><span class="nn">rb</span><span class="p">:</span><span class="mi">113</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0011</span> <span class="nn">p</span><span class="p">:</span><span class="mi">0035</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0043</span> <span class="nn">e</span><span class="p">:</span><span class="mi">000042</span> <span class="nv">METHOD</span> <span class="o">/</span><span class="s-Atom">home</span><span class="o">/</span><span class="s-Atom">atodorov/.rbenv</span><span class="o">/</span><span class="s-Atom">versions</span><span class="o">/</span><span class="mf">2.3.2</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">ruby</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="mf">2.3.0</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">-</span><span class="s-Atom">core</span><span class="o">-</span><span class="mf">3.5.4</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">/</span><span class="s-Atom">core</span><span class="o">/</span><span class="s-Atom">configuration</span><span class="p">.</span><span class="nn">rb</span><span class="p">:</span><span class="mi">1835</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0010</span> <span class="nn">p</span><span class="p">:</span><span class="mi">0011</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0040</span> <span class="nn">e</span><span class="p">:</span><span class="mi">000039</span> <span class="nv">BLOCK</span>  <span class="o">/</span><span class="s-Atom">home</span><span class="o">/</span><span class="s-Atom">atodorov/.rbenv</span><span class="o">/</span><span class="s-Atom">versions</span><span class="o">/</span><span class="mf">2.3.2</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">ruby</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="mf">2.3.0</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">-</span><span class="s-Atom">core</span><span class="o">-</span><span class="mf">3.5.4</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">/</span><span class="s-Atom">core</span><span class="o">/</span><span class="s-Atom">runner</span><span class="p">.</span><span class="nn">rb</span><span class="p">:</span><span class="mi">112</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0009</span> <span class="nn">p</span><span class="p">:</span><span class="mi">0018</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0037</span> <span class="nn">e</span><span class="p">:</span><span class="mi">000036</span> <span class="nv">METHOD</span> <span class="o">/</span><span class="s-Atom">home</span><span class="o">/</span><span class="s-Atom">atodorov/.rbenv</span><span class="o">/</span><span class="s-Atom">versions</span><span class="o">/</span><span class="mf">2.3.2</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">ruby</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="mf">2.3.0</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">-</span><span class="s-Atom">core</span><span class="o">-</span><span class="mf">3.5.4</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">/</span><span class="s-Atom">core</span><span class="o">/</span><span class="s-Atom">reporter</span><span class="p">.</span><span class="nn">rb</span><span class="p">:</span><span class="mi">77</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0008</span> <span class="nn">p</span><span class="p">:</span><span class="mi">0022</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0033</span> <span class="nn">e</span><span class="p">:</span><span class="mi">000032</span> <span class="nv">METHOD</span> <span class="o">/</span><span class="s-Atom">home</span><span class="o">/</span><span class="s-Atom">atodorov/.rbenv</span><span class="o">/</span><span class="s-Atom">versions</span><span class="o">/</span><span class="mf">2.3.2</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">ruby</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="mf">2.3.0</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">-</span><span class="s-Atom">core</span><span class="o">-</span><span class="mf">3.5.4</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">/</span><span class="s-Atom">core</span><span class="o">/</span><span class="s-Atom">runner</span><span class="p">.</span><span class="nn">rb</span><span class="p">:</span><span class="mi">111</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0007</span> <span class="nn">p</span><span class="p">:</span><span class="mi">0025</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0028</span> <span class="nn">e</span><span class="p">:</span><span class="mi">000027</span> <span class="nv">METHOD</span> <span class="o">/</span><span class="s-Atom">home</span><span class="o">/</span><span class="s-Atom">atodorov/.rbenv</span><span class="o">/</span><span class="s-Atom">versions</span><span class="o">/</span><span class="mf">2.3.2</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">ruby</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="mf">2.3.0</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">-</span><span class="s-Atom">core</span><span class="o">-</span><span class="mf">3.5.4</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">/</span><span class="s-Atom">core</span><span class="o">/</span><span class="s-Atom">runner</span><span class="p">.</span><span class="nn">rb</span><span class="p">:</span><span class="mi">87</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0006</span> <span class="nn">p</span><span class="p">:</span><span class="mi">0085</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0023</span> <span class="nn">e</span><span class="p">:</span><span class="mi">000022</span> <span class="nv">METHOD</span> <span class="o">/</span><span class="s-Atom">home</span><span class="o">/</span><span class="s-Atom">atodorov/.rbenv</span><span class="o">/</span><span class="s-Atom">versions</span><span class="o">/</span><span class="mf">2.3.2</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">ruby</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="mf">2.3.0</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">-</span><span class="s-Atom">core</span><span class="o">-</span><span class="mf">3.5.4</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">/</span><span class="s-Atom">core</span><span class="o">/</span><span class="s-Atom">runner</span><span class="p">.</span><span class="nn">rb</span><span class="p">:</span><span class="mi">71</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0005</span> <span class="nn">p</span><span class="p">:</span><span class="mi">0026</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0016</span> <span class="nn">e</span><span class="p">:</span><span class="mi">000015</span> <span class="nv">METHOD</span> <span class="o">/</span><span class="s-Atom">home</span><span class="o">/</span><span class="s-Atom">atodorov/.rbenv</span><span class="o">/</span><span class="s-Atom">versions</span><span class="o">/</span><span class="mf">2.3.2</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">ruby</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="mf">2.3.0</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">-</span><span class="s-Atom">core</span><span class="o">-</span><span class="mf">3.5.4</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">/</span><span class="s-Atom">core</span><span class="o">/</span><span class="s-Atom">runner</span><span class="p">.</span><span class="nn">rb</span><span class="p">:</span><span class="mi">45</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0004</span> <span class="nn">p</span><span class="p">:</span><span class="mi">0025</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0012</span> <span class="nn">e</span><span class="p">:</span><span class="mi">000011</span> <span class="nv">TOP</span>    <span class="o">/</span><span class="s-Atom">home</span><span class="o">/</span><span class="s-Atom">atodorov/.rbenv</span><span class="o">/</span><span class="s-Atom">versions</span><span class="o">/</span><span class="mf">2.3.2</span><span class="o">/</span><span class="s-Atom">lib</span><span class="o">/</span><span class="s-Atom">ruby</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="mf">2.3.0</span><span class="o">/</span><span class="s-Atom">gems</span><span class="o">/</span><span class="s-Atom">rspec</span><span class="o">-</span><span class="s-Atom">core</span><span class="o">-</span><span class="mf">3.5.4</span><span class="o">/</span><span class="s-Atom">exe</span><span class="o">/</span><span class="nn">rspec</span><span class="p">:</span><span class="mi">4</span> <span class="p">[</span><span class="nv">FINISH</span><span class="p">]</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0003</span> <span class="nn">p</span><span class="p">:</span><span class="s-Atom">----</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0010</span> <span class="nn">e</span><span class="p">:</span><span class="mi">000009</span> <span class="nv">CFUNC</span>  <span class="s-Atom">:load</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0002</span> <span class="nn">p</span><span class="p">:</span><span class="mi">0136</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0006</span> <span class="nv">E</span><span class="s-Atom">:</span><span class="mi">001</span><span class="s-Atom">e10</span> <span class="nv">EVAL</span>   <span class="o">/</span><span class="s-Atom">home</span><span class="o">/</span><span class="s-Atom">atodorov/.rbenv</span><span class="o">/</span><span class="s-Atom">versions</span><span class="o">/</span><span class="mf">2.3.2</span><span class="o">/</span><span class="s-Atom">bin</span><span class="o">/</span><span class="nn">rspec</span><span class="p">:</span><span class="mi">22</span> <span class="p">[</span><span class="nv">FINISH</span><span class="p">]</span>
<span class="nn">c</span><span class="p">:</span><span class="mi">0001</span> <span class="nn">p</span><span class="p">:</span><span class="mi">0000</span> <span class="nn">s</span><span class="p">:</span><span class="mi">0002</span> <span class="nv">E</span><span class="s-Atom">:</span><span class="mi">0000</span><span class="nf">a0</span> <span class="p">(</span><span class="s-Atom">none</span><span class="p">)</span> <span class="p">[</span><span class="nv">FINISH</span><span class="p">]</span>
</pre></div>


<p>Googling for <code>vm_call_cfunc - cfp consistency error</code> yields
<a href="https://bugs.ruby-lang.org/issues/10460">Ruby #10460</a>. Comments on the bug and
particularly this one point towards the error:</p>
<div class="highlight"><pre>&gt; Ruby is trying to be nice about reporting the error; but in the end,
&gt; your code is still broken if it overflows stack.
</pre></div>


<p>Somewhere in the test suite was a piece of code that was overflowing the stack.
It was somewhere along the lines of</p>
<div class="highlight"><pre><span class="n">describe</span> <span class="s1">&#39;#active_client_for_user&#39;</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s1">&#39;matching an existing user&#39;</span> <span class="k">do</span>
    <span class="n">it_behaves_like</span> <span class="s1">&#39;manager authentication&#39;</span> <span class="k">do</span>
      <span class="n">include_examples</span> <span class="s1">&#39;active client for user with existing user&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>


<p>Considering the examples in the bug I started looking for patterns where a variable
was defined and later redefined, possibly circling back to the previous definition.
Expanding the shared examples by hand transformed the code into</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">describe</span> <span class="s1">&#39;#active_client_for_user&#39;</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s1">&#39;matching an existing user&#39;</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="ss">:manager</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">let!</span><span class="p">(</span><span class="ss">:api_user_authentication</span><span class="p">)</span> <span class="p">{</span> <span class="n">create</span><span class="p">(</span><span class="ss">:user_authentication</span><span class="p">,</span> <span class="ss">user</span><span class="p">:</span> <span class="n">user</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="n">api_user_authentication</span><span class="o">.</span><span class="n">user</span> <span class="p">}</span>

    <span class="n">context</span> <span class="s1">&#39;with an `active_assigned_client`&#39;</span> <span class="k">do</span>
      <span class="o">...</span> <span class="n">skip</span> <span class="o">...</span>
    <span class="k">end</span>

    <span class="o">...</span> <span class="n">skip</span> <span class="o">...</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table>

<p>Line 5. overrode line 3. When line 4. was executed first because of lazy execution
and the call execution path became: 4-5-4-5-4-5 ... <strong>NOTE:</strong> I think we need a
warning about that in RuboCop, see
<a href="https://github.com/bbatsov/rubocop/issues/3769">RuboCop #3769</a>.
The fix however is a no brainer:</p>
<div class="highlight"><pre><span class="gd">-  let(:user) { create(:user, :manager) }</span>
<span class="gd">-  let!(:api_user_authentication) { create(:user_authentication, user: user) }</span>
<span class="gi">+  let(:manager) { create(:user, :manager) }</span>
<span class="gi">+  let!(:api_user_authentication) { create(:user_authentication, user: manager) }</span>
</pre></div>


<p>Thanks for reading and happy testing.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Sun 04 December 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/12/04/overridden-let-causes-segfault-with-rspec/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/11/30/highlights-from-ista-and-gtac-2016/" rel="bookmark" title="Permalink to Highlights from ISTA and GTAC 2016">
                <h2 class="post-title">
                    Highlights from ISTA and GTAC 2016
                </h2>
            </a>
                <p><img alt="ISTA 2016" src="/images/ista2016.jpg" title="ISTA 2016" /></p>
<p>Another two weeks have passed and I'm blogging about another 2 conferences.
This year both
<a href="https://istacon.org/">Innovations in Software Technologies and Automation</a> and
<a href="https://developers.google.com/google-test-automation-conference/2016/">Google Test Automation Conference</a>
happened on the same day. I was attending ISTA in Sofia during the day and
watching the live stream of GTAC during the evenings. Here are some of the things
that reflected on me:</p>
<ul>
<li>How can I build my software in order to make this a perfect day for the user ?</li>
<li>People are not the problem which causes bad software to exist. When designing
software focus on what people need not on what technology is forcing them to do;</li>
<li>You need to have blind trust in the people you work with because all the times
projects look like they are not going to work until the very end!</li>
<li>It's good to have diverse set of characters in the company and not homogenize people;</li>
<li>Team performance grows over time. Effective teams minimize time waste
during bad periods. They (have and) extract value from conflicts!</li>
<li>One-on-one meetings are usually like status reports which is bad. Both parties
should bring their own issues to the table;</li>
<li>To grow an effective team members need to do things together. For example
pair programming, writing test scenarios, etc;</li>
<li>When teams don't take actions after retrospective meetings it is usually a 
sign of missing foundational trust;</li>
<li>QA engineers need to be present at every step of the software development
life-cycle! This is something I teach my students and have been confirmed by
many friends in the industry;</li>
<li>Agile is all about data, even when it comes to testing and quality. We need to
decompose and measure iteratively;</li>
<li>Agile is also about really skillful people. One way to boost your skills is to
adopt the T-shaped specialist model;</li>
<li>In agile iterative work and continuous delivery is king so QA engineers need to focus
even more on visualization (I will also add documentation), refactoring and code reviews;</li>
<li>Agile teams need to give opportunities to team members for taking risk and taking
ownership of their actions in the gray zone (e.g. actions which isn't clear who should
be doing).</li>
</ul>
<p>In the brave new world of micro services end to end testing is no more! We test each level
in isolation but keep stable contracts/APIs between levels. That way we can reduce
the test burden and still guarantee an acceptable level of risk. This change in
software architecture (monolithic vs. micro) leads to change in technologies (one framework/language
vs. what's best for the task) which in turn leads to changes in testing approach and
testing tools. This ultimately leads to changing people on the team because they now
need different skills than when they were hired! This circles back to the T-shaped
specialist model and the fact that QA should be integrated in every step of the way!
Thanks to Denitsa Evtimova and Lyudmila Labova for this wisdom and the quote pictured
above.</p>
<p>Aneta Petkova talked about monitoring of test results which is a topic very close to my work.
Imagine you have your automated test suite but still get failures occasionally. Are these
bugs or something else broke ? If they are bugs and you are waiting for them to be fixed
do you execute the tests against the still broken build or wait ? If you do, what additional info
do you get from these executions vs. how much time do you spend figuring out
"oh, that's still not fixed or geez, here's another hidden bug in the code" ?</p>
<p>Her team has modified their test execution framework (what I'd usually call a test runner
or even test lab) to have knowledge about issues in JIRA and skip some tests
when no meaningful information can be extracted from them. I have to point out that this
approach may require a lot of maintenance in environments where you have failures due to
infrastructure issues. This idea connects very nicely
with the general idea behind this year's GTAC - don't run tests if you don't need to aka
smart test execution!</p>
<p><a href="https://www.youtube.com/watch?v=2yN53k9jz3U#t=2h54m0s">Boris Prikhodskiy</a>
shared a very simple rule. Don't execute tests</p>
<ul>
<li>which have 100 % pass rate;</li>
<li>during the last month;</li>
<li>and have been executed at least 100 times before that!</li>
</ul>
<p>This is what Unity does for their numerous topic branches and reduces test time
with 60-70 percent. All of the test suite is still executed against their trunk branch
and PR merge queue branches!</p>
<p>At GTAC there were several presentations about speeding up test execution time.
<a href="https://www.youtube.com/watch?v=hbocBqOpuAo#t=3h18m25s">Emanuil Slavov</a> was very practical
but the most important thing he said was that a fast test suite is the result of many
conscious actions which introduced small improvements over time. His team had assigned
themselves the task to iteratively improve their test suite performance and at every step
of the way they analyzed the existing bottlenecks and experimented with possible solutions.</p>
<p>The steps in particular are (on a single machine):</p>
<ul>
<li>Execute tests in dedicated environment;</li>
<li>Start with empty database, not used by anything else; This also leads to
adjustments in your test suite architecture and DB setup procedures;</li>
<li>Simulate and stub external dependencies like 3rd party services;</li>
<li>Move to containers but beware of slow disk I/O;</li>
<li>Run database in memory not on disk because it is a temporary DB anyway;</li>
<li>Don't clean test data, just trash the entire DB once you're done;</li>
<li>Execute tests in parallel which should be the last thing to do!</li>
<li>Equalize workload between parallel threads for optimal performance;</li>
<li>Upgrade the hardware (RAM, CPU) aka vertical scaling;</li>
<li>Add horizontal scaling (probably with a messaging layer);</li>
</ul>
<p><a href="https://www.youtube.com/watch?v=2yN53k9jz3U#t=6h38m7s">John Micco and Atif Memon</a>
talked about flaky tests at Google:</p>
<ul>
<li>84% of the transitions from PASS to FAIL are flakes;</li>
<li>Almost 16% of their 3.5 million tests have some level of flakiness;</li>
<li>Flaky failures frequently block and delay releases;</li>
<li>Google spends between 2% and 16% of their CI compute resources
re-running flaky tests;</li>
<li>Flakiness insertion speed is comparable to flakiness removal speed!</li>
<li>The optimal setting is 2 persons modifying the same source file at the same time.
This leads to minimal chance of breaking stuff;</li>
<li>Fix or delete flaky tests because you don't get meaningful value out of them.</li>
</ul>
<p>So Google want to stop a test execution before it is executed if historical
data shows that the test has attributes of flakiness. The research they talk
about utilizes tons of data collected from Google's CI environment which was
the most interesting fact for me. Indeed if we use data to decide which features
to build for our customers then why not use data to govern the process of testing?
In addition to the video you should read John's post
<a href="https://testing.googleblog.com/2016/05/flaky-tests-at-google-and-how-we.html">Flaky Tests at Google and How We Mitigate Them</a>.</p>
<p>At the end I'd like to finish with 
Rahul Gopinath's
<a href="https://www.youtube.com/watch?v=hbocBqOpuAo#t=4h57m30s">Code Coverage is a Strong Predictor of Test suite Effectiveness in the Real World</a>.
He basically said that code coverage metrics as we know them today are still
the best practical indicator of how good a test suite is. He argues that mutation testing is slow
and only provides additional 4% to a well designed test suite. This is absolutely the opposite of
what Laura Inozemtseva presented last year in her
<a href="https://www.youtube.com/watch?v=sAfROROGujU&amp;list=PLSIUOFhnxEiCWGsN9t5A-XOhRbmz54IS1&amp;index=25">Coverage is Not Strongly Correlated with Test Suite Effectiveness</a>
lightning talk. Rahul also made a point about sample size in the two research papers
and I had the impression he's saying Laura didn't do a proper academic research.</p>
<p>I'm a heavy contributor to Cosmic Ray, the mutation testing tool for Python and also use
mutation testing in my daily job so this is a very interesting topic indeed. I've asked
fellow tool authors to have a look at both presentations and share their opinions.
I also have an idea about a practical experiment to see if full branch coverage and
full mutation coverage will be able to find a known bug in a piece of software
I wrote. I will be writing about this experiment next week so stay tuned.</p>
<p>Thanks for reading and happy testing!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 30 November 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/11/30/highlights-from-ista-and-gtac-2016/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/11/02/it-weekend-highlights/" rel="bookmark" title="Permalink to IT Weekend Highlights">
                <h2 class="post-title">
                    IT Weekend Highlights
                </h2>
            </a>
                <p><img alt="IT Weekend" src="/images/itweekend_cake.jpg" title="IT Weekend" /></p>
<p>Last weekend I attended the third <a href="http://it-weekend.com">IT Weekend</a>.
It's like a training camp for athletes but for QA engineers. While during the
<a href="http://atodorov.org/blog/2016/10/08/what-i-learned-from-it-weekend/">first week</a> the crowd was more in
the junior to mid level range now the crowd was more into the senior level range
which made for better talks and discussions. The most interesting sessions
for me were <em>On-boarding of New Team Members</em> by Nikola Naidenov and
<em>Agile Leadership</em> by Bogoi Bogdanov. Here are some of the highlights
that I wrote down:</p>
<ul>
<li>On-boarding of new team members is very important. You need to have a plan for
their first 6 months at the company. This plan needs to have clearly defined tasks
and expectations;</li>
<li>When a person becomes productive for their team/company it means they have been
on-boarded successfully;</li>
<li>A company provided trainer is a good thing but they tend to focus on broader
knowledge, they don't cover team specific domain knowledge;</li>
<li>Some companies provide both technical and business trainers for their teams;</li>
<li>It is very important to get timely feedback when you are the one providing training.
However feedback isn't always easy to get and we don't always receive sincere feedback;</li>
<li>If the team is swamped with work tasks you need to provide 10-20% of the time
for learning and experimenting with new technologies. IMO this is best done by
filing tickets in your bug/task tracking system and prioritizing them together with
the rest of the tasks;</li>
<li>It is also important to have an individual training plan for each team member
and review this on a regular basis;</li>
<li>We should strive to use unified terminology and jargon as to not confuse
people. IMO it is usually the new hires who are likely to get confused because they
are not familiar with the history of the terms used;</li>
</ul>
<p>In an agile environment we calculate productivity using the formula</p>
<div class="highlight"><pre>Productivity = Effort * Competence * Environment * Motivation^2
</pre></div>


<p>There are 3 important factors that drive motivation</p>
<ul>
<li>to have a <strong>Purpose</strong></li>
<li>to feel <strong>Autonomy</strong></li>
<li>to be able to achieve <strong>Mastery</strong> in your skills</li>
</ul>
<p>It is also important to note that autonomy is not the opposite of alignment
as depicted by the image below.</p>
<p><img alt="Alignment and autonomy" src="/images/alignment_autonomy.jpg" title="alignment and autonomy" /></p>
<p>In agile environment control is a function of trust. To be able to trust people we
need to give them autonomy, transparency and short feedback loop!</p>
<ul>
<li>Manage for the normal treat exceptions as exceptional;</li>
<li>Failure recovery is more important than failure avoidance;</li>
<li>Fail fast means learning fast and improving fast.</li>
</ul>
<p>Thanks for reading and happy testing!</p>
<p><em>Photo credit: Rayna Stankova</em></p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 02 November 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/11/02/it-weekend-highlights/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/10/24/animate-automate/" rel="bookmark" title="Permalink to Animate & Automate">
                <h2 class="post-title">
                    Animate & Automate
                </h2>
            </a>
                <p>Recently I've attended a presentation by MentorMate where they talked about
testing CSS animations (
<a href="https://www.youtube.com/watch?v=MIxzzfFBR8o&amp;list=PLFjlI7p-h1hxBP3cIjEqePSeoBDHud5Db&amp;index=6">video in Bulgarian</a>
). The software under test was an ad tech SDK which
provides CSS based animations to mobile apps and games. The content
is displayed inside a webview and they had to make sure animations were
working correctly on different OS and devices.</p>
<p>Analyzing the content (aka getting to know the domain) they figured out
in reality there were about 20 basic movements and transformations. So the
problem was reduced to "How do we test these 20 basic movements under
various OSes and devices" or "How do we verify that basic CSS transformations
are supported under different versions and flavors of the OS"?</p>
<p>Their test bed included hand crafted web pages with each basic movement
and then several ones with more complex animations (aka integration testing).
The idea was to load
these pages under different devices and inspect whether or not the animations
were visualized properly.</p>
<p>A test script (aka their testing framework) was constantly recording the
coordinates of the elements under test to verify that they were really animated.
The idea was to use a sample rate of 20ms and expect at lest 20 different changes
to the element under test. Coordinates along with color and gradient were recorded
and then returned back and analyzed to report a PASS or FAIL result.</p>
<p>This simplistic framework has limitations of course. It is not currently checking
the boundaries of where the elements are rendered on the screen. Thus if everything
else works as expected this will be a false positive result. On their slides
this can be seen at <a href="https://youtu.be/MIxzzfFBR8o?t=23m10s">23:10</a>.</p>
<p>As a side note the entire effort took about 2 days, including research and preparing
the test content.</p>
<p>I really like the back to basics approach here and the simplistic framework that
MentorMate came up with. Sure it misses some problems but for that particular case
it is good enough, easy and fast to implement.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 24 October 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/10/24/animate-automate/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/10/08/what-i-learned-from-it-weekend/" rel="bookmark" title="Permalink to What I Learned from IT Weekend">
                <h2 class="post-title">
                    What I Learned from IT Weekend
                </h2>
            </a>
                <p><img alt="IT Weekend" src="/images/itweekend.png" title="IT Weekend" /></p>
<p>Last week I attended the first <a href="http://it-weekend.com">IT Weekend</a> in Bulgaria.
It's like a training camp for athletes but for QA engineers. There were 20 people
attending and the format was very friendly and relaxed. The group had members with
various levels of experience and technical skills, also different areas they work in.
All presentations are on
<a href="https://www.youtube.com/watch?v=iRA3tRwclRU&amp;list=PLFjlI7p-h1hxBP3cIjEqePSeoBDHud5Db&amp;index=1">YouTube</a>.
Here's a brief of what happened and what I learned.</p>
<p>I had the honor to present in the first slot and gave a quick introduction
to mutation testing. This was my first time giving this talk and I'm not entirely
happy with how I've presented it. Also mutation testing is touching a lot on unit tests,
programming and source code which in some organizations goes to the devel department.
I think mutation testing is harder to understand from people not familiar with it
than I initially thought. I'm taking note to improve the way I present this topic
to the public.</p>
<p>Yavor Donev gave a good overview of Appium and how to use it on Android.
The most important question for me was "<em>Is it possible to utilize the same test suite
on Android and iOS, given that the environments are different</em>". With this I mean
regardless of how much we try to make the same (native) app on both platforms
it will end up differently because the platforms are essentially different. For
example there is a different number of physical buttons available.</p>
<p>If we assume that both iOS and Android apps follow the same design and use
similar workflow then it should be possible to create a test suite which is
platform aware and account for the minor differences. We're also adding
another layer of complexity by introducing the requirement that both apps stay
in sync with each other and account for the quirks of the foreign platform.
Depending on your apps and goals this may not be an easy task!</p>
<p>The one thing I didn't like about Appium is that upstream doesn't care much about
version compatibility and they tend to break and change stuff arbitrary between
releases. That said if it works, don't update it or otherwise be extremely
careful.</p>
<p>I also had a nice chat with Yavor on the topic of career change, learning to
program and working with people who have very little coding experience. His
approach is to develop a higher level test framework on top of Appium which
his team mates can use more easily.</p>
<p>Aneta Petkova's <em>Selenium Grid in Unix Environment</em> is a bit out of my domain.
However I took one important lesson: regardless of how great your tools are
there are minor details which can make or break your day. In her case these
are the physical location of the tests (e.g. which Selenium node runs them) and
access to shared resources. Turns out WebDriver doesn't give you
this information directly and you need to go through hoops to get it. Her
solution was to place the test code on the Grid Hub and provide a shared file system.</p>
<p>The bigger lesson is: whenever you have to design an automated test environment
(aka test lab) make sure to evaluate your needs beforehand.</p>
<p>The last talk was a guest appearance by Denitsa Evtimova. She is a QA architect
with 16 years of experience and presented the QA strategy at Paysafe group.
They have a large monolithic system (legacy code) and have adopted a pyramid
style approach to testing. Whenever possible tests are brought down to the lowest
level (e.g. unit tests) and not repeated on the higher levels. At the top
stand manual testing. Teams are small: 3-4 developers and 2-3 QAs. It is the team
responsibility to make sure tests are implemented at the lowest possible level.
The process is not strictly enforced and the company relies more on self
governance in this aspect. Also everyone on the team can contribute
additional tests whenever they see something missing.
Test (writing) tasks are all logged in JIRA. They are also small so that
everything can be completed in the same day.</p>
<p>The second day was more informal. We did a quick exploratory testing
exercise and shared opinions on different test tools. Then the group had
a discussion about soft skills and how QA engineers can change the perception
of developers about the QA profession (especially in teams where there are many
manual testers). The key points are:</p>
<ul>
<li>Criticize the software, not the person, e.g. don't blame the person directly;</li>
<li>Communicate with concrete facts and data, not emotions and perceptions;</li>
<li>Jokes of the type "how many QA engineers are needed to screw a light bulb"
are a problem because they lead to underestimation of the job role;</li>
<li>Sometimes it is not quite clear (to others) how the QA role contributes to
the development of the product and the organization;</li>
<li>For a QA it is important to be able to give a non-biased opinion and
observations on what is happening with the product/process;</li>
<li>A QA person needs to be very calm. They have to be able to listen to
everybody (especially developers) and accept their point of view but at
the same time also communicate their own point of view.</li>
<li>It is important
to sit together with developers and observe the problem, brainstorm and
propose possible solutions. This also creates a feedback loop where the
developer feels empowered because he's part of the process identifying
the problem and proposing the best solution;</li>
<li>In agile teams it is a good idea to rotate people between developer and
QA positions. This will help them better understand the job of others,
acquire new skills and also bring fresh thinking to the team;</li>
<li>Quality Assurance is an ungrateful job and only people with very calm and methodical
thinking (to follow through and write all possible scenarios) are able to excel
in this field. On the other hand developer usually think about the happy path
scenarios and strive to make their code work as best as they can;</li>
<li>By rotating job roles within the team developers
will quickly find out that testing is not their field and gain respect
towards their QA peers;</li>
<li>US managers have the habit of telling "good job" to everyone, even for
small and routine tasks. In Bulgaria (and maybe elsewhere) we're not used
to this. Instead we're used of being scolded when we do something wrong.
If everything is good then we don't receive any recognition;</li>
<li>Using the American "good job" is actually a good thing. Team mates will
start performing better over time because they will feel their work is
valued and not meaningless, they will feel recognized which will boost
morale and productivity.</li>
</ul>
<p>Thanks for reading and happy testing!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Sat 08 October 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/10/08/what-i-learned-from-it-weekend/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/08/05/python-2-vs-python-3-list-sort-causes-bugs/" rel="bookmark" title="Permalink to Python 2 vs. Python 3 List Sort Causes Bugs">
                <h2 class="post-title">
                    Python 2 vs. Python 3 List Sort Causes Bugs
                </h2>
            </a>
                <p>Can sorting a list of values crash your software? Apparently it can and is
another example of my
<a href="http://atodorov.org/blog/2016/03/25/hello-world-qa-challenge/">Hello World Bugs</a>.
Python 3 has simplified the
<a href="https://docs.python.org/3/whatsnew/3.0.html#ordering-comparisons">rules for ordering comparisons</a>
which changes the behavior of sorting lists when their contents are dictionaries.
For example:</p>
<div class="highlight"><pre><span class="n">Python</span> <span class="mf">2.7</span><span class="o">.</span><span class="mi">5</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Oct</span> <span class="mi">11</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">16</span><span class="p">)</span> 
<span class="p">[</span><span class="n">GCC</span> <span class="mf">4.8</span><span class="o">.</span><span class="mi">3</span> <span class="mi">20140911</span> <span class="p">(</span><span class="n">Red</span> <span class="n">Hat</span> <span class="mf">4.8</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="mi">9</span><span class="p">)]</span> <span class="n">on</span> <span class="n">linux2</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="p">[{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;b&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}]</span> <span class="o">&lt;</span> <span class="p">[{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;b&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}]</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>


<div class="highlight"><pre><span class="n">Python</span> <span class="mf">3.5</span><span class="o">.</span><span class="mi">1</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Apr</span> <span class="mi">27</span> <span class="mi">2016</span><span class="p">,</span> <span class="mo">04</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">56</span><span class="p">)</span> 
<span class="p">[</span><span class="n">GCC</span> <span class="mf">4.8</span><span class="o">.</span><span class="mi">3</span> <span class="mi">20140911</span> <span class="p">(</span><span class="n">Red</span> <span class="n">Hat</span> <span class="mf">4.8</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="mi">9</span><span class="p">)]</span> <span class="n">on</span> <span class="n">linux</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;b&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}]</span> <span class="o">&lt;</span> <span class="p">[{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;b&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}]</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="n">unorderable</span> <span class="n">types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nb">dict</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>


<p>The problem is that the second elements in both lists have different keys
and Python doesn't know how to compare them. In earlier Python versions
this has been special cased as
<a href="http://stackoverflow.com/questions/3484293/is-there-a-description-of-how-cmp-works-for-dict-objects-in-python-2/3484456#3484456">described here</a>
by Ned Batchelder (the author of Python's coverage tool) but in Python 3
dictionaries have no natural sort order.</p>
<p>In the case of <em>django-chartit</em> (of which I'm now the official maintainer) this
bug triggers when you want to plot data from multiple sources (models) on the same
chart. In this case the fields coming from each data series are different and the
above error is triggered.</p>
<p>I have worked around this in
<a href="https://github.com/chartit/django-chartit/commit/9d9033ecd5a8592a12872293cdf6d710cebf894f">commit 9d9033e</a>
by simply disabling an iterator sort but this is sub-optimal and I'm not quite certain
what the side effect might be. I suspect you may end up with a chart where the order
of values on the X axis isn't the same for the different models, e.g. one graph plotting
the data in ascending order the other one in descending.</p>
<p>The trouble also comes from the fact that we're sorting an iterator (a list of fields) by
telling Python to use a list of dicts to determine the sort order. In this arrangement
there is no way to tell Python how we want to compare our dicts. The only solution I
can think about is creating a custom class and implementing a custom <code>__cmp__()</code> method
for this data structure!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 05 August 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/08/05/python-2-vs-python-3-list-sort-causes-bugs/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/07/23/phantomjs-211-in-ubuntu-different-from-upstream/" rel="bookmark" title="Permalink to PhantomJS 2.1.1 in Ubuntu different from upstream">
                <h2 class="post-title">
                    PhantomJS 2.1.1 in Ubuntu different from upstream
                </h2>
            </a>
                <p>For some time now I've been hitting
<a href="https://github.com/ariya/phantomjs/issues/12506">PhantomJS #12506</a> with the
latest 2.1.1 version. The problem is supposedly fixed in 2.1.0 but this is not
always the case. If you use a .deb package from the latest Ubuntu then the problem
still exists, see
<a href="https://bugs.launchpad.net/ubuntu/+source/phantomjs/+bug/1605628">Ubuntu #1605628</a>.</p>
<p>It turns out the root cause of this, and probably other problems, is the way
PhantomJS packages are built. Ubuntu builds the package against their stock
Qt5WebKit libraries which leads to</p>
<div class="highlight"><pre><span class="nv">$ </span>ldd usr/lib/phantomjs/phantomjs <span class="p">|</span> grep -i qt
    libQt5WebKitWidgets.so.5 <span class="o">=</span>&gt; /lib64/libQt5WebKitWidgets.so.5 <span class="o">(</span>0x00007f5173ebf000<span class="o">)</span>
    libQt5PrintSupport.so.5 <span class="o">=</span>&gt; /lib64/libQt5PrintSupport.so.5 <span class="o">(</span>0x00007f5173e4d000<span class="o">)</span>
    libQt5Widgets.so.5 <span class="o">=</span>&gt; /lib64/libQt5Widgets.so.5 <span class="o">(</span>0x00007f51737b6000<span class="o">)</span>
    libQt5WebKit.so.5 <span class="o">=</span>&gt; /lib64/libQt5WebKit.so.5 <span class="o">(</span>0x00007f5171342000<span class="o">)</span>
    libQt5Gui.so.5 <span class="o">=</span>&gt; /lib64/libQt5Gui.so.5 <span class="o">(</span>0x00007f5170df8000<span class="o">)</span>
    libQt5Network.so.5 <span class="o">=</span>&gt; /lib64/libQt5Network.so.5 <span class="o">(</span>0x00007f5170c9a000<span class="o">)</span>
    libQt5Core.so.5 <span class="o">=</span>&gt; /lib64/libQt5Core.so.5 <span class="o">(</span>0x00007f517080d000<span class="o">)</span>
    libQt5Sensors.so.5 <span class="o">=</span>&gt; /lib64/libQt5Sensors.so.5 <span class="o">(</span>0x00007f516b218000<span class="o">)</span>
    libQt5Positioning.so.5 <span class="o">=</span>&gt; /lib64/libQt5Positioning.so.5 <span class="o">(</span>0x00007f516b1d7000<span class="o">)</span>
    libQt5OpenGL.so.5 <span class="o">=</span>&gt; /lib64/libQt5OpenGL.so.5 <span class="o">(</span>0x00007f516b17c000<span class="o">)</span>
    libQt5Sql.so.5 <span class="o">=</span>&gt; /lib64/libQt5Sql.so.5 <span class="o">(</span>0x00007f516b136000<span class="o">)</span>
    libQt5Quick.so.5 <span class="o">=</span>&gt; /lib64/libQt5Quick.so.5 <span class="o">(</span>0x00007f5169dad000<span class="o">)</span>
    libQt5Qml.so.5 <span class="o">=</span>&gt; /lib64/libQt5Qml.so.5 <span class="o">(</span>0x00007f5169999000<span class="o">)</span>
    libQt5WebChannel.so.5 <span class="o">=</span>&gt; /lib64/libQt5WebChannel.so.5 <span class="o">(</span>0x00007f5169978000<span class="o">)</span>
</pre></div>


<p>While building from the upstream sources gives</p>
<div class="highlight"><pre><span class="nv">$ </span>ldd /tmp/bin/phantomjs <span class="p">|</span> grep -i qt
</pre></div>


<p>If you take a closer look at PhantomJS's sources you will notice there are
3 git submodules in their repository - <code>3rdparty</code>, <code>qtbase</code> and <code>qtwebkit</code>.
Then in their <code>build.py</code> you can clearly see that this local fork of <code>QtWebKit</code>
is built first, then the <code>phantomjs</code> binary is built against it.</p>
<p>The problem is that these custom forks include additional patches to make
WebKit suitable for Phantom's needs. And these patches are not available
in the stock WebKit library that Ubuntu uses.</p>
<blockquote>
<p>Yes, that's correct. We need additional functionality that
vanilla QtWebKit doesn't have. That's why we use custom version.</p>
<p>Vitaly Slobodin, PhantomJS</p>
</blockquote>
<p>At the moment of this writing Vitaly's qtwebkit fork is 28 commits ahead and
39 commits behind qt:dev. I'm surprised Ubuntu's PhantomJS even works.</p>
<p>The solution IMO is to bundle the additional sources into the src.deb package
and use the same building procedure as upstream.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Sat 23 July 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/07/23/phantomjs-211-in-ubuntu-different-from-upstream/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/07/15/on-python-infinite-loops/" rel="bookmark" title="Permalink to On Python Infinite Loops">
                <h2 class="post-title">
                    On Python Infinite Loops
                </h2>
            </a>
                <p>How do you write an endless loop without using <code>True</code>, <code>False</code>, number constants
and comparison operators in Python ?</p>
<p>I've been working on the mutation test tool
<a href="https://github.com/sixty-north/cosmic-ray">Cosmic Ray</a> and discovered that it
was missing a boolean replacement operator, that is an operator which will switch
<code>True</code> to <code>False</code> and vice versa, so I wrote one. I've also added some tests to
Cosmic Ray's test suite and then I hit the infinite loop problem.
CR's test suite contains the following code inside a module called <code>adam.py</code></p>
<div class="highlight"><pre><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">break</span>
</pre></div>


<p>The test suite executes mutations on <code>adam.py</code> and then runs some tests which
it expects to fail. During execution one of the mutations is
<code>replace break with continue</code> which makes the above loop infinite. The test suite
times out after a while and kills the mutation. Everything fails as expected and
we're good.</p>
<p>Adding my boolean replacement operator broke this function. All of the other mutations
work as expected but then the loop becomes</p>
<div class="highlight"><pre><span class="k">while</span> <span class="bp">False</span><span class="p">:</span>
    <span class="k">break</span>
</pre></div>


<p>When we test this particular mutation there is no infinite loop so Cosmic Ray's
test suite doesn't time out like it should and an error is reported.</p>
<div class="highlight"><pre>job ID 25:Outcome.SURVIVED:adam
command: cosmic-ray worker adam boolean_replacer 2 unittest -- tests
<span class="gd">--- mutation diff ---</span>
<span class="gd">--- a/home/travis/build/MrSenko/cosmic-ray/test_project/adam.py</span>
<span class="gi">+++ b/home/travis/build/MrSenko/cosmic-ray/test_project/adam.py</span>
<span class="gu">@@ -32,6 +32,6 @@</span>
     return x
 
 def trigger_infinite_loop():
<span class="gd">-    while True:</span>
<span class="gi">+    while False:</span>
         break
</pre></div>


<p>So the question becomes how to write the loop condition in such a way that nothing
will mutate it but it will still remain true so that when <code>break</code> becomes <code>continue</code>
this piece of code will become an infinite loop ? Using <code>True</code> or <code>False</code> constants
obviously is a no go. Same goes for numeric constants, e.g. <code>1</code> or comparison
operators like <code>&gt;</code>, <code>&lt;</code>, <code>is</code>, <code>not</code>, etc. - all of them will be mutated and will
break the loop condition.</p>
<p>So I took a look at the docs for
<a href="https://docs.python.org/2.4/lib/truth.html">truth value testing</a> and discovered
<a href="https://github.com/sixty-north/cosmic-ray/pull/155">my solution</a>:</p>
<div class="highlight"><pre><span class="k">while</span> <span class="nb">object</span><span class="p">():</span>
    <span class="k">break</span>
</pre></div>


<p>I'm creating an object instance here which will not be mutated by any of the
existing mutation operators.</p>
<p>Thanks for reading and happy testing!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 15 July 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/07/15/on-python-infinite-loops/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/07/13/bug-in-tuxcon-website/" rel="bookmark" title="Permalink to Bug in TuxCon Website">
                <h2 class="post-title">
                    Bug in TuxCon Website
                </h2>
            </a>
                <p><img alt="TuxCon bug" src="/images/bugs/tuxcon_bug.png" title="TuxCon bug" /></p>
<p>Here comes July 9th 2016 and the start of <a href="http://tuxcon.mobi">TuxCon</a> ...
with a bug on their website! The image above is taken during the first
talk of the conference. Obviously the count down timer is completely off.</p>
<p>In
<a href="https://github.com/TuxCon/tuxcon-website/blob/master/js/init.js#L100">init.js:100</a>
there is this piece of code</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">finalDate</span> <span class="o">=</span> <span class="s1">&#39;2016/07/09&#39;</span><span class="p">;</span>

<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div#counter&#39;</span><span class="p">).</span><span class="nx">countdown</span><span class="p">(</span><span class="nx">finalDate</span><span class="p">)</span>
<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update.countdown&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">strftime</span><span class="p">(</span><span class="s1">&#39;&lt;span&gt;%D &lt;em&gt;days&lt;/em&gt;&lt;/span&gt;&#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;&lt;span&gt;%H &lt;em&gt;hours&lt;/em&gt;&lt;/span&gt;&#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;&lt;span&gt;%M &lt;em&gt;minutes&lt;/em&gt;&lt;/span&gt;&#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;&lt;span&gt;%S &lt;em&gt;seconds&lt;/em&gt;&lt;/span&gt;&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>


<p>It counts backwards and updates the HTML until <code>finalDate</code> is reached. Then
the HTML is no longer updated and the default values are shown, which in
this case are non zero. A simple
<a href="https://github.com/TuxCon/tuxcon-website/pull/1">patch</a> fixes the problem.</p>
<p>Initialize your variables properly and happy testing!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 13 July 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/07/13/bug-in-tuxcon-website/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/07/12/testing-the-8-bit-computer-puldin/" rel="bookmark" title="Permalink to Testing the 8-bit computer Puldin">
                <h2 class="post-title">
                    Testing the 8-bit computer Puldin
                </h2>
            </a>
                <p><img alt="Puldin creators" src="/images/puldin_creators.jpg" title="Puldin creators" /></p>
<p>Last weekend I visited <a href="http://tuxcon.mobi">TuxCon</a> in Plovdiv and
was very happy to meet and talk to some of the creators of the Puldin
computer! On the picture above are (left to right) Dimitar Georgiev
- wrote the text editor, Ivo Nenov - BIOS, DOS and core OS developer,
Nedyalko Todorov - director of the vendor company and Orlin Shopov -
BIOS, DOS, compiler and core OS developer.</p>
<p>Puldin is 100% pure Bulgarian development, while the “Pravetz” brand
was copy of Apple ][ (Pravetz 8A, 8C, 8M), Oric (Pravets 8D) and IBM-PC
(Pravetz 16). The Puldin computers were build from scratch both hardware
and software and were produced in Plovdiv in the late 80s and early 90s.
50000 pieces were made, at least 35000 of them have been exported to Russia
and paid for. A typical configuration in a Russian class room consisted of
several Puldin computers and a single Pravetz 16. According to Russian sources
the last usage of these computers was in 2003 serving as Linux terminals
and being maintained without any support from the vendor
(b/c it ceased to exist).</p>
<p><img alt="Puldin 601" src="/images/puldin601.jpg" title="Puldin 601" /></p>
<p>One of the main objectives of Puldin was full compatibility with IBM-PC.
At the time IBM had been releasing extensive documentation about how their
software and hardware works which has been used by Puldin's creators as
their software specs. Despite IBM-PC using faster CPU the Puldin 601 had
a comparable performance due to aggressive software and compiler optimizations.</p>
<p>Testing wise the guys used to compare Puldin's functionality with that of IBM-PC.
It was a hard requirement to have full compatibility on the file storage layer,
that means floppy disks written on Puldin had to be readable on IBM-PC and vice
versa. Same goes for programs compiled on Puldin - they had to execute on IBM-PC.</p>
<p>Everything of course had been tested manually and on top of that all the software
had to be burned to ROM before you can do anything with it. As you can imagine the
testing process had been quite slow and painful compared to today's standards.
I've asked the guys if they'd happened to find a bug in IBM-PC which wasn't present
in their code but they couldn't remember.</p>
<p>What was interesting for me on the hardware side was the fact that you can plug
the computer directly to a cheap TV set and that it's been one of the first computers
which could operate on 12V DC, powered directly from a car battery.</p>
<p><img alt="Pravetz 8" src="/images/pravetz16.jpg" title="Pravetz 8" /></p>
<p>There was also a fully functional Pravetz 8 with an additional VGA port to
connect it to the LCD monitor as well as a SD card reader wired to function as a
floppy disk reader (the small black dot behind the joystick).</p>
<p>For those who missed it (and understand Bulgarian) I have a
<a href="https://www.youtube.com/watch?v=uFGnrqa2RSY&amp;list=PLFjlI7p-h1hxBP3cIjEqePSeoBDHud5Db&amp;index=1">video recording on YouTube</a>.
For more info about the history and the hardware please check-out
<a href="https://olimex.wordpress.com/2015/01/12/retro-computer-puldin-the-only-bulgarian-8-bit-computer-developed-from-scratch/">Olimex post on Puldin</a>
(in English). For more info on Puldin and Pravetz please visit
<a href="http://pyldin.info">pyldin.info</a> (in Russian) and
<a href="http://pravetz8.com">pravetz8.com</a> (in Bulgarian)
using Google translate if need be.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 12 July 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/07/12/testing-the-8-bit-computer-puldin/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/07/06/testing-data-structures-in-pykickstart/" rel="bookmark" title="Permalink to Testing Data Structures in Pykickstart">
                <h2 class="post-title">
                    Testing Data Structures in Pykickstart
                </h2>
            </a>
                <p>When designing automated test cases we often think either about increasing
coverage or in terms of testing more use-cases aka behavior scenarios. Both
are valid approaches to improve testing and both of them seem to focus
around execution control flow (or business logic). However program behavior
is sometimes controlled via the contents of its data structures and this is
something which is rarely tested. </p>
<p>In
<a href="https://github.com/rhinstaller/pykickstart/pull/26#discussion_r32790705">this comment</a>
Brian C. Lane and Vratislav Podzimek from Red Hat are talking about a data structure
which maps Fedora versions to particular implementations of kickstart commands.
For example</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">RHEL7Handler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">RHEL7</span>

    <span class="n">commandMap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;auth&quot;</span><span class="p">:</span> <span class="n">commands</span><span class="o">.</span><span class="n">authconfig</span><span class="o">.</span><span class="n">FC3_Authconfig</span><span class="p">,</span>
        <span class="s">&quot;authconfig&quot;</span><span class="p">:</span> <span class="n">commands</span><span class="o">.</span><span class="n">authconfig</span><span class="o">.</span><span class="n">FC3_Authconfig</span><span class="p">,</span>
        <span class="s">&quot;autopart&quot;</span><span class="p">:</span> <span class="n">commands</span><span class="o">.</span><span class="n">autopart</span><span class="o">.</span><span class="n">F20_AutoPart</span><span class="p">,</span>
        <span class="s">&quot;autostep&quot;</span><span class="p">:</span> <span class="n">commands</span><span class="o">.</span><span class="n">autostep</span><span class="o">.</span><span class="n">FC3_AutoStep</span><span class="p">,</span>
        <span class="s">&quot;bootloader&quot;</span><span class="p">:</span> <span class="n">commands</span><span class="o">.</span><span class="n">bootloader</span><span class="o">.</span><span class="n">RHEL7_Bootloader</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>


<p>In their particular case the Fedora 21 <code>logvol</code> implementation introduced the
<code>--profile</code> parameter but in
Fedora 22 and Fedora 23 the <code>logvol</code> command mapped to the Fedora 20 implementation and the
<code>--profile</code> parameter wasn't available. This is unexpected change in program behavior
although the <code>logvol.py</code> and <code>handlers/f22.py</code> files have
<a href="https://github.com/atodorov/pykickstart-coverage/blob/master/coverage-report.log">99% and 100% code coverage</a>.</p>
<p>This morning I did some coding and created an automated test for this problem. The test
iterates over all command maps. For each command in the map (that is data structure member)
we load the module which provides all possible implementations for that command. In the
loaded module
we search for implementations which have newer versions than what is in the map,
but not newer than the current Fedora version under test. With a little bit of pruning
the current list of offenses is</p>
<div class="highlight"><pre><span class="n">ERROR</span><span class="o">:</span> <span class="n">In</span> <span class="err">`</span><span class="n">handlers</span><span class="o">/</span><span class="n">devel</span><span class="o">.</span><span class="na">py</span><span class="err">`</span> <span class="n">the</span> <span class="s2">&quot;fcoe&quot;</span> <span class="n">command</span> <span class="n">maps</span> <span class="n">to</span> <span class="s2">&quot;F13_Fcoe&quot;</span> <span class="k">while</span> <span class="k">in</span>
<span class="err">`</span><span class="n">pykickstart</span><span class="o">.</span><span class="na">commands</span><span class="o">.</span><span class="na">fcoe</span><span class="err">`</span> <span class="n">there</span> <span class="k">is</span> <span class="n">newer</span> <span class="n">implementation</span><span class="o">:</span> <span class="s2">&quot;RHEL7_Fcoe&quot;</span><span class="o">.</span>

<span class="n">ERROR</span><span class="o">:</span> <span class="n">In</span> <span class="err">`</span><span class="n">handlers</span><span class="o">/</span><span class="n">devel</span><span class="o">.</span><span class="na">py</span><span class="err">`</span> <span class="s2">&quot;FcoeData&quot;</span> <span class="n">maps</span> <span class="n">to</span> <span class="s2">&quot;F13_FcoeData&quot;</span> <span class="k">while</span> <span class="k">in</span>
<span class="err">`</span><span class="n">pykickstart</span><span class="o">.</span><span class="na">commands</span><span class="o">.</span><span class="na">fcoe</span><span class="err">`</span> <span class="n">there</span> <span class="k">is</span> <span class="n">newer</span> <span class="n">implementation</span><span class="o">:</span> <span class="s2">&quot;RHEL7_FcoeData&quot;</span><span class="o">.</span>

<span class="n">ERROR</span><span class="o">:</span> <span class="n">In</span> <span class="err">`</span><span class="n">handlers</span><span class="o">/</span><span class="n">devel</span><span class="o">.</span><span class="na">py</span><span class="err">`</span> <span class="n">the</span> <span class="s2">&quot;user&quot;</span> <span class="n">command</span> <span class="n">maps</span> <span class="n">to</span> <span class="s2">&quot;F19_User&quot;</span> <span class="k">while</span> <span class="k">in</span>
<span class="err">`</span><span class="n">pykickstart</span><span class="o">.</span><span class="na">commands</span><span class="o">.</span><span class="na">user</span><span class="err">`</span> <span class="n">there</span> <span class="k">is</span> <span class="n">newer</span> <span class="n">implementation</span><span class="o">:</span> <span class="s2">&quot;F24_User&quot;</span><span class="o">.</span>

<span class="n">ERROR</span><span class="o">:</span> <span class="n">In</span> <span class="err">`</span><span class="n">handlers</span><span class="o">/</span><span class="n">f24</span><span class="o">.</span><span class="na">py</span><span class="err">`</span> <span class="n">the</span> <span class="s2">&quot;user&quot;</span> <span class="n">command</span> <span class="n">maps</span> <span class="n">to</span> <span class="s2">&quot;F19_User&quot;</span> <span class="k">while</span> <span class="k">in</span>
<span class="err">`</span><span class="n">pykickstart</span><span class="o">.</span><span class="na">commands</span><span class="o">.</span><span class="na">user</span><span class="err">`</span> <span class="n">there</span> <span class="k">is</span> <span class="n">newer</span> <span class="n">implementation</span><span class="o">:</span> <span class="s2">&quot;F24_User&quot;</span><span class="o">.</span>

<span class="n">ERROR</span><span class="o">:</span> <span class="n">In</span> <span class="err">`</span><span class="n">handlers</span><span class="o">/</span><span class="n">f22</span><span class="o">.</span><span class="na">py</span><span class="err">`</span> <span class="n">the</span> <span class="s2">&quot;logvol&quot;</span> <span class="n">command</span> <span class="n">maps</span> <span class="n">to</span> <span class="s2">&quot;F20_LogVol&quot;</span> <span class="k">while</span> <span class="k">in</span>
<span class="err">`</span><span class="n">pykickstart</span><span class="o">.</span><span class="na">commands</span><span class="o">.</span><span class="na">logvol</span><span class="err">`</span> <span class="n">there</span> <span class="k">is</span> <span class="n">newer</span> <span class="n">implementation</span><span class="o">:</span> <span class="s2">&quot;F21_LogVol&quot;</span><span class="o">.</span>

<span class="n">ERROR</span><span class="o">:</span> <span class="n">In</span> <span class="err">`</span><span class="n">handlers</span><span class="o">/</span><span class="n">f22</span><span class="o">.</span><span class="na">py</span><span class="err">`</span> <span class="s2">&quot;LogVolData&quot;</span> <span class="n">maps</span> <span class="n">to</span> <span class="s2">&quot;F20_LogVolData&quot;</span> <span class="k">while</span> <span class="k">in</span>
<span class="err">`</span><span class="n">pykickstart</span><span class="o">.</span><span class="na">commands</span><span class="o">.</span><span class="na">logvol</span><span class="err">`</span> <span class="n">there</span> <span class="k">is</span> <span class="n">newer</span> <span class="n">implementation</span><span class="o">:</span> <span class="s2">&quot;F21_LogVolData&quot;</span><span class="o">.</span>

<span class="n">ERROR</span><span class="o">:</span> <span class="n">In</span> <span class="err">`</span><span class="n">handlers</span><span class="o">/</span><span class="n">f18</span><span class="o">.</span><span class="na">py</span><span class="err">`</span> <span class="n">the</span> <span class="s2">&quot;network&quot;</span> <span class="n">command</span> <span class="n">maps</span> <span class="n">to</span> <span class="s2">&quot;F16_Network&quot;</span> <span class="k">while</span> <span class="k">in</span>
<span class="err">`</span><span class="n">pykickstart</span><span class="o">.</span><span class="na">commands</span><span class="o">.</span><span class="na">network</span><span class="err">`</span> <span class="n">there</span> <span class="k">is</span> <span class="n">newer</span> <span class="n">implementation</span><span class="o">:</span> <span class="s2">&quot;F18_Network&quot;</span><span class="o">.</span>
</pre></div>


<p>The first two are possibly false negatives or related to the naming conventions used
in this module. However the rest appear to be legitimate problems. The <code>user</code> command
has introduced the <code>--groups</code> parameter in Fedora 24 (devel is Fedora 25 currently) but the
parser will fail to recognize this parameter. The <code>logvol</code> problem is recognized as well
since it was never patched. And the Fedora 18 <code>network</code> command implements a new property called
<code>hostname</code> which has probably never been available to be used.</p>
<p>You can follow my current work in
<a href="https://github.com/rhinstaller/pykickstart/pull/91">PR #91</a> and happy testing your
data structures.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 06 July 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/07/06/testing-data-structures-in-pykickstart/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/06/09/dont-upgrade-galaxy-s5-to-android-60/" rel="bookmark" title="Permalink to Don't Upgrade Galaxy S5 to Android 6.0">
                <h2 class="post-title">
                    Don't Upgrade Galaxy S5 to Android 6.0
                </h2>
            </a>
                <p>Samsung is shipping out buggy software like a boss, no doubt about it.
I've written a bit about <a href="http://atodorov.org/blog/categories/samsung/">their bugs</a> previously.
However I didn't expect them to release Android 6.0.1 and render my
<a href="http://amzn.to/1tiiqze">Galaxy S5</a> completely useless with respect
to the feature I use the most.</p>
<p><img alt="Lockscreen" src="/images/samsung/lockscreen_bug.jpg" title="Lockscreen" /></p>
<h2>Tell me the weather for Brussels</h2>
<p>So on Monday I've let Android upgrade to 6.0.1 to be completely surprised
that the lockscreen shows the weather report for Brussels, while
I'm based in Sofia. I've checked <em>AccuWeather</em> (I did go to
<a href="http://atodorov.org/blog/2016/02/02/fosdem-2016-report/">Brussels earlier this year</a>)
but it displayed only Sofia and Thessaloniki. To get rid of this widget
go to <code>Settings -&gt; Lockscreen -&gt; Additional information</code> and turn it off!</p>
<p>I think this weather report comes from GPS/Location based data, which I
have turned off by default but did use a while back ago. After turning
the widget off and back on it didn't appear on the lockscreen. I suspect
they fall back to showing the last good known value when data is missing
instead of handling the error properly.</p>
<h2>Apps are gone</h2>
<p>Some of my installed apps are missing now. So far I've noticed that the
<em>Gallery</em> and <em>S Health</em> icons have disappeared from my homescreen. I think
<em>S Health</em> came from Samsung's app store but still they shouldn't have removed
it silently. Now I wonder what happened to my data.</p>
<p>I don't see why <em>Gallery</em> was removed though. The only way to view pictures
is to use the camera app preview functionality which is kind of grose.</p>
<h2>Grayscale in powersafe mode is gone</h2>
<p>The killer feature on these higher end Galaxy devices is the <em>Powersafe mode</em>
and <em>Ultra Powersafe mode</em>. I use them a lot and by default have my phone in
<em>Powersafe mode</em> with grayscale colors enabled. It is easier on the eyes and
also safes your battery.</p>
<p><strong>NOTE:</strong> grayscale colors don't affect some displays but these devices use
AMOLED screens which need different amounts of power to display different
colors. More black means less power required!</p>
<p>After the upgrade grayscale is no more. There's not even an on/off switch.
I've managed to find a workaround though. First you need to enable developer mode
by tapping 7 times on <code>About device -&gt; Build number</code>. Then go to
<code>Settings -&gt; Developer options</code>, look for the <code>Hardware Accelerated Rendering</code>
section and select <code>Simulate Color Space -&gt; Monochromacy</code>! This is a bit ugly
hack and doesn't have the convenience of turning colors on/off by tapping
the quick Powersafe mode button at the top of the screen!</p>
<p>It looks like Samsung didn't think this upgrade well enough or didn't test it
well enough ? In my line of work (installation and upgrade testing) I've rarely
seen such a big blunder. Thanks for reading and happy testing!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 09 June 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/06/09/dont-upgrade-galaxy-s5-to-android-60/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/06/03/how-to-hire-software-testers-pt-3/" rel="bookmark" title="Permalink to How To Hire Software Testers, Pt. 3">
                <h2 class="post-title">
                    How To Hire Software Testers, Pt. 3
                </h2>
            </a>
                <p>In previous posts (links below) I have described my process of interviewing
QA candidates. Today I'm quoting an excerpt from the book
<a href="http://it-interviews.com/">Mission: My IT career</a>(Bulgarian only) by Ivaylo Hristov,
one of <a href="http://komfo.com">Komfo</a>'s co-founders.</p>
<p><img alt="Fedora pen" src="/images/fedora/pen.png" title="Fedora pen" /></p>
<p>He writes</p>
<div class="highlight"><pre>Probably the most important personal trait of a QA engineer is to
be able to think outside given boundaries and prejudices
(about software that is). When necessary to be non-conventional and
apply different approaches to the problems being solved. This will help
them find defect which nobody else will notice.

Most often errors/mistakes in software development are made due to
wrong expectations or wrong assumptions. Very often this happens because
developers hope their software will be used in one particular way
(as it was designed to) or that a particular set of data will be returned.
Thus the skill to think outside the box is the most important skill
we (as employers) are looking to find in a QA candidate. At job interviews
you can expect to be given tasks and questions which examine those skills.
</pre></div>


<h2>How would you test a pen?</h2>
<p>This is Ivaylo's favorite question for QA candidates. He's looking for
attention to details and knowing when to stop testing. Some of the possible
answers related to core functionality are</p>
<ul>
<li>Does the pen write in the correct color</li>
<li>Does the color fades over time</li>
<li>Does the pen operate normally at various temperatures? What temperature
  intervals would you choose for testing</li>
<li>Does the pen operate normally at various atmospheric pressure</li>
<li>When writing, does the pen leave excessive ink</li>
<li>When writing, do you get a continuous line or not</li>
<li>What pressure does the user need to apply in order to write a
  continuous line</li>
<li>What surfaces can the pen write on? What surfaces would you test</li>
<li>Are you able to write on a piece of paper if there is something soft underneath</li>
<li>What is the maximum inclination angle at which the pen is able to write
  without problems</li>
<li>Does the ink dry fast</li>
<li>If we spill different liquids onto a sheet of paper, on which we had written
  something, does the ink stay intact or smear</li>
<li>Can you use pencil rubber to erase the ink? What else would you test</li>
<li>How long can you write before we run out of ink</li>
<li>How fat is the ink line</li>
</ul>
<p>Then Ivaylo gives a few more non-obvious answers</p>
<ul>
<li>Verify that all labels on the pen/ink cartridge are correctly spelled
  and how durable they are (try to erase them)</li>
<li>Strength test - what is the maximum height you can drop the pen from
  without breaking it</li>
<li>Verify that dimensions are correct</li>
<li>Test if the pen keeps writing after not being used for some time
  (how long)</li>
<li>Testing individual pen components under different temperature and
  atmospheric conditions</li>
<li>Verify that materials used to make the pen are safe, e.g. when you put
  the pen in your mouth</li>
</ul>
<p>When should you stop ? According to the book there can be between 50 and 100
test cases for a single pen, maybe more. It's not a good sign if you stop at
the first 3!</p>
<p>If you want to know what skills are revealed via these questions please
read my other posts on the topic:</p>
<ul>
<li><a href="http://atodorov.org/blog/2016/04/12/how-to-hire-software-testers-pt-1/">The login form question</a></li>
<li><a href="http://atodorov.org/blog/2016/04/16/how-to-hire-software-testers-pt-2/">How do you test a Sudoku solver</a></li>
</ul>
<p>Thanks for reading and happy testing!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 03 June 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/06/03/how-to-hire-software-testers-pt-3/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/05/31/capybaras-findclick-doesnt-always-fire-onclick/" rel="bookmark" title="Permalink to Capybara's find().click doesn't always fire onClick">
                <h2 class="post-title">
                    Capybara's find().click doesn't always fire onClick
                </h2>
            </a>
                <p>Recently I've observed a strange behavior in one of the test suites I'm
working with - a test which submits a web form appeared to fail at a rate
between 10% and 30%. This immediately made me think there is some kind of
race-condition but it turned out that Capybara's <code>find().click</code> method
doesn't always fire the onClick event in the browser!</p>
<p>The test suite uses Capybara, Poltergeist and PhantomJS. The element we
click on is an image, coupled to a hidden check-box underneath. When the image
is clicked onClick is fired and the check-box is updated accordingly. In the
failed cases the underlying check-box wasn't updated!
Searching the web reveals a similar problem described by
<a href="http://aokolish.me/blog/2012/01/22/testing-hover-events-with-capybara/">Alex Okolish</a>
so we've tried his solution:</p>
<div class="highlight"><pre><span class="n">div</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.replacement&#39;</span><span class="p">,</span> <span class="ss">visible</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="ss">:click</span><span class="p">)</span>
</pre></div>


<h2>How to Test</h2>
<p>The failure behavior being somewhat flaky I've opted for running the
test multiple times and see what happens when it fails. Initially I've
executed the test in batches of 10 and 20 repetitions to get a feeling
of how often does it fail before proceeding with debugging. Debugging
was done by logging variables and state on the console and repeating
multiple times. Once a possible solution was
proposed we've run the tests in batches of 100 repetitions and counted
how often they failed.</p>
<p>At the end, when Alex's solution was discovered we've repeated the
testing around 1000 times just to make sure it works reliably.
So far this has been working without issues!</p>
<p>I've spent around a week working on this together with a co-worker
and we didn't really want to spend more time trying to figure out
what was going wrong with our tools. Once we saw that <code>trigger</code> does
the job we didn't continue debugging Capybara or PhantomJS.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 31 May 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/05/31/capybaras-findclick-doesnt-always-fire-onclick/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/04/27/changing-rails-consider_all_requests_local-in-rspec-fails/" rel="bookmark" title="Permalink to Changing Rails consider_all_requests_local in RSpec fails">
                <h2 class="post-title">
                    Changing Rails consider_all_requests_local in RSpec fails
                </h2>
            </a>
                <p>As many others I've been trying to change
<code>Rails.application.config.consider_all_requests_local</code> and
<code>Rails.application.config.action_dispatch.show_exceptions</code> inside my
RSpec tests in order to test custom error pages in a Rails app. However this
doesn't work. My code looked like this</p>
<div class="highlight"><pre><span class="n">feature</span> <span class="s1">&#39;Exceptions&#39;</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">action_dispatch</span><span class="o">.</span><span class="n">show_exceptions</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">consider_all_requests_local</span> <span class="o">=</span> <span class="kp">false</span>
  <span class="k">end</span>
</pre></div>


<p>This works only if I execute <code>exceptions_spec.rb</code> alone. However when something
else executes before that it fails. The config values are
correctly updated but that doesn't seem to have effect.</p>
<p>The answer and solution comes from
<a href="http://thepugautomatic.com/2014/08/404-with-rails-4/#comment-1714338343">Henrik N</a>.</p>
<blockquote>
<p>action_dispatch.show_exceptions gets copied and cached in
Rails.application.env_config, so even if you change
Rails.application.config.action_dispatch.show_exceptions in this
before block the value isn't what you expect when it's used in
ActionDispatch::DebugExceptions.</p>
</blockquote>
<p>In fact <code>DebugExceptions</code> uses <code>env['action_dispatch.show_exceptions']</code>. The
correct code should look like this</p>
<div class="highlight"><pre><span class="n">before</span> <span class="k">do</span>
  <span class="nb">method</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="ss">:env_config</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:env_config</span><span class="p">)</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="n">no_args</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">method</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
      <span class="s1">&#39;action_dispatch.show_exceptions&#39;</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
      <span class="s1">&#39;action_dispatch.show_detailed_exceptions&#39;</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span>
      <span class="s1">&#39;consider_all_requests_local&#39;</span> <span class="o">=&gt;</span> <span class="kp">false</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>


<p>This allows the test to work regardless of the order of execution
of spec files. I don't know why but I also had to leave
<code>show_detailed_exceptions</code> otherwise I wasn't getting the desired results.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 27 April 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/04/27/changing-rails-consider_all_requests_local-in-rspec-fails/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/04/26/mismatch-in-pyparted-interfaces/" rel="bookmark" title="Permalink to Mismatch in Pyparted Interfaces">
                <h2 class="post-title">
                    Mismatch in Pyparted Interfaces
                </h2>
            </a>
                <p>Last week my co-worker Marek Hruscak, from Red Hat, found an interesting case of
mismatch between the two interfaces provided by pyparted. In this article
I'm going to give an example, using simplified code and explain what is
happening. From pyparted's documentation we learn the following</p>
<blockquote>
<p>pyparted is a set of native Python bindings for libparted.  libparted is the
library portion of the GNU parted project.  With pyparted, you can write
applications that interact with disk partition tables and filesystems.</p>
<p>The Python bindings are implemented in two layers.  Since libparted itself
is written in C without any real implementation of objects, a simple 1:1
mapping of externally accessible libparted functions was written.  This
mapping is provided in the _ped Python module.  You can use that module if
you want to, but it's really just meant for the larger parted module.</p>
<div class="highlight"><pre><span class="nx">_ped</span>       <span class="nx">libparted</span> <span class="nx">Python</span> <span class="nx">bindings</span><span class="p">,</span> <span class="nx">direct</span> <span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">mapping</span>
<span class="nx">parted</span>     <span class="nx">Native</span> <span class="nx">Python</span> <span class="nx">code</span> <span class="nx">building</span> <span class="nx">on</span> <span class="nx">_ped</span><span class="p">,</span> <span class="nx">complete</span> <span class="kd">with</span> <span class="nx">classes</span><span class="p">,</span>
           <span class="nx">exceptions</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">advanced</span> <span class="nx">functionality</span><span class="p">.</span>
</pre></div>


</blockquote>
<p>The two interfaces are the <code>_ped</code> and <code>parted</code> modules. As a user I expect them
to behave exactly the same but they don't. For example some partition properties
are read-only in libparted and <code>_ped</code> but not in <code>parted</code>. This is the mismatch
I'm talking about.</p>
<p>Consider the following tests (also available on
<a href="https://github.com/atodorov/pyparted/tree/not_read_only_demo">GitHub</a>)</p>
<div class="highlight"><pre><span class="gh">diff --git a/tests/baseclass.py b/tests/baseclass.py</span>
<span class="gh">index 4f48b87..30ffc11 100644</span>
<span class="gd">--- a/tests/baseclass.py</span>
<span class="gi">+++ b/tests/baseclass.py</span>
<span class="gu">@@ -168,6 +168,12 @@ class RequiresPartition(RequiresDisk):</span>
         self._part = _ped.Partition(disk=self._disk, type=_ped.PARTITION_NORMAL,
         self._part = _ped.Partition(disk=self._disk, type=_ped.PARTITION_NORMAL,
                                     start=0, end=100, fs_type=_ped.file_system_type_get(&quot;ext2&quot;))
 
<span class="gi">+        geom = parted.Geometry(self.device, start=100, length=100)</span>
<span class="gi">+        fs = parted.FileSystem(type=&#39;ext2&#39;, geometry=geom)</span>
<span class="gi">+        self.part = parted.Partition(disk=self.disk, type=parted.PARTITION_NORMAL,</span>
<span class="gi">+                                    geometry=geom, fs=fs)</span>
<span class="gi">+</span>
<span class="gi">+</span>
 # Base class for any test case that requires a hash table of all
 # _ped.DiskType objects available
 class RequiresDiskTypes(unittest.TestCase):
<span class="gh">diff --git a/tests/test__ped_partition.py b/tests/test__ped_partition.py</span>
<span class="gh">index 7ef049a..26449b4 100755</span>
<span class="gd">--- a/tests/test__ped_partition.py</span>
<span class="gi">+++ b/tests/test__ped_partition.py</span>
<span class="gu">@@ -62,8 +62,10 @@ class PartitionGetSetTestCase(RequiresPartition):</span>
         self.assertRaises(exn, setattr, self._part, &quot;num&quot;, 1)
         self.assertRaises(exn, setattr, self._part, &quot;fs_type&quot;,
             _ped.file_system_type_get(&quot;fat32&quot;))
<span class="gd">-        self.assertRaises(exn, setattr, self._part, &quot;geom&quot;,</span>
<span class="gd">-                                     _ped.Geometry(self._device, 10, 20))</span>
<span class="gi">+        with self.assertRaises((AttributeError, TypeError)):</span>
<span class="gi">+#            setattr(self._part, &quot;geom&quot;, _ped.Geometry(self._device, 10, 20))</span>
<span class="gi">+            self._part.geom = _ped.Geometry(self._device, 10, 20)</span>
<span class="gi">+</span>
         self.assertRaises(exn, setattr, self._part, &quot;disk&quot;, self._disk)
 
         # Check that values have the right type.
<span class="gh">diff --git a/tests/test_parted_partition.py b/tests/test_parted_partition.py</span>
<span class="gh">index 0a406a0..8d8d0fd 100755</span>
<span class="gd">--- a/tests/test_parted_partition.py</span>
<span class="gi">+++ b/tests/test_parted_partition.py</span>
<span class="gu">@@ -23,7 +23,7 @@</span>
 import parted
 import unittest
 
<span class="gd">-from tests.baseclass import RequiresDisk</span>
<span class="gi">+from tests.baseclass import RequiresDisk, RequiresPartition</span>
 
 # One class per method, multiple tests per class.  For these simple methods,
 # that seems like good organization.  More complicated methods may require
<span class="gu">@@ -34,11 +34,11 @@ class PartitionNewTestCase(unittest.TestCase):</span>
         # TODO
         self.fail(&quot;Unimplemented test case.&quot;)
 
<span class="gd">-@unittest.skip(&quot;Unimplemented test case.&quot;)</span>
<span class="gd">-class PartitionGetSetTestCase(unittest.TestCase):</span>
<span class="gi">+class PartitionGetSetTestCase(RequiresPartition):</span>
     def runTest(self):
<span class="gd">-        # TODO</span>
<span class="gd">-        self.fail(&quot;Unimplemented test case.&quot;)</span>
<span class="gi">+        with self.assertRaises((AttributeError, TypeError)):</span>
<span class="gi">+            #setattr(self.part, &quot;geometry&quot;, parted.Geometry(self.device, start=10, length=20))</span>
<span class="gi">+            self.part.geometry = parted.Geometry(self.device, start=10, length=20)</span>
 
 @unittest.skip(&quot;Unimplemented test case.&quot;)
 class PartitionGetFlagTestCase(unittest.TestCase):
</pre></div>


<p>The test in <code>test__ped_partition.py</code> works without problems, I've modified it for
visual reference only. This was also the inspiration behind the test in
<code>test_parted_partition.py</code>. However the second test fails with</p>
<div class="highlight"><pre>======================================================================
FAIL: runTest (tests.test_parted_partition.PartitionGetSetTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/tmp/pyparted/tests/test_parted_partition.py&quot;, line 41, in runTest
    self.part.geometry = parted.Geometry(self.device, start=10, length=20)
AssertionError: (&lt;type &#39;exceptions.AttributeError&#39;&gt;, &lt;type &#39;exceptions.TypeError&#39;&gt;) not raised

----------------------------------------------------------------------
</pre></div>


<p>Now it's clear that something isn't quite the same between the two interfaces.
If we look at <code>src/parted/partition.py</code> we see the following snippet</p>
<div class="highlight"><pre>137     fileSystem = property(lambda s: s._fileSystem, lambda s, v: setattr(s, &quot;_fileSystem&quot;, v))
138     geometry = property(lambda s: s._geometry, lambda s, v: setattr(s, &quot;_geometry&quot;, v))
139     system = property(lambda s: s.__writeOnly(&quot;system&quot;), lambda s, v: s.__partition.set_system(v))
140     type = property(lambda s: s.__partition.type, lambda s, v: setattr(s.__partition, &quot;type&quot;, v))
</pre></div>


<p>The geometry property is indeed read-write but the system property is write-only.
<code>git blame</code> leads us to the interesting
<a href="https://github.com/rhinstaller/pyparted/commit/2fc0ee2b">commit 2fc0ee2b</a>, which changes
definitions for quite a few properties and removes the <code>_readOnly</code> method which raises
an exception. Even more interesting is the fact that the <code>Partition.geometry</code> property
hasn't been changed. If you look closer you will notice that the deleted definition and
the new one are exactly the same. Looks like the problem existed even before this change.</p>
<p>Digging down even further we find
<a href="https://github.com/rhinstaller/pyparted/commit/7599aa1ae505f3784ca4936b58b38b8dffb752ff">commit 7599aa1</a>
which is the very first implementation of the <code>parted</code> module. There you can see the
<code>_readOnly</code> method and some properties like <code>path</code> and <code>disk</code> correctly marked as such
but <code>geometry</code> isn't.</p>
<p>Shortly after this commit the first test was added (4b9de0e) and a bit
later the second, empty test class, was added (c85a5e6). This only goes
to show that every piece of software needs appropriate QA coverage, which
pyparted was kind of lacking (and I'm trying to change that).</p>
<p>The reason this bug went unnoticed for so long
is the limited exposure of pyparted. To my knowledge anaconda, the Fedora installer
is its biggest (if not single) consumer and maybe it uses only the <code>_ped</code>
interface (I didn't check) or it doesn't try to do silly things like setting
a value to a read-only property.</p>
<p><strong>
The lesson from this story is to test all of your interfaces and also
make sure they are behaving in exactly the same manner!
</strong></p>
<p>Thanks for reading and happy testing!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 26 April 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/04/26/mismatch-in-pyparted-interfaces/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2016/04/24/capybaras-within-altering-expectpage-scope/" rel="bookmark" title="Permalink to Capybara's within() Altering expect(page) Scope">
                <h2 class="post-title">
                    Capybara's within() Altering expect(page) Scope
                </h2>
            </a>
                <p><strong>
When making assertions inside a <code>within</code> block the assertion scope
is limited to the element selected by the <em>within()</em> function, although
it looks like you are asserting on the entire page!
</strong></p>
<div class="highlight"><pre><span class="n">scenario</span> <span class="s1">&#39;Pressing Escape closes autocomplete popup&#39;</span> <span class="k">do</span>
  <span class="n">within</span><span class="p">(</span><span class="s1">&#39;#new-broadcast&#39;</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">find</span><span class="p">(</span><span class="s1">&#39;#broadcast_field&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;Hello &#39;</span><span class="p">)</span>
      <span class="n">start_typing_name</span><span class="p">(</span><span class="s1">&#39;#broadcast_field&#39;</span><span class="p">,</span> <span class="s1">&#39;@Bret&#39;</span><span class="p">)</span>
      <span class="c1"># will fail below</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;.ui-autocomplete&#39;</span><span class="p">)</span>
      <span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;#broadcast_field&#39;</span><span class="p">,</span> <span class="ss">:escape</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_no_selector</span><span class="p">(</span><span class="s1">&#39;.ui-autocomplete&#39;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>


<p>The above code failed the first <code>expect()</code> and it took me some time before
I figured it out. Capybara's test suite itself gives you the answer</p>
<div class="highlight"><pre><span class="n">it</span> <span class="s2">&quot;should assert content in the given scope&quot;</span> <span class="k">do</span>
  <span class="vi">@session</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="s2">&quot;#for_foo&quot;</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="vi">@session</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;First Name&#39;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@session</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;First Name&#39;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>


<p>So know your frameworks and happy testing.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Sun 24 April 2016
            </p>
<p>There are <a href="http://atodorov.org/blog/2016/04/24/capybaras-within-altering-expectpage-scope/#disqus_thread">comments</a>.</p>        </div>

    <hr>
    <!-- Pager -->
    <ul class="pager">
        <li class="next">
                <a href="http://atodorov.org/blog/categories/qa/index2.html">Older Posts &rarr;</a>
        </li>
    </ul>
    Page 1 / 5
    <hr>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/atodorov_">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/atodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://bg.linkedin.com/in/alextodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://feeds.feedburner.com/atodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.youtube.com/playlist?list=PLFjlI7p-h1hxBP3cIjEqePSeoBDHud5Db">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-youtube fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://amzn.to/1ivu2q4">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-amazon fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=social_icon">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-user-secret fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<section>
    <p>
        I am a Senior QA contractor at Red Hat responsible for finding over
        <a href="/blog/2014/02/19/7-years-1400-bugs-red-hat-qa/">1600 bugs</a>,
        a general purpose open source developer, Red Hat Certified professional,
        cloud hacker and an entrepreneur! My latest start-up is
        <a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=footer">Mr. Senko</a>!
    </p>
    <p>
        I am living in the <a href="http://planet.sofiavalley.com">Sofia Valley</a>
        which is emerging as a busy place for start-up founders and tech enthusiasts
        in Eastern Europe! You can find more about me <a href="/blog/2013/01/25/about-me/">here</a>.
    </p>
    <p>
        <small>
            <em>
                Some of the links contained within this site have my referral id (e.g.,
                <a target="_blank" href="http://www.amazon.com/ref=as_li_ss_tl?_encoding=UTF8&camp=1789&creative=390957&linkCode=ur2&tag=atodorovorg-20&linkId=L6Q34XAXQS5RDMOY">Amazon</a><img src="https://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=ur2&o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />),
                which provides me with a small commission for each sale. Thank you for your support.
            </em>
        </small>
    </p>
</section>

<form action="http://google.com/search" method="get" style="width:300px;margin:0 auto;">
    <fieldset role="search">
        <input type="hidden" name="sitesearch" value="http://atodorov.org" />
        <input class="search" type="text" name="q" placeholder="Search" style="width:100%"/>
    </fieldset>
</form>

<p class="copyright text-muted">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">CC-BY-SA</a> &amp;
    <a rel="license" href="http://opensource.org/licenses/MIT">MIT</a>
    2011-2016 &diams; Alexander Todorov &diams;
    <a href="http://planet.sofiavalley.com">SofiaValley Blog</a>
</p>

<script type='text/javascript'>
window.__lo_site_id = 55936;
    (function() {
        var wa = document.createElement('script'); wa.type = 'text/javascript'; wa.async = true;
        wa.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://cdn') + '.luckyorange.com/w.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(wa, s);
      })();
</script>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="http://atodorov.org/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="http://atodorov.org/theme/js/bootstrap.min.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37979549-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'atodorov';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>