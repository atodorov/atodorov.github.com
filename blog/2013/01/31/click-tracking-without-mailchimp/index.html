
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Click Tracking without MailChimp</title>
  <meta name="author" content="Alexander Todorov">

  
  <meta name="description" content="Here is a standard notification message that users at Difio
receive. It is plain text, no HTML crap, short and URLs are clean and
descriptive. As the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://atodorov.org/blog/2013/01/31/click-tracking-without-mailchimp/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/atodorov" rel="alternate" title="atodorov.org" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Russo+One" rel="stylesheet" type="text/css" />

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37979549-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
<div id="logo-container">
<div id="logo">atodorov.org</div>
<div id="logo-sub"><em>
<a href="/blog/categories/rhel/">red hat</a>,
<a href="/blog/categories/cloud/">cloud</a>,
<a href="/blog/categories/fedora/">fedora</a>,
<a href="/blog/categories/qa/">qa</a>,
<a href="/blog/categories/start-up/">start-up</a>
</em></div>
</div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/atodorov" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/give-away/">Give Away List</a></li>
  <li><a href="/projects/">Projects</a></li>
  <li><a href="http://amzn.to/12zvEDF">Now reading: DevOps for Developers</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Click Tracking Without MailChimp</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-31T21:23:00+02:00" pubdate data-updated="true">Jan 31<span>st</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Here is a standard notification message that users at <a href="http://www.dif.io">Difio</a>
receive. It is plain text, no HTML crap, short and URLs are clean and
descriptive. As the project lead developer I wanted to track when people click on
these links and visit the website but also keep existing functionality.</p>

<p><img src="/images/email_w_links.png" title="Email with links" alt="&quot;Email with links&quot;" /></p>

<h2>Standard approach</h2>

<p>A pretty common approach when sending huge volumes of email is to use an external
service, such as MailChimp. This is one of many email
marketing services which comes with a lot of features. The most important to me
was analytics and reports.</p>

<p>The downside is that MailChimp (and I guess others) use HTML formatted emails
extensively. I don&#8217;t like that and I&#8217;m sure my users will not like it as well.
They are all developers. Not to mention that MailChimp is much more expensive
than <a href="http://aws.amazon.com/ses/">Amazon SES</a> which I use currently.
No MailChimp for me!</p>

<p>Another common approach, used by Feedburner by the way,
is to use shortened URLs which redirect to the original ones and measure clicks
in between. I also didn&#8217;t like this for two reasons: 1) the shortened URLs look
ugly and they are not at all descriptive and 2) I need to generate them automatically
and maintain all the mappings. Why bother ?</p>

<h2>How I did it? </h2>

<p>So I needed something which will do a redirect to a predefined URL, measure how many
redirects were there (essentially clicks on the link) and look nice. The solution is
very simple, if you have not recognized it by now from the picture above.</p>

<p>I opted for a custom redirect engine, which will add tracking information to the
destination URL so I can track it in Google Analytics.</p>

<p>Previous URLs were of the form <code>http://www.dif.io/updates/haml-3.1.2/haml-3.2.0.rc.3/11765/</code>.
I&#8217;ve added the humble <code>/daily/?</code> prefix before the URL path so it becomes
<code>http://www.dif.io/daily/?/updates/haml-3.1.2/haml-3.2.0.rc.3/11765/</code></p>

<p>Now <code>/updates/haml-3.1.2/haml-3.2.0.rc.3/11765/</code> becomes a query string parameter which
the <code>/daily/index.html</code> page uses as its destination. Before doing the redirect
a script adds tracking parameters so that Google Analytics will properly
report this visit. Here is the code:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">uri</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">question</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">param</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">question</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">question</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">param</span> <span class="o">+</span> <span class="s1">&#39;?utm_source=email&amp;utm_medium=email&amp;utm_campaign=Daily_Notification&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Previously Google Analytics was reporting these visits as direct hits while now it lists them under
campaigns like so:</p>

<p><img src="/images/analytics_difio_campaigns.png" title="Difio Analytics" alt="&quot;Difio Analytics&quot;" /></p>

<p>Because all visitors of <a href="http://www.dif.io">Difio</a> use JavaScript enabled browsers
I combined this approach with another one, to
<a href="/blog/2013/01/28/remove-query-string-with-javascript-and-html5/">remove query string with JavaScript</a>
and present clean URLs to the visitor.</p>

<h2>Why JavaScript?</h2>

<p>You may be asking why the hell I am using JavaScript and not Apache&#8217;s wonderful mod_rewrite module?
This is because the destination URLs are hosted in <a href="http://aws.amazon.com/s3/">Amazon S3</a> and I&#8217;m
planning to integrate with <a href="http://aws.amazon.com/cloudfront/">Amazon CloudFront</a>. Both of them
don&#8217;t support .htaccess rules nor anything else similar to mod_rewrite.</p>

<p>As always I&#8217;d love to hear your thoughts and feedback. Please use the comment form below.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Alexander Todorov</span></span>

      








  


<time datetime="2013-01-31T21:23:00+02:00" pubdate data-updated="true">Jan 31<span>st</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/amazon/'>Amazon</a>, <a class='category' href='/blog/categories/javascript/'>JavaScript</a>, <a class='category' href='/blog/categories/s3/'>S3</a>, <a class='category' href='/blog/categories/ses/'>SES</a>, <a class='category' href='/blog/categories/cloud/'>cloud</a>
  
</span>


    </p>
    
      <div class="sharing">
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style addthis_32x32_style">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_preferred_5"></a>
<a class="addthis_button_preferred_6"></a>
<a class="addthis_button_preferred_7"></a>
<a class="addthis_button_preferred_8"></a>
<a class="addthis_button_preferred_9"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5103cc5a2bc6ba17"></script>
<!-- AddThis Button END -->
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/01/30/startup-talk-5-book-list/" title="Previous Post: StartUP Talk#5 - book list">&laquo; StartUP Talk#5 - book list</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/01/31/tip-save-money-on-amazon-buy-used-books/" title="Next Post: Tip: Save Money on Amazon - Buy Used Books">Tip: Save Money on Amazon - Buy Used Books &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:atodorov.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<br/>

<section>
  
  <a href="https://github.com/atodorov">@atodorov</a> on GitHub
  
</section>


<section>
  
    <a href="http://twitter.com/atodorov_" class="twitter-follow-button" data-show-count="true">Follow @atodorov_</a>
  
</section>

<section>
    <h1>Trending Posts</h1>
<!-- AddThis Trending Content BEGIN -->
<div id="addthis_trendingcontent"></div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5103cc5a2bc6ba17"></script>
<script type="text/javascript">
addthis.box("#addthis_trendingcontent", {
    feed_title : "",
    feed_type : "trending",
    feed_period : "month",
    num_links : 5,
    height : "auto",
    width : "auto"});
</script>
<!-- AddThis Trending Content END -->
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/10/13/tip-extending-btrfs-filesystem-for-fedora-virtual-machine/">Tip: Extending Btrfs Filesystem for Fedora Virtual Machine</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/12/tip-installing-missing-debuginfo-packages-for-abrt/">Tip: Installing Missing debuginfo Packages for ABRT</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/11/fedora-20-gnome-3-dot-10-test-day-post-mortem/">Fedora 20 GNOME 3.10 Test Day Post-mortem</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/11/this-week-python-chris-dibona-openshift/">This Week: Python Testing, Chris DiBona on Open Source and OpenShift ENV Variables</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/08/fedora-20-virtualization-test-day-post-mortem/">Fedora 20 Virtualization Test Day Post-mortem</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/07/fedora-20-virtualization-and-gnome-test-days-at-init-lab-this-week/">Fedora 20 Virtualization &amp; GNOME Test Days at init Lab this week</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/23/facebook-ui-bug-strikes-again-at-hackfmi/">Facebook UI Bug Strikes Again at HackFMI</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/23/fedora-test-days-are-coming-to-sofia/">Fedora Test Days are Coming to Sofia</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/15/lenovo-rants-battery-and-dock-flaws/">Lenovo Rants: Battery and Dock Flaws</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/14/upcoming-talk-fedora-test-days-in-sofia/">Upcoming Talk: Fedora Test Days in Sofia</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Disclaimer</h1>
  <p>
Some of the links contained within this site have my referral id (e.g., Amazon), which provides me with a small commission for each sale. Thank you for your support.
  </p>
</section>
<section>
<h1></h1>
<iframe width="260" height="420" scrolling="no" frameborder="no" allowtransparency="true" src="http://www.econt.com/voffice/en/240x400/?mediator=http%3A%2F%2Fatodorov.org"></iframe>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">CC-BY-SA</a>
  &amp;
  <a rel="license" href="http://opensource.org/licenses/MIT">MIT</a>
  2013 &diams; Alexander Todorov
  &diams;
  <a href="/about/">About Me</a>

  <a href="http://planet.sofiavalley.com" style="float:right">SofiaValley Blog</a>
</p>

<script type="text/javascript">
var uri = window.location.toString();
if (uri.indexOf("?") > 0) {
    var clean_uri = uri.substring(0, uri.indexOf("?"));
    window.history.replaceState({}, document.title, clean_uri);
}
</script>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'atodorov';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://atodorov.org/blog/2013/01/31/click-tracking-without-mailchimp/';
        var disqus_url = 'http://atodorov.org/blog/2013/01/31/click-tracking-without-mailchimp/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
