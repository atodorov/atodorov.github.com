<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

            <meta name="google-site-verification" content="XynqZtldWNBbmsynVQZremIxaaO8Wgs6AGR8UZ7KIkM">

        <title>atodorov.org - Articles in the _posts category</title>

            <link href="http://feeds.feedburner.com/atodorov" type="application/atom+xml" rel="alternate" title="atodorov.org Full Atom Feed" />

        <!-- Bootstrap Core CSS -->
        <link href="http://atodorov.org/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="http://atodorov.org/theme/css/clean-blog.min.css" rel="stylesheet">
        <link href="http://atodorov.org/override.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="http://atodorov.org/theme/css/code_blocks/github.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

                <meta property="fb:admins" content="1616937247" />
                    <meta property="og:locale" content="en_US">
		<meta property="og:site_name" content="atodorov.org">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://atodorov.org/">atodorov.org</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/images/header_02.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Articles in the _posts category</h1>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/10/15/anaconda-coverage.py-details/" rel="bookmark" title="Permalink to Anaconda & coverage.py - Pt.2 - Details">
                <h2 class="post-title">
                    Anaconda &amp; coverage.py - Pt.2 - Details
                </h2>
            </a>
            <p>My <a href="/blog/2015/10/14/anaconda-coverage.py-introduction/">previous post</a>
was an introduction to testing installation related components. Now I'm going to
talk more about anaconda and how it is tested.</p>
<p>There are two primary ways to test anaconda. You can execute <code>make check</code> in the
source directory which will trigger the package test suite. The other possibility
is to perform an actual installation, on bare meta or virtual machine, using the
<a href="https://kojipkgs.fedoraproject.org/mash/">latest Rawhide snapshots</a> which also
include the latest anaconda. For both of these methods we can collect code
coverage information. In live installation mode coverage is enabled via the
<code>inst.debug</code> boot argument. Fedora 23 and earlier use <code>debug=1</code> but that
can lead to <a href="https://github.com/rhinstaller/anaconda/pull/291">problems</a>
sometimes.</p>
<h2>Kickstart Testing</h2>
<p><a href="https://github.com/rhinstaller/pykickstart/blob/master/docs/kickstart-docs.rst">Kickstart</a>
is a method of automating the installation of Fedora by supplying the necessary
configuration into a text file and pointing the installer at this file. There is
the directory <code>tests/kickstart_tests</code>, inside the anaconda source, where each
test is a kickstart file and a shell script. The test runner provisions a virtual
machine using boot.iso and the kickstart file. A shell script then verifies
installation was as expected and copies files of interest to the host system.
Kickstart files are also the basis for testing Fedora installations in
<a href="https://beaker.fedoraproject.org/bkr/jobs/">Beaker</a>.</p>
<p>Naturally some of these in-package kickstart tests are the same as
<a href="https://bitbucket.org/fedoraqa/fedora-beaker-tests/">out-of-band kickstart tests</a>.
Hint: there are more available but not yet public.</p>
<p>The question which I don't have an answer for right now is
"Can we remove some of the duplicates and how this affects devel and QE teams" ?
The pros of in-package testing are that it is faster compared to Beaker. The cons
are that you're not testing the real distro (every snapshot is a possible final
release to the users).</p>
<h2>Dogtail</h2>
<p><a href="https://fedorahosted.org/dogtail/">Dogtail</a> uses accessibility technologies to
communicate with desktop applications. It is written in Python and can be used
as GUI test automation framework. Long time ago I've proposed support for Dogtail
in anaconda which was rejected, then couple of years later it was accepted and
later removed from the code again.</p>
<p>Anaconda has in-package Dogtail tests (<code>tests/gui/</code>). They work by attaching
a second disk image with the test suite to a VM running a LiveCD. Anaconda is
started on the LiveCD and an attempt to install Fedora on disk 1 is made.
Everything is driven by the Dogtail scripts. There are only a few of these
tests available and they are currently disabled.
Red Hat QE has also created another method for running Dogtail tests in anaconda
using an updates.img with the previous functionality.</p>
<p>Even if there are some duplicate tests I'm not convinced we have to drop the
<code>tests/gui/</code> directory from the code because
the framework used to drive the graphical interface of anaconda appears to be very
well written. The code is clean and easy to follow.
Also I don't have metrics of how much these two methods differ or how much they cover
in their testing. IMO they are pretty close and before we can find a way to
reliably execute them on a regular basis there isn't much to be done here.
One idea is to use the <code>--dirinstall</code> or <code>--image</code> options and skip the
LiveCD part entirely.</p>
<h2>How Much is Tested</h2>
<p><code>make ci</code> covers 10% of the entire code base for anaconda. Mind you that
<code>tests/storage</code> and <code>tests/gui</code> are currently disabled.
See <a href="https://github.com/rhinstaller/anaconda/pull/346">PR #346</a>,
<a href="https://github.com/rhinstaller/anaconda/pull/327">PR #327</a> and
<a href="https://github.com/rhinstaller/anaconda/pull/319">PR #319</a>!
There is definitely room for improvement.</p>
<p>On the other hand live installation testing is much
better. Text mode covers around 25% while graphical installations around 40%.
Text and graphical combined cover 50% though. These numbers will drop quite a bit
once anaconda learns to
<a href="https://github.com/rhinstaller/anaconda/pull/397">include all possible files</a>
in its report but it is a good estimate.</p>
<p>The important questions to ask here are:</p>
<ul>
<li>How much can PyUnit tests cover in anaconda?</li>
<li>How much can kickstart tests cover ?</li>
<li>Have we reached a threshold in any of the two primary methods for testing ?</li>
<li>Does UI automation (with Dogtail) improve anything ?</li>
<li>When testing a particular feature (say user creation) how different is the
code execution path between manual (GUI) testing, kickstart and unit testing ?
If not so different can we invest in unit tests instead of higher level tests then ?</li>
<li>How different is the code execution path between different tests (manual or kickstart) ?
In other words how much value are we getting from testing for the resources we're putting in ?</li>
</ul>
<p>In my next post I will talk more about these questions and some rudimentary
analysis against coverage data from the various test methods and test cases!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 15 October 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/10/15/anaconda-coverage.py-details/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/10/14/anaconda-coverage.py-introduction/" rel="bookmark" title="Permalink to Anaconda & coverage.py - Pt.1 - Introduction">
                <h2 class="post-title">
                    Anaconda &amp; coverage.py - Pt.1 - Introduction
                </h2>
            </a>
            <p>Since early 2015 I've been working on testing installation related
components in Rawhide. I'm interested in the code produced by the
<a href="https://github.com/rhinstaller/">Red Hat Installer Engineering Team</a> and in
particular in <em>anaconda</em>, <em>blivet</em>, <em>pyparted</em> and <em>pykickstart</em>. The goal of
this effort is to improve the overall testing of these components and also
have Red Hat QE contribute some of our knowledge back to the community. The benefit
of course will be better software for everyone. In the next
several posts I'll summarize what has been done so far and what's to be expected
in the future.</p>
<h2>Test Documentation Matters</h2>
<p>Do you want others to contribute tests? I certainly do! When I started looking
at the code it was obviously clear there was no documentation related to testing.
Everyone needs to know how to write and execute these tests! Currently we have
basic README files describing how to install necessary dependencies for development
and test execution, how to execute the tests (and what can be tested) and most
importantly what is the test architecture. There is description of how the file
structure is organized and which are the base classes to inherit from when adding
new tests. Most of the times each component goes through a <em>pylint</em> check and
a standard PyUnit test suite.</p>
<p>Test documentation is usually in a <code>tests/README</code> file. For example:</p>
<ul>
<li><a href="https://github.com/rhinstaller/anaconda/blob/master/tests/README.rst">anaconda</a></li>
<li><a href="https://github.com/rhinstaller/blivet/blob/master/tests/README.rst">blivet</a></li>
<li><a href="https://github.com/rhinstaller/pykickstart/blob/master/tests/README.rst">pykickstart</a></li>
<li><a href="https://github.com/rhinstaller/pyparted/blob/master/tests/README.rst">pyparted</a></li>
</ul>
<p>I've tried to explain as much as possible without bloating the files and going into
unnecessary details. If you spot something missing please send a pull request.</p>
<h2>Continuous Integration</h2>
<p>This has been largely an effort driven by Chris Lumens from the devel team.
All the components I'm interested in are tested regularly in a CI environment.
There is a <code>make ci</code> Makefile target for those of you interested in what exactly
gets executed.</p>
<h2>Test Coverage</h2>
<p>In order to <strong>improve</strong> something you need to know where you stand. We'll I didn't.
That's why the first step was to integrate the
<a href="https://bitbucket.org/ned/coveragepy">coverage.py</a> tool with all of these components.</p>
<p>With the exception of blivet (written in C) all of the other
components integrate well with coverage.py and produce good statistics. pykickstart is
the champ here with 90% coverage, while anaconda is somewhere between 10% and 50%.
Full test coverage measurement for anaconda isn't straight forward and will be the
subject of my next post. For the C based code we have to hook up with
<a href="https://gcc.gnu.org/onlinedocs/gcc/Gcov.html">Gcov</a> which shouldn't be too difficult.</p>
<p>At the moment there are several open pull requests to integrate the coverage test
targets with <code>make ci</code> and also report the results in human readable form. I will be
collecting these for historical references.</p>
<h2>Tools</h2>
<p>I've created some basic text-mode
<a href="https://github.com/atodorov/coverage-tools">coverage-tools</a> to help me combine and
compare data from different executions. These are only the start of it and I'm expanding
them as my needs for reporting and analytics evolve. I'm also looking into
<a href="/blog/2015/07/27/call-for-ideas-graphical-test-coverage-reports/">more detailed coverage reports</a>
but I don't have enough data and use cases to work on this front at the moment.</p>
<p>Some ideas currently in mind:</p>
<ul>
<li>map code changes (git commits) to existing test coverage to get a feeling where to
invest in more testing;</li>
<li>map bugs to code areas and to existing test coverage to see if we aren't
missing tests in areas where the bugs are happening;</li>
</ul>
<h2>Bugs</h2>
<p>coverage.py is a very nice tool indeed but I guess most people use it in a very
limited way. Shortly after I started working with it I've found several places which
need improvements. These have to do with combining and reporting on multiple files.</p>
<p>Some of the interesting issues I've found and still open are:</p>
<ul>
<li><a href="https://bitbucket.org/ned/coveragepy/pull-requests/63/">PR #63 - New option --dont-remove when combining coverage data</a></li>
<li><a href="https://bitbucket.org/ned/coveragepy/issues/425">#425 - source parameter not including files which are explicitly specified</a></li>
<li><a href="https://bitbucket.org/ned/coveragepy/issues/426">#426 - Difference between coverage results with source specifies full dir instead of module name</a></li>
</ul>
<p>In my next post I will talk about anaconda code coverage and what I want to do with it.
In the mean time please use the comments to share your feedback.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 14 October 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/10/14/anaconda-coverage.py-introduction/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/09/30/thunderbolt-to-vga-adapter-on-linux/" rel="bookmark" title="Permalink to Thunderbolt to VGA adapter on Linux">
                <h2 class="post-title">
                    Thunderbolt to VGA adapter on Linux
                </h2>
            </a>
            <p>I've previously written about my
<a href="http://amzn.to/1Iqhl9e">Thunderbolt to Ethernet</a>
adapter <a href="/blog/2015/05/04/thunderbolt-to-ethernet-adapter-on-linux/">working on Linux</a>
despite claims that it should not. Recently I've used my <a class="wikilink" href="http://amzn.to/1RdviyD">MacBook Air</a> to do a presentation
and the <a href="http://amzn.to/1Iqh0nd">Thunderbolt to VGA adapter</a> worked well enough.</p>
<p>It was an Acer adapter but I have no more details b/c it wasn't mine.</p>
<p>Before the event I've tested it and it worked so on the day of the event I've
freshly rebooted my laptop to be sure no crashed processes or anything like that
was running and gave it a go.</p>
<p>First time I plugged in the <a class="wikilink" href="http://amzn.to/1RdviyD">MacBook</a> everything worked like a charm. Then my computer was
unplugged and the lid closed, causing it to suspend. The second time I've plugged it in
I was told there was nothing showing on the projector so I quickly plugged the adapter out
and then back in. It worked more or less.</p>
<p>At the time I had LibreOffice Impress in presentation
mode but I did see ABRT detecting a kernel problem. When my slides popped up the text
on the first one was mostly missing but the rest were ok!</p>
<p>Mind you I'm still running <a href="/blog/categories/mac/">RHEL 7 on my MacBook Air</a>. The above is
with kernel-3.10.0-229.14.1.el7.x86_64.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 30 September 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/09/30/thunderbolt-to-vga-adapter-on-linux/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/09/25/unit-testing-bad-stub-design-in-dnf/" rel="bookmark" title="Permalink to Unit Testing Example - Bad Stub Design in DNF">
                <h2 class="post-title">
                    Unit Testing Example - Bad Stub Design in DNF
                </h2>
            </a>
            <p>In software testing, usually unit testing, test stubs are programs that simulate
the behaviors of external dependencies that a module undergoing the test depends
on. Test stubs provide canned answers to calls made during the test.</p>
<p>I've discovered an improperly written stub method in one of
<a href="http://dnf.baseurl.org/">DNF</a>'s tests:</p>
<div class="highlight"><span class="filename">tests/test_download.py</span><pre><span class="k">class</span> <span class="nc">DownloadCommandTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">stub_fn</span><span class="p">(</span><span class="n">pkg_spec</span><span class="p">):</span>
            <span class="k">if</span> <span class="s">&#39;.src.rpm&#39;</span> <span class="ow">in</span> <span class="n">pkg_spec</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sourcerpm</span><span class="o">=</span><span class="n">pkg_spec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">pkg</span> <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">q</span> <span class="k">if</span> <span class="n">pkg_spec</span> <span class="o">==</span> <span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="n">cli</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">DownloadCommand</span><span class="p">(</span><span class="n">cli</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">repos</span> <span class="o">=</span> <span class="n">dnf</span><span class="o">.</span><span class="n">repodict</span><span class="o">.</span><span class="n">RepoDict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">_get_query</span> <span class="o">=</span> <span class="n">stub_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">_get_query_source</span> <span class="o">=</span> <span class="n">stub_fn</span>
</pre></div>


<p>The replaced methods look like this:</p>
<div class="highlight"><span class="filename">plugins/download.py</span><pre>    <span class="k">def</span> <span class="nf">_get_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pkg_spec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a query to match a pkg_spec.&quot;&quot;&quot;</span>
        <span class="n">subj</span> <span class="o">=</span> <span class="n">dnf</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">Subject</span><span class="p">(</span><span class="n">pkg_spec</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">subj</span><span class="o">.</span><span class="n">get_best_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">sack</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">available</span><span class="p">()</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">run</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;No package &quot;</span> <span class="o">+</span> <span class="n">pkg_spec</span> <span class="o">+</span> <span class="s">&quot; available.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">dnf</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">PackageNotFoundError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">q</span>

    <span class="k">def</span> <span class="nf">_get_query_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pkg_spec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Return a query to match a source rpm file name.&quot;&quot;&quot;</span>
        <span class="n">pkg_spec</span> <span class="o">=</span> <span class="n">pkg_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>  <span class="c"># skip the .rpm</span>
        <span class="n">nevra</span> <span class="o">=</span> <span class="n">hawkey</span><span class="o">.</span><span class="n">split_nevra</span><span class="p">(</span><span class="n">pkg_spec</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">sack</span><span class="o">.</span><span class="n">query</span><span class="p">()</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">available</span><span class="p">()</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">nevra</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">nevra</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                     <span class="n">release</span><span class="o">=</span><span class="n">nevra</span><span class="o">.</span><span class="n">release</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">nevra</span><span class="o">.</span><span class="n">arch</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">run</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;No package &quot;</span> <span class="o">+</span> <span class="n">pkg_spec</span> <span class="o">+</span> <span class="s">&quot; available.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">dnf</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">PackageNotFoundError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">q</span>
</pre></div>


<p>As seen here <em>stub_fn</em> replaces the <em>_get_query</em> methods from the class under
test. At the time of writing this has probably seemed like a good idea to
speed up writing the tests.</p>
<p>The trouble is we should be replacing the external dependencies of <em>_get_query</em>
(other parts of DNF essentially) and not methods from <em>DownloadCommand</em>. To
understand why this is a bad idea check
<a href="https://github.com/rpm-software-management/dnf-plugins-core/pull/113">PR #113</a>,
which directly modifies <em>_get_query</em>. There's no way to test this patch
with the current state of the test.</p>
<p>So I took a few days to experiment and update the current test stubs. The
result is 
<a href="https://github.com/rpm-software-management/dnf-plugins-core/pull/118">PR #118</a>.
The important bits are the <em>SackStub</em> and <em>SubjectStub</em> classes which hold
information about the available RPM packages on the system. The rest are cosmetics
to fit around the way the query objects are used (q.available(), q.latest(), q.filter()).
The proposed design correctly overrides the external dependencies on
<em>dnf.subject.Subject</em> and <em>self.base.sack</em> which are initialized before our
plugin is loaded by DNF.</p>
<p>I must say this is the first error of this kind I've seen in my QA practice so far.
I have no idea if this was a minor oversight or something which happens more frequently
in open source projects but it's a great example nevertheless.</p>
<p>For those of you who'd like to get started on unit testing I can recommend the book
<a href="http://www.amazon.com/gp/product/1933988274/ref=as_li_ss_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=1933988274&linkCode=as2&tag=atodorovorg-20">The Art of Unit Testing: With Examples in .Net</a><img src="http://www.assoc-amazon.com/e/ir?t=atodorovorg-20&l=as2&o=1&a=1933988274" width="1" height="1" border="0"  style="border:none !important; margin:0px !important;" />
by Roy Osherove!</p>
<p><strong>UPDATE</strong>: Part 2 with more practical examples can be found
<a href="/blog/2015/11/23/bad-stub-design-in-dnf/">here</a>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 25 September 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/09/25/unit-testing-bad-stub-design-in-dnf/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/09/16/4000-bugs-in-fedora-checksec-failures/" rel="bookmark" title="Permalink to 4000+ bugs in Fedora - checksec failures">
                <h2 class="post-title">
                    4000+ bugs in Fedora - checksec failures
                </h2>
            </a>
            <p>In the last week I've been trying to figure out how many packages
conform to the new
<a href="https://fedoraproject.org/wiki/Changes/Harden_All_Packages">Harden All Packages</a>
policy in Fedora!</p>
<p>From 46884 RPMs, 17385 are 'x86_64' meaning they may contain ELF objects.
From them 4489 are reported as failed <code>checksec</code>.</p>
<p>What you should see as the output from <code>checksec is</code></p>
<div class="highlight"><pre>Full RELRO      Canary found      NX enabled    PIE enabled     No RPATH   No RUNPATH
Full RELRO      Canary found      NX enabled    DSO             No RPATH   No RUNPATH
</pre></div>


<p>The first line is for binaries, the second one for libraries b/c
DSOs on x86_64 are always position-independent. Some RPATHs are acceptable,
e.g. <code>%{_libdir}/foo/</code> and I've tried to exclude them unless
other offenses are found. The script which does this is
<a href="https://github.com/atodorov/fedora-scripts/blob/master/checksec-collect">checksec-collect</a>.</p>
<p>Most often I'm seeing <em>Partial RELRO</em>, <em>No canary found</em> and <em>No PIE</em> errors.
Since all packages potentially process untrusted input, it makes sense for all of them
to be hardened and enhance the security of Fedora. That's why all of these errors
should be considered valid bugs.</p>
<h2>Attn package maintainers</h2>
<p>Please see if your package is in the list and try to fix it or let me know
why it should be excluded, for example it's a boot loader and doesn't function
properly with hardening enabled. The full list is available at
<a href="https://github.com/atodorov/fedora-scripts/blob/master/checksec.log">GitHub</a>.</p>
<p>For more information about the different protection mechanisms see the following
links:</p>
<ul>
<li><a href="http://tk-blog.blogspot.bg/2009/02/relro-not-so-well-known-memory.html">Partial vs Full RELRO</a></li>
<li><a href="https://en.wikipedia.org/wiki/Buffer_overflow_protection#Canaries">Stack canaries</a></li>
<li><a href="https://en.wikipedia.org/wiki/NX_bit#Linux">NX memory protection</a></li>
<li><a href="https://securityblog.redhat.com/2012/11/28/position-independent-executables-pie/">Position Independent Executables</a></li>
<li><a href="https://fedoraproject.org/wiki/Packaging:Guidelines#Beware_of_Rpath">RPATH</a></li>
<li><a href="http://blog.tremily.us/posts/rpath/">RUNPATH</a></li>
</ul>
<p><strong>UPDATE 2015-09-17</strong></p>
<p>I've posted my findings on 
<a href="https://lists.fedoraproject.org/pipermail/devel/2015-September/thread.html">fedora-devel</a>
and the comments are more than interesting even revealing an old bug in libtool.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 16 September 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/09/16/4000-bugs-in-fedora-checksec-failures/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/08/20/minor-typo-bug-in-messenger/" rel="bookmark" title="Permalink to Minor Typo Bug in Messenger for bg_BG.UTF-8">
                <h2 class="post-title">
                    Minor Typo Bug in Messenger for bg_BG.UTF-8
                </h2>
            </a>
            <p><img alt="Messenger typo" src="/images/messenger_typo.png" title="Messenger typo" /></p>
<p>There's a typo in the Bulgarian translation of Messenger.com.
It is highlighted by the red dot on the picture.</p>
<p><em>hunspell</em> easily catches it so either Facebook doesn't run their
translations through a spell checker or their spell checker is
borked.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 20 August 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/08/20/minor-typo-bug-in-messenger/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/08/17/pedometer-bug-in-samsung-s-health/" rel="bookmark" title="Permalink to Pedometer Bug in Samsung S Health">
                <h2 class="post-title">
                    Pedometer Bug in Samsung S Health
                </h2>
            </a>
            <p>Do you remember the 
<a href="/blog/2015/01/09/pedometer-bug-in-samsung-gear-fit-smartwatch/">pedometer bug in Samsung Gear Fit</a>
I've discovered earlier ? It turns out that Samsung is a fan of this one
and has the exact same bug in their <em>S Health</em> application.</p>
<p>The application doesn't block pedometer(e.g. steps counting) while
performing other activities such as cycling for example. So in reallity it
reports incorrect value for burned callories. At this time I call it
bad software development practice/architecture on Samsung's part which leads
to this bug being present.</p>
<p>Btw for more interesting bugs see
<a href="http://gearfitbugs.tumblr.com/">Samsung Gear Fit Bug-of-the-Day</a>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 17 August 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/08/17/pedometer-bug-in-samsung-s-health/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/08/14/tip-try-f10-when-editing-grub2-menu-in-efi-mode/" rel="bookmark" title="Permalink to Tip: Try F10 When Editing grub2 Menu in EFI Mode">
                <h2 class="post-title">
                    Tip: Try F10 When Editing grub2 Menu in EFI Mode
                </h2>
            </a>
            <p>When editing the grub2 menu (especially in EFI mode) it tells you to
press Ctrl-x to save your changes and continue the boot process.
However this doesn't work on my <a class="wikilink" href="http://amzn.to/1RdviyD">MacBook Air</a>, see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1253637">rhbz#1253637</a>,
and maybe some other platforms. If this is the case try pressing <strong>F10</strong> 
instead. It works for me!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 14 August 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/08/14/tip-try-f10-when-editing-grub2-menu-in-efi-mode/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/07/27/call-for-ideas-graphical-test-coverage-reports/" rel="bookmark" title="Permalink to Call for Ideas: Graphical Test Coverage Reports">
                <h2 class="post-title">
                    Call for Ideas: Graphical Test Coverage Reports
                </h2>
            </a>
            <p>If you are working with Python and writing unit tests chances are you are
familiar with the <a href="http://nedbatchelder.com/code/coverage/">coverage</a> reporting
tool. However there are testing scenarios in which we either don't use unit tests
or maybe execute different code paths(test cases) independent of each other.</p>
<p>For example, this is the case with installation testing in Fedora. Because anaconda
- the installer is very complex the easiest way is to test it live, not with unit tests.
Even though we can get a coverage report (anaconda is written in Python) it reflects
only the test case it was collected from.</p>
<p><code>coverage combine</code> can be used to combine several data files and produce an aggregate
report. This can tell you how much test coverage you have across all your tests.</p>
<p>As far as I can tell Python's coverage doesn't tell you how many times a particular
line of code has been executed. It also doesn't tell you which test cases executed
a particular line
(see <a href="https://bitbucket.org/ned/coveragepy/pull-request/59">PR #59</a>).
In the Fedora example, I have the feeling many of our tests are touching the same
code base and not contributing that much to the overall test coverage.
So I started working on these items.</p>
<p>I imagine a script which will read coverage data from several test executions
(preferably in JSON format, 
<a href="https://bitbucket.org/ned/coveragepy/pull-request/60">PR #60</a>) and produce a 
graphical report similar to what GitHub does for your commit activity.</p>
<p>See an example <a href="https://s3.amazonaws.com/atodorov/blog/pykickstart_report.html">here</a>!</p>
<p>The example uses darker colors to indicate more line executions, lighter for less
executions. Check the HTML for the actual numbers b/c there are no hints yet.
The input JSON files are
<a href="https://s3.amazonaws.com/atodorov/blog/coverage_json_reports.tar.gz">here</a> and
the script to generate the above HTML is at 
<a href="https://github.com/atodorov/fedora-scripts/blob/master/coverage-tool">GitHub</a>.</p>
<p>Now I need your ideas and comments!</p>
<p>What kinds of coverage reports are you using in your job ? How do you generate them ?
How do they look like ?</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 27 July 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/07/27/call-for-ideas-graphical-test-coverage-reports/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/07/01/open-data-event-coming-to-sofia/" rel="bookmark" title="Permalink to Open Data Event Coming to Sofia">
                <h2 class="post-title">
                    Open Data Event Coming to Sofia
                </h2>
            </a>
            <p><a href="https://www.eventbrite.co.uk/e/17565601186">Open Data and Intelligent Government</a>
is the name of upcoming event organized by <a href="http://sofiatech.bg/en/">Sofia Tech Park</a>
on July 14th.</p>
<p>The (preliminary) topics for this event are:</p>
<ul>
<li>Government vision for opening data;</li>
<li>Presentation of national platform for open data;</li>
<li>Legal aspects of open data;</li>
<li>Presentation of <a href="http://opendata.government.bg/">Bulgarian open data portal</a>;</li>
<li>Europe and open data;</li>
<li>Open, coordinated e-government for citizens and business;</li>
<li>What has already been done by municipalities in Bulgaria;</li>
<li>Strategy of Sofia municipality for open data;</li>
<li>Upcoming open data programming contest organized by Sofia municipality.</li>
</ul>
<p>I will also be participating in this event by covering two topics I'm close to:</p>
<ul>
<li>Entrepreneurship and open data - sharing my limited experience with Difio
and processing open data; </li>
<li>Technical tips for successful open data hackathon - sharing my observations as
a mentor at <a href="http://hackfmi.com">HackFMI</a> and giving some recommendations which will
help the alleged open data contest make a difference not being just another dull event
organized by governmental agencies.</li>
</ul>
<p>So far other confirmed speakers are Rado from <a href="http://hackbulgaria.com">HackBulgaria</a>/
<a href="http://hackfmi.com">HackFMI</a> and <a href="https://www.obshtestvo.bg/">Obshtestvo.bg</a> which are
working in the field of open government and open data.</p>
<p>I'm also in touch with the event organizers and helping a little bit with the program.
If you're interested in speaking please get in touch with me ASAP.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 01 July 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/07/01/open-data-event-coming-to-sofia/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/05/22/devit-conf-2015-impressions/" rel="bookmark" title="Permalink to DEVit Conf 2015 Impressions">
                <h2 class="post-title">
                    DEVit Conf 2015 Impressions
                </h2>
            </a>
            <p>It's been a busy week after <a href="http://devitconf.org/">DEVit conf</a> took place in
Thessaloniki. Here are my impressions.</p>
<p><img alt="Crack, Train, Fix, Release" src="/images/devit2015.jpg" title="Crack, Train, Fix, Release" /></p>
<h2>Sessions</h2>
<p>I've started the day with the session called "Crack, Train, Fix, Release" by 
Chris Heilmann. While it was very interesting for some unknown reason I
was expecting a talk more closely related to software testing. Unfortunately at the
same time in the other room was a talk called "Integration Testing from the Trenches"
by Nicolas Frankel which I missed.</p>
<p>At the end Chris answered the question "What to do about old versions of IE ?".
And the answer pretty much was "Don't try to support everything, leave them with
basic functionality so that users can achieve what they came for on your website.
Don't put nice buttons b/c IE 6 users are not used to nice things and they get confused."</p>
<p>If you remember I had a similar question to Jeremy Keith at 
<a href="/blog/2015/04/20/videos-from-bulgaria-web-summit-2015/">Bulgaria Web Summit</a> last month
and the answer was similar:</p>
<blockquote>
<p>Q: Which one is Jeremy's favorite device/browser to develop for.</p>
<p>A: Your approach is wrong and instead we should be thinking in terms of what features are 
essential or non-essential for our websites and develop around features
(if supported, if not supported) not around browsers!</p>
</blockquote>
<p>Btw I did ask Chris if he knows Jeremy and he does.</p>
<p>After the coffee break there was "JavaScript ♥ Unicode" by Mathias Bynens which
I saw last year at <a href="http://how.camp/">How Camp</a> in Veliko Tarnovo so I just stopped by
to say hi and went to listen to 
"The future of responsive web design: web component queries" by Nikos Zinas.
As far as I understood Nikos is a local rock-star developer. I'm not much into web
development but the opportunity to create your own HTML components (tags) looks
very promising. I guess there will be more business coming for
<a href="http://telerik.com">Telerik</a> :).</p>
<p>I wanted to listen to "Live Productive Coder" by Heinz Kabutz but that one started
in Greek so I switched the room for 
"iOS real time content modifications using websockets" by  Benny Weingarten-Gabbay.</p>
<p>After lunch I went straight for
"Introduction to Docker: What is it and why should I care?" by Ian Miell
which IMO was the most interesting talk of the day. It wasn't very technical but
managed to clear some of the mysticism around Docker and what it actually is.
I tried to grab a few minutes of Ian's time and we found topics of common interest
to talk about (<a href="http://www.projectatomic.io/">Project Atomic</a> anyone?) but later
failed to find him and continue the talk. I guess I'll have to follow online.</p>
<p>Tim Perry with "Your Web Stack Would Betray You In An Instant" made a great show.
The room was packed, I myself was actually standing the whole time. He described a series
of failures across the entire web development stack which gave developers hard times
patching and upgrading their services. The lesson: everything fails, be prepared!</p>
<p>The last talk I visited was "GitHub Automation" by Forbes Lindesay. It was more of an
inspirational talk, rather than technical one. GitHub provides cool API so why not use it?</p>
<h2>Organization</h2>
<p><img alt="DEVit team" src="/images/devit2015team.jpg" title="DEVit team" /></p>
<p>From what I know this is the first year of DEVit. For a first timer the team did great!
I particularly liked the two coffee breaks before lunch and in the early afternoon and the
sponsors pitches in between the main talks.</p>
<p>All talks were recorded but I have no idea what's happening with the videos!</p>
<p>I will definitely make a point of visiting Thessaloniki more often and follow the local
IT and start-up scenes there. And tonight is Silicon Drinkabout which will be the official
after party of <a href="http://digitalk.bg/">DigitalK</a> in Sofia.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 22 May 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/05/22/devit-conf-2015-impressions/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/05/21/bug-in-vmware-open-house-website/" rel="bookmark" title="Permalink to Bug in VMware Open House Website">
                <h2 class="post-title">
                    Bug in VMware Open House Website
                </h2>
            </a>
            <p><img alt="&quot;Open House website bug&quot;" src="/images/vmware_bug.png" title="Bug in VMware Open House website" /></p>
<p>This is a slightly annoying UI bug in
<a href="http://www.openhouse.vmware-bulgaria.com/">VMware's Open House</a> website. I've reported
it and hopefully they will fix it.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 21 May 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/05/21/bug-in-vmware-open-house-website/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/05/20/free-software-testing-books/" rel="bookmark" title="Permalink to Free Software Testing Books">
                <h2 class="post-title">
                    Free Software Testing Books
                </h2>
            </a>
            <p>There's a huge list of 
<a href="https://github.com/ligurio/free-software-testing-books/blob/master/free-software-testing-books.md">free books</a>
on the topic of software testing. This will definitely be my summer reading list.
I hope you find it helpful.</p>
<h2>200 Graduation Theses About Software Testing</h2>
<p>The guys from <a href="http://qahelp.net">QAHelp</a> have compiled a list of 200
graduation theses from various universities which are freely accessible
online. The list can be found
<a href="http://qahelp.net/200-dissertatsij-po-testirovaniyu-v-svobodnoj-dostupe/">here</a>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 20 May 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/05/20/free-software-testing-books/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/05/13/why-does-sysctl-not-write-under-slash-sys/" rel="bookmark" title="Permalink to Why does sysctl not write under /sys">
                <h2 class="post-title">
                    Why does sysctl not write under /sys
                </h2>
            </a>
            <p>Recently I've been looking into 
<a href="/blog/2015/04/30/fixing-tilde-and-function-keys-mapping-for-macbook-air-on-linux/">fixing tilde and Fn keys mapping for MacBook Air</a>
and thought I could use <code>sysctl</code> to permanently set the desired values. Unfortunately this is not
possible. <code>sysctl</code> can only write under <code>/proc/sys</code> and this is 
<a href="https://gitlab.com/procps-ng/procps/blob/master/sysctl.c#L54">hard-coded in the source</a>:</p>
<div class="highlight"><pre>static const char PROC_PATH[] = &quot;/proc/sys/&quot;;
</pre></div>


<p>IMO this is relatively easy to patch and allow sysctl to read/write values under /sys.
The only open question I see is backward compatibility - maybe adding new parameter (e.g. --sysfs)
or adding extended sytax e.g. if variable name starts with / then treat it as absolute path.</p>
<p>I've asked sysctl maintainers on the 
<a href="http://www.freelists.org/post/procps/Can-we-make-sysctl-readwrite-sys-values-along-with-procsys">procps mailing list</a>
but so far got no answer. </p>
<p>Is anyone else interested in this? How do you set parameter values under /sys then ?</p>
<p><strong>NOTE:</strong> for my particular purposes I could have used config files under
<em>/etc/modprobe.d/</em> or a startup script (I used that) instead.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 13 May 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/05/13/why-does-sysctl-not-write-under-slash-sys/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/05/05/using-usb-to-vga-adapter-on-macbook-air-with-linux/" rel="bookmark" title="Permalink to Using USB to VGA Adapter on MacBook Air with Linux">
                <h2 class="post-title">
                    Using USB to VGA Adapter on MacBook Air with Linux
                </h2>
            </a>
            <p>A quick solution for <a class="wikilink" href="http://amzn.to/1RdviyD">MacBook Air</a> users running Linux who want to
use external projector is to use a USB to VGA adapter. Mine is
<a href="http://www.amazon.com/gp/product/B004AIJE9G/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=B004AIJE9G&linkCode=as2&tag=atodorovorg-20&linkId=74W7KWXBGC7SZ5QH">Plugable UGA-165</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=as2&o=1&a=B004AIJE9G" width="1" height="1" border="0"  style="border:none !important; margin:0px !important;" />
and it works great with Red Hat Enterprise Linux 7.1.</p>
<p>After the device is plugged in the <em>udl</em> kernel module is loaded
and a new framebuffer device is created (/dev/fb1 in my case). Using
<em>mate-display-properties</em> I'm able to configure the 2nd monitor attached
to the USB video card. I was able to succeffully display an OpenOffice
presentation on the 2nd monitor and play YouTube video.</p>
<p>All USB 2.0 devices from Plugable should be well supported on Linux.
For USB 3.0 David Airlie from Red Hat is doing some reverse engineering
but I have no idea what the status is. For more info see:</p>
<ul>
<li><a href="http://plugable.com/2012/06/21/displaylink-usb-devices-on-linux-kernel-3-4-0">http://plugable.com/2012/06/21/displaylink-usb-devices-on-linux-kernel-3-4-0</a></li>
<li><a href="http://airlied.livejournal.com/80307.html">http://airlied.livejournal.com/80307.html</a></li>
<li><a href="http://airlied.livejournal.com/80516.html">http://airlied.livejournal.com/80516.html</a></li>
<li><a href="http://airlied.livejournal.com/80797.html">http://airlied.livejournal.com/80797.html</a></li>
</ul>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 05 May 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/05/05/using-usb-to-vga-adapter-on-macbook-air-with-linux/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/05/04/thunderbolt-to-ethernet-adapter-on-linux/" rel="bookmark" title="Permalink to Thunderbolt to Ethernet Adapter on Linux">
                <h2 class="post-title">
                    Thunderbolt to Ethernet Adapter on Linux
                </h2>
            </a>
            <p>As it seems my
<a href="http://www.amazon.com/gp/product/B008ALA6DW/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=B008ALA6DW&linkCode=as2&tag=atodorovorg-20&linkId=T2J6D7GIDMKNWLYV">Thunderbolt to gigabit Ethernet adapter</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=as2&o=1&a=B008ALA6DW" width="1" height="1" border="0"  style="border:none !important; margin:0px !important;" />
works with 
<a href="/blog/2015/04/26/installing-red-hat-enterprise-linux-7-on-macbook-air-2015/">RHEL 7.1</a>
on a <a class="wikilink" href="http://amzn.to/1RdviyD">MacBook Air</a> despite some reports it may not.</p>
<p>After plugging the device is automatically recognized and the <em>tg3</em> driver is loaded.
Detailed <em>lspci</em> below:</p>
<div class="highlight"><pre><span class="mi">0</span><span class="n">a</span><span class="o">:</span><span class="mf">00.0</span> <span class="n">Ethernet</span> <span class="n">controller</span><span class="o">:</span> <span class="n">Broadcom</span> <span class="n">Corporation</span> <span class="n">NetXtreme</span> <span class="n">BCM57762</span> <span class="n">Gigabit</span> <span class="n">Ethernet</span> <span class="n">PCIe</span>
    <span class="n">Subsystem</span><span class="o">:</span> <span class="n">Apple</span> <span class="n">Inc</span><span class="o">.</span> <span class="n">Device</span> <span class="mi">00</span><span class="n">f6</span>
    <span class="n">Physical</span> <span class="n">Slot</span><span class="o">:</span> <span class="mi">9</span>
    <span class="n">Flags</span><span class="o">:</span> <span class="n">bus</span> <span class="n">master</span><span class="o">,</span> <span class="n">fast</span> <span class="n">devsel</span><span class="o">,</span> <span class="n">latency</span> <span class="mi">0</span><span class="o">,</span> <span class="n">IRQ</span> <span class="mi">19</span>
    <span class="n">Memory</span> <span class="n">at</span> <span class="n">cd800000</span> <span class="o">(</span><span class="mi">64</span><span class="o">-</span><span class="n">bit</span><span class="o">,</span> <span class="n">prefetchable</span><span class="o">)</span> <span class="o">[</span><span class="n">size</span><span class="o">=</span><span class="mi">64</span><span class="n">K</span><span class="o">]</span>
    <span class="n">Memory</span> <span class="n">at</span> <span class="n">cd810000</span> <span class="o">(</span><span class="mi">64</span><span class="o">-</span><span class="n">bit</span><span class="o">,</span> <span class="n">prefetchable</span><span class="o">)</span> <span class="o">[</span><span class="n">size</span><span class="o">=</span><span class="mi">64</span><span class="n">K</span><span class="o">]</span>
    <span class="o">[</span><span class="n">virtual</span><span class="o">]</span> <span class="n">Expansion</span> <span class="n">ROM</span> <span class="n">at</span> <span class="n">cd820000</span> <span class="o">[</span><span class="n">disabled</span><span class="o">]</span> <span class="o">[</span><span class="n">size</span><span class="o">=</span><span class="mi">64</span><span class="n">K</span><span class="o">]</span>
    <span class="n">Capabilities</span><span class="o">:</span> <span class="o">[</span><span class="mi">48</span><span class="o">]</span> <span class="n">Power</span> <span class="n">Management</span> <span class="n">version</span> <span class="mi">3</span>
    <span class="n">Capabilities</span><span class="o">:</span> <span class="o">[</span><span class="mi">50</span><span class="o">]</span> <span class="n">Vital</span> <span class="n">Product</span> <span class="n">Data</span>
    <span class="n">Capabilities</span><span class="o">:</span> <span class="o">[</span><span class="mi">58</span><span class="o">]</span> <span class="n">MSI</span><span class="o">:</span> <span class="n">Enable</span><span class="o">-</span> <span class="n">Count</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">8</span> <span class="n">Maskable</span><span class="o">-</span> <span class="mi">64</span><span class="n">bit</span><span class="o">+</span>
    <span class="n">Capabilities</span><span class="o">:</span> <span class="o">[</span><span class="n">a0</span><span class="o">]</span> <span class="n">MSI</span><span class="o">-</span><span class="n">X</span><span class="o">:</span> <span class="n">Enable</span><span class="o">+</span> <span class="n">Count</span><span class="o">=</span><span class="mi">6</span> <span class="n">Masked</span><span class="o">-</span>
    <span class="n">Capabilities</span><span class="o">:</span> <span class="o">[</span><span class="n">ac</span><span class="o">]</span> <span class="n">Express</span> <span class="n">Endpoint</span><span class="o">,</span> <span class="n">MSI</span> <span class="mi">00</span>
    <span class="n">Capabilities</span><span class="o">:</span> <span class="o">[</span><span class="mi">100</span><span class="o">]</span> <span class="n">Advanced</span> <span class="n">Error</span> <span class="n">Reporting</span>
    <span class="n">Capabilities</span><span class="o">:</span> <span class="o">[</span><span class="mi">13</span><span class="n">c</span><span class="o">]</span> <span class="n">Device</span> <span class="n">Serial</span> <span class="n">Number</span> <span class="mi">00</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="n">ac</span><span class="o">-</span><span class="mi">87</span><span class="o">-</span><span class="n">a3</span><span class="o">-</span><span class="mi">25</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="mi">33</span>
    <span class="n">Capabilities</span><span class="o">:</span> <span class="o">[</span><span class="mi">150</span><span class="o">]</span> <span class="n">Power</span> <span class="n">Budgeting</span> <span class="o">&lt;?&gt;</span>
    <span class="n">Capabilities</span><span class="o">:</span> <span class="o">[</span><span class="mi">160</span><span class="o">]</span> <span class="n">Virtual</span> <span class="n">Channel</span>
    <span class="n">Capabilities</span><span class="o">:</span> <span class="o">[</span><span class="mi">1</span><span class="n">b0</span><span class="o">]</span> <span class="n">Latency</span> <span class="n">Tolerance</span> <span class="n">Reporting</span>
    <span class="n">Kernel</span> <span class="n">driver</span> <span class="k">in</span> <span class="n">use</span><span class="o">:</span> <span class="n">tg3</span>
</pre></div>


<p>Unplugging and pluggin back in the network cable works as expected.
I did see my computer freeze 2 out of 10 times when I've unplugged the
<a href="http://amzn.to/1Iqi22v">Thunderbolt adapter</a> but couldn't reproduce it repliably
or grab more info. </p>
<p>For the record this is with kernel 3.10.0-229.1.2.el7.x86_64 which is missing
this
<a href="https://git.kernel.org/cgit/linux/kernel/git/gregkh/char-misc.git/commit/?h=char-misc-next&amp;id=16603153666d22df544ae9f9b3764fd18da28eeb">upstream commit</a>.
I'm not sure why it works though.</p>
<p>If I remember correctly <em>tg3</em> is available during installation so you should
be able to use the <a href="http://amzn.to/1Iqi22v">Thunderbolt adapter</a> instead of WiFi as well.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 04 May 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/05/04/thunderbolt-to-ethernet-adapter-on-linux/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/05/01/compiling-twinkle-sip-phone-on-rhel-7/" rel="bookmark" title="Permalink to Compiling Twinkle SIP Phone on RHEL 7">
                <h2 class="post-title">
                    Compiling Twinkle SIP Phone on RHEL 7
                </h2>
            </a>
            <p>One of the best SIP clients for Linux is <a href="http://twinklephone.com/">Twinkle</a>.
However upstream is not active (or even maybe dead) and the package is missing from
latest Fedora releases and fails to build on RHEL 7.</p>
<p>First you need to build and install a few dependencies in the following order:
<a href="http://koji.fedoraproject.org/koji/packageinfo?packageID=8437">ucommon</a>,
<a href="http://koji.fedoraproject.org/koji/packageinfo?packageID=1443">ccrtp</a>,
<a href="http://koji.fedoraproject.org/koji/packageinfo?packageID=6408">libzrtpcpp</a>.
You will also need <a href="https://fedoraproject.org/wiki/EPEL">EPEL 7</a> enabled
to satisfy build dependencies.</p>
<p>Then apply the following patch to the original 
<a href="http://koji.fedoraproject.org/koji/buildinfo?buildID=397914">twinkle.spec</a></p>
<div class="highlight"><pre><span class="o">---</span> <span class="n">twinkle</span><span class="p">.</span><span class="n">spec</span><span class="p">.</span><span class="n">orig</span>   <span class="mi">2015</span><span class="o">-</span><span class="mo">05</span><span class="o">-</span><span class="mo">01</span> <span class="mi">14</span><span class="o">:</span><span class="mo">07</span><span class="o">:</span><span class="mf">01.870710147</span> <span class="o">+</span><span class="mo">0300</span>
<span class="o">+++</span> <span class="n">twinkle</span><span class="p">.</span><span class="n">spec</span>    <span class="mi">2015</span><span class="o">-</span><span class="mo">05</span><span class="o">-</span><span class="mo">01</span> <span class="mi">15</span><span class="o">:</span><span class="mo">07</span><span class="o">:</span><span class="mf">28.734734573</span> <span class="o">+</span><span class="mo">0300</span>
<span class="err">@@</span> <span class="o">-</span><span class="mi">47</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">47</span><span class="p">,</span><span class="mi">8</span> <span class="err">@@</span>
 
 <span class="nf">%build</span>
 <span class="k">export</span> <span class="n">LDFLAGS</span><span class="o">=-</span><span class="n">lkio</span> 
<span class="o">+</span><span class="k">export</span> <span class="n">CPPFLAGS</span><span class="o">=</span><span class="s">&quot;$CPPFLAGS -I/usr/include/libzrtpcpp/&quot;</span> 
<span class="o">+</span><span class="nf">%__autoconf</span>
 <span class="nf">%configure</span>
 <span class="n">make</span> <span class="o">%</span><span class="p">{</span><span class="o">?</span><span class="n">_smp_mflags</span><span class="p">}</span>
</pre></div>


<p>The package now builds, installs and runs successfully on RHEL 7.
The compiled packages and dependencies are available in my
<a href="/blog/2015/04/29/rhel-7-repository-for-macbook-air/">Macbook Air RHEL 7 repository</a>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 01 May 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/05/01/compiling-twinkle-sip-phone-on-rhel-7/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/04/30/fixing-tilde-and-function-keys-mapping-for-macbook-air-on-linux/" rel="bookmark" title="Permalink to Fixing Tilde and Function Keys Mapping for MacBook Air on Linux">
                <h2 class="post-title">
                    Fixing Tilde and Function Keys Mapping for MacBook Air on Linux
                </h2>
            </a>
            <p>Thera are two problems with the <a class="wikilink" href="http://amzn.to/1RdviyD">MacBook Air</a> keyboard on Linux:</p>
<p>Function keys and media keys are switched and by default you have to
press Fn+F5 in order to refresh a browser page. The 
<a href="https://chaidarun.com/fedora-mbp">solution</a> is</p>
<div class="highlight"><pre>echo 2 &gt; /sys/module/hid_apple/parameters/fnmode
</pre></div>


<p>The tilde key is mapped improperly, see 
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1025041#c2">RHBZ #1025041</a>.
To fix it</p>
<div class="highlight"><pre>echo 0 &gt; /sys/module/hid_apple/parameters/iso_layout
</pre></div>


<h2>Permanent fix</h2>
<p>Either you have to add the above commands in a boot script or you can
<code>yum install mba-kbd-fix</code> from my
<a href="/blog/2015/04/29/rhel-7-repository-for-macbook-air/">Macbook Air RHEL 7 repository</a>.
The RPM source can be found <a href="https://github.com/atodorov/mba-kbd-fix">here</a>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Thu 30 April 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/04/30/fixing-tilde-and-function-keys-mapping-for-macbook-air-on-linux/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/04/29/rhel-7-repository-for-macbook-air/" rel="bookmark" title="Permalink to Red Hat Enterprise Linux 7 Repository for MacBook Air">
                <h2 class="post-title">
                    Red Hat Enterprise Linux 7 Repository for MacBook Air
                </h2>
            </a>
            <p>I've made a repository with binary (x86_64 only) and source RPM packages which
are missing from Red Hat Enterprise Linux 7 and necessary when using a 
<a class="wikilink" href="http://amzn.to/1RdviyD">MacBook Air</a>. To install execute the commands below:</p>
<div class="highlight"><pre>cd /etc/yum.repos.d/
wget https://s3.amazonaws.com/atodorov/rpms/macbook/el7/rhel7-macbook.repo
</pre></div>


<h2>Wireless driver</h2>
<div class="highlight"><pre>yum install kmod-wl
</pre></div>


<h2>Display backlight driver</h2>
<div class="highlight"><pre>yum install kmod-mba6x_bl
</pre></div>


<p>And uncomment <code>/etc/X11/xorg.conf.d/98-mba_bl.conf</code>.</p>
<p><em>Note:</em> the .spec file is available from 
<a href="https://github.com/patjak/mba6x_bl/pull/26">RP #26</a>.</p>
<h2>Fixing keyboard mapping</h2>
<div class="highlight"><pre>yum install mba-kbd-fix
</pre></div>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 29 April 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/04/29/rhel-7-repository-for-macbook-air/#disqus_thread">comments</a>.</p>        </div>
        <hr>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/04/29/fixing-display-brightness-on-macbook-air-with-rhel-7/" rel="bookmark" title="Permalink to Fixing Display Brightness on MacBook Air with RHEL 7">
                <h2 class="post-title">
                    Fixing Display Brightness on MacBook Air with RHEL 7
                </h2>
            </a>
            <p>One issue with RHEL/CentOS/Fedora on <a class="wikilink" href="http://amzn.to/1RdviyD">MacBook Air</a> laptops is brightness control
and backlight behavior after suspend/resume. I've found the solution 
<a href="http://mattoncloud.org/2014/02/05/fedora-20-on-a-macbook-air/">here</a>
and only tweaked it slightly for my use case.</p>
<h2>mba6x_bl doesn't load automatically</h2>
<p>The reason being the driver matches older hardware:</p>
<div class="highlight"><pre><span class="nv">$ </span>modinfo mba6x_bl
filename:       /lib/modules/3.10.0-229.1.2.el7.x86_64/extra/mba6x_bl/mba6x_bl.ko
<span class="nb">alias</span>:          dmi:*:pnMacBookAir6*
license:        GPL
description:    MacBook Air 6,1 and 6,2 backlight driver
author:         Patrik Jakobsson &lt;patrik.r.jakobsson@gmail.com&gt;
rhelversion:    7.1
srcversion:     4D069C8EB0E470AF27E7F8D
depends:        video
vermagic:       3.10.0-229.1.2.el7.x86_64 SMP mod_unload modversions
</pre></div>


<p>My system is <strong>MacBookAir7,2</strong> and doesn't match the module alias. So a 
<a href="https://github.com/patjak/mba6x_bl/pull/25">quick fix</a> was needed.
For more info about <code>MODULE_ALIAS</code> see
<a href="https://wiki.archlinux.org/index.php/Modalias">ArchWiki</a>.
Alternatively on Red Hat based systems you can place a config file
under <code>/etc/sysconfig/modules</code>, see 
<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/sec-Persistent_Module_Loading.html">the docs</a>
for more details.</p>
<h2>intel_backlight driver is in the way</h2>
<p>On older systems mba6x_bl doesn't get used automatically. The problem is the offending
intel_backlight driver which gets used instead. To workaround it add this xorg.conf snippet:</p>
<div class="highlight"><pre><span class="nv">$ </span>cat /etc/X11/xorg.conf.d/98-mba_bl.conf
Section <span class="s2">&quot;Device&quot;</span>
    Identifier      <span class="s2">&quot;Intel Graphics&quot;</span>
    Driver          <span class="s2">&quot;intel&quot;</span>
    Option          <span class="s2">&quot;Backlight&quot;</span>     <span class="s2">&quot;mba6x_backlight&quot;</span>
EndSection
</pre></div>


<p>For more info see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=989555#c19">RHBZ 989555</a>.</p>
<h2>Everything in one go</h2>
<p>If you are using RHEL 7 or CentOS 7 (version 7.1 required) instead of Fedora you can take
a look at my <a href="/blog/2015/04/29/rhel-7-repository-for-macbook-air/">Macbook Air RHEL 7 repository</a>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 29 April 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/04/29/fixing-display-brightness-on-macbook-air-with-rhel-7/#disqus_thread">comments</a>.</p>        </div>
        <hr>

    <!-- Pager -->
    <ul class="pager">
        <li class="next">
                <a href="http://atodorov.org/category/_posts.html">Newest Posts &rarr;</a>
                <a href="http://atodorov.org/category/_posts3.html">Older Posts &rarr;</a>
        </li>
    </ul>
    Page 2 / 11
    <hr>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="https://twitter.com/atodorov_">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/atodorov">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>

                        <li>
                            <a href="https://bg.linkedin.com/in/alextodorov">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>


                    <section>
                        <p>
                            I am a QA contractor at Red Hat responsible for over
                            <a href="/blog/2014/02/19/7-years-1400-bugs-red-hat-qa/">1500 bugs</a>,
                            a general purpose open source developer, Red Hat Certified professional,
                            cloud hacker and an entrepreneur!
                        </p>

                        <p>
                            I am living in the <a href="http://planet.sofiavalley.com">Sofia Valley</a>
                            which is emerging as a busy place for start-up founders and tech enthusiasts
                            in Eastern Europe! You can find more about me <a href="/blog/2013/01/25/about-me/">here</a>.
                        </p>

                        <p>
                            <small>
                                <em>
                                    Some of the links contained within this site have my referral id (e.g.,
                                    <a target="_blank" href="http://www.amazon.com/ref=as_li_ss_tl?_encoding=UTF8&camp=1789&creative=390957&linkCode=ur2&tag=atodorovorg-20&linkId=L6Q34XAXQS5RDMOY">Amazon</a><img src="https://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=ur2&o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />),
                                    which provides me with a small commission for each sale. Thank you for your support.
                                </em>
                            </small>
                        </p>
                    </section>

                    <form action="http://google.com/search" method="get" style="width:300px;margin:0 auto;">
                        <fieldset role="search">
                            <input type="hidden" name="sitesearch" value="http://atodorov.org" />
                            <input class="search" type="text" name="q" placeholder="Search" style="width:100%"/>
                        </fieldset>
                    </form>

                    <p class="copyright text-muted">
                        <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">CC-BY-SA</a> &amp;
                        <a rel="license" href="http://opensource.org/licenses/MIT">MIT</a>
                        2011-2015 &diams; Alexander Todorov &diams;
                        <a href="http://planet.sofiavalley.com">SofiaValley Blog</a>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="http://atodorov.org/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="http://atodorov.org/theme/js/bootstrap.min.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37979549-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'atodorov';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>