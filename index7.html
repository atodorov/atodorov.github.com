<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

            <meta name="google-site-verification" content="XynqZtldWNBbmsynVQZremIxaaO8Wgs6AGR8UZ7KIkM">

        <title>atodorov.org - you can logoff, but you can never leave</title>

        <link href="http://feeds.feedburner.com/atodorov" type="application/atom+xml" rel="alternate" title="atodorov.org Full Atom Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="http://atodorov.org/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="http://atodorov.org/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="http://atodorov.org/theme/css/code_blocks/github.css" rel="stylesheet">

            <!-- CSS specified by the user -->
            <link href="http://atodorov.org/override.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="http://atodorov.org/theme/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

                <meta property="fb:admins" content="1616937247" >
                <meta property="og:locale" content="en_US">
		<meta property="og:site_name" content="atodorov.org">
            <meta name="twitter:card" content="summary_large_image">
            <meta name="twitter:site" content="@atodorov_">
            <meta name="twitter:title" content="atodorov.org">
            <meta name="twitter:description" content="you can logoff, but you can never leave">
                <meta name="twitter:image" content="http://atodorov.org//images/header_02.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://atodorov.org/">atodorov.org</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                        <li><a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=menu">Mr. Senko</a></li>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
        <header class="intro-header" style="background-image: url('/images/header_02.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="page-heading">
                        <h1>atodorov.org</h1>
                            <hr class="small">
                            <span class="subheading">you can logoff, but you can never leave</span>
                            <ul class="list-inline text-center">
                                <li>
                                    <a href="https://twitter.com/atodorov_">
                                        <span class="fa-stack fa-lg">
                                            <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://github.com/atodorov">
                                        <span class="fa-stack fa-lg">
                                            <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://bg.linkedin.com/in/alextodorov">
                                        <span class="fa-stack fa-lg">
                                            <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="http://feeds.feedburner.com/atodorov">
                                        <span class="fa-stack fa-lg">
                                            <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://www.youtube.com/playlist?list=PLFjlI7p-h1hxBP3cIjEqePSeoBDHud5Db">
                                        <span class="fa-stack fa-lg">
                                            <i class="fa fa-youtube fa-stack-1x fa-inverse"></i>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="http://amzn.to/1ivu2q4">
                                        <span class="fa-stack fa-lg">
                                            <i class="fa fa-amazon fa-stack-1x fa-inverse"></i>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=social_icon">
                                        <span class="fa-stack fa-lg">
                                            <i class="fa fa-user-secret fa-stack-1x fa-inverse"></i>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/04/20/videos-from-bulgaria-web-summit-2015/" rel="bookmark" title="Permalink to Videos from Bulgaria Web Summit 2015">
                <h2 class="post-title">
                    Videos from Bulgaria Web Summit 2015
                </h2>
            </a>
                <p><img alt="We're full" src="/images/bgws2015.jpg" title="We're full" /></p>
<p><a href="http://bulgariawebsummit.com">Bulgaria Web Summit</a> 2015 is over. The event was
incredible and I had a lot of fun moderating the main room. We had many people
coming from other countries and I've made lots of new friends.
Thank you to everyone who attended!</p>
<p>You can find video recordings of all talks in the main room (in order of appearance) below:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3THnzZCI4sw?rel=0" frameborder="0" allowfullscreen></iframe>

<iframe width="560" height="315" src="https://www.youtube.com/embed/LtgPnYkEj3E?rel=0" frameborder="0" allowfullscreen></iframe>

<iframe width="560" height="315" src="https://www.youtube.com/embed/4IFyMSvoy-c?rel=0" frameborder="0" allowfullscreen></iframe>

<iframe width="560" height="315" src="https://www.youtube.com/embed/ZGLKZSnCIUU?rel=0" frameborder="0" allowfullscreen></iframe>

<iframe width="560" height="315" src="https://www.youtube.com/embed/GBv4QWFDETY?rel=0" frameborder="0" allowfullscreen></iframe>

<iframe width="560" height="315" src="https://www.youtube.com/embed/DhnsmsvSG7w?rel=0" frameborder="0" allowfullscreen></iframe>

<p>Hope to see you next time in Sofia! </p>
<p>Mean while I learned about <a href="http://devitconf.org/">DEVit</a> in Thessaloniki in May and another one in Zagreb in October.
See you there :)</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 20 April 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/04/20/videos-from-bulgaria-web-summit-2015/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/04/14/how-to-find-if-lvm-volume-is-thinly-provisioned/" rel="bookmark" title="Permalink to How to Find if LVM Volume is Thinly Provisioned">
                <h2 class="post-title">
                    How to Find if LVM Volume is Thinly Provisioned
                </h2>
            </a>
                <p>The latest versions of Red Hat Enterprise Linux, CentOS and Fedora all
support LVM thin provisioning. Here's how to tell if a logical volume
has been thinly provisioned or not.</p>
<p>Using <code>lvs</code> to display volume information look under the <em>Attr</em> column.
Attribute values have the following meaning:</p>
<blockquote>
<p>The lv_attr bits are:</p>
<p>1  Volume type: (C)ache, (m)irrored, (M)irrored without initial sync, (o)rigin,
(O)rigin  with  merging  snapshot, (r)aid,  (R)aid  without  initial  sync,
(s)napshot,  merging  (S)napshot, (p)vmove, (v)irtual, mirror or raid (i)mage,
mirror or raid (I)mage out-of-sync, mirror (l)og device, under  (c)onversion,
thin  (V)olume,  (t)hin pool, (T)hin pool data, raid or pool m(e)tadata or
pool metadata spare.</p>
</blockquote>
<p>This is how <code>lvs</code> looks like when you have a regular LVM setup:</p>
<div class="highlight"><pre># lvs
  LV   VG              Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root rhel_dhcp70-183 -wi-ao---- 17,47g                                                    
  swap rhel_dhcp70-183 -wi-ao----  2,00g
</pre></div>


<p>When using LVM thin provisioning you're looking for the left-most attribute bit
to be V, t or T. Here's an example:</p>
<div class="highlight"><pre># lvs
  LV     VG              Attr       LSize  Pool   Origin Data%  Meta%  Move Log Cpy%Sync Convert
  pool00 rhel_dhcp71-101 twi-aotz-- 14,55g               7,52   3,86                            
  root   rhel_dhcp71-101 Vwi-aotz-- 14,54g pool00        7,53                                   
  swap   rhel_dhcp71-101 -wi-ao----  2,00g
</pre></div>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 14 April 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/04/14/how-to-find-if-lvm-volume-is-thinly-provisioned/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/04/08/tip-linux-io-default-lun-is-0-instead-of-1/" rel="bookmark" title="Permalink to Tip: Linux-IO default LUN is 0 instead of 1">
                <h2 class="post-title">
                    Tip: Linux-IO default LUN is 0 instead of 1
                </h2>
            </a>
                <p>I've been testing iBFT in KVM which worked quite well with a RHEL 6 iSCSI target
and failed miserably when I switched to RHEL 7 iSCSI target.</p>
<div class="highlight"><pre>iPXE&gt; dhcp net0
DHCP (net0 52:54:00:12:34:56)... ok
iPXE&gt; set keep-san 1
iPXE&gt; sanboot iscsi:10.0.0.1:::1:iqn.2015-05.com.example:target1
Could not open SAN device: Input/output error (http://ipxe.org/1d704539)
iPXE&gt;
</pre></div>


<p>The <a href="http://ipxe.org/err/1d7045">error page</a> says</p>
<blockquote>
<p>Note that the default configuration when Linux is the target is for the disk to be LUN 1.</p>
</blockquote>
<p>Well this is not true for Linux-IO (targetcli). <strong>The default LUN is 0!</strong></p>
<div class="highlight"><pre>iPXE&gt; sanboot iscsi:10.0.0.1:::0:iqn.2015-05.com.example:target1
Registered SAN device 0x80
Booting from SAN device 0x80
</pre></div>


<p>Kudos to Bruno Goncalves from Red Hat in helping me debug this issue!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 08 April 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/04/08/tip-linux-io-default-lun-is-0-instead-of-1/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/04/08/how-to-configure-targetcli-to-listen-on-ipv4-and-ipv6/" rel="bookmark" title="Permalink to How to Configure targetcli to Listen on IPv4 and IPv6">
                <h2 class="post-title">
                    How to Configure targetcli to Listen on IPv4 and IPv6
                </h2>
            </a>
                <p>In order to configure <em>targetcli</em> to listen on both IPv4 and IPv6 one has to
delete the default IPv4 portal configuration and replace it with IPv6 instead.</p>
<div class="highlight"><pre># targetcli 
/&gt;
/&gt; cd iscsi/iqn.2015-04.com.example:target1/tpg1/portals
/iscsi/iqn.20.../tpg1/portals&gt; ls
o- portals ............................................................................................................ [Portals: 1]
  o- 0.0.0.0:3260 ............................................................................................................. [OK]
/iscsi/iqn.20.../tpg1/portals&gt; delete 0.0.0.0 3260
Deleted network portal 0.0.0.0:3260
/iscsi/iqn.20.../tpg1/portals&gt; create ::0
Using default IP port 3260
Created network portal ::0:3260.
/iscsi/iqn.20.../tpg1/portals&gt; ls
o- portals ............................................................................................................ [Portals: 1]
  o- [::0]:3260 ............................................................................................................... [OK]
/iscsi/iqn.20.../tpg1/portals&gt; exit

# netstat -antp | grep 3260
tcp6       0      0 :::3260                 :::*                    LISTEN
</pre></div>


<p>It appears the target is listening only on IPv6 but in fact it will
also accept connections over IPv4. I've tried it. </p>
<p>This is a bit counter intuitive, however if you try adding the IPv6 address
without removing the default IPv4 one <em>targetcli</em> will throw an error:</p>
<div class="highlight"><pre>/iscsi/iqn.20.../tpg1/portals&gt; create ::0
Using default IP port 3260
Could not create NetworkPortal in configFS.
/&gt;
</pre></div>


<p>For more information about <em>targetcli</em> usage see my previous post
<a href="/blog/2015/04/07/how-to-configure-iscsi-target-on-red-hat-enterprise-linux-7/">How to Configure iSCSI Target on Red Hat Enterprise Linux 7</a>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 08 April 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/04/08/how-to-configure-targetcli-to-listen-on-ipv4-and-ipv6/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/04/07/how-to-configure-iscsi-target-on-red-hat-enterprise-linux-7/" rel="bookmark" title="Permalink to How to Configure iSCSI Target on Red Hat Enterprise Linux 7">
                <h2 class="post-title">
                    How to Configure iSCSI Target on Red Hat Enterprise Linux 7
                </h2>
            </a>
                <p>Linux-IO (LIO) Target is an open-source implementation of the SCSI target that
has become the standard one included in the Linux kernel and the one present in
Red Hat Enterprise Linux 7. The popular <em>scsi-target-utils</em> package is replaced
by the newer <em>targetcli</em> which makes configuring a software iSCSI target quite
different.</p>
<p>In earlier versions one had to edit the <code>/etc/tgtd/targets.conf</code> file and
<code>service tgtd restart</code>. Here is an example configuration:</p>
<div class="highlight"><pre><span class="nt">&lt;target</span> <span class="err">iqn.2008-09.com.example:server.target1</span><span class="nt">&gt;</span>
    backing-store /dev/vg_iscsi/lv_lun1
    backing-store /dev/vg_iscsi/lv_lun2

    incominguser user2 secretpass23
    outgoinguser userA secretpassA
<span class="nt">&lt;/target&gt;</span>
</pre></div>


<p><em>targetcli</em> can be used either as an interactive shell or as stand alone commands.
Here is an example shell session which creates a file-based disk image. Comments are
provided inline:</p>
<div class="highlight"><pre><span class="cp"># yum install -y targetcli</span>
<span class="cp"># systemctl enable target</span>

<span class="cp"># targetcli </span>

<span class="cp"># first create a disk image with the name of disk1. All files are sparsely created.</span>

<span class="o">/&gt;</span> <span class="n">backstores</span><span class="o">/</span><span class="n">fileio</span> <span class="n">create</span> <span class="n">disk1</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libvirt</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">disk1</span><span class="p">.</span><span class="n">img</span> <span class="mi">10</span><span class="n">G</span>
<span class="n">Created</span> <span class="n">fileio</span> <span class="n">disk1</span> <span class="n">with</span> <span class="n">size</span> <span class="mi">10737418240</span>

<span class="cp"># create an iSCSI target. NB: this only defines the target</span>

<span class="o">/&gt;</span> <span class="n">iscsi</span><span class="o">/</span> <span class="n">create</span> <span class="n">iqn</span><span class="mf">.2015</span><span class="o">-</span><span class="mf">04.</span><span class="n">com</span><span class="p">.</span><span class="nl">example</span><span class="p">:</span><span class="n">target1</span>
<span class="n">Created</span> <span class="n">target</span> <span class="n">iqn</span><span class="mf">.2015</span><span class="o">-</span><span class="mf">04.</span><span class="n">com</span><span class="p">.</span><span class="nl">example</span><span class="p">:</span><span class="n">target1</span><span class="p">.</span>
<span class="n">Created</span> <span class="n">TPG</span> <span class="mf">1.</span>
<span class="n">Global</span> <span class="n">pref</span> <span class="n">auto_add_default_portal</span><span class="o">=</span><span class="nb">true</span>
<span class="n">Created</span> <span class="k">default</span> <span class="n">portal</span> <span class="n">listening</span> <span class="n">on</span> <span class="n">all</span> <span class="n">IPs</span> <span class="p">(</span><span class="mf">0.0.0.0</span><span class="p">),</span> <span class="n">port</span> <span class="mf">3260.</span>

<span class="cp"># TPGs (Target Portal Groups) allow the iSCSI to support multiple complete</span>
<span class="cp"># configurations within one target. This is useful for complex quality-of-service</span>
<span class="cp"># configurations. targetcli will automatically create one TPG when the target</span>
<span class="cp"># is created, and almost all setups only need one.</span>

<span class="cp"># switch to TPG definition for our target</span>

<span class="o">/&gt;</span> <span class="n">cd</span> <span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.2015</span><span class="o">-</span><span class="mf">04.</span><span class="n">com</span><span class="p">.</span><span class="nl">example</span><span class="p">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span>

<span class="cp"># list the contents</span>

<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">ls</span> 
<span class="n">o</span><span class="o">-</span> <span class="n">tpg1</span> <span class="p">.....................................................................................................</span> <span class="p">[</span><span class="n">no</span><span class="o">-</span><span class="n">gen</span><span class="o">-</span><span class="n">acls</span><span class="p">,</span> <span class="n">no</span><span class="o">-</span><span class="n">auth</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">acls</span> <span class="p">................................................................................................................</span> <span class="p">[</span><span class="nl">ACLs</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">luns</span> <span class="p">................................................................................................................</span> <span class="p">[</span><span class="nl">LUNs</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">portals</span> <span class="p">..........................................................................................................</span> <span class="p">[</span><span class="nl">Portals</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">o</span><span class="o">-</span> <span class="mf">0.0.0.0</span><span class="o">:</span><span class="mi">3260</span> <span class="p">...........................................................................................................</span> <span class="p">[</span><span class="n">OK</span><span class="p">]</span>

<span class="cp"># create a portal aka IP:port pairs which expose the target on the network</span>

<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">portals</span><span class="o">/</span> <span class="n">create</span>
<span class="n">Using</span> <span class="k">default</span> <span class="n">IP</span> <span class="n">port</span> <span class="mi">3260</span>
<span class="n">Binding</span> <span class="n">to</span> <span class="n">INADDR_ANY</span> <span class="p">(</span><span class="mf">0.0.0.0</span><span class="p">)</span>
<span class="n">This</span> <span class="n">NetworkPortal</span> <span class="n">already</span> <span class="n">exists</span> <span class="k">in</span> <span class="n">configFS</span><span class="p">.</span>

<span class="cp"># create logical units (LUNs) aka disks inside our target</span>
<span class="cp"># in other words bind the target to its on-disk storage</span>

<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">luns</span><span class="o">/</span> <span class="n">create</span> <span class="o">/</span><span class="n">backstores</span><span class="o">/</span><span class="n">fileio</span><span class="o">/</span><span class="n">disk1</span>
<span class="n">Created</span> <span class="n">LUN</span> <span class="mf">0.</span>

<span class="cp"># disable authentication</span>

<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">attribute</span> <span class="n">authentication</span><span class="o">=</span><span class="mi">0</span>
<span class="n">Parameter</span> <span class="n">authentication</span> <span class="n">is</span> <span class="n">now</span> <span class="sc">&#39;0&#39;</span><span class="p">.</span>

<span class="cp"># enable read/write mode</span>

<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">attribute</span> <span class="n">demo_mode_write_protect</span><span class="o">=</span><span class="mi">0</span>
<span class="n">Parameter</span> <span class="n">demo_mode_write_protect</span> <span class="n">is</span> <span class="n">now</span> <span class="sc">&#39;0&#39;</span><span class="p">.</span>

<span class="cp"># Enable generate_node_acls mode. This can be thought of as </span>
<span class="cp"># &quot;ignore ACLs mode&quot; -- both  authentication and LUN mapping</span>
<span class="cp"># will then use the TPG settings.</span>

<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">attribute</span> <span class="n">generate_node_acls</span><span class="o">=</span><span class="mi">1</span>
<span class="n">Parameter</span> <span class="n">generate_node_acls</span> <span class="n">is</span> <span class="n">now</span> <span class="sc">&#39;1&#39;</span><span class="p">.</span>

<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">ls</span>
<span class="n">o</span><span class="o">-</span> <span class="n">tpg1</span> <span class="p">........................................................................................................</span> <span class="p">[</span><span class="n">gen</span><span class="o">-</span><span class="n">acls</span><span class="p">,</span> <span class="n">no</span><span class="o">-</span><span class="n">auth</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">acls</span> <span class="p">................................................................................................................</span> <span class="p">[</span><span class="nl">ACLs</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">luns</span> <span class="p">................................................................................................................</span> <span class="p">[</span><span class="nl">LUNs</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">lun0</span> <span class="p">.....................................................................</span> <span class="p">[</span><span class="n">fileio</span><span class="o">/</span><span class="n">disk1</span> <span class="p">(</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libvirt</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">disk1</span><span class="p">.</span><span class="n">img</span><span class="p">)]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">portals</span> <span class="p">..........................................................................................................</span> <span class="p">[</span><span class="nl">Portals</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">o</span><span class="o">-</span> <span class="mf">0.0.0.0</span><span class="o">:</span><span class="mi">3260</span> <span class="p">...........................................................................................................</span> <span class="p">[</span><span class="n">OK</span><span class="p">]</span>

<span class="cp"># exit or Ctrl+D will save the configuration under /etc/target/saveconfig.json</span>

<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">exit</span>
<span class="n">Global</span> <span class="n">pref</span> <span class="n">auto_save_on_exit</span><span class="o">=</span><span class="nb">true</span>
<span class="n">Last</span> <span class="mi">10</span> <span class="n">configs</span> <span class="n">saved</span> <span class="k">in</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">backup</span><span class="p">.</span>
<span class="n">Configuration</span> <span class="n">saved</span> <span class="n">to</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">saveconfig</span><span class="p">.</span><span class="n">json</span>

<span class="cp"># after creating a second target the layout looks like this</span>

<span class="o">/&gt;</span> <span class="n">ls</span>
<span class="n">o</span><span class="o">-</span> <span class="o">/</span> <span class="p">.........................................................................................................................</span> <span class="p">[...]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">backstores</span> <span class="p">..............................................................................................................</span> <span class="p">[...]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">block</span> <span class="p">..................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="nl">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">fileio</span> <span class="p">.................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="nl">Objects</span><span class="p">:</span> <span class="mi">2</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">disk1</span> <span class="p">..................................................</span> <span class="p">[</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libvirt</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">disk1</span><span class="p">.</span><span class="n">img</span> <span class="p">(</span><span class="mf">10.0</span><span class="n">GiB</span><span class="p">)</span> <span class="n">write</span><span class="o">-</span><span class="n">back</span> <span class="n">activated</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">disk2</span> <span class="p">..................................................</span> <span class="p">[</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libvirt</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">disk2</span><span class="p">.</span><span class="n">img</span> <span class="p">(</span><span class="mf">10.0</span><span class="n">GiB</span><span class="p">)</span> <span class="n">write</span><span class="o">-</span><span class="n">back</span> <span class="n">activated</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">pscsi</span> <span class="p">..................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="nl">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">ramdisk</span> <span class="p">................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="nl">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">iscsi</span> <span class="p">............................................................................................................</span> <span class="p">[</span><span class="nl">Targets</span><span class="p">:</span> <span class="mi">2</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">iqn</span><span class="mf">.2015</span><span class="o">-</span><span class="mf">04.</span><span class="n">com</span><span class="p">.</span><span class="nl">example</span><span class="p">:</span><span class="n">target1</span> <span class="p">...................................................................................</span> <span class="p">[</span><span class="nl">TPGs</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">tpg1</span> <span class="p">..................................................................................................</span> <span class="p">[</span><span class="n">gen</span><span class="o">-</span><span class="n">acls</span><span class="p">,</span> <span class="n">no</span><span class="o">-</span><span class="n">auth</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span>   <span class="n">o</span><span class="o">-</span> <span class="n">acls</span> <span class="p">..........................................................................................................</span> <span class="p">[</span><span class="nl">ACLs</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span>   <span class="n">o</span><span class="o">-</span> <span class="n">luns</span> <span class="p">..........................................................................................................</span> <span class="p">[</span><span class="nl">LUNs</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span>   <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">lun0</span> <span class="p">...............................................................</span> <span class="p">[</span><span class="n">fileio</span><span class="o">/</span><span class="n">disk1</span> <span class="p">(</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libvirt</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">disk1</span><span class="p">.</span><span class="n">img</span><span class="p">)]</span>
  <span class="o">|</span> <span class="o">|</span>   <span class="n">o</span><span class="o">-</span> <span class="n">portals</span> <span class="p">....................................................................................................</span> <span class="p">[</span><span class="nl">Portals</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span>     <span class="n">o</span><span class="o">-</span> <span class="mf">0.0.0.0</span><span class="o">:</span><span class="mi">3260</span> <span class="p">.....................................................................................................</span> <span class="p">[</span><span class="n">OK</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">iqn</span><span class="mf">.2015</span><span class="o">-</span><span class="mf">04.</span><span class="n">com</span><span class="p">.</span><span class="nl">example</span><span class="p">:</span><span class="n">target2</span> <span class="p">...................................................................................</span> <span class="p">[</span><span class="nl">TPGs</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span>   <span class="n">o</span><span class="o">-</span> <span class="n">tpg1</span> <span class="p">..................................................................................................</span> <span class="p">[</span><span class="n">gen</span><span class="o">-</span><span class="n">acls</span><span class="p">,</span> <span class="n">no</span><span class="o">-</span><span class="n">auth</span><span class="p">]</span>
  <span class="o">|</span>     <span class="n">o</span><span class="o">-</span> <span class="n">acls</span> <span class="p">..........................................................................................................</span> <span class="p">[</span><span class="nl">ACLs</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="o">|</span>     <span class="n">o</span><span class="o">-</span> <span class="n">luns</span> <span class="p">..........................................................................................................</span> <span class="p">[</span><span class="nl">LUNs</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span>     <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">lun0</span> <span class="p">...............................................................</span> <span class="p">[</span><span class="n">fileio</span><span class="o">/</span><span class="n">disk2</span> <span class="p">(</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libvirt</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">disk2</span><span class="p">.</span><span class="n">img</span><span class="p">)]</span>
  <span class="o">|</span>     <span class="n">o</span><span class="o">-</span> <span class="n">portals</span> <span class="p">....................................................................................................</span> <span class="p">[</span><span class="nl">Portals</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span>       <span class="n">o</span><span class="o">-</span> <span class="mf">0.0.0.0</span><span class="o">:</span><span class="mi">3260</span> <span class="p">.....................................................................................................</span> <span class="p">[</span><span class="n">OK</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">loopback</span> <span class="p">.........................................................................................................</span> <span class="p">[</span><span class="nl">Targets</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>


<span class="cp"># enable CHAP and Reverse CHAP (mutual) for both discovery and login authentication</span>

<span class="cp"># discovery authentication is enabled under the global iscsi node</span>

<span class="o">/&gt;</span> <span class="n">cd</span> <span class="o">/</span><span class="n">iscsi</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">discovery_auth</span> <span class="n">enable</span><span class="o">=</span><span class="mi">1</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">discovery_auth</span> <span class="n">userid</span><span class="o">=</span><span class="n">IncomingUser</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">discovery_auth</span> <span class="n">password</span><span class="o">=</span><span class="n">SomePassword1</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">discovery_auth</span> <span class="n">mutual_userid</span><span class="o">=</span><span class="n">OutgoingUser</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">discovery_auth</span> <span class="n">mutual_password</span><span class="o">=</span><span class="n">AnotherPassword2</span>

<span class="cp"># login authentication is enabled either under the TPG node or under ACLs</span>

<span class="o">/</span><span class="n">iscsi</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="n">iqn</span><span class="mf">.2015</span><span class="o">-</span><span class="mf">04.</span><span class="n">com</span><span class="p">.</span><span class="nl">example</span><span class="p">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">attribute</span> <span class="n">authentication</span><span class="o">=</span><span class="mi">1</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">auth</span> <span class="n">userid</span><span class="o">=</span><span class="n">IncomingUser2</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">auth</span> <span class="n">password</span><span class="o">=</span><span class="n">SomePassword3</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">auth</span> <span class="n">mutual_userid</span><span class="o">=</span><span class="n">OutgoingUser2</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">auth</span> <span class="n">mutual_password</span><span class="o">=</span><span class="n">AnotherPassword4</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="p">...</span><span class="o">:</span><span class="n">target1</span><span class="o">/</span><span class="n">tpg1</span><span class="o">&gt;</span> <span class="n">exit</span>
</pre></div>


<p>Hints:</p>
<ul>
<li>activating targetcli service at boot is mandatory, otherwise your configuration won’t be read after a reboot</li>
<li>if you type <code>cd</code> <em>targetcli</em> will display an interactive node tree</li>
<li>after configuration is saved you don't need to restart anything</li>
<li>the old <em>scsi-target-utils</em> doesn't support discovery authentication</li>
<li><em>targetcli</em> allows kernel memory to be shared as a block SCSI device via the
ramdisk backstore. It also supports "nullio" mode, which discards all writes, and returns all-zeroes for reads.</li>
<li>I'm having troubles configuring portals to listen both on any IPv4 addresses and any IPv6 addresses
the system has. I've still not figured that out entirely.</li>
</ul>
<p>For more information please read Chapter 25 from Red Hat's
<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/ch25.html">Storage Administration Guide</a>
or checkout
<a target="_blank" href="http://www.amazon.com/s/ref=as_li_ss_tl?_encoding=UTF8&camp=1789&creative=390957&field-keywords=red%20hat%20enterprise%20linux%207&linkCode=ur2&rh=n%3A283155%2Ck%3Ared%20hat%20enterprise%20linux%207&sprefix=red%20hat%20enterprise%20linux%207%2Cstripbooks%2C253&tag=atodorovorg-20&url=search-alias%3Dstripbooks&linkId=SI7U3LCMCMA4EZOM">Red Hat Enterprise Linux 7 books on Amazon</a><img src="https://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=ur2&o=1" width="1" height="1" border="0" style="border:none !important; margin:0px !important;" />.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 07 April 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/04/07/how-to-configure-iscsi-target-on-red-hat-enterprise-linux-7/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/03/16/mining-e-mail-identities-with-gravatar/" rel="bookmark" title="Permalink to Mining E-mail Identities with Gravatar">
                <h2 class="post-title">
                    Mining E-mail Identities with Gravatar
                </h2>
            </a>
                <p>Recently I've laid my hands on a list of little over 7000 email addresses.
This begs the question how much of them are still in use and what for ?</p>
<p>My data is not fresh so I've uploaded the list to Facebook and created a custom
audience. 2400 of 7129 addresses were recognized - 30% of these addresses are
on Facebook and easy to target! Need to figure out which ones. </p>
<p>I could have tried some sort of batch search combined with the custom audience
functionality but I didn't find an API for that and decided not to bother.
Instead I've opted for Gravatar.</p>
<div class="highlight"><span class="filename">gravatars.sh</span><pre><span class="c">#!/bin/bash</span>

<span class="k">while</span> <span class="nb">read </span>LINE<span class="p">;</span> <span class="k">do</span>
    <span class="nv">HASH</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> -n <span class="nv">$LINE</span> <span class="p">|</span> md5sum <span class="p">|</span> cut -f1 -d<span class="s1">&#39; &#39;</span><span class="sb">`</span>
    wget <span class="s2">&quot;http://gravatar.com/avatar/</span><span class="nv">$HASH</span><span class="s2">&quot;</span> -O <span class="s2">&quot;</span><span class="nv">$LINE</span><span class="s2">&quot;</span>
<span class="k">done</span> &lt; /dev/stdin
</pre></div>


<p>Feed <code>gravatars.sh</code> with the email list and it will download all images to the
current working directory and use the address as the file name. After 
<code>md5sum *@* | cut -f1 -d' ' | sort | uniq -c</code> I quickly noticed the following:</p>
<ul>
<li>4563 addresses have the <code>a1719586837f0fdac8835f74cf4ef04a</code> check-sum; These are
not found on Gravatar.</li>
<li>2400 addresses have the <code>d5fe5cbcc31cff5f8ac010db72eb000c</code> check-sum. These are
addresses which are registered with Gravatar but didn't bother to change the default
image.</li>
<li>166 remaining addresses, each with a different check-sum. These have their custom
pictures uploaded to Gravatar and probably much more actively used.</li>
</ul>
<p>A second check with Facebook reveals 900 out of these 2566 addresses were recognized.
This begs the question is Facebook showing incorrect stats or are there 1500 addresses
using Gravatar (or have used at some point) which are not on Facebook ?</p>
<p>At least some of the remaining 4000 addresses are still active and used to send emails.
Next I will be looking for ways to identify them. Any suggestions and comments are more
than welcome!</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 16 March 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/03/16/mining-e-mail-identities-with-gravatar/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/01/09/pedometer-bug-in-samsung-gear-fit-smartwatch/" rel="bookmark" title="Permalink to Pedometer Bug in Samsung Gear Fit Smartwatch">
                <h2 class="post-title">
                    Pedometer Bug in Samsung Gear Fit Smartwatch
                </h2>
            </a>
                <p><a style="float:left;display:inline-block;margin-right:10px;" href="http://www.amazon.com/gp/product/B00J4DY8RU/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=B00J4DY8RU&linkCode=as2&tag=atodorovorg-20&linkId=RNJGVYUTOOJFGWOU">
<img src="/images/samsung/gear_fit.jpg" />
</a>
<sub>
Image source <a href="http://pocketnow.com/2014/05/02/samsung-gear-fit-review-pre-buttal-video">Pocketnow</a>
<sub></p>
<p>Recently I've been playing around with a
<a href="http://www.amazon.com/gp/product/B00J4DY8RU/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=B00J4DY8RU&linkCode=as2&tag=atodorovorg-20&linkId=RNJGVYUTOOJFGWOU">Samsung Gear Fit</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=as2&o=1&a=B00J4DY8RU" width="1" height="1" border="0"  style="border:none !important; margin:0px !important;" />
and while the hardware seems good I'm a bit disapointed on the software side.
There is at least one bug which is clearly visible - <strong>pedometer counts calories twice
when it's on and exercise mode is started</strong>.</p>
<p>How to test:</p>
<ul>
<li>Start the <em>Pedometer</em> app and record any initial readings;</li>
<li>Walk a fixed distance and at the end record all readings;</li>
<li>Now go back to the <em>Exercise</em> app and select a <em>Walking</em>
exercise from the menu. Tap <em>Start</em>;</li>
<li>Walk back the same distance/road as before. At the end of the journey
stop the walking exercise and record all readings.</li>
</ul>
<p>Expected results:</p>
<p>At the end of the trip I expect to see roughly the same calories burned
for both directions.</p>
<p>Actual results:</p>
<p>The return trip counted twice as many calories compared to the forward trip.
Here's some actual data to prove it:</p>
<div class="highlight"><pre>+--------------------------+----------+----------------+---------+-------------+---------+
|                          | Initial  | Forward trip   |         | Return trip |         |
|                          | Readings | Pedometer only |  Delta  | Pedometer &amp; |  Delta  |
|                          |          |                |         | Exercise    |         |
+--------------------------+----------+----------------+---------+-------------+---------+
|              Total Steps | 14409 st | 14798 st       | 389 st  | 15246 st    | 448 st  |
+--------------------------+----------+----------------+---------+-------------+---------+
|           Total Distance | 12,19 km | 12,52 km       | 0,33 km | 12,90 km    | 0,38 km |
+--------------------------+----------+----------------+---------+-------------+---------+
| Cal burned via Pedometer |  731 Cal |  751 Cal       | 20 Cal  |  772 Cal    | 21 Cal  |
+--------------------------+----------+----------------+=========+-------------+=========+
| Cal burned via Exercise  |  439 Cal |  439 Cal       | 0       |  460 Cal    | 21 Cal  |
+--------------------------+----------+----------------+---------+-------------+=========+
|    Total calories burned | 1170 Cal | 1190 Cal       | 20 cal  | 1232 Cal    | 42 Cal  |
+--------------------------+----------+----------------+=========+-------------+=========+
</pre></div>


<p><strong>Note:</strong> Data values above were taken from Samsung's <em>S Health</em> app which is easier to work with
instead of the Gear Fit itself.</p>
<p>The problem is that both apps are accessing the sensor simultaneously and not aware of each other.
In theory it should be relatively easy to block access of one app while the other is running but
that may not be so easy to implement on the limited platform the Gear Fit is.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 09 January 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/01/09/pedometer-bug-in-samsung-gear-fit-smartwatch/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/01/07/2-barcode-related-bugs-in-myfitnesspal/" rel="bookmark" title="Permalink to 2 Barcode Related Bugs in MyFitnessPal">
                <h2 class="post-title">
                    2 Barcode Related Bugs in MyFitnessPal
                </h2>
            </a>
                <p><img alt="Barcode that fails to scan" src="/images/barcode/fail.jpg" title="Barcode that fails to scan" /></p>
<p><strong>Did you know that the popular <em>MyFitnessPal</em> application can't scan barcodes
printed on curved surfaces?</strong> The above barcode fails to scan because it is
printed on a metal can full of roasted almonds :). In contrast the
<em>Barcode Scanner</em> from <em>ZXing Team</em> understands it just fine. My bet is
<em>MyFitnessPal</em> uses less advanced barcode scanning library. Judging from
the visual clues in the app the issue is between 6 and 0 where white space is wider.</p>
<p><img alt="Barcode that scans fine" src="/images/barcode/pass.jpg" title="Barcode that scans fine" /></p>
<p>Despite being a bit blurry this second barcode is printed on a flat surface and
is understood by both <em>MyFitnessPal</em> and "ZXing Barcode Scanner".</p>
<p><strong>NOTE</strong> I get the same results regardless if I try to scan the actual barcode
printed on packaging, a picture from a mobile device screen or these two images
from the laptop screen.</p>
<p><strong>MyFitnessPal also has problems with duplicate barcodes!</strong> Barcodes are not unique
and many producers use the same code for multiple products. I've seen this in the
case of two different varieties of salami from the same manufacturer on the good end
and two different products produced across the world (eggs and popcorn) on the
extreme end.</p>
<p>Once the user scans their barcodes and establish that the existing information is
not correct they can <em>Create a Food</em> and update the calories database. This is then
synced back to MyFitnesPal servers and overrides any existing information. When the same
barcode is scanned for the second time only the new DB entry is visible.</p>
<p>How to reproduce:</p>
<ul>
<li>Scan an existing barcode and enter it to MFP database if not already there;</li>
<li>Scan the same barcode one more time and pretend the information is not correct;</li>
<li>Click the <em>Create a Food</em> button and fill-in the fields. For example use a
different food name to distinguish between the two database entries. Save!</li>
<li>From another device with different account (to verify information in DB)
scan the same barcode again. </li>
</ul>
<p>Actual results:
The last entered information is shown.</p>
<p>Expected results:
User is shown both DB records and can select between them.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 07 January 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/01/07/2-barcode-related-bugs-in-myfitnesspal/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2015/01/05/endless-loop-bug-candy-crush-saga-level-80/" rel="bookmark" title="Permalink to Endless Loop Bug in Candy Crush Saga Level 80">
                <h2 class="post-title">
                    Endless Loop Bug in Candy Crush Saga Level 80
                </h2>
            </a>
                <p>Happy new year everyone. During the holidays I've discovered several interesting
bugs which will be revealed in this blog. Starting today with a bug in the popular
game <em>Candy Crush Saga</em>.</p>
<p>In level 80 one teleport is still open but the chocolates are blocking the rest.
The game has ended but candies keep flowing through the teleport and the level doesn't exit.
My guess is that the game logic is missing a check whether or not it will go into an endless loop.</p>
<iframe width="560" height="315" src="//www.youtube.com/embed/haBepFwyaxY" frameborder="0" allowfullscreen></iframe>

<p>This bug seems to be generic for the entire game. It pops up also on
level 137 in the Owl part of the game (recorded by somebody else):</p>
<iframe width="420" height="315" src="//www.youtube.com/embed/6q1_LIdamqw" frameborder="0" allowfullscreen></iframe>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 05 January 2015
            </p>
<p>There are <a href="http://atodorov.org/blog/2015/01/05/endless-loop-bug-candy-crush-saga-level-80/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2014/12/22/blackberry-z10-is-killing-my-wifi-router/" rel="bookmark" title="Permalink to BlackBerry Z10 is Killing My WiFi Router">
                <h2 class="post-title">
                    BlackBerry Z10 is Killing My WiFi Router
                </h2>
            </a>
                <p>Few days ago I've resurrected my BlackBerry Z10 only to find out that it kills
my WiFi router shortly after connecting to the network.
It looks like many people are having the same problem with BlackBerry but most forum
threads don't offer a meaningful solution so I did some tests. </p>
<p>Everything works fine when WiFi mode is set to either 11bgn mixed or 11n only and
WiFi security is disabled.</p>
<p>When using WPA2/Personal security mode and AES encryption the problem occurs
regardless of which WiFi mode is used. There is another type of encryption called TKIP
but the device itself warns that this is not supported by the 802.11n specification
(all my devices use it anyway).</p>
<p>So to recap:
<strong>BlackBerry Z10 causes my TP-Link router to die if using WPA2/Personal security with
AES Encryption. Switching to open network with MAC address filtering works fine!</strong></p>
<p>I haven't had the time to upgrade the firmware of this router and see if the problem persists.
Most likely I'll just go ahead and flash it with OpenWRT.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 22 December 2014
            </p>
<p>There are <a href="http://atodorov.org/blog/2014/12/22/blackberry-z10-is-killing-my-wifi-router/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2014/11/19/speed-comparison-of-web-proxies-written-in-python-twisted-and-go/" rel="bookmark" title="Permalink to Speed Comparison of Web Proxies Written in Python Twisted and Go">
                <h2 class="post-title">
                    Speed Comparison of Web Proxies Written in Python Twisted and Go
                </h2>
            </a>
                <p>After I figured out that
<a href="/blog/2014/11/11/speeding-up-celery-backends-part-3/">Celery is rather slow</a>
I moved on to test another part of my environment - a web proxy server.
The test here compares two proxy 
<a href="https://gist.github.com/atodorov/666035d270d97d982cd5">implementations</a>
- one with Python Twisted,
the other in Go. The backend is a simple web server written in Go, which is
probably the fastest thing when it comes to serving HTML.</p>
<p>The test content is a snapshot of the front page of this blog taken few days ago.
The system is a standard Lenovo X220 laptop, with Intel Core i7 CPU, with 4 cores.
The measurement instrument is the popular wrk tool with a
<a href="/blog/2014/11/18/proxy-support-for-wrk-http-benchmarking-tool/">custom Lua script to redirect the requests through the proxy</a>.</p>
<p>All tests were repeated several times, only the best results are shown here.
I've taken time between the tests in order for all open TCP ports to close.
I've also observed the number of open ports (e.g. sockets) using <code>netstat</code>.</p>
<h2>Baseline</h2>
<p>Using wrk against the web server in Go yields around 30000 requests per second
with an average of 2000 TCP ports in use:</p>
<div class="highlight"><pre><span class="nv">$ </span>./wrk -c1000 -t20 -d30s http://127.0.0.1:8000/atodorov.html
Running 30s <span class="nb">test</span> @ http://127.0.0.1:8000/atodorov.html
  <span class="m">20</span> threads and <span class="m">1000</span> connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   304.43ms  518.27ms   1.47s    82.69%
    Req/Sec     1.72k     2.45k   17.63k    88.70%
  <span class="m">1016810</span> requests in 29.97s, 34.73GB <span class="nb">read</span>
<span class="nb">  </span>Non-2xx or 3xx responses: 685544
Requests/sec:  33928.41
Transfer/sec:      1.16GB
</pre></div>


<h2>Python Twisted</h2>
<p>The <a href="https://gist.github.com/atodorov/666035d270d97d982cd5">Twisted implementation</a>
performs at little over 1000 reqs/sec with an average TCP port use between 20000 and 30000:</p>
<div class="highlight"><pre>./wrk -c1000 -t20 -d30s http://127.0.0.1:8080 -s scripts/proxy.lua -- http://127.0.0.1:8000/atodorov.html
Running 30s test @ http://127.0.0.1:8080
  20 threads and 1000 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   335.53ms  117.26ms 707.57ms   64.77%
    Req/Sec   104.14     72.19   335.00     55.94%
  40449 requests in 30.02s, 3.67GB read
  Socket errors: connect 0, read 0, write 0, timeout 8542
  Non-2xx or 3xx responses: 5382
Requests/sec:   1347.55
Transfer/sec:    125.12MB
</pre></div>


<h2>Go proxy</h2>
<p>First I've run several 30 seconds tests and performance was around 8000 req/sec
with around 20000 ports used (most of them remain in TIME_WAIT state for a while).
Then I've modified <code>proxy.go</code> to make use of all available CPUs on the system and let
the test run for 5 minutes.</p>
<div class="highlight"><pre><span class="nv">$ </span>./wrk -c1000 -t20 -d300s http://127.0.0.1:9090 -s scripts/proxy.lua -- http://127.0.0.1:8000/atodorov.html
Running 5m <span class="nb">test</span> @ http://127.0.0.1:9090
  <span class="m">20</span> threads and <span class="m">1000</span> connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   137.22ms  437.95ms   4.45s    97.55%
    Req/Sec   669.54    198.52     1.71k    76.40%
  <span class="m">3423108</span> requests in 5.00m, 58.27GB <span class="nb">read</span>
<span class="nb">  </span>Socket errors: connect 0, <span class="nb">read </span>26, write 181, timeout 24268
  Non-2xx or 3xx responses: 2870522
Requests/sec:  11404.19
Transfer/sec:    198.78MB
</pre></div>


<p>Performance peaked at 10000 req/sec. TCP port usage initially rose to around 30000
but rapidly dropped and stayed around 3000. Both <code>webserver.go</code> and <code>proxy.go</code> were
printing the following messages on the console:</p>
<div class="highlight"><pre><span class="nt">2014</span><span class="o">/</span><span class="nt">11</span><span class="o">/</span><span class="nt">18</span> <span class="nt">21</span><span class="nd">:53:06</span> <span class="nt">http</span><span class="o">:</span> <span class="nt">Accept</span> <span class="nt">error</span><span class="o">:</span> <span class="nt">accept</span> <span class="nt">tcp</span> <span class="cp">[</span><span class="p">::</span><span class="cp">]</span><span class="nd">:9090</span><span class="o">:</span> <span class="nt">too</span> <span class="nt">many</span> <span class="nt">open</span> <span class="nt">files</span><span class="o">;</span> <span class="nt">retrying</span> <span class="nt">in</span> <span class="nt">1s</span>
</pre></div>


<h2>Conclusion</h2>
<p>There's no doubt that Go is blazingly fast compared to Python and I'm most likely to use it
further in my experiments. Still I didn't expect a 3x difference in performance from webserver vs. proxy.</p>
<p>Another thing that worries me is the huge number of open TCP ports which then drops and stays
consistent over time and the error messages from both webserver and proxy (maybe per process sockets limit).</p>
<p>At the moment I'm not aware of the internal workings of neither wrk, nor
Go itself, nor the goproxy library to make conclusion if this is a bad thing or expected.
I'm eager to hear what others think in the comments. Thanks!</p>
<h2>Update 2015-01-27</h2>
<p>I have retested with PyPy but on a different system so I'm giving all the test results
on it as well. <code>/proc/cpuinfo</code> says we have 16 x Intel(R) Xeon(R) CPU E5-2450L 0 @ 1.80GHz
CPUs. </p>
<p>Baseline - Go server:</p>
<div class="highlight"><pre><span class="nv">$ </span>./wrk -c1000 -t20 -d30s http://127.0.0.1:8000/atodorov.html
Running 30s <span class="nb">test</span> @ http://127.0.0.1:8000/atodorov.html
  <span class="m">20</span> threads and <span class="m">1000</span> connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    15.57ms   20.38ms 238.93ms   98.11%
    Req/Sec     3.55k     1.32k   15.91k    82.49%
  <span class="m">1980738</span> requests in 30.00s, 174.53GB <span class="nb">read</span>
<span class="nb">  </span>Socket errors: connect 0, <span class="nb">read </span>0, write 0, timeout 602
  Non-2xx or 3xx responses: 60331
Requests/sec:  66022.87
Transfer/sec:      5.82GB
</pre></div>


<p>Go proxy (30 sec):</p>
<div class="highlight"><pre><span class="nv">$ </span>./wrk -c1000 -t20 -d30s http://127.0.0.1:9090 -s scripts/proxy.lua -- http://127.0.0.1:8000/atodorov.html
Running 30s <span class="nb">test</span> @ http://127.0.0.1:9090
  <span class="m">20</span> threads and <span class="m">1000</span> connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    68.93ms  718.98ms  12.60s    99.58%
    Req/Sec     1.61k   784.01     4.83k    62.50%
  <span class="m">942757</span> requests in 30.00s, 32.16GB <span class="nb">read</span>
<span class="nb">  </span>Socket errors: connect 0, <span class="nb">read </span>26, write 0, timeout 3050
  Non-2xx or 3xx responses: 589940
Requests/sec:  31425.47
Transfer/sec:      1.07GB
</pre></div>


<p>Python proxy with <code>Twisted==14.0.2</code> and <code>pypy-2.2.1-2.el7.x86_64</code>:</p>
<div class="highlight"><pre><span class="nv">$ </span>./wrk -c1000 -t20 -d30s http://127.0.0.1:8080 -s scripts/proxy.lua -- http://127.0.0.1:8000/atodorov.html
Running 30s <span class="nb">test</span> @ http://127.0.0.1:8080
  <span class="m">20</span> threads and <span class="m">1000</span> connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   858.75ms    1.47s    6.00s    88.09%
    Req/Sec   146.39    104.83   341.00     54.18%
  <span class="m">85645</span> requests in 30.00s, 853.54MB <span class="nb">read</span>
<span class="nb">  </span>Socket errors: connect 0, <span class="nb">read </span>289, write 0, timeout 3297
  Non-2xx or 3xx responses: 76567
Requests/sec:   2854.45
Transfer/sec:     28.45MB
</pre></div>


<p><strong>Update 2015-01-27-2</strong></p>
<p>Python proxy with <code>Twisted==14.0.2</code> and <code>python-2.7.5-16.el7.x86_64</code>:</p>
<div class="highlight"><pre><span class="nv">$ </span>./wrk -c1000 -t20 -d30s http://127.0.0.1:8080 -s scripts/proxy.lua -- http://127.0.0.1:8000/atodorov.html
Running 30s <span class="nb">test</span> @ http://127.0.0.1:8080
  <span class="m">20</span> threads and <span class="m">1000</span> connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   739.64ms    1.58s   14.22s    96.18%
    Req/Sec    84.43     36.61   157.00     67.79%
  <span class="m">49173</span> requests in 30.01s, 701.77MB <span class="nb">read</span>
<span class="nb">  </span>Socket errors: connect 0, <span class="nb">read </span>240, write 0, timeout 2463
  Non-2xx or 3xx responses: 41683
Requests/sec:   1638.38
Transfer/sec:     23.38MB
</pre></div>


<p>As seen Go proxy is slower than the Go server by factor of 2.
Python proxy is slower by than the Go server by factor of 20.
These results are similar to previous ones so I don't think PyPy
makes any significant difference.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 19 November 2014
            </p>
<p>There are <a href="http://atodorov.org/blog/2014/11/19/speed-comparison-of-web-proxies-written-in-python-twisted-and-go/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2014/11/18/proxy-support-for-wrk-http-benchmarking-tool/" rel="bookmark" title="Permalink to Proxy Support for wrk HTTP Benchmarking Tool">
                <h2 class="post-title">
                    Proxy Support for wrk HTTP Benchmarking Tool
                </h2>
            </a>
                <p>Few times recently I've seen people using an HTTP benchmarking tool called
<a href="https://github.com/wg/wrk">wrk</a> and decided to give it a try. It is a very cool
instrument but didn't fit my use case perfectly. What I needed is to be able to
redirect the connection through a web proxy and measure how much the proxy
slows down things compared to hitting the web server directly with wrk.
In other words - how fast is the proxy server.</p>
<h2>How does a proxy work</h2>
<p>I've examined the source code of two proxies (one in Python and another one in Go)
and what happens is this:</p>
<ul>
<li>The proxy server starts listening to a TCP port</li>
<li>A client (e.g. the browser) sends the request using an absolute URL (GET http://example.com/about.html)</li>
<li>Instead of connecting directly to the web server behind example.com the client connects to the proxy</li>
<li>The proxy server does connect to example.com directly, reads the response and delivers it back to 
the client.</li>
</ul>
<h2>Proxy in wrk</h2>
<p>Luckily wrk supports the execution of Lua scripts so we can make a 
<a href="https://github.com/wg/wrk/pull/107">simple script</a> like this:</p>
<div class="highlight"><pre><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span>
    <span class="nx">target_url</span> <span class="o">=</span> <span class="nx">args</span><span class="cp">[</span><span class="mi">1</span><span class="cp">]</span> <span class="o">--</span> <span class="nx">proxy</span> <span class="nx">needs</span> <span class="nx">absolute</span> <span class="nx">URL</span>
<span class="nx">end</span>

<span class="nx">request</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">wrk</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="nx">target_url</span><span class="p">)</span>
<span class="nx">end</span>
</pre></div>


<p>Then update your command line to something like this:
    ./wrk [options] http://proxy:port -s proxy.lua -- http://example.com/about.html</p>
<p>This causes wrk to connect to our proxy server but instead issue GET requests for another URL.
Depending on how your proxy works you may need to add the <code>Host: example.com</code> header as well.
Now let's do some testing.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 18 November 2014
            </p>
<p>There are <a href="http://atodorov.org/blog/2014/11/18/proxy-support-for-wrk-http-benchmarking-tool/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2014/11/17/hackfmi-sms-delivery-powered-by-twilio/" rel="bookmark" title="Permalink to HackFMI SMS Delivery Powered by Twilio">
                <h2 class="post-title">
                    HackFMI SMS Delivery Powered by Twilio
                </h2>
            </a>
                <p>Ten days ago the regular <a href="http://hackfmi.com/">HackFMI</a> competition was held.
This year they tried sending SMS notifications to all participants which was powered
by <a href="http://twilio.com">Twilio</a> both in terms of infrastructure and cost.</p>
<p><strong>Twilio</strong> provided a <strong>20$ upgrade code</strong> valid in the next 6 months for all new accounts.
This was officially announced at the opening ceremony (although at the last possible time) of the
competition, however no teams decided to incorporate SMS/Voice into their games.
I'm a little disappointed by this fact.</p>
<p>In terms of software a simple <a href="https://github.com/atodorov/django-twilio-sms">Django app</a>
was used. It is by no means production ready but does the job and was quick to write.</p>
<p>A little over 300 messages were sent with number distribution as follows:</p>
<ul>
<li>Mtel - 166</li>
<li>Globul - 86</li>
<li>Vivacom - 50</li>
</ul>
<p>The total price for Mtel and Globul messages is roughly the same because sending
SMS to Globul via Twilio is as twice expensive. The total sums up to about 25 $.
HackFMI team used two accounts to send the messages - one using the provided
20$ upgrade code from Twilio and the second one was mine.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 17 November 2014
            </p>
<p>There are <a href="http://atodorov.org/blog/2014/11/17/hackfmi-sms-delivery-powered-by-twilio/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2014/11/11/speeding-up-celery-backends-part-3/" rel="bookmark" title="Permalink to Speeding Up Celery Backends, Part 3">
                <h2 class="post-title">
                    Speeding Up Celery Backends, Part 3
                </h2>
            </a>
                <p>In the second part of this article we've seen 
<a href="/blog/2014/11/07/speeding-up-celery-backends-part-2/">how slow Celery actually is</a>.
Now let's explore what happens inside and see if we can't speed things up.</p>
<p>I've used <a href="http://pycallgraph.slowchop.com/en/latest/">pycallgraph</a> to create
call graph visualizations of my application. It has the nice feature to also show
execution time and use different colors for fast and slow operations.</p>
<p>Full command line is:</p>
<div class="highlight"><pre>pycallgraph -v --stdlib --include ... graphviz -o calls.png -- ./manage.py celery_load_test
</pre></div>


<p>where the <code>--include</code> is used to limit the graph to a particular Python module(s).</p>
<h2>General findings</h2>
<p><img alt="call graph" src="/images/celery/general.png" title="call graph" /></p>
<ul>
<li>The first four calls is where most of the time is spent as seen on the picture. </li>
<li>As it seems most of the slow down comes from Celery itself, not the underlying messaging
transport Kombu (not shown on picture)</li>
<li><code>celery.app.amqp.TaskProducer.publish_task</code> takes half of the execution time of
<code>celery.app.base.Celery.send_task</code></li>
<li><code>celery.app.task.Task.delay</code> directly executes <code>.apply_async</code> and can be skipped if one
rewrites the code.</li>
</ul>
<h2>More findings</h2>
<p>In <code>celery.app.base.Celery.send_task</code> there is this block of code:</p>
<div class="highlight"><pre>349         with self.producer_or_acquire(producer) as P:
350             self.backend.on_task_call(P, task_id)
351             task_id = P.publish_task(
352                 name, args, kwargs, countdown=countdown, eta=eta,
353                 task_id=task_id, expires=expires,
354                 callbacks=maybe_list(link), errbacks=maybe_list(link_error),
355                 reply_to=reply_to or self.oid, **options
356             )
</pre></div>


<p><code>producer</code> is always None because delay() doesn't pass it as argument.
I've tried passing it explicitly to apply_async() as so:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">djapp.celery</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c"># app = debug_task._get_app() # if not defined in djapp.celery</span>
<span class="n">producer</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">amqp</span><span class="o">.</span><span class="n">producer_pool</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">debug_task</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">producer</span><span class="o">=</span><span class="n">producer</span><span class="p">)</span>
</pre></div>


<p>However this doesn't speedup anything. If we replace the above code block like this:</p>
<div class="highlight"><pre>349         with producer as P:
</pre></div>


<p>it blows up on the second iteration because producer and its channel is already None !?!</p>
<p>If you are unfamiliar with the with statement in Python please read
<a href="http://effbot.org/zone/python-with-statement.htm">this article</a>. In short the with statement is
a compact way of writing try/finally. The underlying <code>kombu.messaging.Producer</code> class does a
<code>self.release()</code> on exit of the with statement.</p>
<p>I also tried killing the with statement and using producer directly but with limited success. While
it was not released(was non None) on subsequent iterations the memory usage grew much more and there
wasn't any performance boost.</p>
<h2>Conclusion</h2>
<p>The with statement is used throughout both Celery and Kombu and I'm not at all sure if
there's a mechanism for keep-alive connections. My time constraints are limited and I'll probably
not spend anymore time on this problem soon.</p>
<p>Since my use case involves task producer and consumers on localhost I'll try to workaround the
current limitations by using Kombu directly 
(see <a href="https://gist.github.com/atodorov/2bc1fcd34531ad260ed7">this gist</a>) with a transport that
uses either a UNIX domain socket or a name pipe (FIFO) file.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 11 November 2014
            </p>
<p>There are <a href="http://atodorov.org/blog/2014/11/11/speeding-up-celery-backends-part-3/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2014/11/07/speeding-up-celery-backends-part-2/" rel="bookmark" title="Permalink to Speeding up Celery Backends, Part 2">
                <h2 class="post-title">
                    Speeding up Celery Backends, Part 2
                </h2>
            </a>
                <p>In the <a href="/blog/2014/11/05/speeding-up-celery-backends/">first part</a> of this
post I looked at a few celery backends and discovered they didn't meet my needs.
Why is the Celery stack slow? How slow is it actually?</p>
<h2>How slow is Celery in practice</h2>
<ul>
<li>Queue: 500`000 msg/sec</li>
<li>Kombu:  14`000 msg/sec</li>
<li>Celery:  2`000 msg/sec</li>
</ul>
<h2>Detailed test description</h2>
<p>There are three main components of the Celery stack: </p>
<ul>
<li>Celery itself</li>
<li>Kombu which handles the transport layer</li>
<li>Python Queue()'s underlying everything</li>
</ul>
<p>Using the <a href="https://gist.github.com/atodorov/2bc1fcd34531ad260ed7">Queue and Kombu tests</a>
run for 1 000 000 messages I got the following results:</p>
<ul>
<li>Raw Python Queue: Msgs per sec: 500`000</li>
<li>Raw Kombu without Celery where <code>kombu/utils/__init__.py:uuid()</code> is set to return 0<ul>
<li>with json serializer: Msgs per sec: 5`988</li>
<li>with pickle serializer: Msgs per sec: 12`820</li>
<li>with the custom mem_serializer from <a href="/blog/2014/11/05/speeding-up-celery-backends/">part 1</a>:
Msgs per sec: 14`492</li>
</ul>
</li>
</ul>
<p><strong>Note:</strong> when the test is executed with 100K messages mem_serializer yielded
25`000 msg/sec then the performance is saturated. I've observed similar behavior 
with raw Python Queue()'s. I saw some cache buffers being managed internally to avoid OOM
exceptions. This is probably the main reason performance becomes saturated over a longer
execution.</p>
<ul>
<li>Using <a href="https://gist.github.com/atodorov/0156cc41491a5e1ff953">celery_load_test.py</a> modified to
loop 1 000 000 times I got 1908.0 tasks created per sec.</li>
</ul>
<p>Another interesting this worth outlining - in the kombu test there are these lines:</p>
<div class="highlight"><pre>with producers[connection].acquire(block=True) as producer:
    for j in range(1000000):
</pre></div>


<p>If we swap them the performance drops down to 3875 msg/sec which is comparable with the
Celery results. Indeed inside Celery there's the same <code>with producer.acquire(block=True)</code>
construct which is executed every time a new task is published. Next I will be looking 
into this to figure out exactly where the slowliness comes from.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Fri 07 November 2014
            </p>
<p>There are <a href="http://atodorov.org/blog/2014/11/07/speeding-up-celery-backends-part-2/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2014/11/05/speeding-up-celery-backends/" rel="bookmark" title="Permalink to Speeding up Celery Backends, Part 1">
                <h2 class="post-title">
                    Speeding up Celery Backends, Part 1
                </h2>
            </a>
                <p>I'm working on an application which fires a lot of Celery tasks - the more
the better! Unfortunately Celery backends seem to be rather slow :(.
Using the <a href="https://gist.github.com/atodorov/0156cc41491a5e1ff953">celery_load_test.py</a>
command for Django I was able to capture some metrics:</p>
<ul>
<li>Amazon SQS backend: 2 or 3 tasks/sec</li>
<li>Filesystem backend: 2000 - 2500 tasks/sec</li>
<li>Memory backend: around 3000 tasks/sec</li>
</ul>
<p>Not bad but I need in the order of 10000 tasks created per sec!
The other noticeable thing is that memory backend isn't much faster compared to
the filesystem one! NB: all of these backends actually come from the kombu package.</p>
<h2>Why is Celery slow ?</h2>
<p>Using <code>celery_load_test.py</code> together with 
<a href="/blog/2014/11/05/performance-profiling-in-python-with-cprofile/">cProfile</a> I
was able to pin-point some problematic areas:</p>
<ul>
<li>
<p><code>kombu/transports/virtual/__init__.py</code>: class Channel.basic_publish() - does
self.encode_body() into base64 encoded string. Fixed with custom transport backend
I called fastmemory which redefines the body_encoding property:</p>
<div class="highlight"><pre><span class="nd">@cached_property</span>
<span class="k">def</span> <span class="nf">body_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">None</span>
</pre></div>


</li>
<li>
<p>Celery uses json or pickle (or other) serializers to serialize the data.
While json yields between 2000-3000 tasks/sec, pickle does around 3500 tasks/sec.
Replacing with a custom serializer which just returns
the objects (since we read/write from/to memory) yields about 4000 tasks/sec tops:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">kombu.serialization</span> <span class="kn">import</span> <span class="n">register</span>

<span class="k">def</span> <span class="nf">loads</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="k">def</span> <span class="nf">dumps</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="n">register</span><span class="p">(</span><span class="s">&#39;mem_serializer&#39;</span><span class="p">,</span> <span class="n">dumps</span><span class="p">,</span> <span class="n">loads</span><span class="p">,</span>
        <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;application/x-memory&#39;</span><span class="p">,</span>
        <span class="n">content_encoding</span><span class="o">=</span><span class="s">&#39;binary&#39;</span><span class="p">)</span>
</pre></div>


</li>
<li>
<p><code>kombu/utils/__init__.py</code>: def uuid() - generates random unique identifiers
which is a slow operation. Replacing it with <code>return "00000000"</code> boosts performance
to 7000 tasks/sec.</p>
</li>
</ul>
<p>It's clear that a constant UUID is not of any practical use but serves well to illustrate
how much does this function affect performance. </p>
<p><strong>Note:</strong>
Subsequent executions of <code>celery_load_test</code> seem to report degraded performance even with
the most optimized transport backend. I'm not sure why is this. One possibility is the random
UUID usage in other parts of the Celery/Kombu stack which drains entropy on the system and
generating more random numbers becomes slower. If you know better please tell me!</p>
<p>I will be looking for a better understanding
of these IDs in Celery and hope to be able to produce a faster uuid() function. Then I'll be
exploring the transport stack even more in order to reach the goal of 10000 tasks/sec.
If you have any suggestions or pointers please share them in the comments.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 05 November 2014
            </p>
<p>There are <a href="http://atodorov.org/blog/2014/11/05/speeding-up-celery-backends/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2014/11/05/performance-profiling-in-python-with-cprofile/" rel="bookmark" title="Permalink to Performance Profiling in Python with cProfile">
                <h2 class="post-title">
                    Performance Profiling in Python with cProfile
                </h2>
            </a>
                <p>This is a quick reference on profiling Python applications with
<a href="https://docs.python.org/2/library/profile.html#module-cProfile">cProfile</a>:</p>
<div class="highlight"><pre><span class="nv">$ </span>python -m cProfile -s <span class="nb">time </span>application.py
</pre></div>


<p>The output is sorted by execution time <code>-s time</code></p>
<div class="highlight"><pre>     <span class="mi">9072842</span> <span class="kd">function</span> <span class="nx">calls</span> <span class="p">(</span><span class="mi">8882140</span> <span class="nx">primitive</span> <span class="nx">calls</span><span class="p">)</span> <span class="k">in</span> <span class="mf">9.830</span> <span class="nx">CPU</span> <span class="nx">seconds</span>

   <span class="nx">Ordered</span> <span class="nx">by</span><span class="o">:</span> <span class="nx">internal</span> <span class="nx">time</span>

   <span class="nx">ncalls</span>  <span class="nx">tottime</span>  <span class="nx">percall</span>  <span class="nx">cumtime</span>  <span class="nx">percall</span> <span class="nx">filename</span><span class="o">:</span><span class="nx">lineno</span><span class="p">(</span><span class="kd">function</span><span class="p">)</span>
    <span class="mi">61868</span>    <span class="mf">0.575</span>    <span class="mf">0.000</span>    <span class="mf">0.861</span>    <span class="mf">0.000</span> <span class="kr">abstract</span><span class="p">.</span><span class="nx">py</span><span class="o">:</span><span class="mi">28</span><span class="p">(</span><span class="nx">__init__</span><span class="p">)</span>
    <span class="mi">41250</span>    <span class="mf">0.527</span>    <span class="mf">0.000</span>    <span class="mf">0.660</span>    <span class="mf">0.000</span> <span class="nx">uuid</span><span class="p">.</span><span class="nx">py</span><span class="o">:</span><span class="mi">101</span><span class="p">(</span><span class="nx">__init__</span><span class="p">)</span>
    <span class="mi">61863</span>    <span class="mf">0.405</span>    <span class="mf">0.000</span>    <span class="mf">1.054</span>    <span class="mf">0.000</span> <span class="kr">abstract</span><span class="p">.</span><span class="nx">py</span><span class="o">:</span><span class="mi">40</span><span class="p">(</span><span class="nx">as_dict</span><span class="p">)</span>
    <span class="mi">41243</span>    <span class="mf">0.343</span>    <span class="mf">0.000</span>    <span class="mf">1.131</span>    <span class="mf">0.000</span> <span class="nx">__init__</span><span class="p">.</span><span class="nx">py</span><span class="o">:</span><span class="mi">143</span><span class="p">(</span><span class="nx">uuid4</span><span class="p">)</span>
   <span class="mi">577388</span>    <span class="mf">0.338</span>    <span class="mf">0.000</span>    <span class="mf">0.649</span>    <span class="mf">0.000</span> <span class="kr">abstract</span><span class="p">.</span><span class="nx">py</span><span class="o">:</span><span class="mi">46</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">genexpr</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="mi">20622</span>    <span class="mf">0.289</span>    <span class="mf">0.000</span>    <span class="mf">8.824</span>    <span class="mf">0.000</span> <span class="nx">base</span><span class="p">.</span><span class="nx">py</span><span class="o">:</span><span class="mi">331</span><span class="p">(</span><span class="nx">send_task</span><span class="p">)</span>
    <span class="mi">61907</span>    <span class="mf">0.232</span>    <span class="mf">0.000</span>    <span class="mf">0.477</span>    <span class="mf">0.000</span> <span class="nx">datastructures</span><span class="p">.</span><span class="nx">py</span><span class="o">:</span><span class="mi">467</span><span class="p">(</span><span class="nx">__getitem__</span><span class="p">)</span>
    <span class="mi">20622</span>    <span class="mf">0.225</span>    <span class="mf">0.000</span>    <span class="mf">9.298</span>    <span class="mf">0.000</span> <span class="nx">task</span><span class="p">.</span><span class="nx">py</span><span class="o">:</span><span class="mi">455</span><span class="p">(</span><span class="nx">apply_async</span><span class="p">)</span>
    <span class="mi">61863</span>    <span class="mf">0.218</span>    <span class="mf">0.000</span>    <span class="mf">2.502</span>    <span class="mf">0.000</span> <span class="kr">abstract</span><span class="p">.</span><span class="nx">py</span><span class="o">:</span><span class="mi">52</span><span class="p">(</span><span class="nx">__copy__</span><span class="p">)</span>
    <span class="mi">20621</span>    <span class="mf">0.208</span>    <span class="mf">0.000</span>    <span class="mf">4.766</span>    <span class="mf">0.000</span> <span class="nx">amqp</span><span class="p">.</span><span class="nx">py</span><span class="o">:</span><span class="mi">208</span><span class="p">(</span><span class="nx">publish_task</span><span class="p">)</span>
   <span class="mi">462640</span>    <span class="mf">0.193</span>    <span class="mf">0.000</span>    <span class="mf">0.247</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="nx">isinstance</span><span class="p">}</span>
   <span class="mi">515525</span>    <span class="mf">0.162</span>    <span class="mf">0.000</span>    <span class="mf">0.193</span>    <span class="mf">0.000</span> <span class="kr">abstract</span><span class="p">.</span><span class="nx">py</span><span class="o">:</span><span class="mi">41</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
    <span class="mi">41246</span>    <span class="mf">0.153</span>    <span class="mf">0.000</span>    <span class="mf">0.633</span>    <span class="mf">0.000</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">py</span><span class="o">:</span><span class="mi">143</span><span class="p">(</span><span class="nx">__init__</span><span class="p">)</span>
</pre></div>


<p>In the example above (actual application) first line is kombu's
<code>abstract.py: class Object(object).__init__()</code>
and the second one is Python's
<code>uuid.py: class UUID().__init__()</code>.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Wed 05 November 2014
            </p>
<p>There are <a href="http://atodorov.org/blog/2014/11/05/performance-profiling-in-python-with-cprofile/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2014/10/14/mtel-fuck-up-online-invoices/" rel="bookmark" title="Permalink to How Mtel, the Biggest Mobile Operator in Bulgaria, Fucked-Up Their Online Invoice System">
                <h2 class="post-title">
                    How Mtel, the Biggest Mobile Operator in Bulgaria, Fucked-Up Their Online Invoice System
                </h2>
            </a>
                <p>Prompted by <a href="http://radorado.me/">Rado's</a> post about
<a href="https://www.facebook.com/radorado.radoslav.georgiev/posts/10204276374941470">Mtel not fixing a business customer Internet connection</a>
I want to tell you a story about how the big company totally fucked up their
online invoice system and give you a few more hints about how stupidity
reigns supreme even in big companies, especially in Bulgaria.</p>
<p>I've never received a paper invoice for my phone bill and used the website to access any information
about my bills and calls duration, etc. The problem is that I ported my number to another operator.</p>
<p><strong>Porting a number away from Mtel automatically cuts access to your previous invoices online</strong></p>
<h2>The problem in technical terms</h2>
<p>This is a tech blog so let's be technical. Users can register at Mtel's website via
username and password. If they are customers then they can add their numbers to their
profile. Once the number is verified (via SMS code), the user has access to additional services
one of which is online invoices and monthly usage reports.</p>
<p>Migrating away to another operator "erases" your number from the system but
this is not true actually. All the information is still there because they can give me
print outs if I pay all the extra fees and simply because no business will voluntarily
erase their database records.</p>
<p><strong>The genius who designed the <em>if-number-migrated-then-delete-from-user-profile-and-cut-off-access</em>
business process/software implementation is the biggest idiot in the world.</strong></p>
<h2>How Mtel handled my complaint</h2>
<p>My request for
explanation (see below) was answered with a nice letter, basically telling me to piss off. None of my
questions were answered. To make things worse they want to charge extra fees for detailed print outs. </p>
<p>What I've asked for:</p>
<ul>
<li>To be granted access back to all of my invoices online. Not only I paid for them but this
is something of a personal information;</li>
<li>To be given copies of my last 5 invoices, preferably via email;</li>
<li>To be given explanation why my online access to previous invoices was cut off;</li>
<li>Mtel to stop doing this and allow access to online invoices for everyone of their past
or current customers;</li>
</ul>
<p>I've also told them I'm available to help them fix their system if they don't have
the resources to do so (hint, hint: it's an if-then condition or something very close I bet).</p>
<p>A copy of my complaint and the response to it (in Bulgarian only):</p>
<p><img alt="&quot;Complaint&quot;" src="/images/mtel/complaint_01.jpg" title="Complaint" />
<img alt="&quot;Complaint&quot;" src="/images/mtel/complaint_01.jpg" title="Complaint" />
<img alt="&quot;Response&quot;" src="/images/mtel/response.jpg" title="Response" /></p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 14 October 2014
            </p>
<p>There are <a href="http://atodorov.org/blog/2014/10/14/mtel-fuck-up-online-invoices/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2014/10/13/shutdown-your-startup-in-7-steps/" rel="bookmark" title="Permalink to Shutdown Your Startup in 7 Steps">
                <h2 class="post-title">
                    Shutdown Your Startup in 7 Steps
                </h2>
            </a>
                <p>A month ago one of my startups Difio stopped working forever.
This is the story of how to go about shutting down a working
web service and not about why it came around to this.</p>
<h2>Step #1: Disable new registrations</h2>
<p>You obviously need to make sure new customers
arriving at your web site will not sing up to only find the service is
shutting down later.</p>
<p>Disable whatever sign-on/registration system you have in place
but leave currently registered users to login as they wish.</p>
<h2>Step #2: Disable payments</h2>
<p>Difio had paying customers, just not enough of them and it was based on
a subscription model which was automatically renewed without any interaction
from the customer.</p>
<p>The first thing I did was to disable all payments for the service which
was quite easy (just a few comments) because Difio used an external payment
processor.</p>
<p>Next thing was to go through all subscriptions that were still active and
cancel them. This prevented the payment processor to automatically charge
the customers next time their subscription renewal was due.</p>
<p>Because all subscriptions were charged in advance and when canceled were
still considered active (due to expire at some later date) Difio had to
keep operating at least one month after all subscriptions have been canceled.</p>
<h2>Step #3: Notify all customers that you are shutting down</h2>
<p>I scheduled this to happen right after the last subscription was canceled.
An email to everyone who registered to the website and a blog post should work
for most startups. See ours <a href="http://www.dif.io/blog/2014/08/10/difio-is-shutting-down/">here</a>.</p>
<p>Make sure to provide a gratis period if necessary. Difio had a gratis period
of one month after the shutdown announcement.</p>
<h2>Step #4: Disable all external triggers</h2>
<p>Difio was a complex piece of software which relied on external triggers like
web hooks and repetitive tasks executed by cron.</p>
<p>Disabling these will prevent external services or hosting providers 
getting errors about your URLs not being accessible. It is just polite
to do so. </p>
<p>You may want to keep these still operational during the gratis period
before the physical shutdown or disable them straight away. In Difio's
case they were left operational because there were customers who have paid
in advance and relied on this functionality.</p>
<h2>Step #5: Prepare your 'Service Disabled' banner</h2>
<p>You will probably want to let people know why something isn't working
as it used (or is expected) to be. A simple page explaining that
you're going to shut down should be enough. </p>
<p>Difio required the user to be logged in to see most of the website.
This made it very easy to redirect everything to the same page.
A few more places were linking to public URLs which were manually rewritten
to point to the same 'Service Disabled' page.</p>
<p>It is the same page used previously to redirect new registrations to.</p>
<h2>Step #6: Terminate all processing resources</h2>
<p>Difio used both AWS EC2 instances and an OpenShift PaaS instance to do its
processing. Simply terminating all of them was enough. The only thing left
is a couple of static HTML pages behind the domain.</p>
<h2>Step #7: Database archival</h2>
<p>The last thing you need to do is archive your database. Although the
startup is out of business already you have gathered additional information
which may come handy at a later time.</p>
<p>Difio didn't collect any personal information about its users, except email
and didn't store financial information either. This made it safe to just make
a backup of the database and leave it lurking around on disk. </p>
<p>However beware 
if you have collected personal and/or financial information from your customers.
You may want to erase/anonymize some of it before doing your backups and
probably safeguard them from unauthorized access.</p>
<p>That's it, your startup is officially dead now! Let me know if I've missed 
something in the comments below.</p>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Mon 13 October 2014
            </p>
<p>There are <a href="http://atodorov.org/blog/2014/10/13/shutdown-your-startup-in-7-steps/#disqus_thread">comments</a>.</p>        </div>
        <div class="post-preview">
            <a href="http://atodorov.org/blog/2014/09/30/traction-a-startup-guide-to-getting-customers/" rel="bookmark" title="Permalink to Traction: A Startup Guide to Getting Customers">
                <h2 class="post-title">
                    Traction: A Startup Guide to Getting Customers
                </h2>
            </a>
                <blockquote>
<p>Many entrepreneurs who build great products simply don't have a good distribution strategy.</p>
<p>Mark Andreessen, venture capitalist</p>
</blockquote>
<p><a href="http://www.amazon.com/gp/product/B00N06Y2DW/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=B00N06Y2DW&linkCode=as2&tag=atodorovorg-20&linkId=4GDHEYN66CPL7L72">Traction: A Startup Guide to Getting Customers</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=as2&o=1&a=B00N06Y2DW" width="1" height="1" border="0"  style="border:none !important; margin:0px !important;" />
introduces startup founders and employees to the "Bullseye Framework," 
a five-step process successful companies use to get traction. 
This framework helps founders find the marketing channel that will be key to unlocking the next stage of growth. </p>
<p>Too often, startups building a product struggle with traction once they launch. 
This struggle has startups trying random tactics - some ads, a blog post or two - in an unstructured way that leads to failure. 
Traction shows readers how to systematically approach marketing, and covers how successful businesses have grown through each of
the following 19 channels:</p>
<ul>
<li>Viral Marketing</li>
<li>Public Relations (PR)</li>
<li>Unconventional PR</li>
<li>Search Engine Marketing (SEM)</li>
<li>Social and Display Ads</li>
<li>Offline Ads</li>
<li>Search Engine Optimization (SEO)</li>
<li>Content Marketing</li>
<li>Email Marketing</li>
<li>Engineering as Marketing</li>
<li>Target Market Blogs</li>
<li>Business Development (BD)</li>
<li>Sales</li>
<li>Affiliate Programs</li>
<li>Existing Platforms</li>
<li>Trade Shows</li>
<li>Offline Events</li>
<li>Speaking Engagements</li>
<li>Community Building </li>
</ul>
<p>The book is very easy to read and full of practical advice which should serve as a starting point and give you
more ideas how to approach a particular distribution channel. It took me two days to read and 
I already had some ideas to test even before reading the whole of it. My next steps are to apply the principles
to my current startup <a href="http://obuvki41plus.com">Obuvki 41 Plus</a> and a future one I have in mind.</p>
<p>To anyone building a startup of any kind I would recommend the following selection of books:</p>
<ul>
<li><a href="http://www.amazon.com/gp/product/1591847788/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=1591847788&linkCode=as2&tag=atodorovorg-20&linkId=IR465SOS3KA4BJLF">Hooked: How to Build Habit-Forming Products</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=as2&o=1&a=1591847788" width="1" height="1" border="0"  style="border:none !important; margin:0px !important;" /> - 
to learn how to make products (especially mobile apps) that customers keep using on their own without
additional external marketing (<a href="/blog/2014/01/28/book-review-january-2014/">review here</a>)</li>
<li><a href="http://www.amazon.com/gp/product/1449334911/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=1449334911&linkCode=as2&tag=atodorovorg-20&linkId=MHLGJPMJDO4FJDQB">UX for Lean Startups</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=as2&o=1&a=1449334911" width="1" height="1" border="0"  style="border:none !important; margin:0px !important;" /> -
lean product development (<a href="/blog/2013/12/09/book-review-ux-for-lean-startups/">review here</a>)</li>
<li><a href="http://www.amazon.com/gp/product/B00N06Y2DW/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=B00N06Y2DW&linkCode=as2&tag=atodorovorg-20&linkId=AYMPCBH4MP5PC6G5">Traction: A Startup Guide to Getting Customers</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=as2&o=1&a=B00N06Y2DW" width="1" height="1" border="0"  style="border:none !important; margin:0px !important;" /> -
customer growth development</li>
</ul>
<p>Start reading right now (and also support this blog) by following the links below: </p>
<iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=ss_til&ad_type=product_link&tracking_id=atodorovorg-20&marketplace=amazon&region=US&placement=1591847788&asins=1591847788&linkId=SXJNPAOV2J4SKU4G&show_border=true&link_opens_in_new_window=true">
</iframe>

<iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=ss_til&ad_type=product_link&tracking_id=atodorovorg-20&marketplace=amazon&region=US&placement=1449334911&asins=1449334911&linkId=7UM2YUNUK5UNVPSI&show_border=true&link_opens_in_new_window=true">
</iframe>

<iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=ss_til&ad_type=product_link&tracking_id=atodorovorg-20&marketplace=amazon&region=US&placement=B00N06Y2DW&asins=B00N06Y2DW&linkId=WS2AWWLBNFAFA5PO&show_border=true&link_opens_in_new_window=true">
</iframe>
            <p class="post-meta">Posted by
                    <a href="http://atodorov.org/author/alexander-todorov.html">Alexander Todorov</a>
                 on Tue 30 September 2014
            </p>
<p>There are <a href="http://atodorov.org/blog/2014/09/30/traction-a-startup-guide-to-getting-customers/#disqus_thread">comments</a>.</p>        </div>

    <hr>
    <!-- Pager -->
    <ul class="pager">
        <li class="next">
                <a href="http://atodorov.org/index8.html">Older Posts &rarr;</a>
                <a href="http://atodorov.org/index6.html"> &larr; Newest Posts</a>
        </li>
    </ul>
    Page 7 / 15
    <hr>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/atodorov_">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/atodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://bg.linkedin.com/in/alextodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://feeds.feedburner.com/atodorov">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.youtube.com/playlist?list=PLFjlI7p-h1hxBP3cIjEqePSeoBDHud5Db">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-youtube fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://amzn.to/1ivu2q4">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-amazon fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://mrsenko.com/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=social_icon">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-user-secret fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<section>
    <p>
        I am a Senior QA contractor at Red Hat responsible for finding over
        <a href="/blog/2014/02/19/7-years-1400-bugs-red-hat-qa/">1600 bugs</a>,
        Red Hat Certified professional, cloud hacker and a general purpose
        open source developer! I am the maintainer of
        <a href="http://kiwitcms.org/?utm_source=atodorov.org&utm_medium=blog&utm_campaign=footer">Kiwi TCMS</a>!
    </p>
    <p>
        I am living in the <a href="http://planet.sofiavalley.com">Sofia Valley</a>
        which is emerging as a busy place for start-up founders and tech enthusiasts
        in Eastern Europe! You can find more about me <a href="/blog/2013/01/25/about-me/">here</a>.
    </p>
    <p>
        <small>
            <em>
                Some of the links contained within this site have my referral id (e.g.,
                <a target="_blank" href="http://www.amazon.com/ref=as_li_ss_tl?_encoding=UTF8&camp=1789&creative=390957&linkCode=ur2&tag=atodorovorg-20&linkId=L6Q34XAXQS5RDMOY">Amazon</a><img src="https://ir-na.amazon-adsystem.com/e/ir?t=atodorovorg-20&l=ur2&o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />),
                which provides me with a small commission for each sale. Thank you for your support.
            </em>
        </small>
    </p>
</section>

<form action="http://google.com/search" method="get" style="width:300px;margin:0 auto;">
    <fieldset role="search">
        <input type="hidden" name="sitesearch" value="http://atodorov.org" />
        <input class="search" type="text" name="q" placeholder="Search" style="width:100%"/>
    </fieldset>
</form>

<p class="copyright text-muted">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">CC-BY-SA</a> &amp;
    <a rel="license" href="http://opensource.org/licenses/MIT">MIT</a>
    2011-2016 &diams; Alexander Todorov &diams;
    <a href="http://planet.sofiavalley.com">SofiaValley Blog</a>
</p>

<script type='text/javascript'>
window.__lo_site_id = 55936;
    (function() {
        var wa = document.createElement('script'); wa.type = 'text/javascript'; wa.async = true;
        wa.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://cdn') + '.luckyorange.com/w.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(wa, s);
      })();
</script>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="http://atodorov.org/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="http://atodorov.org/theme/js/bootstrap.min.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37979549-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'atodorov';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>